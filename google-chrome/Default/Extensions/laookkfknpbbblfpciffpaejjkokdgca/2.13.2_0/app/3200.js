"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[3200,5711],{85711:(t,e,o)=>{o.r(e),o.d(e,{default:()=>h});var i=o(30512),c=o(31624),M=o(64438),a=o(67652);const s=new M.Z("tab.focus.emptySave",.01),u=new(i.Z.extend({name:"FocusDataService",mixins:[c.X],unreactive:()=>({type:"focus",mode:localStorage.getItem("token")?a.Z.Sync:a.Z.Cache}),defaultPath:"focus",methods:{add(t,e){return e.focus?c.X.methods.add.apply(this,arguments):(s.info("Focus data service add with no focus",{userUuid:localStorage.getItem("userId"),stackTrace:m.utils.getStackTrace()}),Promise.reject())}}}));var d=o(2770);const g=i.Z.extend({name:"FocusModel",mixins:[d.Z],data:()=>({id:null,archived:!1,completed:!1,createdDate:m.now(),focus:null,forDate:null,todoId:null,props:["focus","completed","archived","forDate","createdDate","todoId"]}),methods:{updateData(t){d.Z.methods.updateData.call(this,t),this.completed=!!t.completed}}});var n=o(94234),N=o(20144),D=o(40531);const l=new(N.ZP.extend({name:"AutoFocusManager",data:()=>({activeFocus:null,loaded:!1}),computed:{autoFocusEnabled:()=>D.ax.autoFocus&&m.conditionalFeatures.featureEnabled("pinfocus")},watch:{autoFocusEnabled:{handler(t){t?this.getTopTodo().then((t=>this.activeFocus=this.createFocusFromTodo(t))):this.activeFocus=null},immediate:!0},"activeFocus.focus"(t){this.activeFocus&&m.trigger("todo:set:title",this.activeFocus.todoId,t)}},created(){m.on("todo:globalChange",this.onTodoChange),m.on("todo:loadingStateChange",this.onLoadingStateChange),m.on("todo:activeListLoaded",this.setLoaded),this.getInitialLoadedState()},destroyed(){m.off("todo:globalChange",this.onTodoChange),m.off("todo:loadingStateChange",this.onLoadingStateChange),m.off("todo:activeListLoaded",this.setLoaded)},methods:{getInitialLoadedState(){return m.widgetManager.getWidgetAsync("todo").then((t=>{var e,o;"Done"===(null===(e=t.manager.activeProvider.selectedList())||void 0===e||null===(o=e.itemCollection)||void 0===o?void 0:o.listStatus)&&(this.loaded=!0)}))},setLoaded(){this.loaded=!0},toggleComplete(){this.activeFocus&&(this.activeFocus.completed=!this.activeFocus.completed,m.trigger("todo:set:done",this.activeFocus.todoId,this.activeFocus.completed))},onLoadingStateChange(){this.autoFocusEnabled&&this.getTopTodo().then((t=>{var e;!t||this.activeFocus&&(t.get("id")||t.id)===this.activeFocus.todoId?t||null!==(e=this.activeFocus)&&void 0!==e&&e.completed||(this.activeFocus=null):this.activeFocus=this.createFocusFromTodo(t)}))},getTopTodo:()=>m.widgetManager.getWidgetAsync("todo").then((t=>t.getTopTodo())),onTodoChange(...t){var e,o,i;const c=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.autoFocusEnabled||null==c||!c.changed||!Object.keys(c.changed).length||!1===(null===(e=c.changed)||void 0===e?void 0:e.isLoading))return;const M=(null===(o=c.changed)||void 0===o?void 0:o.completedDate)||(null===(i=c.changed)||void 0===i?void 0:i.modifiedServer);this.getTopTodo().then((t=>{var e,o;t?this.activeFocus=this.createFocusFromTodo(t):null!==(e=this.activeFocus)&&void 0!==e&&e.todoId&&(c.get("id")||c.id).includes(null===(o=this.activeFocus)||void 0===o?void 0:o.todoId)&&(this.activeFocus.completed=c.get("done"),M||(this.activeFocus=null))}))},createFocusFromTodo(t){if(!t)return null;let e=new g;return e.updateData({focus:t.get("title"),archived:!1,completed:t.get("done"),createdDate:m.now(),id:m.utils.uuidv4(),todoId:t.get("id")||t.id,forDate:m.utils.getDateString()}),e}}}));var j=o(81405);const h=new(i.Z.extend({name:"FocusCollection",mixins:[n.FZ,n.mX],unreactive:()=>({type:"focus",Model:g,dataService:u,newModel:null,analytics:new j.ZP({feature:"focus"})}),computed:{emptyFocus(){return!this.activeFocus.focus},activeFocusInCollection(){const t=m.utils.getDateString(),e=Object.values(this.data.items).filter((e=>!e.archived&&e.forDate===t)).sort(((t,e)=>e.createdDate-t.createdDate));return e.length?e[0]:null},activeFocus(){return l.activeFocus||this.activeFocusInCollection||this.newModel},loaded(){return(!l.autoFocusEnabled||l.loaded)&&this.data.loaded}},created(){this.instantiateNewModel(),m.on("focus:pin",this.onFocusPin),m.on("todo:globalChange",this.onTodoChange),m.on("newDay",this.archiveAll)},destroyed(){m.off("focus:pin",this.onFocusPin),m.off("todo:globalChange",this.onTodoChange),m.off("newDay",this.archiveAll)},methods:{instantiateNewModel(){this.newModel=new this.Model,this.newModel.copyProperties()},async save(){const t=this.emptyFocus;l.activeFocus||this.activeFocus.editProps.focus&&await this[this.emptyFocus?"add":"update"](this.activeFocus),t&&this.instantiateNewModel(),this.analytics.capture("focus "+(t?"add":"edit"),{position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"}),this.activeFocus.commitChanges(),this.activeFocus.todoId&&m.trigger("todo:set:title",this.activeFocus.todoId,this.activeFocus.focus)},archive(){this.analytics.capture("focus clear",{completed:this.activeFocus.completed}),l.activeFocus?D.ax.autoFocus=!1:n.FZ.methods.archive.call(this,this.activeFocus)},archiveAll(){Object.values(this.data.items).forEach((t=>this.archive(t)))},toggleComplete(){const t=this.activeFocus.completed;this.analytics.capture("focus "+(t?"uncomplete":"complete"),Object.assign({position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"},t?{}:{autofocus:l.autoFocusEnabled})),l.activeFocus?l.toggleComplete():(this.activeFocus.completed=!t,this.dataService.update(this.activeFocus.id,{completed:!t}).then((()=>{this.activeFocus.todoId&&m.trigger("todo:set:done",this.activeFocus.todoId,!t)})).catch((e=>{throw this.activeFocus.completed=t,e})))},onFocusPin(t){D.ax.autoFocus=!1;let e=l.createFocusFromTodo(t);e&&e.focus&&(e.copyProperties(),this.add(e))},onTodoChange(...t){var e,o;const i=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.activeFocus||!Object.keys(this.data.items).length||null==i||!i.changed)return;let c=Object.values(this.data.items).find((t=>{var e;return t.todoId&&t.todoId===((null===(e=i.get)||void 0===e?void 0:e.call(i,"id"))||(null==i?void 0:i.id))}));if(!c)return;if(null!==(e=t[0])&&void 0!==e&&null!==(o=e.changed)&&void 0!==o&&o.deleted)return void this.archive();const M=i.get("done"),a=i.get("title");c.completed===M&&c.focus===a||(c.completed=M,c.focus=a,this.dataService.update(c.id,{completed:M,focus:a}))}}}))},30827:(t,e,o)=>{o.d(e,{Z:()=>c});var i=o(30512);const c=m.showAnyway=new(i.Z.extend({name:"ShowAnyway",data:()=>({widgets:[]}),methods:{show(t){this.includes(t)||this.widgets.push(t)},hide(t){const e=this.widgets.indexOf(t);~e&&this.widgets.splice(e,1)},includes(t){return this.widgets.includes(t)}}}))},61667:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},67652:(t,e,o)=>{var i;o.d(e,{Z:()=>c}),function(t){t.Sync="sync",t.Cache="cache",t.Server="server",t.Timestamp="timestamp"}(i||(i={}));const c=i},52545:t=>{t.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTYgMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEwLjYwMzIgMS4yMzMwN0MxMC45Njg2IDEuNDI4MTYgMTEuMTA2NyAxLjg4MjUyIDEwLjkxMTYgMi4yNDc5Mkw5LjY2MTYgNC41ODkxNUM5LjQ2NjUyIDQuOTU0NTUgOS4wMTIxNiA1LjA5MjYxIDguNjQ2NzYgNC44OTc1MkM4LjI4MTM2IDQuNzAyNDQgOC4xNDMzIDQuMjQ4MDcgOC4zMzgzOSAzLjg4MjY4TDkuNTg4MzkgMS41NDE0NEM5Ljc4MzQ4IDEuMTc2MDUgMTAuMjM3OCAxLjAzNzk4IDEwLjYwMzIgMS4yMzMwN1oiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQuMDUyNjUgNi42NTY3N0M0LjExMTE3IDYuMzIwMzggNC4yNTg4OSA1Ljk0OTM3IDQuNTgwODEgNS42Mjc0NUM1LjEyOTk1IDUuMDc4MzEgNS44MjE5NSA1LjAzNjA4IDYuMjQxMyA1LjA3ODc5QzYuNjc1NiA1LjEyMzAzIDcuMDg1OSA1LjI3NjMzIDcuNDI4MDEgNS40NDMwMkM4LjEyNTk1IDUuNzgzMSA4Ljg2NTg1IDYuMzM5OTggOS41MzIzNiA3LjAwNjQ5QzEwLjE5ODkgNy42NzMgMTAuNzU1OCA4LjQxMjkgMTEuMDk1OCA5LjExMDg0QzExLjI2MjUgOS40NTI5NSAxMS40MTU4IDkuODYzMjYgMTEuNDYwMSAxMC4yOTc2QzExLjUwMjggMTAuNzE2OSAxMS40NjA1IDExLjQwODkgMTAuOTExNCAxMS45NThDMTAuNTU5OCAxMi4zMDk2IDEwLjE0OTcgMTIuNDUzNCA5Ljc5MDA0IDEyLjUwMDJMMS43NzY4NSAxNS42ODI2QzEuNDk3OTMgMTUuNzkzMyAxLjE3OTg0IDE1LjcyNzIgMC45NjgyMiAxNS41MTQ0QzAuNzU2NjAzIDE1LjMwMTYgMC42OTIyMTEgMTQuOTgzMSAwLjgwNDUyOCAxNC43MDQ4TDQuMDUyNjUgNi42NTY3N1pNNy40Njk4MSAxMS44MDc3QzYuOTU3MTQgMTEuNDgxNSA2LjQzOTQ5IDExLjA1ODcgNS45NTk4NCAxMC41NzlDNS40Njk4IDEwLjA4OSA1LjAzOTAxIDkuNTU5MjQgNC43MTAwOSA5LjAzNTdMMi44NTEwNCAxMy42NDJMNy40Njk4MSAxMS44MDc3Wk05Ljg1MDc0IDEwLjg5NzRDOS40NSAxMS4yOTgxIDguMTgyODYgMTAuNjgwNyA3LjAyMDUgOS41MTgzNUM1Ljg1ODE1IDguMzU1OTkgNS4yNDA3MyA3LjA4ODg1IDUuNjQxNDcgNi42ODgxMUM2LjA0MjIgNi4yODczOCA3LjMwOTM0IDYuOTA0NzkgOC40NzE3IDguMDY3MTVDOS42MzQwNiA5LjIyOTUxIDEwLjI1MTUgMTAuNDk2NyA5Ljg1MDc0IDEwLjg5NzRaIi8+PHBhdGggZD0iTTE0LjczMjUgOS4yMTg0NUMxNS4xMzU5IDkuMTI0MzMgMTUuMzg2NiA4LjcyMTAzIDE1LjI5MjUgOC4zMTc2NUMxNS4xOTg0IDcuOTE0MjcgMTQuNzk1MSA3LjY2MzU2IDE0LjM5MTcgNy43NTc2OEwxMi44Mjk2IDguMTIyMTZDMTIuNDI2MiA4LjIxNjI3IDEyLjE3NTUgOC42MTk1NyAxMi4yNjk2IDkuMDIyOTVDMTIuMzYzNyA5LjQyNjMzIDEyLjc2NyA5LjY3NzA0IDEzLjE3MDQgOS41ODI5MkwxNC43MzI1IDkuMjE4NDVaIi8+PHBhdGggZD0iTTUuNTA2ODQgMi44NzQ0QzUuMzY1MTQgMi43NzUwMSA1LjE2OTg1IDIuNzQxNDkgNS4wNDY3MSAyLjc0OTE4QzQuNjMzMyAyLjc3NDk3IDQuMjc3MjUgMi40NjA3NSA0LjI1MTQ2IDIuMDQ3MzRDNC4yMjU2NiAxLjYzMzkzIDQuNTM5ODggMS4yNzc4OCA0Ljk1MzI5IDEuMjUyMDlDNS4zMzAxNSAxLjIyODU3IDUuODg0ODYgMS4zMDczNyA2LjM2ODE2IDEuNjQ2MzNDNi44OTQyIDIuMDE1MjggNy4yNSAyLjYzNDA0IDcuMjUgMy40OTgxOUM3LjI1IDMuOTEyNDEgNi45MTQyMSA0LjI0ODE5IDYuNSA0LjI0ODE5QzYuMDg1NzkgNC4yNDgxOSA1Ljc1IDMuOTEyNDEgNS43NSAzLjQ5ODE5QzUuNzUgMy4wODk0MiA1LjYwNTggMi45NDM4IDUuNTA2ODQgMi44NzQ0WiIvPjxwYXRoIGQ9Ik0xNS40ODU0IDIuNjAxMTFDMTUuNDA0MiAyLjE5NDk0IDE1LjAwOTEgMS45MzE1MyAxNC42MDI5IDIuMDEyNzZDMTQuMTk2NyAyLjA5Mzk5IDEzLjkzMzMgMi40ODkxMSAxNC4wMTQ2IDIuODk1MjhDMTQuMDkxMSAzLjI3Nzc4IDEzLjk3NjQgMy40OTk1OSAxMy44MjQ4IDMuNjM2NzVDMTMuNjQ4MSAzLjc5Njc1IDEzLjMzNjMgMy45MTIwNCAxMi45NDI5IDMuODc2MjdDMTEuOTc2NyAzLjc4ODQ0IDExLjMwMjEgNC4yNDMzNyAxMC45MDQxIDQuODI4OEMxMC41MzU5IDUuMzcwNTkgMTAuNDAyMiA2LjAxNDA2IDEwLjM3NjMgNi40NTQxNUMxMC4zNTIgNi44Njc2NSAxMC42Njc1IDcuMjIyNTggMTEuMDgxIDcuMjQ2OUMxMS40OTQ1IDcuMjcxMjIgMTEuODQ5NCA2Ljk1NTc0IDExLjg3MzcgNi41NDIyNEMxMS44ODk1IDYuMjc0IDExLjk3NTkgNS45MjA0MiAxMi4xNDQ3IDUuNjcyMDNDMTIuMjgzOSA1LjQ2NzI3IDEyLjQ2MzQgNS4zMzg4NyAxMi44MDcxIDUuMzcwMTFDMTMuNTM4NyA1LjQzNjYyIDE0LjI4OTQgNS4yMzk0MSAxNC44MzE0IDQuNzQ4ODRDMTUuMzk4NiA0LjIzNTQ0IDE1LjY1ODkgMy40Njg2IDE1LjQ4NTQgMi42MDExMVoiLz48L3N2Zz4K"}}]);