(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[213,5711],{63568:(t,e,o)=>{"use strict";o.d(e,{Z:()=>i});const i={clock:{name:"Clock",feature:"default clock",icon:o(45671)},pomodoro:{name:"Pomodoro",icon:o(95648),upsell:"UPSELL_POMODORO"}}},85711:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>f});var i=o(30512),s=o(31624),a=o(64438),n=o(67652);const r=new a.Z("tab.focus.emptySave",.01),d=new(i.Z.extend({name:"FocusDataService",mixins:[s.X],unreactive:()=>({type:"focus",mode:localStorage.getItem("token")?n.Z.Sync:n.Z.Cache}),defaultPath:"focus",methods:{add(t,e){return e.focus?s.X.methods.add.apply(this,arguments):(r.info("Focus data service add with no focus",{userUuid:localStorage.getItem("userId"),stackTrace:m.utils.getStackTrace()}),Promise.reject())}}}));var c=o(2770);const l=i.Z.extend({name:"FocusModel",mixins:[c.Z],data:()=>({id:null,archived:!1,completed:!1,createdDate:m.now(),focus:null,forDate:null,todoId:null,props:["focus","completed","archived","forDate","createdDate","todoId"]}),methods:{updateData(t){c.Z.methods.updateData.call(this,t),this.completed=!!t.completed}}});var u=o(94234),h=o(20144),p=o(40531);const g=new(h.ZP.extend({name:"AutoFocusManager",data:()=>({activeFocus:null,loaded:!1}),computed:{autoFocusEnabled:()=>p.ax.autoFocus&&m.conditionalFeatures.featureEnabled("pinfocus")},watch:{autoFocusEnabled:{handler(t){t?this.getTopTodo().then((t=>this.activeFocus=this.createFocusFromTodo(t))):this.activeFocus=null},immediate:!0},"activeFocus.focus"(t){this.activeFocus&&m.trigger("todo:set:title",this.activeFocus.todoId,t)}},created(){m.on("todo:globalChange",this.onTodoChange),m.on("todo:loadingStateChange",this.onLoadingStateChange),m.on("todo:activeListLoaded",this.setLoaded),this.getInitialLoadedState()},destroyed(){m.off("todo:globalChange",this.onTodoChange),m.off("todo:loadingStateChange",this.onLoadingStateChange),m.off("todo:activeListLoaded",this.setLoaded)},methods:{getInitialLoadedState(){return m.widgetManager.getWidgetAsync("todo").then((t=>{var e,o;"Done"===(null===(e=t.manager.activeProvider.selectedList())||void 0===e||null===(o=e.itemCollection)||void 0===o?void 0:o.listStatus)&&(this.loaded=!0)}))},setLoaded(){this.loaded=!0},toggleComplete(){this.activeFocus&&(this.activeFocus.completed=!this.activeFocus.completed,m.trigger("todo:set:done",this.activeFocus.todoId,this.activeFocus.completed))},onLoadingStateChange(){this.autoFocusEnabled&&this.getTopTodo().then((t=>{var e;!t||this.activeFocus&&(t.get("id")||t.id)===this.activeFocus.todoId?t||null!==(e=this.activeFocus)&&void 0!==e&&e.completed||(this.activeFocus=null):this.activeFocus=this.createFocusFromTodo(t)}))},getTopTodo:()=>m.widgetManager.getWidgetAsync("todo").then((t=>t.getTopTodo())),onTodoChange(...t){var e,o,i;const s=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.autoFocusEnabled||null==s||!s.changed||!Object.keys(s.changed).length||!1===(null===(e=s.changed)||void 0===e?void 0:e.isLoading))return;const a=(null===(o=s.changed)||void 0===o?void 0:o.completedDate)||(null===(i=s.changed)||void 0===i?void 0:i.modifiedServer);this.getTopTodo().then((t=>{var e,o;t?this.activeFocus=this.createFocusFromTodo(t):null!==(e=this.activeFocus)&&void 0!==e&&e.todoId&&(s.get("id")||s.id).includes(null===(o=this.activeFocus)||void 0===o?void 0:o.todoId)&&(this.activeFocus.completed=s.get("done"),a||(this.activeFocus=null))}))},createFocusFromTodo(t){if(!t)return null;let e=new l;return e.updateData({focus:t.get("title"),archived:!1,completed:t.get("done"),createdDate:m.now(),id:m.utils.uuidv4(),todoId:t.get("id")||t.id,forDate:m.utils.getDateString()}),e}}}));var v=o(81405);const f=new(i.Z.extend({name:"FocusCollection",mixins:[u.FZ,u.mX],unreactive:()=>({type:"focus",Model:l,dataService:d,newModel:null,analytics:new v.ZP({feature:"focus"})}),computed:{emptyFocus(){return!this.activeFocus.focus},activeFocusInCollection(){const t=m.utils.getDateString(),e=Object.values(this.data.items).filter((e=>!e.archived&&e.forDate===t)).sort(((t,e)=>e.createdDate-t.createdDate));return e.length?e[0]:null},activeFocus(){return g.activeFocus||this.activeFocusInCollection||this.newModel},loaded(){return(!g.autoFocusEnabled||g.loaded)&&this.data.loaded}},created(){this.instantiateNewModel(),m.on("focus:pin",this.onFocusPin),m.on("todo:globalChange",this.onTodoChange),m.on("newDay",this.archiveAll)},destroyed(){m.off("focus:pin",this.onFocusPin),m.off("todo:globalChange",this.onTodoChange),m.off("newDay",this.archiveAll)},methods:{instantiateNewModel(){this.newModel=new this.Model,this.newModel.copyProperties()},async save(){const t=this.emptyFocus;g.activeFocus||this.activeFocus.editProps.focus&&await this[this.emptyFocus?"add":"update"](this.activeFocus),t&&this.instantiateNewModel(),this.analytics.capture("focus "+(t?"add":"edit"),{position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"}),this.activeFocus.commitChanges(),this.activeFocus.todoId&&m.trigger("todo:set:title",this.activeFocus.todoId,this.activeFocus.focus)},archive(){this.analytics.capture("focus clear",{completed:this.activeFocus.completed}),g.activeFocus?p.ax.autoFocus=!1:u.FZ.methods.archive.call(this,this.activeFocus)},archiveAll(){Object.values(this.data.items).forEach((t=>this.archive(t)))},toggleComplete(){const t=this.activeFocus.completed;this.analytics.capture("focus "+(t?"uncomplete":"complete"),Object.assign({position:localStorage.getItem("pomodoro-showing")?"pomodoro":"default"},t?{}:{autofocus:g.autoFocusEnabled})),g.activeFocus?g.toggleComplete():(this.activeFocus.completed=!t,this.dataService.update(this.activeFocus.id,{completed:!t}).then((()=>{this.activeFocus.todoId&&m.trigger("todo:set:done",this.activeFocus.todoId,!t)})).catch((e=>{throw this.activeFocus.completed=t,e})))},onFocusPin(t){p.ax.autoFocus=!1;let e=g.createFocusFromTodo(t);e&&e.focus&&(e.copyProperties(),this.add(e))},onTodoChange(...t){var e,o;const i=t[0];if(t.find((t=>t&&(t.ignoreRender||t.silent)))||!this.activeFocus||!Object.keys(this.data.items).length||null==i||!i.changed)return;let s=Object.values(this.data.items).find((t=>{var e;return t.todoId&&t.todoId===((null===(e=i.get)||void 0===e?void 0:e.call(i,"id"))||(null==i?void 0:i.id))}));if(!s)return;if(null!==(e=t[0])&&void 0!==e&&null!==(o=e.changed)&&void 0!==o&&o.deleted)return void this.archive();const a=i.get("done"),n=i.get("title");s.completed===a&&s.focus===n||(s.completed=a,s.focus=n,this.dataService.update(s.id,{completed:a,focus:n}))}}}))},91035:()=>{addin.collect.PomodorosComplete=m.collect.SyncedCollection.extend({initialize:function(){let t={};m.conditionalFeatures.featureEnabled("offlineDataOnly")&&(t.offlineOnly=!0),this.model=addin.models.PomodorosComplete,t.idAttribute="id",t.name="pomodorosCompleted",t.model=this.model,t.readOnly=!1,t.apiUrl=m.globals.urlRootApi+"pomodoro/completed",localStorage.getItem("pomodoroCompletedCounts")&&m.trigger("pomodoro:completedStats",localStorage.getObject("pomodoroCompletedCounts")),m.collect.SyncedCollection.prototype.initialize.call(this,null,t)},parse(t){if(!t)return;if(Array.isArray(t))return t;let e={counts:t.counts,focusedMinutes:t.focusedMinutes};return localStorage.setItem("pomodoroCompletedCounts",JSON.stringify(e)),m.trigger("pomodoro:completedStats",e),t.completed}})},11862:()=>{window.addin=window.addin||{models:{},collect:{},views:{}},addin.models.PomodorosComplete=Backbone.Model.extend({defaults:{completed:`${(new Date).toISOString().split(".")[0]}Z`,focusMinutes:0,restMinutes:0},initialize:function(){this.attributes.createdDate=m.date()}})},99460:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>r});var i=o(8081),s=o.n(i),a=o(23645),n=o.n(a)()(s());n.push([t.id,"\n/* stylelint-disable */\n.has-pomodoro .center-above { display: block;\n}\n/* stylelint-enable */\n",""]);const r=n},89696:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>u});var i=o(8081),s=o.n(i),a=o(23645),n=o.n(a),r=o(61667),d=o.n(r),c=new URL(o(55179),o.b),m=n()(s()),l=d()(c);m.push([t.id,`\n/* stylelint-disable */\n.pomodoro[data-v-58dd3a16] { display: flex; flex-direction: column; align-items: center; --font-size-greeting: 3rem;\n}\n.above[data-v-58dd3a16], .below[data-v-58dd3a16] { text-align: center;\n}\n.above[data-v-58dd3a16] { margin-bottom: 0.6rem; display: flex; flex-direction: column; align-items: center;\n}\n.modes[data-v-58dd3a16] { display: flex; font-size: 1rem; font-weight: 700; text-align: center; text-transform: uppercase;\n}\n.mode[data-v-58dd3a16] { padding: 5px 12px; display: inline-block; opacity: var(--opacity-stop-3); cursor: pointer;\n}\n.mode[data-v-58dd3a16]:hover, .mode.active[data-v-58dd3a16] { opacity: 1;\n}\n.mode-focus[data-v-58dd3a16] { margin-right: 4px;\n}\n.time[data-v-58dd3a16] { font-size: 8.5rem; text-shadow: 0 0 20px rgba(0 0 0 / var(--opacity-stop-3));\n}\n.three-col-layout--center[data-v-58dd3a16] {\n}\n.greeting-wrapper[data-v-58dd3a16] { position: relative;\n}\n.greeting-inner-wrapper[data-v-58dd3a16] { font-size: var(--font-size-greeting); font-weight: 500; text-align: center;\n}\n\n\t\t/* Focus Overrides */\n.center-focus[data-v-58dd3a16] { display: block; font-size: 100% !important;\n}\n.center-focus[data-v-58dd3a16] .focus-content { position: relative;\n}\n.center-focus[data-v-58dd3a16] .checkbox { margin: 6px 1rem 0;\n}\n.center-focus[data-v-58dd3a16] .prompt { padding-bottom: 0;\n}\n.center-focus[data-v-58dd3a16] .focus-input, .prompt .hidden-data[data-v-58dd3a16] { padding: 0; border: none; border-bottom: none; font-size: var(--font-size-greeting) !important; line-height: normal;\n}\n\n\t\t\t/* ••• hover effects -> Prevent focus ••• from showing when general center pomodoro is hovered  */\n.center-focus[data-v-58dd3a16] .dash-icon { opacity: 0;\n}\n.center-focus[data-v-58dd3a16]:hover .dash-icon { opacity: 0.8;\n}\n.right[data-v-58dd3a16] {\n}\n.below[data-v-58dd3a16] { margin-top: 35px; display: flex; align-items: center; gap: 12px;\n}\n.button[data-v-58dd3a16] { --v-padding: 9px; --background-color: rgba(0,0,0,0.25); padding: var(--v-padding) 32px; display: flex; background: var(--background-color); border: 2px solid #fff; border-radius: 50px; box-shadow: 0 0 12px var(--background-color); color: #fff; cursor: pointer; font-size: 0.9375rem; font-weight: 600; outline: none; text-transform: uppercase;\n}\n.button[data-v-58dd3a16]:hover { background: rgba(0,0,0,0.175);\n}\n.button[data-v-58dd3a16]:hover:active { background: rgba(0,0,0,0.1); transition-duration: 0s;\n}\n.button.disabled[data-v-58dd3a16] { transition: opacity 500ms var(--a-curve); visibility: hidden;\n}\n.circle[data-v-58dd3a16] { --size: 650px; position: absolute; top: 0; left: 0; bottom: 0; right: 0; z-index: -1; display: flex; align-items: center; justify-content: center;\n}\n.circle-inner[data-v-58dd3a16] { height: var(--size); width: var(--size); max-height: min(90vh, 95vw); max-width: min(90vh, 95vw); position: relative; flex-shrink: 0; transform: translateY(-10px) rotate(-45deg);\n}\n.circle-background[data-v-58dd3a16] { -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); transition: opacity 1s ease; -webkit-mask-image: url(${l}); mask-image: url(${l});\n}\n.circle-foreground[data-v-58dd3a16] { background: rgba(255 255 255 / var(--opacity-stop-2)); -webkit-mask-image: url(${l}); mask-image: url(${l});\n}\n.circle-svg[data-v-58dd3a16], .circle-background[data-v-58dd3a16], .circle-foreground[data-v-58dd3a16] { position: absolute; inset: 0;\n}\n.circle-svg[data-v-58dd3a16] path { opacity: var(--opacity-stop-4); transition: 0.2s ease; stroke-dashoffset: var(--f346d42a); stroke: white !important;\n}\n@media screen and (max-width: 450px) {\n.circle[data-v-58dd3a16] { --size: 375px;\n}\n.modes[data-v-58dd3a16] { font-size: 1rem;\n}\n.mode[data-v-58dd3a16] {\n}\n.time[data-v-58dd3a16] { font-size: 5rem; font-weight: 500; letter-spacing: -1px;\n}\n.pomodoro .greeting-inner-wrapper[data-v-58dd3a16] { --font-size-greeting: clamp(10px, 8vw, 32px); margin-top: 2px;\n}\n.center-focus[data-v-58dd3a16] .focus-input, .prompt .hidden-data[data-v-58dd3a16] { margin: 0;\n}\n\n\t/* Dropdown */\n[data-v-58dd3a16] .stats { padding-right: var(--toast-padding) !important; padding-left: var(--toast-padding) !important; background: none !important;\n}\n}\n.fade-leave-to[data-v-58dd3a16], .fade-enter[data-v-58dd3a16] {\n\topacity: 0 !important;\n}\n\n/* Instead of worrying about fade-deep, just fade the blur on it's own after pomodoro appears */\n.fade-enter-active .circle-background[data-v-58dd3a16], .fade-leave-active .circle-background[data-v-58dd3a16] { opacity: 0!important;\n}\n`,""]);const u=m},61667:t=>{"use strict";t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},67652:(t,e,o)=>{"use strict";var i;o.d(e,{Z:()=>s}),function(t){t.Sync="sync",t.Cache="cache",t.Server="server",t.Timestamp="timestamp"}(i||(i={}));const s=i},30213:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>y});var i=function(){var t=this,e=t._self._c;return t.optionsOnly?e("pomodoro-dropdown",{attrs:{"always-open":!0,timers:t.timers,sounds:t.sounds,autoplay:t.autoplay,"hide-seconds":t.hideSeconds,"completed-stats":t.completedStats,options:t.centerOptions},on:{"update:sounds":function(e){t.sounds=e},"update:autoplay":function(e){t.autoplay=e},"update:hideSeconds":function(e){t.hideSeconds=e},"update:hide-seconds":function(e){t.hideSeconds=e},"update:timer":t.setTimerDuration,"complete-timer":t.completeTimer,"restart-timer":t.restartTimer,"add-ten-minutes":t.addTenMinutes,"switch-clock":t.switchClock}}):e("section",{staticClass:"clock pomodoro app-container has-dash-icon",class:{running:t.started,"show-anyway":t.showAnyway.includes("pomodoro")},attrs:{"data-show-anyway":"pomodoro","data-test":"pomodoro"}},[e("div",{staticClass:"circle"},[e("div",{staticClass:"circle-inner"},[e("div",{staticClass:"circle-background"}),t._v(" "),e("div",{staticClass:"circle-foreground"}),t._v(" "),e("inline-svg",{staticClass:"circle-svg",attrs:{src:o(55179)}})],1)]),t._v(" "),e("div",{staticClass:"above"},[e("nav",{staticClass:"modes"},[e("div",{staticClass:"mode mode-focus",class:{active:"Focus"==t.activeTimer.name},attrs:{"data-test":"focus-btn"},on:{click:function(e){return t.clickTimer("focus")}}},[t._v("Focus")]),t._v(" "),e("div",{staticClass:"mode mode-break",class:{active:"Break"==t.activeTimer.name},attrs:{"data-test":"rest-btn"},on:{click:function(e){return t.clickTimer("rest")}}},[t._v("Break")])])]),t._v(" "),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("three-col-layout",{key:t.activeTimerId,staticClass:"time-wrapper",scopedSlots:t._u([t.quickNavVisible?{key:"left",fn:function(){return[t.$touch?t._e():e("quick-nav",{attrs:{options:t.centerOptions,region:"center",active:"pomodoro"},on:{"switch-to":t.switchClock}})]},proxy:!0}:null,{key:"center",fn:function(){return[e("pomodoro-time",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.showToastMenu,expression:"showToastMenu"}],attrs:{"hide-seconds":t.hideSeconds,hours:t.hours,minutes:t.minutes,seconds:t.seconds}})]},proxy:!0},{key:"right",fn:function(){return[e("pomodoro-dropdown",{attrs:{timers:t.timers,sounds:t.sounds,autoplay:t.autoplay,"hide-seconds":t.hideSeconds,"completed-stats":t.completedStats,options:t.centerOptions},on:{"update:sounds":function(e){t.sounds=e},"update:autoplay":function(e){t.autoplay=e},"update:hideSeconds":function(e){t.hideSeconds=e},"update:hide-seconds":function(e){t.hideSeconds=e},"update:timer":t.setTimerDuration,"complete-timer":t.completeTimer,"restart-timer":t.restartTimer,"add-ten-minutes":t.addTenMinutes,"switch-clock":t.switchClock}})]},proxy:!0}],null,!0)})],1),t._v(" "),e("div",{staticClass:"greeting-wrapper"},[e("transition",{attrs:{name:t.messageFade,mode:"out-in"}},[t.showFocusComponent?e("div",{staticClass:"greeting-inner-wrapper"},[e("focus",{staticClass:"center-focus",attrs:{"input-placeholder":"+ Add a focus","in-pomodoro":!0,"pomodoro-message":t.message}})],1):e("div",{key:t.message,staticClass:"greeting-inner-wrapper message",attrs:{"data-test":"message"}},[t._v(t._s(t.message))])])],1),t._v(" "),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{key:t.activeTimerId,staticClass:"below"},[t.focusPlus10Visible?e("button",{staticClass:"button u--mobile-hide",attrs:{"data-test":"extend-focus-button"},on:{click:t.extendFocusAfterEnd}},[t._v("Focus +10 min")]):t._e(),t._v(" "),e("button",{staticClass:"button",class:{disabled:0===t.timeRemaining},attrs:{"data-test":"start-stop-button"},on:{click:t.toggleMasterPlayPause}},[t._v(t._s(t.started?"Pause":"Start"))])])])],1)};i._withStripped=!0;const s={focus:["Time to focus.","Focus time."],rest:["Time for a break.","Break time."]};var a=o(30512);o(11862),o(91035);const n=new(a.Z.extend({name:"PomodoroDataManager",data:()=>({completedStats:{counts:{today:0,week:0,allTime:0},focusedMinutes:{today:0,week:0,allTime:0}},intervalId:null}),created(){this.completedCountLocalStorageKey="pomodoroCompletedCounts",m.on("pomodoro:completedStats",this.setCompletedStats),window.addEventListener("storage",this.handleCompletedStatsChange),this.createSyncedCollection()},destroyed(){m.off("pomodoro:completedStats",this.setCompletedStats),clearInterval(this.intervalId)},methods:{createSyncedCollection(){addin.collect.pomodorosComplete=new addin.collect.PomodorosComplete},addCompletedPomodoro(t){try{addin.collect.pomodorosComplete.create(t)}catch(t){console.error(t)}finally{this.completedStats.counts.today++,this.completedStats.counts.allTime++,this.completedStats.counts.week++;const t=m.models.customization.get("pomodoroSettingsStr"),e=t&&JSON.parse(t),o=Number(e.focusDuration);this.completedStats.focusedMinutes.today+=o,this.completedStats.focusedMinutes.allTime+=o,this.completedStats.focusedMinutes.week+=o,localStorage.setItem(this.completedCountLocalStorageKey,JSON.stringify(this.completedStats))}},setCompletedStats(t){this.completedStats=t},handleCompletedStatsChange(t){if(t.key===this.completedCountLocalStorageKey){const e=JSON.parse(t.newValue);e&&this.setCompletedStats(e)}},fetch(){addin.collect.pomodorosComplete.fetch()},createIntervalFetch(){this.intervalId=setInterval((()=>{this.fetch()}),18e5)},clearIntervalFetch(){clearInterval(this.intervalId)}}}));var r=o(42223),d=o(30827),c=o(63568),l=o(3728),u=o(85711),h=o(81405),p=o(80809),g=o(20144);const v=new h.ZP({feature:"pomodoro",is_paid_event:!0}),f={name:"Pomodoro",components:{ThreeColLayout:l.Z,QuickNav:()=>o.e(1025).then(o.bind(o,1025)),PomodoroTime:()=>o.e(3268).then(o.bind(o,93268)),PomodoroDropdown:()=>Promise.all([o.e(6283),o.e(1013),o.e(5940),o.e(8930),o.e(2548),o.e(4820),o.e(2173)]).then(o.bind(o,15820)),Focus:()=>Promise.all([o.e(927),o.e(8292)]).then(o.bind(o,80927))},unreactive:()=>({showAnyway:d.Z,centerOptions:c.Z}),mixins:[r.Z],props:{optionsOnly:{type:Boolean,default:!1},quickNavVisible:{type:Boolean,default:!0}},data:()=>({timers:{focus:{name:"Focus",minutes:25},rest:{name:"Break",minutes:5}},activeTimerId:"focus",started:!1,timeRemaining:0,expectedTimerEnd:0,timer:null,sounds:!0,autoplay:!1,hideSeconds:!1}),computed:{activeTimer(){return this.timers[this.activeTimerId]},startMessage(){return m.utils.getRandomItem(s[this.activeTimerId])},dashProgress(){const t=60*this.activeTimer.minutes;return Math.min(this.timeRemaining,t)/t*212+"%"},message(){return this.started||0!==this.timeRemaining?this.started?this.activeTimer.name:this.startMessage:"Done!"},showFocusComponent(){return"Focus"===this.activeTimer.name&&0!==this.timeRemaining},messageFade(){return this.started?"fade-fast":"fade"},completedStats:()=>n.completedStats,hours(){return this.hideSeconds?Math.trunc(this.timeRemaining/3600).toString():m.utils.twoDigit(Math.trunc(this.timeRemaining/3600))},minutes(){return this.hideSeconds?Math.trunc(this.timeRemaining/60%60).toString():m.utils.twoDigit(Math.trunc(this.timeRemaining/60%60))},seconds(){return m.utils.twoDigit(this.timeRemaining%60)},timeString(){return this.hideSeconds?this.hours>0?`${this.hours}h ${this.minutes}m`:`${this.minutes}m`:this.hours>0?`${this.hours}:${this.minutes}:${this.seconds}`:`${this.minutes}:${this.seconds}`},documentTitle(){var t;const e=null===(t=u.default.activeFocus)||void 0===t?void 0:t.focus;return`${this.timeString} · ${e&&!e.completed&&"focus"===this.activeTimerId?e:this.activeTimer.name}`},isSafari:m.utils.isSafari,focusPlus10Visible(){return"rest"===this.activeTimerId&&!this.started&&0!==this.timeRemaining&&this.$plus}},watch:{sounds(){this.saveSettingsToCustomization("sounds",this.sounds)},autoplay(){this.saveSettingsToCustomization("autoplay",this.autoplay)},hideSeconds(){this.saveSettingsToCustomization("hideSeconds",this.hideSeconds)},documentTitle(t){document.title=t}},mounted(){this.optionsOnly||(this.autoStartFocusTimer&&(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.start.play(),this.start()),this.$body=$("body"),this.$body.addClass("has-pomodoro"))},created(){m.models.customization.on("change:pomodoroSettingsStr",this.handleSettingsChange),this.settingsMigrationFromLocalToCustomization(),this.setSettingsFromCustomization(),this.optionsOnly||(window.addEventListener("storage",this.handleStorageChangeForStartedPomodoro),m.on("newDay",this.resetToFocus),m.on("pomodoro:reset",this.resetToFocus),m.on("pomodoro:restart",this.restartTimer),m.on("pomodoro:complete",this.completeTimer),m.on("pomodoro:togglePlay",this.togglePlay),n.fetch(),n.createIntervalFetch(),window.pomodoroSounds={start:new Audio("sounds/pomo-start.mp3"),stop:new Audio("sounds/pomo-stop.mp3"),done:new Audio("sounds/pomo-done.mp3")},(()=>{if("true"===localStorage.getItem("pomodoro-running")||localStorage.getItem("pomodoro-showing")||localStorage.getItem("pomodoro-time-remaining")){if(this.started="true"===localStorage.getItem("pomodoro-running"),this.autoStartFocusTimer="true"===localStorage.getItem("pomodoro-focus-timer"),this.autoStartFocusTimer)return this.setTimer("focus"),void localStorage.removeItem("pomodoro-focus-timer");this.activeTimerId=localStorage.getItem("pomodoro-started")||this.activeTimerId,localStorage.getItem("pomodoro-time-remaining")?this.timeRemaining=Number(localStorage.getItem("pomodoro-time-remaining")):localStorage.getItem("pomodoro-started-expected-timer-end")&&(this.expectedTimerEnd=Number(localStorage.getItem("pomodoro-started-expected-timer-end")),isNaN(this.expectedTimerEnd)||(this.timeRemaining=Math.floor((this.expectedTimerEnd-Date.now())/1e3))),this.timeRemaining/60>Number(this.activeTimer.minutes)?(this.stop(),this.reset()):this.timeRemaining>0&&this.started?this.timeOutForCountdown():this.timeRemaining<0?(localStorage.setItem("pomodoro-running",!1),"focus"===this.activeTimerId?this.setTimer("rest"):this.setTimer("focus"),this.clearStartedTimeout()):this.timeRemaining||this.setTimer(this.activeTimerId)}else this.setTimer(this.activeTimerId),this.removeAllPomodoroLocalStorageKeys()})(),m.trigger("pomodoro:created"))},destroyed(){m.models.customization.off("change:pomodoroSettingsStr",this.handleSettingsChange),this.optionsOnly||(this.$body.removeClass("has-pomodoro"),m.off("newDay",this.resetToFocus),m.off("pomodoro:reset",this.resetToFocus),m.off("pomodoro:togglePlay",this.togglePlay),m.off("pomodoro:restart",this.restartTimer),m.off("pomodoro:complete",this.completeTimer),window.removeEventListener("storage",this.handleStorageChangeForStartedPomodoro),clearTimeout(this.timer),document.title="New Tab",this.stop(),localStorage.setItem("pomodoro-closed",!0),this.removeAllPomodoroLocalStorageKeys(),n.clearIntervalFetch())},methods:{countdown(){this.calculateTimeRemaining(),this.timeRemaining<=0||this.timeOutForCountdown()},timeOutForCountdown(){const t=1e3-(new Date).getMilliseconds()+10;clearTimeout(this.timer),this.timer=setTimeout(this.countdown,t)},calculateTimeRemaining(){const t=Number(localStorage.getItem("pomodoro-started-expected-timer-end"));if(isNaN(t)||(this.expectedTimerEnd=t),this.timeRemaining>0&&(this.timeRemaining=Math.floor((this.expectedTimerEnd-Date.now())/1e3)),this.timeRemaining<=0)return this.isSafari?this.complete():this.completeDebounced()},togglePlay(){!0===this.started?(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.stop.play(),this.stop()):(this.sounds&&!this.optionsOnly&&window.pomodoroSounds.start.play(),this.start())},toggleMasterPlayPause(){this.togglePlay()},completeDebounced(){clearTimeout(this.completeTimeout),this.completeTimeout=setTimeout(this.complete,100)},complete(){if("Focus"===this.activeTimer.name){const t={focusMinutes:this.timers.focus.minutes,restMinutes:this.timers.rest.minutes};n.addCompletedPomodoro(t)}this.sounds&&!this.optionsOnly&&window.pomodoroSounds.done.play(),this.timeRemaining=0,this.stop(),this.switchTimers(),v.capture("pomodoro complete",{period:this.activeTimerId})},switchTimers(){const t=this.autoplay;setTimeout((()=>{"focus"===this.activeTimerId?this.setTimer("rest"):this.setTimer("focus"),t&&this.start()}),1500)},reset(){this.setCountdownTimer(),this.stop(),localStorage.setItem("pomodoro-reset",!0)},resetToFocus(){this.reset(),this.setTimer("focus"),this.setCountdownTimer()},start(){this.clearStartedTimeout(),this.started=!0,this.expectedTimerEnd=Date.now()+1e3*this.timeRemaining,localStorage.removeItem("pomodoro-time-remaining"),localStorage.setItem("pomodoro-running",!0),localStorage.setItem("pomodoro-started-expected-timer-end",this.expectedTimerEnd),this.timeOutForCountdown(),v.capture("pomodoro start",{period:this.activeTimerId})},stop(){this.clearStartedTimeout(),localStorage.setItem("pomodoro-running",!1),localStorage.setItem("pomodoro-time-remaining",this.timeRemaining),v.capture("pomodoro stop",{period:this.activeTimerId})},setTimer(t){this.started&&this.stop(),this.activeTimerId=t,localStorage.setItem("pomodoro-started",this.activeTimerId),this.setCountdownTimer()},clickTimer(t){this.setTimer(t),v.capture("period change",{new_value:t})},setCountdownTimer(){this.timeRemaining=60*this.activeTimer.minutes,localStorage.removeItem("pomodoro-started-expected-timer-end"),localStorage.removeItem("pomodoro-time-remaining")},setTimerDuration(t,e){this.saveSettingsToCustomization(`${t}Duration`,e),v.capture("duration change",{period:t,new_value:e})},setTimeRemainingAfterUpdate(t,e,o){if(this.activeTimerId!==t)return;const i=60*(o-e),s=this.timeRemaining;i<0&&s<0-i?(this.started&&this.stop(),this.reset(),this.setTimerWhenNotStarted()):(this.timeRemaining+=i,this.expectedTimerEnd+=1e3*i,localStorage.setItem("pomodoro-started-expected-timer-end",this.expectedTimerEnd))},setTimerWhenNotStarted(t){this.started||this.activeTimerId!==t||(this.timeRemaining=60*this.timers[t].minutes)},closePomodoro(){this.$emit("pomodoro-show",!1)},handleStorageChangeForStartedPomodoro(t){switch(t.key){case"pomodoro-running":if(null===t.newValue)return;"true"===t.newValue?(this.clearStartedTimeout(),this.started=!0,this.expectedTimerEnd=Date.now()+1e3*this.timeRemaining,this.timeOutForCountdown()):this.clearStartedTimeout();break;case"pomodoro-reset":if(null===t.newValue)return;this.setCountdownTimer(),this.clearStartedTimeout(),localStorage.removeItem("pomodoro-reset");break;case"pomodoro-closed":if(null===t.newValue)return;document.title="New Tab",n.clearIntervalFetch(),this.removeAllPomodoroLocalStorageKeys(),this.$emit("pomodoro-show",!1);break;case"pomodoro-complete":if(null===t.newValue)return;this.timeRemaining=0,this.stop(),this.switchTimers(),localStorage.removeItem("pomodoro-complete");break;case"pomodoro-started":if(null===t.newValue)return;this.setTimer(t.newValue)}},handleSettingsChange(){let t=this.getPomodoroSettingsFromCustomization();if(!t)return;const e=void 0===t.sounds||t.sounds;if(e!==this.sounds&&(this.sounds=e),t.autoplay!==this.autoplay&&(this.autoplay=t.autoplay),t.hideSeconds!==this.hideSeconds&&(this.hideSeconds=t.hideSeconds),Number(t.focusDuration)!==Number(this.timers.focus.minutes)){const e=this.timers.focus.minutes;this.timers.focus.minutes=Number(t.focusDuration),this.setTimeRemainingAfterUpdate("focus",e,Number(t.focusDuration))}if(Number(t.restDuration)!==Number(this.timers.rest.minutes)){const e=this.timers.rest.minutes;this.timers.rest.minutes=Number(t.restDuration),this.setTimeRemainingAfterUpdate("rest",e,Number(t.restDuration))}},clearStartedTimeout(){this.started=!1,clearTimeout(this.timer)},removeAllPomodoroLocalStorageKeys(){["pomodoro-reset","pomodoro-running","pomodoro-closed","pomodoro-started-expected-timer-end","pomodoro-current-focus","pomodoro-complete","pomodoro-focus-timer"].forEach((t=>{localStorage.removeItem(t)}))},switchClock(t){"clock"===t&&this.closePomodoro()},getPomodoroSettingsFromCustomization(){const t=m.models.customization.get("pomodoroSettingsStr");return t&&JSON.parse(t)},setSettingsFromCustomization(){let t=this.getPomodoroSettingsFromCustomization();t&&(this.timers.focus.minutes=Number(t.focusDuration),this.timers.rest.minutes=Number(t.restDuration),this.sounds=void 0===t.sounds||t.sounds,this.autoplay=t.autoplay,this.hideSeconds=t.hideSeconds)},saveSettingsToCustomization(t,e){let o=this.getPomodoroSettingsFromCustomization();o&&(o[t]=e,m.models.customization.save("pomodoroSettingsStr",JSON.stringify(o)))},settingsMigrationFromLocalToCustomization(){let t={"pomodoro-focus-duration":"focusDuration","pomodoro-rest-duration":"restDuration","pomodoro-autoplay":"autoplay"};Object.keys(t).forEach((e=>{localStorage.getItem(e)&&(this.saveSettingsToCustomization(t[e],localStorage.getItem(e)),localStorage.removeItem(e))}))},completeTimer(){this.optionsOnly?m.trigger("pomodoro:complete"):(this.complete(),localStorage.setItem("pomodoro-complete",!0))},restartTimer(){this.optionsOnly?m.trigger("pomodoro:restart"):this.reset()},addTenMinutes(){this.setTimerDuration("focus",Number(this.timers.focus.minutes)+10)},showToastMenu(){this.$e.$emit("pomodoro:toggleDropdown",!0)},async extendFocusAfterEnd(){this.setTimer("focus"),await p.Z.delay(1e3),Number(this.timers.focus.minutes)<10&&this.addTenMinutes(),this.timeRemaining=600,this.expectedTimerEnd+=6e5,localStorage.setItem("pomodoro-started-expected-timer-end",this.expectedTimerEnd),await p.Z.delay(500),this.toggleMasterPlayPause()}}},S=()=>{(0,g.sj)(((t,e)=>({f346d42a:t.dashProgress})))},T=f.setup;f.setup=T?(t,e)=>(S(),T(t,e)):S;const w=f;o(47950),o(84150);const y=(0,o(51900).Z)(w,i,[],!1,null,"58dd3a16",null).exports},47950:(t,e,o)=>{var i=o(99460);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,o(45346).Z)("4fc6fc24",i,!1,{ssrId:!0})},84150:(t,e,o)=>{var i=o(89696);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals),(0,o(45346).Z)("1d8f360c",i,!1,{ssrId:!0})}}]);