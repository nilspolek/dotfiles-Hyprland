"use strict";(self.webpackChunkcb_wallet_extension=self.webpackChunkcb_wallet_extension||[]).push([[3891,4931],{583767:(e,r,t)=>{t.r(r),t.d(r,{RetailTrade:()=>_});var n,o,a,s=t(202784),i=t(107267),u=t(601848),l=t(86296),c=t(886855),d=t(352087),f=t(888716),p=t(334291),m=t.n(p),y=t(907839),b=t(61517),v=t(405263),g=t(48972),w=t(755256),S=t(471609),h=t(728209),T=t(586772),x=t(482576),P=t(335657),E=t(682507),I=t(799759),j=t(182955),k=t(303908),O=t(552322);function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function C(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function A(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?C(Object(t),!0).forEach((function(r){L(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function L(e,r,t){return(r=function(e){var r=function(e,r){if("object"!==R(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===R(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function N(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,s,i=[],u=!0,l=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(l)throw o}}return i}}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return H(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function M(){return null}function _(){var e,r;(0,x.c)();var t=(0,P.useRetrieveTradeContext)()(),n=(0,i.useParams)(),o=N((0,s.useState)(n),1)[0],a=(0,E.x)(),p=BigInt(null!==(e=null!==(r=o.chainId)&&void 0!==r?r:a.chainId)&&void 0!==e?e:1),R=c.Network.fromChainId({chainPrefix:(0,d.getPrefix)(p),chainId:p}),C=(0,f.useSwapAssetsByNetwork)(),L=(0,s.useMemo)((function(){var e=Object.keys(C).flatMap((function(){return C[o.chainId]})).find((function(e){var r;return(null===(r=e.address)||void 0===r?void 0:r.rawValue)===o.contractAddress}));return e?e.swapId:""}),[o.chainId,o.contractAddress,C]),H=(0,u.useLogRetailTradeErrorViewed)(),_=(0,T.y)(),G=(0,s.useMemo)((function(){return"entry"===_?(0,O.jsx)(I.T,{}):(0,O.jsx)(M,{})}),[_]),V=(0,w.z)({redirectToRoute:h.RoutesEnum.DEFAULT}).isRenderedInPopup,D=(0,s.useMemo)((function(){var e;return t&&delete t.stepperPosition,A(A({},j.initialValues),{},{sourceWalletId:"",selectedNetwork:R,targetAssetId:L,targetAssetContractAddress:null!==(e=o.contractAddress)&&void 0!==e?e:"",browserMode:!0})}),[R,o.contractAddress,t,L]);(0,u.useLogRetailTradeViewed)(L);var U=(0,s.useCallback)((function(e){var r=e.error,t=e.errorHash;H({errorHash:t,errorMessage:r.message,targetAssetId:L});var n=(0,l.coerceError)(r,"retail trade - log global error");(0,l.cbReportError)({error:n,metadata:{error:null==r?void 0:r.message},context:"swap-error",severity:"error",isHandled:!1})}),[H,L]),F=(0,s.useCallback)((function(e){var r=e.error;return(0,O.jsx)(S._,{error:r})}),[]);return V?(0,O.jsx)(O.Fragment,{}):(0,O.jsx)(g.VStack,{height:b.IR,children:(0,O.jsx)(y.S,{onError:U,renderFallback:F,children:(0,O.jsx)(v.J,{fallback:G,children:(0,O.jsx)(j.form.Provider,{onSubmit:m(),initialValues:D,children:(0,O.jsx)(k.TradeContent,{defaultStep:_})})})})})}e=t.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),("undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e})(_,"usePersistTradeContextTimestamp{}\nuseRetrieveTradeContext{retrieveTradeContext}\nuseParams{routeParams}\nuseState{[params](routeParams)}\nuseTradeQueryParams{queryParams}\nuseSwapAssetsByNetwork{swapAssetsByNetwork}\nuseMemo{targetAssetId}\nuseLogRetailTradeErrorViewed{logRetailTradeErrorViewed}\nuseDefaultStep{defaultStep}\nuseMemo{fallbackComponent}\nuseRedirectIfRenderedInPopup{{ isRenderedInPopup }}\nuseMemo{initialFormValues}\nuseLogRetailTradeViewed{}\nuseCallback{logGlobalError}\nuseCallback{renderFallback}",(function(){return[x.c,P.useRetrieveTradeContext,i.useParams,E.x,f.useSwapAssetsByNetwork,u.useLogRetailTradeErrorViewed,T.y,w.z,u.useLogRetailTradeViewed]})),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(M,"EmptyFallback","/workspaces/apps/extension/src/screens/Trade/RetailTrade.tsx"),o.register(_,"RetailTrade","/workspaces/apps/extension/src/screens/Trade/RetailTrade.tsx")),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)},303908:(e,r,t)=>{t.r(r),t.d(r,{Trade:()=>F,TradeContent:()=>D});var n,o=t(202784),a=t(107267),s=t(160593),i=t(86296),u=t(612321),l=t(886855),c=t(352087),d=t(654683),f=t(334291),p=t.n(f),m=t(907839),y=t(61517),b=t(405263),v=t(95898),g=t(48972),w=t(395545),S=t(695652),h=t(471609),T=t(586772),x=t(482576),P=t(335657),E=t(682507),I=t(799759),j=t(823245),k=t(182955),O=t(907075),R=t(552322);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function A(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function L(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?A(Object(t),!0).forEach((function(r){N(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function N(e,r,t){return(r=function(e){var r=function(e,r){if("object"!==C(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===C(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function H(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,s,i=[],u=!0,l=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(l)throw o}}return i}}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return M(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return M(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}e=t.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var _,G,V="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};function D(e){var r,t=e.defaultStep,n=null===(r=(0,v.Z)(k.form).selectedNetwork.value.asChain())||void 0===r?void 0:r.chainId;if(!(null==n?void 0:n.toString()))throw new Error("Invalid network. No associated EthereumChain found");var o=H((0,u.useConcurrentSuspense)((function(e){return e(S.k)()}),(function(e){return e(d.c)()})),2),a=o[0],s=o[1];return(0,R.jsx)(j.tU,{supportedChains:a,children:(0,R.jsx)(k.stepper.Provider,{defaultStep:t,children:(0,R.jsx)(O.TradeStepper,{mostPopularSwapAssetId:null==s?void 0:s.id})})})}function U(){return null}function F(){var e,r;(0,x.c)();var t=(0,P.useRetrieveTradeContext)()(),n=(0,a.useParams)(),u=H((0,o.useState)(n),1)[0],d=(0,E.x)(),f=BigInt(null!==(e=null!==(r=u.chainId)&&void 0!==r?r:d.chainId)&&void 0!==e?e:1),v=l.Network.fromChainId({chainPrefix:(0,c.getPrefix)(f),chainId:f}),S=(0,o.useMemo)((function(){return n.walletId?decodeURIComponent(n.walletId):""}),[n.walletId]),j=(0,o.useMemo)((function(){return n.swapId?decodeURIComponent(n.swapId):""}),[n.swapId]),O=(0,T.y)(),C=(0,o.useMemo)((function(){return"entry"===O?(0,R.jsx)(I.T,{}):(0,R.jsx)(U,{})}),[O]),A=(0,o.useMemo)((function(){var e,r;return t?(delete t.stepperPosition,L(L(L({},k.initialValues),{},{selectedNetwork:v},t),{},{aggregatorID:null!==(e=null==t||null===(r=t.swapTradeResponse)||void 0===r||null===(r=r.quote)||void 0===r?void 0:r.aggregatorID)&&void 0!==e?e:""})):L(L({},k.initialValues),{},{sourceWalletId:S,selectedNetwork:v,targetAssetId:d.targetAssetId||j||k.initialValues.targetAssetId})}),[v,t,d,S,j]),N=(0,o.useCallback)((function(e){var r=e.error,t=e.errorHash;(0,s.logEvent)("trade.full_screen_error.viewed",{errorHash:t,errorMessage:r.message,action:w.ActionType.view,componentType:w.ComponentType.page});var n=(0,i.coerceError)(r,"trade - log global error");(0,i.cbReportError)({error:n,metadata:{error:null==r?void 0:r.message},context:"swap-error",severity:"error",isHandled:!1})}),[]),M=(0,o.useCallback)((function(e){var r=e.error;return(0,R.jsx)(h._,{error:r})}),[]);return(0,R.jsx)(g.VStack,{height:y.IR,children:(0,R.jsx)(m.S,{onError:N,renderFallback:M,children:(0,R.jsx)(b.J,{fallback:C,children:(0,R.jsx)(k.form.Provider,{onSubmit:p(),initialValues:A,children:(0,R.jsx)(D,{defaultStep:O})})})})})}V(D,"useFields{{ selectedNetwork }}\nuseConcurrentSuspense{[supportedChains, mostPopularAsset]}",(function(){return[v.Z,u.useConcurrentSuspense]})),V(F,"usePersistTradeContextTimestamp{}\nuseRetrieveTradeContext{retrieveTradeContext}\nuseParams{routeParams}\nuseState{[params](routeParams)}\nuseTradeQueryParams{queryParams}\nuseMemo{sourceWalletId}\nuseMemo{targetAssetId}\nuseDefaultStep{defaultStep}\nuseMemo{fallbackComponent}\nuseMemo{initialFormValues}\nuseCallback{logGlobalError}\nuseCallback{renderFallback}",(function(){return[x.c,P.useRetrieveTradeContext,a.useParams,E.x,T.y]})),(_="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(_.register(D,"TradeContent","/workspaces/apps/extension/src/screens/Trade/Trade.tsx"),_.register(U,"EmptyFallback","/workspaces/apps/extension/src/screens/Trade/Trade.tsx"),_.register(F,"Trade","/workspaces/apps/extension/src/screens/Trade/Trade.tsx")),(G="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&G(e)},482576:(e,r,t)=>{t.d(r,{c:()=>c});var n,o=t(202784);e=t.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var a,s,i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},u="timeExtClosed",l="unload";function c(){(0,o.useEffect)((function(){function e(){var e=(new Date).getTime();localStorage.setItem(u,JSON.stringify(e))}return window.addEventListener(l,e),function(){window.removeEventListener(l,e)}}),[])}i(c,"useEffect{}"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(a.register(u,"timeExtClosedKey","/workspaces/apps/extension/src/screens/Trade/hooks/usePersistTradeContextTimestamp.tsx"),a.register(l,"eventName","/workspaces/apps/extension/src/screens/Trade/hooks/usePersistTradeContextTimestamp.tsx"),a.register(c,"usePersistTradeContextTimestamp","/workspaces/apps/extension/src/screens/Trade/hooks/usePersistTradeContextTimestamp.tsx")),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)},755256:(e,r,t)=>{r.z=void 0;const n=t(202784),o=t(647933),a=t(924719);r.z=function(e){const{redirectToRoute:r,onBeforeRedirect:t}=e,{replace:s}=(0,o.useHistory)(),i=(0,a.isInPopup)();return(0,n.useEffect)((function(){i&&r.length>0&&(t?.(),s(r))}),[s,t,r,i]),{isRenderedInPopup:i}}},586772:(e,r,t)=>{r.y=void 0;const n=t(202784),o=t(647933),a=t(728209),s=t(907075),i=t(335657),u=t(121387);r.y=function(){const e=(0,i.useRetrieveTradeContext)(),r=(0,u.useIsFirstSwap)(),{location:t}=(0,o.useHistory)();return(0,n.useMemo)((()=>{const n=e();return t.pathname===a.RoutesEnum.TRADE_NUX||r?s.TradeStepsEnum.SWAP_NUX:t.pathname.match(/trade\/gaslessNux\//)?s.TradeStepsEnum.GASLESS_SWAP_NUX:n?.swapTradeResponse&&n?.unsignedSwapTxResult?.transaction&&n?.unsignedSwapTxResult.wallet&&n?.stepperPosition&&n?.stepperPosition!==s.TradeStepsEnum.ENTRY?n.stepperPosition===s.TradeStepsEnum.CONFIRMATION_PREVIEW?s.TradeStepsEnum.CONFIRMATION_PREVIEW:n.stepperPosition===s.TradeStepsEnum.STATUS?s.TradeStepsEnum.STATUS:s.TradeStepsEnum.ENTRY:s.TradeStepsEnum.ENTRY}),[e,t.pathname,r])}},682507:(e,r,t)=>{r.x=void 0;const n=t(202784),o=t(647933);r.x=function(){const{search:e}=(0,o.useLocation)();return(0,n.useMemo)((()=>{const r=new URLSearchParams(e);return{targetAssetId:r.get("targetAssetId"),chainId:r.get("chainId")}}),[e])}},654683:(e,r,t)=>{r.c=void 0;const n=t(553476),o=t(118398),a=(0,n.atom)({key:"mostPopularSwapAsset",default:void 0,effects:[({setSelf:e})=>{e(async function(){return(await(0,o.getSortedSwapAssetStats)()??[])[0]}())}]});r.c=function(){return(0,n.useRecoilValue)(a)}},888716:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.useSwapAssetsByNetwork=r.ASSET_BY_NETWORK_QUERY_KEY=void 0;const n=t(602438),o=t(205418),a=t(352087),s=t(278292),i=t(57356),u=t(800354);r.ASSET_BY_NETWORK_QUERY_KEY="asset_by_network",r.useSwapAssetsByNetwork=function(){const e={},t=(0,a.useSupportedSwapChains)().filter((e=>Number(e.chainId)!==o.EVMChain.BSC)),l=(0,n.useQuery)([r.ASSET_BY_NETWORK_QUERY_KEY],(async()=>async function(e){const r={};return await Promise.all(e.map((async e=>{const t=e.chainId.toString();return(0,s.fetchSwapAssets)({chainId:t}).then((e=>{r[t]=e.result.map((e=>new i.SwapAsset(e)))})).catch((()=>{r[t]=[]}))}))),r}(t)),{suspense:!0,staleTime:6e4,notifyOnChangeProps:["data"],retry:3,retryDelay:e=>1e3*2**(e+1)});return l.data?(0,u.memoizeDerivedValue)(l.data,(()=>(Object.keys(l.data).forEach((r=>{e[r]=l.data[r].map((e=>e))})),e))):t.reduce((function(e,r){return e[r.chainId.toString()]=[],e}),{})}}}]);
//# sourceMappingURL=3891.js.map