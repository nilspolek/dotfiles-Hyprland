/*! For license information please see service.js.LICENSE.txt */
(()=>{var e={247359:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ActionType:()=>A,AmplitudePlatformName:()=>x,AnalyticsEventImportance:()=>E,AnalyticsQueries:()=>m,AuthStatus:()=>M,ComponentType:()=>N,IThresholdTier:()=>Mt,MetricType:()=>T,PlatformName:()=>C,SessionActions:()=>R,SessionAutomatedEvents:()=>O,SessionRank:()=>I,SubjectType:()=>S,UserTypeCommerce:()=>v,UserTypeInsto:()=>y,UserTypeRetail:()=>f,UserTypeRetailBusinessBanking:()=>b,UserTypeRetailEmployeeInternal:()=>g,UserTypeRetailEmployeePersonal:()=>_,UserTypeWallet:()=>w,automatedEvents:()=>an,automatedMappingConfig:()=>cn,clearMarkEntry:()=>yn,clearPerformanceMarkEntries:()=>gn,config:()=>W,createEventConfig:()=>sn,device:()=>ee,endPerfMark:()=>fn,exposeExperiment:()=>Xt,generateUUID:()=>ne,getAnalyticsHeaders:()=>wn,getReferrerData:()=>ye,getUrlHostname:()=>be,getUrlParams:()=>ve,getUrlPathname:()=>we,getUserContext:()=>En,identify:()=>Zt,identifyFlow:()=>Ie,identity:()=>te,identityFlow:()=>Re,init:()=>Jt,initNextJsTrackPageview:()=>tn,initTrackPageview:()=>en,isEventKeyFormatValid:()=>Ae,isSessionEnded:()=>ht,location:()=>ue,logEvent:()=>At,logMetric:()=>Ct,logPageView:()=>jt,markNTBT:()=>Lt,markStep:()=>Dt,markStepOnce:()=>qt,onVisibilityChange:()=>Kt,optIn:()=>rn,optOut:()=>nn,perfMark:()=>pn,persistentData:()=>pe,postMessage:()=>Z,recordSessionDuration:()=>Wt,removeFromIdentifyFlow:()=>Oe,savePersistentData:()=>lt,sendScheduledEvents:()=>vt,setBreadcrumbs:()=>he,setConfig:()=>H,setLocation:()=>de,setPagePath:()=>Ee,setPageview:()=>Le,setPersistentData:()=>me,setSessionStart:()=>ut,setTime:()=>rt,startPerfMark:()=>mn,timeStone:()=>nt,useEventLogger:()=>_n,useLogEventOnMount:()=>bn,usePerformanceMarks:()=>vn});var r=n(571419),i=n(768762),a=n.n(i),s=n(202784);function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let m;!function(e){e.fbclid="fbclid",e.gclid="gclid",e.msclkid="msclkid",e.ptclid="ptclid",e.ttclid="ttclid",e.utm_source="utm_source",e.utm_medium="utm_medium",e.utm_campaign="utm_campaign",e.utm_term="utm_term",e.utm_content="utm_content"}(m||(m={}));const f=0,y=1,g=2,_=3,b=4,v=5,w=6;let E,T,S,N,A,C,x,M,R,O,I;!function(e){e.low="low",e.high="high"}(E||(E={})),function(e){e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram"}(T||(T={})),function(e){e.commerce_merchant="commerce_merchant",e.device="device",e.edp_fingerprint="edp_fingerprint",e.nft="nft",e.user="user",e.wallet="wallet",e.uuid="user_uuid"}(S||(S={})),function(e){e.unknown="unknown",e.banner="banner",e.button="button",e.card="card",e.chart="chart",e.content_script="content_script",e.dropdown="dropdown",e.link="link",e.page="page",e.modal="modal",e.table="table",e.search_bar="search_bar",e.service_worker="service_worker",e.text="text",e.text_input="text_input",e.tray="tray",e.checkbox="checkbox",e.icon="icon"}(N||(N={})),function(e){e.unknown="unknown",e.blur="blur",e.click="click",e.change="change",e.dismiss="dismiss",e.focus="focus",e.hover="hover",e.select="select",e.measurement="measurement",e.move="move",e.process="process",e.render="render",e.scroll="scroll",e.view="view",e.search="search",e.keyPress="keyPress"}(A||(A={})),function(e){e.unknown="unknown",e.web="web",e.android="android",e.ios="ios",e.mobile_web="mobile_web",e.tablet_web="tablet_web",e.server="server",e.windows="windows",e.macos="macos",e.extension="extension"}(C||(C={})),function(e){e.web="Web",e.ios="iOS",e.android="Android"}(x||(x={})),function(e){e[e.notLoggedIn=0]="notLoggedIn",e[e.loggedIn=1]="loggedIn"}(M||(M={})),function(e){e.ac="ac",e.af="af",e.ah="ah",e.al="al",e.am="am",e.ar="ar",e.as="as"}(R||(R={})),function(e){e.pv="pv"}(O||(O={})),function(e){e.xs="xs",e.s="s",e.m="m",e.l="l",e.xl="xl",e.xxl="xxl"}(I||(I={}));const k="https://analytics-service-dev.cbhq.net",P="/amp",L="/metrics",D="/track-exposures",q="analytics-db",B="Analytics SDK:",j=Object.values(m),$="pageview",U="session_duration",F={navigationTiming:{eventName:"perf_navigation_timing"},redirectTime:{eventName:"perf_redirect_time"},RT:{eventName:"perf_redirect_time"},TTFB:{eventName:"perf_time_to_first_byte"},networkInformation:{eventName:"perf_network_information"},storageEstimate:{eventName:"perf_storage_estimate"},FCP:{eventName:"perf_first_contentful_paint"},FID:{eventName:"perf_first_input_delay"},LCP:{eventName:"perf_largest_contentful_paint"},CLS:{eventName:"perf_cumulative_layout_shift"},TBT:{eventName:"perf_total_blocking_time"},NTBT:{eventName:"perf_navigation_total_blocking_time"},INP:{eventName:"perf_interact_to_next_paint"},ET:{eventName:"perf_element_timing"}},K=/^(https?:\/\/)/,W={authCookie:"logged_in",amplitudeApiKey:"",batchEventsPeriod:5e3,batchEventsThreshold:30,batchMetricsPeriod:5e3,batchMetricsThreshold:30,headers:{},interactionManager:null,isAlwaysAuthed:!1,isProd:!1,onError:(e,t)=>{console.error(B,e,t)},platform:C.unknown,projectName:"",ricTimeoutScheduleEvent:1e3,ricTimeoutSetDevice:500,showDebugLogging:!1,trackUserId:!1,version:null,apiEndpoint:k,eventsEndpoint:k+P,metricsEndPoint:k+L,exposureEndpoint:k+D,steps:{}},V=function(e,...t){return t.reduce(((e,t)=>n=>e(t(n))),e)}((e=>{if(!0!==e.isProd)return e;const t=(n=e.apiEndpoint)?K.test(n)?n:`https://${n}`:"https://dp.coinbase.com";var n;return h(h({},e),{},{apiEndpoint:t,eventsEndpoint:t+P,metricsEndPoint:t+L,exposureEndpoint:t+D})})),H=e=>{Object.assign(W,V(e))},Q=[C.web,C.mobile_web,C.tablet_web],z=560,G=1024;function Y(){return"android"===W.platform}function J(){return"ios"===W.platform}function X(){return Q.includes(W.platform)}function Z(e){if(X()&&navigator&&"serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage(e)}catch(e){e instanceof Error&&W.onError(e)}}const ee={amplitudeOSName:null,amplitudeOSVersion:null,amplitudeDeviceModel:null,amplitudePlatform:null,browserName:null,browserMajor:null,osName:null,userAgent:null,width:null,height:null},te={countryCode:null,deviceId:null,device_os:null,isOptOut:!1,languageCode:null,locale:null,jwt:null,session_lcc_id:null,userId:null},ne=e=>e?(e^16*Math.random()>>e/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,ne),re=()=>W.isAlwaysAuthed||!!te.userId,ie=()=>{const e={};return te.countryCode&&(e.country_code=te.countryCode),e},ae=()=>{const e=W.platform;if(e===C.web)switch(!0){case window.matchMedia(`(max-width: ${z}px)`).matches:return C.mobile_web;case window.matchMedia(`(max-width: ${G}px, min-width: ${z+1}px)`).matches:return C.tablet_web}return e},se=e=>{Object.assign(te,e),X()&&Z({identity:{isAuthed:!!te.userId,locale:te.locale||null}})},oe=e=>{ee.height=e.height,ee.width=e.width},ce=()=>{H({platform:ae()}),X()&&Z({config:{platform:W.platform}})},le=()=>{performance.mark&&performance.mark("ua_parser_start");const e=new(n(846353))(ee.userAgent).getResult();ee.browserName=e.browser.name||null,ee.browserMajor=e.browser.major||null,ee.osName=e.os.name||null,ee.amplitudeOSName=ee.browserName,ee.amplitudeOSVersion=ee.browserMajor,ee.amplitudeDeviceModel=ee.osName,Z({device:{browserName:ee.browserName,osName:ee.osName}}),performance.mark&&(performance.mark("ua_parser_end"),performance.measure("ua_parser","ua_parser_start","ua_parser_end"))},ue={breadcrumbs:[],initialUAAData:{},pageKey:"",pageKeyRegex:{},pagePath:"",prevPageKey:"",prevPagePath:""};function he(e){Object.assign(ue,{breadcrumbs:e})}function de(e){Object.assign(ue,e)}const pe={eventId:0,sequenceNumber:0,sessionId:0,lastEventTime:0,sessionStart:0,sessionUUID:null,userId:null,ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0};function me(e){Object.assign(pe,e)}function fe(){return document?.referrer??""}const ye=()=>{const e=fe();if(!e)return{};const t=new URL(e);return t.hostname===be()?{}:{referrer:e,referring_domain:t.hostname}},ge=()=>{const e=new URLSearchParams(ve()),t={};return j.forEach((n=>{e.has(n)&&(t[n]=(e.get(n)||"").toLowerCase())})),t},_e=()=>{const e={};return j.forEach((t=>{pe[t]&&(e[t]=pe[t])})),e},be=()=>window?.location?.hostname||"",ve=()=>window?.location?.search||"",we=()=>window?.location?.pathname||"",Ee=()=>{const e=W.overrideWindowLocation?ue.pagePath:we()+ve();e&&e!==ue.pagePath&&(e!==ue.pagePath&&Te(),ue.pagePath=e,ue.pageKeyRegex&&Object.keys(ue.pageKeyRegex).some((e=>{if(ue.pageKeyRegex[e].test(ue.pagePath))return ue.pageKey=e,!0})))},Te=()=>{if(X()){const e=fe();if(!ue.prevPagePath&&e){const t=new URL(e);if(t.hostname===be())return void(ue.prevPagePath=t.pathname)}}ue.prevPagePath=ue.pagePath,ue.prevPageKey=ue.pageKey},Se=e=>{X()&&Object.assign(e,X()?(Object.keys(ue.initialUAAData).length>0||(new URLSearchParams(ve()),ue.initialUAAData=h(h(h({},_e()),ge()),ye())),ue.initialUAAData):ue.initialUAAData)},Ne=/^[a-zd]+(_[a-zd]+)*$/;function Ae(e){return Ne.test(e)}const Ce=["action","component_type","component_name","context","logging_id"],xe=["has_multi_account","has_ledger_multi_address","ujs"],Me="ujs_",Re={};function Oe(e){e.forEach((e=>{xe.includes(e)&&delete Re[e]}))}function Ie(e){const t=Object.entries(e).reduce(((e,t)=>{const n=c(t,2),r=n[0],i=n[1];return!Ce.includes(r)&&xe.includes(r)?Ae(r)?h(h({},e),{},{[r]:i}):(W.onError(new Error("IdentityFlow property names must have snake case format"),{[r]:i}),e):e}),{});t.ujs?.length&&(t.ujs=t.ujs.map((e=>`${Me}${e}`))),Object.assign(Re,t)}const ke={blacklistRegex:[],isEnabled:!1};function Pe(){return{page_key:ue.pageKey,page_path:ue.pagePath,prev_page_key:ue.prevPageKey,prev_page_path:ue.prevPagePath}}function Le(e){Object.assign(ke,e)}const De={eventsQueue:[],eventsScheduled:!1,metricsQueue:[],metricsScheduled:!1};const qe="application/x-www-form-urlencoded; charset=UTF-8",Be=e=>{const t=e.data,n=e.importance,r=e.isJSON,i=e.onError,a=e.url,s=r?"application/json":qe,o=n||E.low,c=r?JSON.stringify(t):new URLSearchParams(t).toString();if(!X()||r||!("sendBeacon"in navigator)||o!==E.low||W.headers&&0!==Object.keys(W.headers).length)if(X()&&!r){const e=new XMLHttpRequest;e.open("POST",a,!0),Object.keys(W.headers).forEach((t=>{e.setRequestHeader(t,W.headers[t])})),e.setRequestHeader("Content-Type",qe),te.jwt&&e.setRequestHeader("authorization",`Bearer ${te.jwt}`),e.send(c)}else{const e=h(h({},W.headers),{},{"Content-Type":s});te.jwt&&(e.Authorization=`Bearer ${te.jwt}`),fetch(a,{method:"POST",mode:"no-cors",headers:e,body:c}).catch((e=>{i(e,{context:"AnalyticsSDKApiError"})}))}else{const e=new Blob([c],{type:qe});navigator.sendBeacon(a,e)}},je="rgb(5,177,105)",$e=11,Ue=e=>{const t=e.metricName,n=e.data;if(!W.showDebugLogging||!console)return;const r=`%c ${B}`,i=`color:${je};font-size:${$e}px;`;console.group(r,i,t),n.forEach((e=>{e.event_type?console.log(e.event_type,e):console.log(e)})),console.groupEnd()},Fe=e=>{const t=e.metricName,n=e.data;if(!W.showDebugLogging||!console)return;const r=`color:${je};font-size:${$e}px;`,i=`%c ${B}`;console.log(i,r,t,n)},Ke=e=>e.map((e=>(e=>{const t=e.tags||{},n=h(h({authed:re()?"true":"false",platform:W.platform},t),{},{project_name:W.projectName,version_name:W.version||null});return{metric_name:e.metricName,page_path:e.pagePath||null,value:e.value,tags:n,type:e.metricType}})(e))),We={ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0},Ve={ac:20,af:5,ah:1,al:1,am:0,ar:10,as:20},He={pv:25},Qe=15,ze=60,Ge=240,Ye=960,Je=3840,Xe={xs:0,s:1,m:1,l:2,xl:2,xxl:2},Ze=e=>{Object.assign(We,e)},et=e=>{(e=>{switch(e.action){case A.click:We.ac+=1;break;case A.focus:We.af+=1;break;case A.hover:We.ah+=1;break;case A.move:We.am+=1;break;case A.scroll:We.al+=1;break;case A.search:We.ar+=1;break;case A.select:We.as+=1}})(e),e.event_type!==$?e.event_type===U&&((e=>{if(!e.session_rank)return;const t=e.session_rank;Object.values(R).forEach((e=>{We.sqs+=We[e]*Ve[e]})),Object.values(O).forEach((e=>{We.sqs+=We[e]*He[e]})),We.sqs*=Xe[t]})(e),Object.assign(e,We),Ze({ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0})):We.pv+=1};function tt(){return(new Date).getTime()}const nt={timeStart:tt(),timeOnPagePath:0,timeOnPageKey:0,prevTimeOnPagePath:0,prevTimeOnPageKey:0,sessionDuration:0,sessionEnd:0,sessionStart:0,prevSessionDuration:0};function rt(e){Object.assign(nt,e)}const it={isReady:!1,idbKeyval:null};function at(e){Object.assign(it,e)}const st={},ot=async()=>{if(!it.idbKeyval)return Promise.resolve(null);try{return await it.idbKeyval.get(q)}catch{return W.onError(new Error("IndexedDB:Get:InternalError")),Promise.resolve(null)}},ct=async e=>{if(it.idbKeyval)try{await it.idbKeyval.set(q,e)}catch{W.onError(new Error("IndexedDB:Set:InternalError"))}},lt=()=>{"server"!==W.platform&&(me({sessionStart:nt.sessionStart,ac:We.ac,af:We.af,ah:We.ah,al:We.al,am:We.am,ar:We.ar,as:We.as,pv:We.pv}),te.userId&&me({userId:te.userId}),ct(pe))},ut=()=>{const e=tt();pe.sessionId&&pe.lastEventTime&&pe.sessionUUID&&!ht(e)||(pe.sessionId=e,pe.sessionUUID=ne(),rt({sessionStart:e}),Fe({metricName:"Started new session:",data:{persistentData:pe,timeStone:nt}})),pe.lastEventTime=e},ht=e=>e-pe.lastEventTime>18e5,dt=e=>{et(e);const t=e.event_type;delete e.event_type;const n=e.deviceId?e.deviceId:null,r=e.timestamp;return delete e.timestamp,me({eventId:pe.eventId+1}),me({sequenceNumber:pe.sequenceNumber+1}),ut(),lt(),{device_id:te.deviceId||n||null,user_id:te.userId,timestamp:r,event_id:pe.eventId,session_id:pe.sessionId||-1,event_type:t,version_name:W.version||null,platform:ee.amplitudePlatform,os_name:ee.amplitudeOSName,os_version:ee.amplitudeOSVersion,device_model:ee.amplitudeDeviceModel,language:te.languageCode,event_properties:h(h({},e),{},{height:ee.height,width:ee.width}),user_properties:ie(),uuid:ne(),library:{name:"@cbhq/client-analytics",version:"8.3.0"},sequence_number:pe.sequenceNumber,user_agent:ee.userAgent}},pt=e=>e.map((e=>dt(e))),mt=e=>{X()&&window?.requestIdleCallback?window.requestIdleCallback(e,{timeout:W.ricTimeoutScheduleEvent}):(Y()||J())&&W.interactionManager?W.interactionManager.runAfterInteractions(e):e()},ft=(e,t,n)=>{const r=e||"";return a()("2"+r+t+n)};class yt extends Error{constructor(e){super(e),this.name="CircularJsonReference",this.message=e,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(e).stack}}class gt extends yt{constructor(...e){super(...e),this.name="DomReferenceInAnalyticsEvent"}}const _t=(e,t=E.low)=>{var n;(e&&De.eventsQueue.push(e),it.isReady)&&(!W.trackUserId||te.userId?(t===E.high||(n=bt,0!==De.eventsQueue.length&&(De.eventsQueue.length>=W.batchEventsThreshold||(De.eventsScheduled||(De.eventsScheduled=!0,setTimeout((()=>{De.eventsScheduled=!1,n(pt(De.eventsQueue)),De.eventsQueue=[]}),W.batchEventsPeriod)),0))))&&vt():De.eventsQueue.length>10&&(W.trackUserId=!1,W.onError(new Error("userId not set in Logged-in"))))},bt=(e,t=E.low)=>{if(te.isOptOut||0===e.length)return;let n;try{n=JSON.stringify(e)}catch(t){const r=e.map((e=>e.event_type)).join(", "),i=c((e=>{try{const n=[];for(const r of e){const e=h({},r);r.event_properties&&(e.event_properties=h(h({},e.event_properties),{},{currentTarget:null,target:null,relatedTarget:null,_dispatchInstances:null,_targetInst:null,view:(t=r.event_properties.view,["string","number","boolean"].includes(typeof t)?r.event_properties.view:null)})),n.push(e)}return[!0,JSON.stringify(n)]}catch(e){return[!1,""]}var t})(e),2),a=i[0],s=i[1];if(!a)return void W.onError(new yt(t instanceof Error?t.message:"unknown"),{listEventType:r});n=s,W.onError(new gt("Found DOM element reference"),{listEventType:r,stringifiedEventData:n})}const r=tt().toString(),i=h(h({},{e:n,v:"2",upload_time:r}),{},{client:W.amplitudeApiKey,checksum:ft(W.amplitudeApiKey,n,r)});Be({url:W.eventsEndpoint,data:i,importance:t,onError:W.onError}),Ue({metricName:"Batch Events",data:e})},vt=()=>{var e;bt(pt(De.eventsQueue)),e={eventsQueue:[]},Object.assign(De,e)},wt=Object.values(A),Et=Object.values(N),Tt=e=>wt.includes(e)?e:A.unknown,St=e=>Et.includes(e)?e:N.unknown,Nt=(e,t,n)=>{const r={auth:re()?M.loggedIn:M.notLoggedIn,action:Tt(e),component_type:St(t),logging_id:n,platform:W.platform,project_name:W.projectName};return"number"==typeof te.userTypeEnum&&(r.user_type_enum=te.userTypeEnum),r},At=(e,t,n=E.low)=>{if(te.isOptOut)return;if(W.platform===C.unknown)return void W.onError(new Error("SDK platform not initialized"));const r=(e=>{const t=tt();if(!e)return W.onError(new Error("missing logData")),h(h({},Nt(A.unknown,N.unknown)),{},{locale:te.locale,session_lcc_id:te.session_lcc_id,session_uuid:pe.sessionUUID,timestamp:t,time_start:nt.timeStart});const n=h(h(h({},e),Nt(e.action,e.componentType,e.loggingId)),{},{locale:te.locale,session_lcc_id:te.session_lcc_id,session_uuid:pe.sessionUUID,timestamp:t,time_start:nt.timeStart});return delete n.componentType,delete n.loggingId,n})(t);!function(e){ke.isEnabled&&(Ee(),Object.assign(e,Pe()))}(r),Se(r),function(e){Object.keys(Re).length>0&&Object.assign(e,Re)}(r),r.has_double_fired=!1,r.event_type=e,n===E.high?_t(r,n):mt((()=>{_t(r)}))},Ct=e=>{if(W.platform===C.unknown)return void W.onError(new Error("SDK platform not initialized"));C.server!==W.platform&&!e.pagePath&&ue.pagePath&&(e.pagePath=ue.pagePath);const t=!Object.keys(Re).length?e.tags:Object.assign({},e.tags,Re);if(t&&Object.assign(e,{tags:t}),De.metricsQueue.push(e),n=xt,0!==De.metricsQueue.length&&(De.metricsQueue.length>=W.batchMetricsThreshold||(De.metricsScheduled||(De.metricsScheduled=!0,setTimeout((()=>{De.metricsScheduled=!1,n(Ke(De.metricsQueue)),De.metricsQueue=[]}),W.batchMetricsPeriod)),0))){const e=Ke(De.metricsQueue);xt(e),De.metricsQueue=[]}var n},xt=e=>{mt((()=>{Be({url:W.metricsEndPoint,data:{metrics:e},isJSON:!0,onError:W.onError})})),Ue({metricName:"Batch Metrics",data:e})};let Mt;function Rt(e){return e.toLowerCase()}!function(e){e.instant="instant",e.quick="quick",e.moderate="moderate",e.slow="slow",e.unavoidable="unavoidable"}(Mt||(Mt={}));let Ot={};const It=(e,t)=>{W?.onMarkStep&&W.onMarkStep(e,t),Ie({ujs:t})};let kt;const Pt={Perfume:()=>{},markStep:e=>{},markStepOnce:e=>{}},Lt=()=>{X()&&kt&&kt.markNTBT&&kt.markNTBT()},Dt=e=>{X()&&kt&&Pt.markStep&&Pt.markStep(e)},qt=e=>{X()&&kt&&Pt.markStepOnce&&Pt.markStepOnce(e)},Bt=()=>{if(X())try{const e=n(27996);Pt.markStep=e.markStep,Pt.markStepOnce=e.markStepOnce,kt=new e.Perfume({analyticsTracker:e=>{const t=e.data,n=e.attribution,r=e.metricName,i=e.navigatorInformation,a=e.rating,s=F[r],o=n?.category||null;if(!s&&!o)return;const c=i?.deviceMemory||0,l=i?.hardwareConcurrency||0,u=i?.isLowEndDevice||!1,d=i?.isLowEndExperience||!1,p=i?.serviceWorkerStatus||"unsupported",m=h({deviceMemory:c,hardwareConcurrency:l,isLowEndDevice:u,isLowEndExperience:d,serviceWorkerStatus:p},Ot),f={is_low_end_device:u,is_low_end_experience:d,page_key:ue.pageKey||"",save_data:t.saveData||!1,service_worker:p,is_perf_metric:!0};if("navigationTiming"===r)t&&"number"==typeof t.redirectTime&&Ct({metricName:F.redirectTime.eventName,metricType:T.histogram,tags:f,value:t.redirectTime||0});else if("TTFB"===r)At(s.eventName,h({action:A.measurement,componentType:N.page,duration:t||null,vitalsScore:a||null},m)),Ct({metricName:F.TTFB.eventName,metricType:T.histogram,tags:h({},f),value:t}),a&&Ct({metricName:`perf_web_vitals_ttfb_${a}`,metricType:T.count,tags:f,value:1});else if("networkInformation"===r)t?.effectiveType&&(Ot=t,At(s.eventName,{action:A.measurement,componentType:N.page,networkInformationDownlink:t.downlink,networkInformationEffectiveType:t.effectiveType,networkInformationRtt:t.rtt,networkInformationSaveData:t.saveData,navigatorDeviceMemory:c,navigatorHardwareConcurrency:l}));else if("storageEstimate"===r)At(s.eventName,h(h({action:A.measurement,componentType:N.page},t),m)),Ct({metricName:"perf_storage_estimate_caches",metricType:T.histogram,tags:f,value:t.caches}),Ct({metricName:"perf_storage_estimate_indexed_db",metricType:T.histogram,tags:f,value:t.indexedDB});else if("CLS"===r)At(s.eventName,h({action:A.measurement,componentType:N.page,score:100*t||null,vitalsScore:a||null},m)),a&&Ct({metricName:`perf_web_vitals_cls_${a}`,metricType:T.count,tags:f,value:1});else if("FID"===r){const e=n?.performanceEntry||null,r=parseInt(e?.processingStart||"");At(s.eventName,h({action:A.measurement,componentType:N.page,duration:t||null,processingStart:e?.processingStart?r:null,startTime:e?.startTime?parseInt(e.startTime):null,vitalsScore:a||null},m)),a&&Ct({metricName:`perf_web_vitals_fidVitals_${a}`,metricType:T.count,tags:f,value:1})}else"step"===o?(At("perf_user_journey_step",h({action:A.measurement,componentType:N.page,duration:t||null,rating:a??null,step_name:r},m)),Ct({metricName:`user_journey_step.${W.projectName}.${W.platform}.${r}_vitals_${a}`,metricType:T.count,tags:f,value:1}),Ct({metricName:`user_journey_step.${W.projectName}.${W.platform}.${r}`,metricType:T.distribution,tags:f,value:t||null})):F[r]&&(At(s.eventName,h({action:A.measurement,componentType:N.page,duration:t||null,vitalsScore:a||null},m)),a&&Ct({metricName:`perf_web_vitals_${Rt(r)}_${a}`,metricType:T.count,tags:f,value:1}))},maxMeasureTime:3e4,steps:W.steps,onMarkStep:It})}catch(e){e instanceof Error&&W.onError(e)}};function jt(e={callMarkNTBT:!0}){"unknown"!==W.platform&&(ke.blacklistRegex.some((e=>e.test(we())))||(At($,{action:A.render,componentType:N.page}),e.callMarkNTBT&&Lt()))}let $t=!1,Ut=!1;const Ft=e=>{$t=!e.persisted},Kt=(e,t="hidden",n=!1)=>{Ut||(addEventListener("pagehide",Ft),addEventListener("beforeunload",(()=>{})),Ut=!0),addEventListener("visibilitychange",(({timeStamp:n})=>{document.visibilityState===t&&e({timeStamp:n,isUnloading:$t})}),{capture:!0,once:n})};const Wt=()=>{const e=ht(tt());if(e&&(j.forEach((e=>{pe[e]&&delete pe[e]})),lt()),!pe.lastEventTime||!nt.sessionStart||!e)return;const t=Math.round((pe.lastEventTime-nt.sessionStart)/1e3);if(t<1||t>36e3)return;const n=(e=>e<Qe?I.xs:e<ze?I.s:e<Ge?I.m:e<Ye?I.l:e<Je?I.xl:I.xxl)(t);At(U,{action:A.measurement,componentType:N.page,session_duration:t,session_end:pe.lastEventTime,session_start:nt.sessionStart,session_rank:n})};function Vt(){var e;X()&&(e=()=>{ce(),oe({width:window?.innerWidth??null,height:window?.innerHeight??null})},addEventListener("resize",(()=>{requestAnimationFrame((()=>{e()}))})))}const Ht=[],Qt=[],zt=async()=>{const e=await ot();at({isReady:!0}),Gt(),e&&(Yt(),me({eventId:e.eventId||pe.eventId,sequenceNumber:e.sequenceNumber||pe.sequenceNumber,sessionId:e.sessionId||pe.sessionId,lastEventTime:e.lastEventTime||pe.lastEventTime,sessionUUID:e.sessionUUID||pe.sessionUUID}),function(e){me(h(h({},function(e){const t={};return j.forEach((n=>{e[n]&&(t[n]=e[n])})),t}(e)),ge()))}(e),rt({sessionStart:e.sessionStart||pe.sessionStart}),Ze({ac:e.ac||We.ac,af:e.af||We.af,ah:e.ah||We.ah,al:e.al||We.al,am:e.am||We.am,ar:e.ar||We.ar,as:e.as||We.as,pv:e.pv||We.pv}),W.trackUserId&&se({userId:e.userId||te.userId}),Wt(),Fe({metricName:"Initialized Analytics IndexedDB:",data:e}))},Gt=()=>{const e=Ht.shift();e&&e()},Yt=()=>{const e=Qt.shift();e&&e()};const Jt=e=>{H(e),X()&&(te.languageCode=navigator?.languages[0]||navigator?.language||""),ce(),(()=>{if(X()&&window?.indexedDB){const e=(0,r.X3)("keyval-store",1,{upgrade(e){e.createObjectStore("keyval")}});at({idbKeyval:{get:async t=>(await e).get("keyval",t),set:async(t,n)=>(await e).put("keyval",n,t),delete:async t=>(await e).delete("keyval",t),keys:async()=>(await e).getAllKeys("keyval")}})}else at({idbKeyval:{get:async e=>new Promise((t=>{t(st[e])})),set:async(e,t)=>new Promise((n=>{st[e]=t,n(e)})),delete:async e=>new Promise((()=>{delete st[e]})),keys:async()=>new Promise((e=>{e(Object.keys(st))}))}})})(),Fe({metricName:"Initialized Analytics:",data:{deviceId:te.deviceId}}),Ht.push((()=>{_t()})),zt(),X()?("requestIdleCallback"in window?window.requestIdleCallback(le,{timeout:W.ricTimeoutSetDevice}):le(),ee.amplitudePlatform=x.web,ee.userAgent=window?.navigator?.userAgent||null,oe({height:window?.innerHeight??null,width:window?.innerWidth??null})):J()?ee.amplitudePlatform=x.ios:Y()&&(ee.amplitudePlatform=x.android),X()&&(Kt((()=>{me({lastEventTime:tt()}),lt(),vt()}),"hidden"),Kt((()=>{Wt()}),"visible")),Vt(),Bt()},Xt=e=>{const t=(e=>({test_name:e.testName,group_name:e.group,subject_id:e.subjectId,exposed_at:tt(),subject_type:e.subjectType,platform:W.platform}))(e);Be({url:W.exposureEndpoint,data:[t],onError:W.onError,isJSON:!0,importance:E.high}),Fe({metricName:"Event: exposeExperiment",data:t})},Zt=e=>{se(e),Fe({metricName:"Identify:",data:{countryCode:te.countryCode,deviceId:te.deviceId,userId:te.userId}})},en=({blacklistRegex:e,pageKeyRegex:t,browserHistory:n})=>{Le({blacklistRegex:e||[],isEnabled:!0}),de({pageKeyRegex:t}),jt({callMarkNTBT:!1}),n.listen((()=>{jt()}))},tn=({blacklistRegex:e,pageKeyRegex:t,nextJsRouter:n})=>{Le({blacklistRegex:e||[],isEnabled:!0}),de({pageKeyRegex:t}),jt({callMarkNTBT:!1});n.events.on("routeChangeComplete",(()=>{jt()}))},nn=()=>{se({isOptOut:!0}),ct({})},rn=()=>{se({isOptOut:!1})},an={Button:{label:"cb_button",uuid:"e921a074-40e6-4371-8700-134d5cd633e6",componentType:N.button}};function sn(e,t,n){return{componentName:e,actions:t,data:n}}function on(e,t,n){const r=n.componentName,i=n.data;At(e.label,h({componentType:e.componentType,action:t,loggingId:e.uuid,component_name:r},i))}const cn={actionMapping:{onPress:A.click,onHover:A.hover},handlers:{Button:{[A.click]:e=>on(an.Button,A.click,e),[A.hover]:e=>on(an.Button,A.hover,e)}}};const ln=()=>void 0!==typeof window&&"performance"in window&&"mark"in performance&&"getEntriesByName"in performance,un=(e,t)=>`perf_${e}${t?.label?`_${t.label}`:""}`,hn=(e,t,n)=>`${un(e,n)}__${t}`;let dn={};const pn=(e,t,n)=>{if(!ln())return;const r=hn(e,t,n);if(performance.mark(r),"end"===t){const t=un(e,n);!function(e,t,n){try{performance.measure(e,t,n)}catch(e){W.onError(e)}}(t,hn(e,"start",n),r);const i=performance.getEntriesByName(t).pop();i&&Ct(h({metricName:e,metricType:T.distribution,value:i.duration},n?.tags?{tags:n.tags}:{}))}},mn=(e,t)=>{if(!ln())return;const n=hn(e,"start",t);dn[n]||(pn(e,"start",t),dn[n]=!0)},fn=(e,t)=>{if(!ln())return;const n=hn(e,"start",t);dn[n]&&(pn(e,"end",t),yn(e,t))},yn=(e,t)=>{const n=hn(e,"start",t),r=dn,i=(r[n],o(r,[n].map(p)));dn=i},gn=()=>{ln()&&(performance.clearMarks(),dn={})};function _n(e,t,n=E.low){const r=(0,s.useRef)(t);return(0,s.useEffect)((()=>{r.current=t}),[t]),(0,s.useCallback)((t=>{At(e,h(h({},r.current),t),n)}),[e,n])}function bn(e,t){(0,s.useEffect)((()=>{const n=h(h({},t),{},{action:A.render});At(e,n)}),[])}function vn(e,t){return{markStartPerf:(0,s.useCallback)((()=>mn(e,t)),[e,t]),markEndPerf:(0,s.useCallback)((n=>fn(e,h(h({},t),n))),[e,t])}}function wn(){return{"X-CB-Device-ID":te.deviceId||"unknown","X-CB-Is-Logged-In":te.userId?"true":"false","X-CB-Pagekey":ue.pageKey||"unknown","X-CB-UJS":(e=Re.ujs,void 0===e||0===e.length?"":e.join(",")),"X-CB-Platform":W.platform||"unknown","X-CB-Project-Name":W.projectName||"unknown","X-CB-Session-UUID":pe.sessionUUID||"unknown","X-CB-Version-Name":W.version?String(W.version):"unknown"};var e}function En(){return Object.entries(h(h(h({},Re),Pe()),{},{sessionUUID:pe.sessionUUID,userId:pe.userId})).reduce(((e,t)=>{return null!=(n=t[1])&&""!==n?h(h({},e),{},{[t[0]]:t[1]}):e;var n}),{})}},27996:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Perfume:()=>je,markStep:()=>De,markStepOnce:()=>qe});var r,i,a={isResourceTiming:!1,isElementTiming:!1,maxTime:3e4,reportOptions:{}},s=window,o=s.console,c=s.navigator,l=s.performance,u=function(){return c.deviceMemory},h=function(){return c.hardwareConcurrency},d="mark.",p=function(){return l&&!!l.getEntriesByType&&!!l.now&&!!l.mark},m="4g",f=!1,y={},g={value:0},_={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},b={value:0},v={value:0},w={},E={isHidden:!1,didChange:!1},T=function(){E.isHidden=!1,document.hidden&&(E.isHidden=document.hidden,E.didChange=!0)},S=function(e,t){try{var n=new PerformanceObserver((function(e){t(e.getEntries())}));return n.observe({type:e,buffered:!0}),n}catch(e){o.warn("Perfume.js:",e)}return null},N=function(){return!!(h()&&h()<=4)||!!(u()&&u()<=4)},A=function(e,t){switch(e){case"slow-2g":case"2g":case"3g":return!0;default:return N()||t}},C=function(e){return parseFloat(e.toFixed(4))},x=function(e){return"number"!=typeof e?null:C(e/Math.pow(1024,2))},M=function(e,t,n,r,i){var o,l=function(){a.analyticsTracker&&(E.isHidden&&!["CLS","INP"].includes(e)||a.analyticsTracker({attribution:r,metricName:e,data:t,navigatorInformation:c?{deviceMemory:u()||0,hardwareConcurrency:h()||0,serviceWorkerStatus:"serviceWorker"in c?c.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:N(),isLowEndExperience:A(m,f)}:{},rating:n,navigationType:i}))};["CLS","INP"].includes(e)?l():(o=l,"requestIdleCallback"in s?s.requestIdleCallback(o,{timeout:3e3}):o())},R=function(e){e.forEach((function(e){if(!("self"!==e.name||e.startTime<g.value)){var t=e.duration-50;t>0&&(b.value+=t,v.value+=t)}}))};!function(e){e.instant="instant",e.quick="quick",e.moderate="moderate",e.slow="slow",e.unavoidable="unavoidable"}(r||(r={}));var O,I,k,P,L,D=((i={})[r.instant]={vitalsThresholds:[100,200],maxOutlierThreshold:1e4},i[r.quick]={vitalsThresholds:[200,500],maxOutlierThreshold:1e4},i[r.moderate]={vitalsThresholds:[500,1e3],maxOutlierThreshold:1e4},i[r.slow]={vitalsThresholds:[1e3,2e3],maxOutlierThreshold:1e4},i[r.unavoidable]={vitalsThresholds:[2e3,5e3],maxOutlierThreshold:2e4},i),q={RT:[100,200],TBT:[200,600],NTBT:[200,600]},B=function(e,t){return q[e]?t<=q[e][0]?"good":t<=q[e][1]?"needsImprovement":"poor":null},j=function(e,t,n){Object.keys(t).forEach((function(e){"number"==typeof t[e]&&(t[e]=C(t[e]))})),M(e,t,null,n||{})},$=function(e){var t=e.attribution,n=e.name,r=e.rating,i=e.value,s=e.navigationType;"FCP"===n&&(g.value=i),["FCP","LCP"].includes(n)&&!w[0]&&(w[0]=S("longtask",R)),"FID"===n&&setTimeout((function(){E.didChange||($({attribution:t,name:"TBT",rating:B("TBT",b.value),value:b.value,navigationType:s}),j("dataConsumption",_.value))}),1e4);var o=C(i);o<=a.maxTime&&o>=0&&M(n,o,r,t,s)},U=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},F=function(e){if("loading"===document.readyState)return"loading";var t=U();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},K=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},W=function(e,t){var n="";try{for(;e&&9!==e.nodeType;){var r=e,i=r.id?"#"+r.id:K(r)+(r.className&&r.className.length?"."+r.className.replace(/\s+/g,"."):"");if(n.length+i.length>(t||100)-1)return n||i;if(n=n?i+">"+n:i,r.id)break;e=r.parentNode}}catch(e){}return n},V=-1,H=function(){return V},Q=function(e){addEventListener("pageshow",(function(t){t.persisted&&(V=t.timeStamp,e(t))}),!0)},z=function(){var e=U();return e&&e.activationStart||0},G=function(e,t){var n=U(),r="navigate";return H()>=0?r="back-forward-cache":n&&(r=document.prerendering||z()>0?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},Y=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},J=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},X=function(e,t,n,r){var i,a;return function(s){t.value>=0&&(s||r)&&((a=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=a,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},Z=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},ee=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},te=-1,ne=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},re=function(e){"hidden"===document.visibilityState&&te>-1&&(te="visibilitychange"===e.type?e.timeStamp:0,ae())},ie=function(){addEventListener("visibilitychange",re,!0),addEventListener("prerenderingchange",re,!0)},ae=function(){removeEventListener("visibilitychange",re,!0),removeEventListener("prerenderingchange",re,!0)},se=function(){return te<0&&(te=ne(),ie(),Q((function(){setTimeout((function(){te=ne(),ie()}),0)}))),{get firstHiddenTime(){return te}}},oe=function(e,t){t=t||{},ee((function(){var n,r=[1800,3e3],i=se(),a=G("FCP"),s=Y("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<i.firstHiddenTime&&(a.value=Math.max(e.startTime-z(),0),a.entries.push(e),n(!0)))}))}));s&&(n=X(e,a,r,t.reportAllChanges),Q((function(i){a=G("FCP"),n=X(e,a,r,t.reportAllChanges),Z((function(){a.value=performance.now()-i.timeStamp,n(!0)}))})))}))},ce={passive:!0,capture:!0},le=new Date,ue=function(e,t){O||(O=t,I=e,k=new Date,pe(removeEventListener),he())},he=function(){if(I>=0&&I<k-le){var e={entryType:"first-input",name:O.type,target:O.target,cancelable:O.cancelable,startTime:O.timeStamp,processingStart:O.timeStamp+I};P.forEach((function(t){t(e)})),P=[]}},de=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){ue(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,ce),removeEventListener("pointercancel",r,ce)};addEventListener("pointerup",n,ce),addEventListener("pointercancel",r,ce)}(t,e):ue(t,e)}},pe=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,de,ce)}))},me=0,fe=1/0,ye=0,ge=function(e){e.forEach((function(e){e.interactionId&&(fe=Math.min(fe,e.interactionId),ye=Math.max(ye,e.interactionId),me=ye?(ye-fe)/7+1:0)}))},_e=function(){return L?me:performance.interactionCount||0},be=0,ve=function(){return _e()-be},we=[],Ee={},Te=function(e){var t=we[we.length-1],n=Ee[e.interactionId];if(n||we.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};Ee[r.id]=r,we.push(r)}we.sort((function(e,t){return t.latency-e.latency})),we.splice(10).forEach((function(e){delete Ee[e.id]}))}},Se=function(e,t){!function(e,t){t=t||{},ee((function(){var n=[200,500];"interactionCount"in performance||L||(L=Y("event",ge,{type:"event",buffered:!0,durationThreshold:0}));var r,i=G("INP"),a=function(e){e.forEach((function(e){e.interactionId&&Te(e),"first-input"===e.entryType&&!we.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))&&Te(e)}));var t,n=(t=Math.min(we.length-1,Math.floor(ve()/50)),we[t]);n&&n.latency!==i.value&&(i.value=n.latency,i.entries=n.entries,r())},s=Y("event",a,{durationThreshold:t.durationThreshold||40});r=X(e,i,n,t.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),J((function(){a(s.takeRecords()),i.value<0&&ve()>0&&(i.value=0,i.entries=[]),r(!0)})),Q((function(){we=[],be=_e(),i=G("INP"),r=X(e,i,n,t.reportAllChanges)})))}))}((function(t){!function(e){if(e.entries.length){var t=e.entries.sort((function(e,t){return t.duration-e.duration||t.processingEnd-t.processingStart-(e.processingEnd-e.processingStart)}))[0];e.attribution={eventTarget:W(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:F(t.startTime)}}else e.attribution={}}(t),e(t)}),t)},Ne={},Ae=function e(t){document.prerendering?ee((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},Ce=function(e,t){t=t||{};var n=[800,1800],r=G("TTFB"),i=X(e,r,n,t.reportAllChanges);Ae((function(){var a=U();if(a){var s=a.responseStart;if(s<=0||s>performance.now())return;r.value=Math.max(s-z(),0),r.entries=[a],i(!0),Q((function(){r=G("TTFB",0),(i=X(e,r,n,t.reportAllChanges))(!0)}))}}))},xe=function(e){e.forEach((function(e){e.identifier&&$({attribution:{identifier:e.identifier},name:"ET",rating:null,value:e.startTime})}))},Me=function(e){e.forEach((function(e){if(a.isResourceTiming&&j("resourceTiming",e),e.decodedBodySize&&e.initiatorType){var t=e.decodedBodySize/1e3;_.value[e.initiatorType]+=t,_.value.total+=t}}))},Re=function(){!function(e,t){Ce((function(e){!function(e){if(e.entries.length){var t=e.entries[0],n=t.activationStart||0,r=Math.max(t.domainLookupStart-n,0),i=Math.max(t.connectStart-n,0),a=Math.max(t.requestStart-n,0);e.attribution={waitingTime:r,dnsTime:i-r,connectionTime:a-i,requestTime:e.value-a,navigationEntry:t}}else e.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}}(e),function(e){e.value>0&&$(e)}(e)}),t)}(0,a.reportOptions.ttfb),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[.1,.25],i=G("CLS"),a=-1,s=0,o=[],c=function(t){a>-1&&e(t)},l=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],r=o[o.length-1];s&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(s+=e.value,o.push(e)):(s=e.value,o=[e]),s>i.value&&(i.value=s,i.entries=o,n())}}))},u=Y("layout-shift",l);u&&(n=X(c,i,r,t.reportAllChanges),oe((function(e){a=e.value,i.value<0&&(i.value=0,n())})),J((function(){l(u.takeRecords()),n(!0)})),Q((function(){s=0,a=-1,i=G("CLS",0),n=X(c,i,r,t.reportAllChanges),Z((function(){return n()}))})))}))}((function(e){!function(e){if(e.entries.length){var t=e.entries.reduce((function(e,t){return e&&e.value>t.value?e:t}));if(t&&t.sources&&t.sources.length){var n=(r=t.sources).find((function(e){return e.node&&1===e.node.nodeType}))||r[0];if(n)return void(e.attribution={largestShiftTarget:W(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:F(t.startTime)})}}var r;e.attribution={}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.cls),function(e,t){oe((function(e){!function(e){if(e.entries.length){var t=U(),n=e.entries[e.entries.length-1];if(t){var r=t.activationStart||0,i=Math.max(0,t.responseStart-r);return void(e.attribution={timeToFirstByte:i,firstByteToFCP:e.value-i,loadState:F(e.entries[0].startTime),navigationEntry:t,fcpEntry:n})}}e.attribution={timeToFirstByte:0,firstByteToFCP:e.value,loadState:F(H())}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.fcp),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[100,300],i=se(),a=G("FID"),s=function(e){e.startTime<i.firstHiddenTime&&(a.value=e.processingStart-e.startTime,a.entries.push(e),n(!0))},o=function(e){e.forEach(s)},c=Y("first-input",o);n=X(e,a,r,t.reportAllChanges),c&&J((function(){o(c.takeRecords()),c.disconnect()}),!0),c&&Q((function(){var i;a=G("FID"),n=X(e,a,r,t.reportAllChanges),P=[],I=-1,O=null,pe(addEventListener),i=s,P.push(i),he()}))}))}((function(e){!function(e){var t=e.entries[0];e.attribution={eventTarget:W(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:F(t.startTime)}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.fid),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[2500,4e3],i=se(),a=G("LCP"),s=function(e){var t=e[e.length-1];if(t){var r=Math.max(t.startTime-z(),0);r<i.firstHiddenTime&&(a.value=r,a.entries=[t],n())}},o=Y("largest-contentful-paint",s);if(o){n=X(e,a,r,t.reportAllChanges);var c=function(){Ne[a.id]||(s(o.takeRecords()),o.disconnect(),Ne[a.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),J(c,!0),Q((function(i){a=G("LCP"),n=X(e,a,r,t.reportAllChanges),Z((function(){a.value=performance.now()-i.timeStamp,Ne[a.id]=!0,n(!0)}))}))}}))}((function(e){!function(e){if(e.entries.length){var t=U();if(t){var n=t.activationStart||0,r=e.entries[e.entries.length-1],i=r.url&&performance.getEntriesByType("resource").filter((function(e){return e.name===r.url}))[0],a=Math.max(0,t.responseStart-n),s=Math.max(a,i?(i.requestStart||i.startTime)-n:0),o=Math.max(s,i?i.responseEnd-n:0),c=Math.max(o,r?r.startTime-n:0),l={element:W(r.element),timeToFirstByte:a,resourceLoadDelay:s-a,resourceLoadTime:o-s,elementRenderDelay:c-o,navigationEntry:t,lcpEntry:r};return r.url&&(l.url=r.url),i&&(l.lcpResourceEntry=i),void(e.attribution=l)}}e.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:e.value}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.lcp),Se((function(e){return $(e)}),a.reportOptions.inp),a.isResourceTiming&&S("resource",Me),a.isElementTiming&&S("element",xe)},Oe=function(e){var t="usageDetails"in e?e.usageDetails:{};j("storageEstimate",{quota:x(e.quota),usage:x(e.usage),caches:x(t.caches),indexedDB:x(t.indexedDB),serviceWorker:x(t.serviceWorkerRegistrations)})},Ie={finalMarkToStepsMap:{},startMarkToStepsMap:{},active:{}},ke=function(e){delete Ie.active[e]},Pe=function(e,t,n){var r="step."+e,i=l.getEntriesByName(d+t).length>0;if(l.getEntriesByName(d+n).length>0&&a.steps){var s=D[a.steps[e].threshold],o=s.maxOutlierThreshold,c=s.vitalsThresholds;if(i){var u=l.measure(r,d+t,d+n),h=u.duration;if(h<=o){var p=function(e,t){return e<=t[0]?"good":e<=t[1]?"needsImprovement":"poor"}(h,c);h>=0&&(M(e,h,p,{category:"step"},void 0),l.measure("step.".concat(e,"_vitals_").concat(p),{start:u.startTime+u.duration,end:u.startTime+u.duration,detail:{type:"stepVital",duration:h}}))}}}},Le=function(e){var t;if(Ie.finalMarkToStepsMap[e]){var n=Ie.finalMarkToStepsMap[e];Object.keys(n).forEach((function(t){var r=n[t];r.forEach(ke),Promise.all(r.map((function(n){return function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function o(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((r=r.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function(){return function(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(r){switch(r.label){case 0:return[4,Pe(n,t,e)];case 1:return r.sent(),[2]}}))}))}))).catch((function(){}))}))}else!function(e){var t,n=null!==(t=Ie.startMarkToStepsMap[e])&&void 0!==t?t:[];Object.keys(n).forEach((function(e){Ie.active[e]||(Ie.active[e]=!0)}))}(e);null===(t=a.onMarkStep)||void 0===t||t.call(a,e,Object.keys(Ie.active))},De=function(e){l.mark(d+e),Le(e)},qe=function(e){0===l.getEntriesByName(d+e).length&&(l.mark(d+e),Le(e))},Be=0,je=function(){function e(e){if(void 0===e&&(e={}),this.v="9.0.0-rc.2",a.analyticsTracker=e.analyticsTracker,a.isResourceTiming=!!e.resourceTiming,a.isElementTiming=!!e.elementTiming,a.maxTime=e.maxMeasureTime||a.maxTime,a.reportOptions=e.reportOptions||a.reportOptions,a.steps=e.steps,a.onMarkStep=e.onMarkStep,p()){"PerformanceObserver"in s&&Re(),void 0!==document.hidden&&document.addEventListener("visibilitychange",T);var t=function(){if(!p())return{};var e=l.getEntriesByType("navigation")[0];if(!e)return{};var t=e.responseStart,n=e.responseEnd;return{fetchTime:n-e.fetchStart,workerTime:e.workerStart>0?n-e.workerStart:0,totalTime:n-e.requestStart,downloadTime:n-t,timeToFirstByte:t-e.requestStart,headerSize:e.transferSize-e.encodedBodySize||0,dnsLookupTime:e.domainLookupEnd-e.domainLookupStart,redirectTime:e.redirectEnd-e.redirectStart}}();j("navigationTiming",t),t.redirectTime&&$({attribution:{},name:"RT",rating:B("RT",t.redirectTime),value:t.redirectTime}),j("networkInformation",function(){if("connection"in c){var e=c.connection;return"object"!=typeof e?{}:(m=e.effectiveType,f=!!e.saveData,{downlink:e.downlink,effectiveType:e.effectiveType,rtt:e.rtt,saveData:!!e.saveData})}return{}}()),c&&c.storage&&"function"==typeof c.storage.estimate&&c.storage.estimate().then(Oe),a.steps&&a.steps&&(Ie.startMarkToStepsMap={},Ie.finalMarkToStepsMap={},Ie.active={},Object.entries(a.steps).forEach((function(e){var t,n,r=e[0],i=e[1].marks,a=i[0],s=i[1],o=null!==(n=Ie.startMarkToStepsMap[a])&&void 0!==n?n:{};if(o[r]=!0,Ie.startMarkToStepsMap[a]=o,Ie.finalMarkToStepsMap[s]){var c=Ie.finalMarkToStepsMap[s][a];c.push(r),Ie.finalMarkToStepsMap[s][a]=c}else Ie.finalMarkToStepsMap[s]=((t={})[a]=[r],t)})))}}return e.prototype.start=function(e){p()&&!y[e]&&(y[e]=!0,l.mark("mark_".concat(e,"_start")))},e.prototype.end=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!0),p()&&y[e]){l.mark("mark_".concat(e,"_end")),delete y[e];var r=function(e){l.measure(e,"mark_".concat(e,"_start"),"mark_".concat(e,"_end"));var t=l.getEntriesByName(e).pop();return t&&"measure"===t.entryType?t.duration:-1}(e);n&&j(e,C(r),t)}},e.prototype.endPaint=function(e,t){var n=this;setTimeout((function(){n.end(e,t)}))},e.prototype.clear=function(e){delete y[e],l.clearMarks&&(l.clearMarks("mark_".concat(e,"_start")),l.clearMarks("mark_".concat(e,"_end")))},e.prototype.markNTBT=function(){var e=this;this.start("ntbt"),v.value=0,clearTimeout(Be),Be=setTimeout((function(){e.end("ntbt",{},!1),$({attribution:{},name:"NTBT",rating:B("NTBT",v.value),value:v.value}),v.value=0}),2e3)},e}()},395545:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ActionType:()=>x,AmplitudePlatformName:()=>R,AnalyticsEventImportance:()=>S,AnalyticsQueries:()=>y,AuthStatus:()=>O,ComponentType:()=>C,IThresholdTier:()=>Ft,MetricType:()=>N,PlatformName:()=>M,SessionActions:()=>I,SessionAutomatedEvents:()=>k,SessionRank:()=>P,SubjectType:()=>A,UserTypeCommerce:()=>E,UserTypeInsto:()=>_,UserTypeRetail:()=>g,UserTypeRetailBusinessBanking:()=>w,UserTypeRetailEmployeeInternal:()=>b,UserTypeRetailEmployeePersonal:()=>v,UserTypeWallet:()=>T,automatedEvents:()=>wn,automatedMappingConfig:()=>Sn,clearMarkEntry:()=>Fn,clearPerformanceMarkEntries:()=>Wn,config:()=>Y,createEventConfig:()=>En,createNewSpan:()=>On,createNewTrace:()=>Pn,device:()=>se,endPerfMark:()=>Kn,exposeExperiment:()=>mn,flushQueue:()=>Gn,generateUUID:()=>ce,getAnalyticsHeaders:()=>Yn,getReferrerData:()=>Te,getTracingHeaders:()=>Mn,getTracingHeadersFromSpan:()=>Rn,getTracingId:()=>xn,getUrlHostname:()=>Ae,getUrlParams:()=>Ce,getUrlPathname:()=>xe,getUserContext:()=>zn,identify:()=>yn,identifyFlow:()=>je,identity:()=>oe,identityFlow:()=>qe,incrementUjNavigation:()=>Jt,init:()=>fn,initNextJsTrackPageview:()=>_n,initTrackPageview:()=>gn,isEventKeyFormatValid:()=>ke,isSessionEnded:()=>ft,location:()=>ge,logEvent:()=>jt,logMetric:()=>Ut,logPageView:()=>Zt,logTrace:()=>Ln,markNTBT:()=>zt,markStep:()=>Gt,markStepOnce:()=>Yt,onVisibilityChange:()=>rn,optIn:()=>vn,optOut:()=>bn,perfMark:()=>$n,persistentData:()=>ve,postMessage:()=>ae,recordSessionDuration:()=>sn,removeFromIdentifyFlow:()=>Be,savePersistentData:()=>lt,sendScheduledEvents:()=>Mt,setBreadcrumbs:()=>_e,setConfig:()=>X,setLocation:()=>be,setPagePath:()=>Me,setPageview:()=>Bt,setPersistentData:()=>we,setSessionStart:()=>mt,setTime:()=>rt,startPerfMark:()=>Un,timeStone:()=>nt,updateSpan:()=>In,updateTrace:()=>kn,useEventLogger:()=>Vn,useLogEventOnMount:()=>Hn,usePerformanceMarks:()=>Qn});var r=n(846353),i=n.n(r),a=n(571419),s=n(768762),o=n.n(s),c=n(202784);function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}let y=function(e){return e.fbclid="fbclid",e.gclid="gclid",e.msclkid="msclkid",e.ptclid="ptclid",e.ttclid="ttclid",e.utm_source="utm_source",e.utm_medium="utm_medium",e.utm_campaign="utm_campaign",e.utm_term="utm_term",e.utm_content="utm_content",e}({});const g=0,_=1,b=2,v=3,w=4,E=5,T=6;let S=function(e){return e.low="low",e.high="high",e}({}),N=function(e){return e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram",e}({}),A=function(e){return e.commerce_merchant="commerce_merchant",e.device="device",e.edp_fingerprint_id="edp_fingerprint_id",e.nft_user="nft_user",e.user="user",e.wallet_user="wallet_user",e.uuid="user_uuid",e}({}),C=function(e){return e.unknown="unknown",e.banner="banner",e.button="button",e.card="card",e.chart="chart",e.content_script="content_script",e.dropdown="dropdown",e.link="link",e.page="page",e.modal="modal",e.table="table",e.search_bar="search_bar",e.service_worker="service_worker",e.text="text",e.text_input="text_input",e.tray="tray",e.checkbox="checkbox",e.icon="icon",e}({}),x=function(e){return e.unknown="unknown",e.blur="blur",e.click="click",e.change="change",e.dismiss="dismiss",e.focus="focus",e.hover="hover",e.select="select",e.measurement="measurement",e.move="move",e.process="process",e.render="render",e.scroll="scroll",e.view="view",e.search="search",e.keyPress="keyPress",e}({}),M=function(e){return e.unknown="unknown",e.web="web",e.android="android",e.ios="ios",e.mobile_web="mobile_web",e.tablet_web="tablet_web",e.server="server",e.windows="windows",e.macos="macos",e.extension="extension",e}({}),R=function(e){return e.web="Web",e.ios="iOS",e.android="Android",e}({}),O=function(e){return e[e.notLoggedIn=0]="notLoggedIn",e[e.loggedIn=1]="loggedIn",e}({}),I=function(e){return e.ac="ac",e.af="af",e.ah="ah",e.al="al",e.am="am",e.ar="ar",e.as="as",e}({}),k=function(e){return e.pv="pv",e}({}),P=function(e){return e.xs="xs",e.s="s",e.m="m",e.l="l",e.xl="xl",e.xxl="xxl",e}({});const L="https://analytics-service-dev.cbhq.net",D=3e5,q=5e3,B="analytics-db",j="experiment-exposure-db",$="Analytics SDK:",U=Object.values(y),F="pageview",K="session_duration",W={navigationTiming:{eventName:"perf_navigation_timing"},redirectTime:{eventName:"perf_redirect_time"},RT:{eventName:"perf_redirect_time"},TTFB:{eventName:"perf_time_to_first_byte"},networkInformation:{eventName:"perf_network_information"},storageEstimate:{eventName:"perf_storage_estimate"},FCP:{eventName:"perf_first_contentful_paint"},FID:{eventName:"perf_first_input_delay"},LCP:{eventName:"perf_largest_contentful_paint"},CLS:{eventName:"perf_cumulative_layout_shift"},TBT:{eventName:"perf_total_blocking_time"},NTBT:{eventName:"perf_navigation_total_blocking_time"},INP:{eventName:"perf_interact_to_next_paint"},ET:{eventName:"perf_element_timing"},userJourneyStep:{eventName:"perf_user_journey_step"}},V="1",H="web",Q=["access_token","refresh_token","reset_token"],z=/^(https?:\/\/)/;function G(e){return{eventsEndpoint:e+"/amp",metricsEndPoint:e+"/metrics",exposureEndpoint:e+"/track-exposures",tracesEndpoint:e+"/traces"}}const Y=p(p({authCookie:"logged_in",amplitudeApiKey:"",batchEventsPeriod:q,batchEventsThreshold:30,batchMetricsPeriod:q,batchMetricsThreshold:30,batchTracesPeriod:q,batchTracesThreshold:30,headers:{},interactionManager:null,isAlwaysAuthed:!1,isProd:!1,isInternalApplication:!1,onError:(e,t)=>{console.error($,e,t)},platform:M.unknown,projectName:"",ricTimeoutScheduleEvent:1e3,ricTimeoutSetDevice:500,showDebugLogging:!1,trackUserId:!1,version:null,apiEndpoint:L},G(L)),{},{steps:{},disableReporting:!1});const J=function(e,...t){return t.reduce(((e,t)=>n=>e(t(n))),e)}((e=>{if(!e.isProd)return e.isInternalApplication?(e.apiEndpoint="https://analytics-service-internal-dev.cbhq.net",p(p({},e),G(e.apiEndpoint))):e;const t=(e=>e.apiEndpoint?z.test(e.apiEndpoint)?e.apiEndpoint:`https://${e.apiEndpoint}`:e.isInternalApplication?"https://analytics-service-internal.cbhq.net":"https://as.coinbase.com")(e);return p(p({},e),{},{apiEndpoint:t},G(t))}),(function(e){const t=e.revokedQueryParams?e.revokedQueryParams:[];return p(p({},e),{},{revokedQueryParams:Q.concat(t)})}),(function(e){return e.disableReporting&&Object.assign(e,p(p({},e),{},{onError:()=>{}})),p({},e)})),X=e=>{const t=[e.batchEventsThreshold,e.batchMetricsThreshold,e.batchTracesThreshold];for(const e of t)if((e||0)>30){console.warn("You are setting the threshhold for the batch limit to be greater than 30. This may cause request overload.");break}Object.assign(Y,J(e))},Z=[M.web,M.mobile_web,M.tablet_web],ee=560,te=1024;function ne(){return"android"===Y.platform}function re(){return"ios"===Y.platform}function ie(){return Z.includes(Y.platform)}function ae(e){if(ie()&&navigator&&"serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage(e)}catch(e){e instanceof Error&&Y.onError(e)}}const se={amplitudeOSName:null,amplitudeOSVersion:null,amplitudeDeviceModel:null,amplitudePlatform:null,browserName:null,browserMajor:null,osName:null,userAgent:null,width:null,height:null},oe={countryCode:null,deviceId:null,device_os:null,isOptOut:!1,languageCode:null,locale:null,jwt:null,session_lcc_id:null,userAgent:null,userId:null},ce=e=>e?(e^16*Math.random()>>e/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,ce),le=()=>Y.isAlwaysAuthed||!!oe.userId,ue=()=>{const e={};return oe.countryCode&&(e.country_code=oe.countryCode),e},he=()=>{const e=Y.platform;if(e===M.web)switch(!0){case window.matchMedia(`(max-width: ${ee}px)`).matches:return M.mobile_web;case window.matchMedia(`(max-width: ${te}px, min-width: ${ee+1}px)`).matches:return M.tablet_web}return e},de=()=>{ie()?("requestIdleCallback"in window?window.requestIdleCallback(ye,{timeout:Y.ricTimeoutSetDevice}):ye(),se.amplitudePlatform=R.web,se.userAgent=window?.navigator?.userAgent||null,me({height:window?.innerHeight??null,width:window?.innerWidth??null})):re()?(se.amplitudePlatform=R.ios,se.userAgent=oe.userAgent,se.userAgent&&ye()):ne()&&(se.userAgent=oe.userAgent,se.amplitudePlatform=R.android,se.userAgent&&ye())},pe=e=>{Object.assign(oe,e),ie()&&ae({identity:{isAuthed:!!oe.userId,locale:oe.locale||null}})},me=e=>{se.height=e.height,se.width=e.width},fe=()=>{X({platform:he()}),ie()&&ae({config:{platform:Y.platform}})},ye=()=>{performance.mark&&performance.mark("ua_parser_start");const e=new(i())(se.userAgent??"").getResult();se.browserName=e.browser.name||null,se.browserMajor=e.browser.major||null,se.osName=e.os.name||null,se.amplitudeOSName=se.browserName,se.amplitudeOSVersion=se.browserMajor,se.amplitudeDeviceModel=se.osName,ae({device:{browserName:se.browserName,osName:se.osName}}),performance.mark&&(performance.mark("ua_parser_end"),performance.measure("ua_parser","ua_parser_start","ua_parser_end"))},ge={breadcrumbs:[],initialUAAData:{},pageKey:"",pageKeyRegex:{},pagePath:"",prevPageKey:"",prevPagePath:""};function _e(e){Object.assign(ge,{breadcrumbs:e})}function be(e){Object.assign(ge,e)}const ve={eventId:0,sequenceNumber:0,sessionId:0,lastEventTime:0,sessionStart:0,sessionUUID:null,userId:null,ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0};function we(e){Object.assign(ve,e)}function Ee(){return document?.referrer??""}const Te=()=>{const e=Ee();if(!e)return{};const t=new URL(e);return t.hostname===Ae()?{}:{referrer:e,referring_domain:t.hostname}},Se=()=>{const e=new URLSearchParams(Ce()),t={};return U.forEach((n=>{e.has(n)&&(t[n]=(e.get(n)||"").toLowerCase())})),t},Ne=()=>{const e={};return U.forEach((t=>{ve[t]&&(e[t]=ve[t])})),e},Ae=()=>window?.location?.hostname||"",Ce=()=>Y.revokedQueryParams?function(e,t){const n=new RegExp(`[&?]${t.join("=.*?(&|$)|")}=.*?(&|$)`,"g");return e.replace(n,"").replace(/^&/,"?")}(window?.location?.search||"",Y.revokedQueryParams):window?.location?.search||"",xe=()=>window?.location?.pathname||"",Me=()=>{const e=Y.overrideWindowLocation?ge.pagePath:xe()+Ce();e&&e!==ge.pagePath&&(e!==ge.pagePath&&Re(),ge.pagePath=e,ge.pageKeyRegex&&Object.keys(ge.pageKeyRegex).some((e=>{if(ge.pageKeyRegex[e].test(ge.pagePath))return ge.pageKey=e,!0})))},Re=()=>{if(ie()){const e=Ee();if(!ge.prevPagePath&&e){const t=new URL(e);if(t.hostname===Ae())return void(ge.prevPagePath=t.pathname)}}ge.prevPagePath=ge.pagePath,ge.prevPageKey=ge.pageKey},Oe=e=>{ie()&&Object.assign(e,ie()?(Object.keys(ge.initialUAAData).length>0||(new URLSearchParams(Ce()),ge.initialUAAData=p(p(p({},Ne()),Se()),Te())),ge.initialUAAData):ge.initialUAAData)},Ie=/^[a-zd]+(_[a-zd]+)*$/;function ke(e){return Ie.test(e)}const Pe=["action","component_type","component_name","context","logging_id"],Le=["num_non_hardware_accounts","ujs"],De="ujs_",qe={};function Be(e){e.forEach((e=>{Le.includes(e)&&delete qe[e]}))}function je(e){const t=Object.entries(e).reduce(((e,t)=>{const n=u(t,2),r=n[0],i=n[1];return!Pe.includes(r)&&Le.includes(r)?ke(r)?p(p({},e),{},{[r]:i}):(Y.onError(new Error("IdentityFlow property names must have snake case format"),{[r]:i}),e):e}),{});t.ujs?.length&&(t.ujs=t.ujs.map((e=>`${De}${e}`))),Object.assign(qe,t)}function $e(){return Y.platform!==M.unknown||(Y.onError(new Error("SDK platform not initialized")),!1)}const Ue={eventsQueue:[],eventsScheduled:!1,metricsQueue:[],metricsScheduled:!1,tracesQueue:[],tracesScheduled:!1};function Fe(e){Object.assign(Ue,e)}const Ke={ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0},We={ac:20,af:5,ah:1,al:1,am:0,ar:10,as:20},Ve={pv:25},He=15,Qe=60,ze=240,Ge=960,Ye=3840,Je={xs:0,s:1,m:1,l:2,xl:2,xxl:2},Xe=e=>e<He?P.xs:e<Qe?P.s:e<ze?P.m:e<Ge?P.l:e<Ye?P.xl:P.xxl,Ze=e=>{Object.assign(Ke,e)},et=e=>{(e=>{switch(e.action){case x.click:Ke.ac+=1;break;case x.focus:Ke.af+=1;break;case x.hover:Ke.ah+=1;break;case x.move:Ke.am+=1;break;case x.scroll:Ke.al+=1;break;case x.search:Ke.ar+=1;break;case x.select:Ke.as+=1}})(e),e.event_type!==F?e.event_type===K&&((e=>{if(!e.session_rank)return;const t=e.session_rank;Object.values(I).forEach((e=>{Ke.sqs+=Ke[e]*We[e]})),Object.values(k).forEach((e=>{Ke.sqs+=Ke[e]*Ve[e]})),Ke.sqs*=Je[t]})(e),Object.assign(e,Ke),Ze({ac:0,af:0,ah:0,al:0,am:0,ar:0,as:0,pv:0,sqs:0})):Ke.pv+=1};function tt(){return(new Date).getTime()}const nt={timeStart:tt(),timeOnPagePath:0,timeOnPageKey:0,prevTimeOnPagePath:0,prevTimeOnPageKey:0,sessionDuration:0,sessionEnd:0,sessionStart:0,prevSessionDuration:0};function rt(e){Object.assign(nt,e)}const it={isReady:!1,idbKeyval:null};function at(e){Object.assign(it,e)}const st={},ot=async e=>{if(!it.idbKeyval)return Promise.resolve(null);try{return await it.idbKeyval.get(e)}catch{return Y.onError(new Error("IndexedDB:Get:InternalError")),Promise.resolve(null)}},ct=async(e,t)=>{if(it.idbKeyval)try{await it.idbKeyval.set(e,t)}catch{Y.onError(new Error("IndexedDB:Set:InternalError"))}},lt=()=>{"server"!==Y.platform&&(we({sessionStart:nt.sessionStart,ac:Ke.ac,af:Ke.af,ah:Ke.ah,al:Ke.al,am:Ke.am,ar:Ke.ar,as:Ke.as,pv:Ke.pv}),oe.userId&&we({userId:oe.userId}),ct(B,ve))},ut="rgb(5,177,105)",ht=11,dt=e=>{const t=e.metricName,n=e.data,r=e.importance||S.low;if(!Y.showDebugLogging||!console)return;const i=`%c ${$}`,a=`color:${ut};font-size:${ht}px;`,s=`Importance: ${r}`;console.group(i,a,t,s),n.forEach((e=>{e.event_type?console.log(e.event_type,e):console.log(e)})),console.groupEnd()},pt=e=>{const t=e.metricName,n=e.data,r=e.importance||S.low;if(!Y.showDebugLogging||!console)return;const i=`color:${ut};font-size:${ht}px;`,a=`%c ${$}`,s=`Importance: ${r}`;console.log(a,i,t,n,s)},mt=()=>{const e=tt();ve.sessionId&&ve.lastEventTime&&ve.sessionUUID&&!ft(e)||(ve.sessionId=e,ve.sessionUUID=ce(),rt({sessionStart:e}),pt({metricName:"Started new session:",data:{persistentData:ve,timeStone:nt}})),ve.lastEventTime=e},ft=e=>e-ve.lastEventTime>18e5,yt=e=>{et(e);const t=e.event_type;delete e.event_type;const n=e.deviceId?e.deviceId:null,r=e.timestamp;return delete e.timestamp,we({eventId:ve.eventId+1}),we({sequenceNumber:ve.sequenceNumber+1}),mt(),lt(),{device_id:oe.deviceId||n||null,user_id:oe.userId,timestamp:r,event_id:ve.eventId,session_id:ve.sessionId||-1,event_type:t,version_name:Y.version||null,platform:se.amplitudePlatform,os_name:se.amplitudeOSName,os_version:se.amplitudeOSVersion,device_model:se.amplitudeDeviceModel,language:oe.languageCode,event_properties:p(p({},e),{},{session_uuid:ve.sessionUUID,height:se.height,width:se.width}),user_properties:ue(),uuid:ce(),library:{name:"@cbhq/client-analytics",version:"10.9.1"},sequence_number:ve.sequenceNumber,user_agent:se.userAgent||oe.userAgent}},gt=e=>e.map((e=>yt(e))),_t=e=>e.map((e=>(e=>{const t=e.tags||{},n=p(p({authed:le()?"true":"false",platform:Y.platform},t),{},{project_name:Y.projectName,version_name:Y.version||null});return{metric_name:e.metricName,page_path:e.pagePath||null,value:e.value,tags:n,type:e.metricType}})(e))),bt=e=>0!==Ue.metricsQueue.length&&(Ue.metricsQueue.length>=Y.batchMetricsThreshold||(Ue.metricsScheduled||(Ue.metricsScheduled=!0,setTimeout((()=>{Ue.metricsScheduled=!1,e(_t(Ue.metricsQueue)),Ue.metricsQueue=[]}),Y.batchMetricsPeriod)),!1)),vt=e=>0!==Ue.tracesQueue.length&&(Ue.tracesQueue.length>=Y.batchTracesThreshold||(Ue.tracesScheduled||(Ue.tracesScheduled=!0,setTimeout((()=>{Ue.tracesScheduled=!1,e(Ue.tracesQueue),Ue.tracesQueue=[]}),Y.batchTracesPeriod)),!1)),wt=e=>{ie()&&window?.requestIdleCallback?window.requestIdleCallback(e,{timeout:Y.ricTimeoutScheduleEvent}):(ne()||re())&&Y.interactionManager?Y.interactionManager.runAfterInteractions(e):e()},Et="application/x-www-form-urlencoded; charset=UTF-8",Tt=e=>{const t=e.data,n=e.importance,r=e.isJSON,i=e.onError,a=e.url,s=r?"application/json":Et,o=n||S.low,c=r?JSON.stringify(t):new URLSearchParams(t).toString();function l(){const e=new XMLHttpRequest;e.open("POST",a,!0),Object.keys(Y.headers||{}).forEach((t=>{e.setRequestHeader(t,Y.headers[t])})),e.setRequestHeader("Content-Type",Et),oe.jwt&&e.setRequestHeader("authorization",`Bearer ${oe.jwt}`),e.send(c)}if(!ie()||r||!("sendBeacon"in navigator)||o!==S.low||Y.headers&&0!==Object.keys(Y.headers).length)if(ie()&&!r)l();else{const e=p(p({},Y.headers),{},{"Content-Type":s});oe.jwt&&(e.Authorization=`Bearer ${oe.jwt}`),fetch(a,{method:"POST",mode:"no-cors",headers:e,body:c}).catch((e=>{i(e,{context:"AnalyticsSDKApiError"})}))}else{const e=new Blob([c],{type:Et});try{navigator.sendBeacon.bind(navigator)(a,e)||l()}catch(e){Y.onError(e),l()}}},St=(e,t,n)=>{const r=e||"";return o()("2"+r+t+n)};class Nt extends Error{constructor(e){super(e),this.name="CircularJsonReference",this.message=e,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error(e).stack}}class At extends Nt{constructor(...e){super(...e),this.name="DomReferenceInAnalyticsEvent"}}const Ct=(e,t=S.low)=>{var n;(e&&Ue.eventsQueue.push(e),it.isReady)&&(!Y.trackUserId||oe.userId?(t===S.high||(n=xt,0!==Ue.eventsQueue.length&&(Ue.eventsQueue.length>=Y.batchEventsThreshold||(Ue.eventsScheduled||(Ue.eventsScheduled=!0,setTimeout((()=>{Ue.eventsScheduled=!1,n(gt(Ue.eventsQueue)),Ue.eventsQueue=[]}),Y.batchEventsPeriod)),0))))&&Mt(t):Ue.eventsQueue.length>10&&(Y.trackUserId=!1,Y.onError(new Error("userId not set in Logged-in"))))},xt=(e,t=S.low)=>{if(oe.isOptOut||0===e.length)return;let n;try{n=JSON.stringify(e)}catch(t){const r=e.map((e=>e.event_type)).join(", "),i=u((e=>{try{const n=[];for(const r of e){const e=p({},r);r.event_properties&&(e.event_properties=p(p({},e.event_properties),{},{currentTarget:null,target:null,relatedTarget:null,_dispatchInstances:null,_targetInst:null,view:(t=r.event_properties.view,["string","number","boolean"].includes(typeof t)?r.event_properties.view:null)})),n.push(e)}return[!0,JSON.stringify(n)]}catch(e){return[!1,""]}var t})(e),2),a=i[0],s=i[1];if(!a)return void Y.onError(new Nt(t instanceof Error?t.message:"unknown"),{listEventType:r});n=s,Y.onError(new At("Found DOM element reference"),{listEventType:r,stringifiedEventData:n})}const r=tt().toString(),i=p(p({},{e:n,v:"2",upload_time:r}),{},{client:Y.amplitudeApiKey,checksum:St(Y.amplitudeApiKey,n,r)});Tt({url:Y.eventsEndpoint,data:i,importance:t,onError:Y.onError}),dt({metricName:"Batch Events",data:e,importance:t})},Mt=(e=S.low)=>{xt(gt(Ue.eventsQueue),e),Fe({eventsQueue:[]})},Rt=Object.values(x),Ot=Object.values(C),It=e=>Rt.includes(e)?e:x.unknown,kt=e=>Ot.includes(e)?e:C.unknown,Pt=(e,t,n)=>{const r={auth:le()?O.loggedIn:O.notLoggedIn,action:It(e),component_type:kt(t),logging_id:n,platform:Y.platform,project_name:Y.projectName};return"number"==typeof oe.userTypeEnum&&(r.user_type_enum=oe.userTypeEnum),r},Lt=e=>{const t=tt();if(!e)return Y.onError(new Error("missing logData")),p(p({},Pt(x.unknown,C.unknown)),{},{locale:oe.locale,session_lcc_id:oe.session_lcc_id,timestamp:t,time_start:nt.timeStart});const n=p(p(p({},e),Pt(e.action,e.componentType,e.loggingId)),{},{locale:oe.locale,session_lcc_id:oe.session_lcc_id,timestamp:t,time_start:nt.timeStart});return delete n.componentType,delete n.loggingId,n},Dt={blacklistRegex:[],isEnabled:!1};function qt(){return{page_key:ge.pageKey,page_path:ge.pagePath,prev_page_key:ge.prevPageKey,prev_page_path:ge.prevPagePath}}function Bt(e){Object.assign(Dt,e)}function jt(e,t,n=S.low){if(oe.isOptOut)return;if(!$e())return;const r=Lt(t);!function(e){Dt.isEnabled&&(Me(),Object.assign(e,qt()))}(r),Oe(r),function(e){Object.keys(qe).length>0&&Object.assign(e,qe)}(r),r.has_double_fired=!1,r.event_type=e,n===S.high?Ct(r,n):wt((()=>{Ct(r)}))}function $t(e,t=!1){t?Tt({url:Y.metricsEndPoint,data:{metrics:e},isJSON:!0,onError:Y.onError}):wt((()=>{Tt({url:Y.metricsEndPoint,data:{metrics:e},isJSON:!0,onError:Y.onError})})),dt({metricName:"Batch Metrics",data:e})}function Ut(e){if(!$e())return;M.server!==Y.platform&&!e.pagePath&&ge.pagePath&&(e.pagePath=ge.pagePath);const t=p(!Object.keys(qe).length?p({},e.tags):p(p({},e.tags),qe),{},{locale:oe.locale});if(t&&Object.assign(e,{tags:t}),Ue.metricsQueue.push(e),bt($t)){$t(_t(Ue.metricsQueue)),Ue.metricsQueue=[]}}let Ft=function(e){return e.instant="instant",e.quick="quick",e.moderate="moderate",e.slow="slow",e.unavoidable="unavoidable",e}({});function Kt(e){return e.toLowerCase()}let Wt={};const Vt=(e,t)=>{Y?.onMarkStep&&Y.onMarkStep(e,t),je({ujs:t})};let Ht;const Qt={Perfume:()=>{},markStep:e=>{},markStepOnce:e=>{},incrementUjNavigation:()=>{}},zt=()=>{ie()&&Ht&&Ht.markNTBT&&Ht.markNTBT()},Gt=e=>{ie()&&Ht&&Qt.markStep&&Qt.markStep(e)},Yt=e=>{ie()&&Ht&&Qt.markStepOnce&&Qt.markStepOnce(e)},Jt=()=>{ie()&&Ht&&Qt.incrementUjNavigation&&Qt.incrementUjNavigation()},Xt=()=>{if(ie())try{const e=n(826002);Qt.markStep=e.markStep,Qt.markStepOnce=e.markStepOnce,Qt.incrementUjNavigation=e.incrementUjNavigation,Ht=new e.Perfume({analyticsTracker:e=>{const t=e.data,n=e.attribution,r=e.metricName,i=e.navigatorInformation,a=e.rating,s=W[r];if(!s&&!n?.category)return;const o=i?.deviceMemory||0,c=i?.hardwareConcurrency||0,l=i?.isLowEndDevice||!1,u=i?.isLowEndExperience||!1,h=i?.serviceWorkerStatus||"unsupported",d=p({deviceMemory:o,hardwareConcurrency:c,isLowEndDevice:l,isLowEndExperience:u,serviceWorkerStatus:h},Wt),m={is_low_end_device:l,is_low_end_experience:u,page_key:ge.pageKey||"",save_data:t.saveData||!1,service_worker:h,is_perf_metric:!0};if("navigationTiming"===r)t&&"number"==typeof t.redirectTime&&Ut({metricName:W.redirectTime.eventName,metricType:N.histogram,tags:m,value:t.redirectTime||0});else if("TTFB"===r)jt(s.eventName,p({action:x.measurement,componentType:C.page,duration:t||null,vitalsScore:a||null},d)),Ut({metricName:W.TTFB.eventName,metricType:N.histogram,tags:p({},m),value:t}),a&&Ut({metricName:`perf_web_vitals_ttfb_${a}`,metricType:N.count,tags:m,value:1});else if("networkInformation"===r)t?.effectiveType&&(Wt=t,jt(s.eventName,{action:x.measurement,componentType:C.page,networkInformationDownlink:t.downlink,networkInformationEffectiveType:t.effectiveType,networkInformationRtt:t.rtt,networkInformationSaveData:t.saveData,navigatorDeviceMemory:o,navigatorHardwareConcurrency:c}));else if("storageEstimate"===r)jt(s.eventName,p(p({action:x.measurement,componentType:C.page},t),d)),Ut({metricName:"perf_storage_estimate_caches",metricType:N.histogram,tags:m,value:t.caches}),Ut({metricName:"perf_storage_estimate_indexed_db",metricType:N.histogram,tags:m,value:t.indexedDB});else if("CLS"===r)jt(s.eventName,p({action:x.measurement,componentType:C.page,score:100*t||null,vitalsScore:a||null},d)),a&&Ut({metricName:`perf_web_vitals_cls_${a}`,metricType:N.count,tags:m,value:1});else if("FID"===r){const e=n?.performanceEntry||null,r=parseInt(e?.processingStart||"");jt(s.eventName,p({action:x.measurement,componentType:C.page,duration:t||null,processingStart:e?.processingStart?r:null,startTime:e?.startTime?parseInt(e.startTime):null,vitalsScore:a||null},d)),a&&Ut({metricName:`perf_web_vitals_fidVitals_${a}`,metricType:N.count,tags:m,value:1})}else"userJourneyStep"===r?(jt("perf_user_journey_step",p({action:x.measurement,componentType:C.page,duration:t||null,rating:a??null,step_name:n?.stepName||""},d)),Ut({metricName:`user_journey_step.${Y.projectName}.${Y.platform}.${n?.stepName||""}_vitals_${a}`,metricType:N.count,tags:m,value:1}),Ut({metricName:`user_journey_step.${Y.projectName}.${Y.platform}.${n?.stepName||""}`,metricType:N.distribution,tags:m,value:t||null})):W[r]&&t&&(jt(s.eventName,p({action:x.measurement,componentType:C.page,duration:t||null,vitalsScore:a||null},d)),a&&(Ut({metricName:`perf_web_vitals_${Kt(r)}_${a}`,metricType:N.count,tags:m,value:1}),"LCP"===r&&Ut({metricName:`perf_web_vitals_${Kt(r)}`,metricType:N.distribution,tags:m,value:t})))},maxMeasureTime:3e4,steps:Y.steps,onMarkStep:Vt})}catch(e){e instanceof Error&&Y.onError(e)}};function Zt(e={callMarkNTBT:!0}){"unknown"!==Y.platform&&(Dt.blacklistRegex.some((e=>e.test(xe())))||(jt(F,{action:x.render,componentType:C.page}),e.callMarkNTBT&&zt()))}let en=!1,tn=!1;const nn=e=>{en=!e.persisted},rn=(e,t="hidden",n=!1)=>{tn||(addEventListener("pagehide",nn),addEventListener("beforeunload",(()=>{})),tn=!0),addEventListener("visibilitychange",(({timeStamp:n})=>{document.visibilityState===t&&e({timeStamp:n,isUnloading:en})}),{capture:!0,once:n})};const an=36e3;function sn(){const e=ft(tt());if(e&&(U.forEach((e=>{ve[e]&&delete ve[e]})),lt()),!ve.lastEventTime||!nt.sessionStart||!e)return;const t=Math.round((ve.lastEventTime-nt.sessionStart)/1e3);if(t<1||t>an)return;const n=Xe(t);jt(K,{action:x.measurement,componentType:C.page,session_duration:t,session_end:ve.lastEventTime,session_start:nt.sessionStart,session_rank:n})}function on(){var e;ie()&&(e=()=>{fe(),me({width:window?.innerWidth??null,height:window?.innerHeight??null})},addEventListener("resize",(()=>{requestAnimationFrame((()=>{e()}))})))}const cn=[],ln=[],un=async()=>{const e=await ot(B);at({isReady:!0}),hn(),e&&(dn(),we({eventId:e.eventId||ve.eventId,sequenceNumber:e.sequenceNumber||ve.sequenceNumber,sessionId:e.sessionId||ve.sessionId,lastEventTime:e.lastEventTime||ve.lastEventTime,sessionUUID:e.sessionUUID||ve.sessionUUID}),function(e){we(p(p({},function(e){const t={};return U.forEach((n=>{e[n]&&(t[n]=e[n])})),t}(e)),Se()))}(e),rt({sessionStart:e.sessionStart||ve.sessionStart}),Ze({ac:e.ac||Ke.ac,af:e.af||Ke.af,ah:e.ah||Ke.ah,al:e.al||Ke.al,am:e.am||Ke.am,ar:e.ar||Ke.ar,as:e.as||Ke.as,pv:e.pv||Ke.pv}),Y.trackUserId&&pe({userId:e.userId||oe.userId}),sn(),pt({metricName:"Initialized Analytics IndexedDB:",data:e}))},hn=()=>{const e=cn.shift();e&&e()},dn=()=>{const e=ln.shift();e&&e()};let pn={};function mn(e){const t=function(e){return{test_name:e.testName,group_name:e.group,subject_id:e.subjectId,exposed_at:tt(),subject_type:e.subjectType,platform:Y.platform}}(e);pn[e.testName]=pn[e.testName]||0,pn[e.testName]+D>tt()?pt({metricName:`Event: exposeExperiment ${e.testName} not sent`,data:t}):(pn[e.testName]=tt(),ct(j,pn),pt({metricName:`Event: exposeExperiment ${e.testName} sent`,data:t}),Tt({url:Y.exposureEndpoint,data:[t],onError:(t,n)=>{pn[e.testName]=0,ct(j,pn),Y.onError(t,n)},isJSON:!0,importance:S.high}))}const fn=e=>{X(e),ie()&&(oe.languageCode=navigator?.languages[0]||navigator?.language||""),fe(),(()=>{if(ie()&&window?.indexedDB){const e=(0,a.X3)("keyval-store",1,{upgrade(e){e.createObjectStore("keyval")}});at({idbKeyval:{get:async t=>(await e).get("keyval",t),set:async(t,n)=>(await e).put("keyval",n,t),delete:async t=>(await e).delete("keyval",t),keys:async()=>(await e).getAllKeys("keyval")}})}else at({idbKeyval:{get:async e=>new Promise((t=>{t(st[e])})),set:async(e,t)=>new Promise((n=>{st[e]=t,n(e)})),delete:async e=>new Promise((()=>{delete st[e]})),keys:async()=>new Promise((e=>{e(Object.keys(st))}))}})})(),pt({metricName:"Initialized Analytics:",data:{deviceId:oe.deviceId}}),cn.push((()=>{Ct()})),un(),async function(){ot(j).then((e=>{pn=e??{}})).catch((e=>{e instanceof Error&&Y.onError(e)}))}(),de(),ie()&&(rn((()=>{we({lastEventTime:tt()}),lt(),Mt()}),"hidden"),rn((()=>{sn()}),"visible")),on(),Xt()},yn=e=>{pe(e),e.userAgent&&de(),pt({metricName:"Identify:",data:{countryCode:oe.countryCode,deviceId:oe.deviceId,userId:oe.userId}})},gn=({blacklistRegex:e,pageKeyRegex:t,browserHistory:n})=>{Bt({blacklistRegex:e||[],isEnabled:!0}),be({pageKeyRegex:t}),Zt({callMarkNTBT:!1}),n.listen((()=>{Zt()}))},_n=({blacklistRegex:e,pageKeyRegex:t,nextJsRouter:n})=>{Bt({blacklistRegex:e||[],isEnabled:!0}),be({pageKeyRegex:t}),Zt({callMarkNTBT:!1});n.events.on("routeChangeComplete",(()=>{Zt()}))},bn=()=>{pe({isOptOut:!0}),ct(B,{})},vn=()=>{pe({isOptOut:!1})},wn={Button:{label:"cb_button",uuid:"e921a074-40e6-4371-8700-134d5cd633e6",componentType:C.button}};function En(e,t,n){return{componentName:e,actions:t,data:n}}function Tn(e,t,n){const r=n.componentName,i=n.data;jt(e.label,p({componentType:e.componentType,action:t,loggingId:e.uuid,component_name:r},i))}const Sn={actionMapping:{onPress:x.click,onHover:x.hover},handlers:{Button:{[x.click]:e=>Tn(wn.Button,x.click,e),[x.hover]:e=>Tn(wn.Button,x.hover,e)}}};function Nn(e,t=!1){t?Tt({url:Y.tracesEndpoint,data:{traces:e},isJSON:!0,onError:Y.onError}):wt((()=>{Tt({url:Y.tracesEndpoint,data:{traces:e},isJSON:!0,onError:Y.onError})})),dt({metricName:"Batch Traces",data:e})}const An=1e6;function Cn(e){return e*An}function xn(e=function(){return window?.crypto}()){const t=new Uint32Array(2);e?.getRandomValues(t);return((BigInt(t[0])<<BigInt(32))+BigInt(t[1])).toString()}function Mn(e,t){return{"x-datadog-origin":"rum","x-datadog-parent-id":t,"x-datadog-sampling-priority":"1","x-datadog-trace-id":e}}function Rn(e){return Mn(e.trace_id,e.span_id)}function On(e){const t=e.name,n=e.traceId,r=e.spanId,i=e.start,a=e.duration,s=e.resource,o=e.meta,c=e.parentId;return{duration:a?Cn(a):0,name:t,resource:s,service:Y.projectName,span_id:r??xn(),start:i?Cn(i):0,trace_id:n??xn(),parent_id:c??V,type:H,meta:p(p(p({platform:Y.platform},ge.pageKey?{page_key:ge.pageKey}:{}),qe.ujs?.length?{last_ujs:qe.ujs[qe.ujs.length-1]}:{}),o??{})}}function In(e,t){const n=p(p({},e.meta),t.meta),r={start:t.start?Cn(t.start):e.start,duration:t.duration?Cn(t.duration):e.duration};Object.assign(e,t,p({meta:n},r))}function kn(e,t){e.forEach((e=>In(e,t)))}function Pn(e){return[On(e)]}function Ln(e,t){$e()&&function(e){return e.length>0}(e)&&(t&&kn(e,t),Ue.tracesQueue.push(e),vt(Nn)&&(Nn(Ue.tracesQueue),Ue.tracesQueue=[]))}function Dn(){return void 0!==typeof window&&"performance"in window&&"mark"in performance&&"getEntriesByName"in performance}function qn(e,t){return`perf_${e}${t?.label?`_${t.label}`:""}`}function Bn(e,t,n){return`${qn(e,n)}__${t}`}let jn={};function $n(e,t,n){if(!Dn())return;const r=Bn(e,t,n);if(performance.mark(r),"end"===t){const t=qn(e,n);!function(e,t,n){try{performance.measure(e,t,n)}catch(e){Y.onError(e)}}(t,Bn(e,"start",n),r);const i=performance.getEntriesByName(t).pop();i&&Ut(p({metricName:e,metricType:N.distribution,value:i.duration},n?.tags?{tags:n.tags}:{}))}}function Un(e,t){if(!Dn())return;const n=Bn(e,"start",t);jn[n]||($n(e,"start",t),jn[n]=!0)}function Fn(e,t){const n=Bn(e,"start",t),r=jn,i=(r[n],l(r,[n].map(f)));jn=i}function Kn(e,t){if(!Dn())return;const n=Bn(e,"start",t);jn[n]&&($n(e,"end",t),Fn(e,t))}function Wn(){Dn()&&(performance.clearMarks(),jn={})}function Vn(e,t,n=S.low){const r=(0,c.useRef)(t);return(0,c.useEffect)((()=>{r.current=t}),[t]),(0,c.useCallback)((t=>{jt(e,p(p({},r.current),t),n)}),[e,n])}function Hn(e,t,n=S.low){(0,c.useEffect)((()=>{const r=p(p({},t),{},{action:x.render});jt(e,r,n)}),[])}function Qn(e,t){return{markStartPerf:(0,c.useCallback)((()=>Un(e,t)),[e,t]),markEndPerf:(0,c.useCallback)((n=>Kn(e,p(p({},t),n))),[e,t])}}function zn(){return Object.entries(p(p(p({},qe),qt()),{},{sessionUUID:ve.sessionUUID,userId:ve.userId})).reduce(((e,t)=>{return null!=(n=t[1])&&""!==n?p(p({},e),{},{[t[0]]:t[1]}):e;var n}),{})}async function Gn(){return new Promise((e=>{xt(gt(Ue.eventsQueue)),$t(_t(Ue.metricsQueue),!0),Nn(Ue.tracesQueue,!0),Fe({eventsQueue:[],metricsQueue:[],tracesQueue:[]}),e()}))}function Yn(){return{"X-CB-Device-ID":oe.deviceId||"unknown","X-CB-Is-Logged-In":oe.userId?"true":"false","X-CB-Pagekey":ge.pageKey||"unknown","X-CB-UJS":(e=qe.ujs,void 0===e||0===e.length?"":e.join(",")),"X-CB-Platform":Y.platform||"unknown","X-CB-Project-Name":Y.projectName||"unknown","X-CB-Session-UUID":ve.sessionUUID||"unknown","X-CB-Version-Name":Y.version?String(Y.version):"unknown"};var e}},193479:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ClientKillSwitchContext:()=>f,ClientKillSwitchProvider:()=>w,PlatformName:()=>h,config:()=>p,defaultClientKillSwitchConfig:()=>m,fetchKillSwitches:()=>_,getSSRKillSwitch:()=>g,initClientKillSwitch:()=>b,setLatestKillSwitchConfig:()=>y,useKillSwitch:()=>E});var r=n(202784),i=n(921166),a=n(552322);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h=function(e){return e.unknown="unknown",e.web="web",e.android="android",e.ios="ios",e.mobile_web="mobile_web",e.tablet_web="tablet_web",e.server="server",e.windows="windows",e.macos="macos",e.extension="extension",e}({}),d=function(e){return e.count="count",e.rate="rate",e.gauge="gauge",e.distribution="distribution",e.histogram="histogram",e}({});const p={default:{disabled:!1,serviceUrl:"",scope:"",platform:h.unknown,version:""}},m={default:{}},f=(0,r.createContext)({scope:"default",clientKillSwitchConfig:{},setKillSwitchConfig(){p.default.contextErrorHandler&&p.default.contextErrorHandler()}});function y(e,t){if(!t)return e;let n=!1;return Object.keys(e).forEach((r=>{void 0!==t[r]&&e[r]!==t[r]?(e[r]=t[r],n=!0):void 0===t[r]&&(e[r]&&(n=!0),e[r]=!1)})),n?l({},e):e}function g(e){return m?.[e]||!1}async function _(e){const t=e??{},n=t.optionalScope,r=t.optionalKillSwitchUrl,a=t.optionalApiParams,s=n??"default";try{const e={scope:n?p[n].scope:p.default.scope,platform:n?p[n].platform:p.default.platform,version:n?p[n].version:p.default.version},t=(0,i.encode)(JSON.stringify(a??e)),o=r??p[s].serviceUrl,c=await fetch(`${o}?q=${t}`,{headers:{"Content-Type":"application/json"}}).then((async e=>e.json()));return c.killswitches?c.killswitches:null}catch(e){return e instanceof Error&&p[s].fetchErrorHandler?.(e),null}}async function b(e,t){const n=t.scope;if(Object.keys(m).includes(n)){console.warn("You are initializing the kill switch package with the same scope as the prior initialization. This may cause unexpected behavior. See https://docs.cbhq.net/frontend/resilience/client-kill-switch/overview for more information.");const t=l(l({},m[n]),e);m[n]=l({},t)}else p[n]=l({},t),m[n]=l({},e);if(p[n].disabled)return;const r=await _({optionalScope:n});if(p[n].logger&&r){const e=`enable_logging_metrics_${p[n].logger?.platform}`;p[n].logger.enableLogging=r[e]}const i=y(m[n],r);if(Object.assign(m[n],i),p[n].logger?.enableLogging)for(const e in m[n])if(m[n][e]){p[n].logger?.logMetric({metricName:"kill_switch_initialized",metricType:d.count,value:1});break}return m[n]}const v=3e4;function w({children:e,initialKillSwitches:t,scope:n}){const i="function"==typeof t?t():t[n],o=s((0,r.useState)(i),2),c=o[0],l=o[1],u=(0,r.useMemo)((()=>({scope:n,clientKillSwitchConfig:c,setKillSwitchConfig:e=>{const t=y(c,e);t!==c&&l(t)}})),[n,c]);return(0,r.useEffect)((()=>{if(p[n].disabled)return;const e=setInterval((async()=>{if(p[n].platform===h.server)return;const e=await _({optionalScope:n});if(null!==e&&(u.setKillSwitchConfig(e),p[n].logger)){const t=`enable_logging_metrics_${p[n].logger?.platform}`;p[n].logger.enableLogging=e[t]}}),v);return()=>clearInterval(e)}),[]),(0,a.jsx)(f.Provider,{value:u,children:e})}function E(e){const t=(0,r.useRef)(!1),n=(0,r.useContext)(f),i=n.scope;if(null===e)return!1;const a=e;if(!(a in m[i])){const e="default"===i?`You are using the ${a} killl switch outside of the ClientKillSwitchProvider.`:`${a} is not in the ${i}'s client kill switch object.`;return console.error(e),!1}if(n.clientKillSwitchConfig){const e=n.clientKillSwitchConfig[a]||!1,r=!(e===t.current);return p[i].logger?.enableLogging&&e&&r&&(p[i].logger?.logMetric({metricName:"kill_switches_enabled",metricType:d.count,value:1,tags:{kill_switch:a}}),t.current=e),e}return p[i].hookErrorHandler&&p[i].hookErrorHandler?.(),!1}},407337:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(116188),i=n(754881);class a{static isSQLiteFamily(e){return["sqlite","cordova","react-native","nativescript","sqljs","expo","better-sqlite3","capacitor"].includes(e.options.type)}static isMySQLFamily(e){return["mysql","mariadb"].includes(e.options.type)}static isReleaseVersionOrGreater(e,t){return null!=e.version&&i.m.isGreaterOrEqual(e.version,t)}static isPostgresFamily(e){return["postgres","aurora-postgres"].includes(e.options.type)}static buildDriverOptions(e,t){if(e.url){const n=this.parseConnectionUrl(e.url);t&&t.useSid&&n.database&&(n.sid=n.database);for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return Object.assign({},e,n)}return Object.assign({},e)}static buildMongoDBDriverOptions(e,t){if(e.url){const n=this.parseMongoDBConnectionUrl(e.url);t&&t.useSid&&n.database&&(n.sid=n.database);for(const e of Object.keys(n))void 0===n[e]&&delete n[e];return Object.assign({},e,n)}return Object.assign({},e)}static buildAlias({maxAliasLength:e},t,...n){"string"==typeof t?(n.unshift(t),t={shorten:!1,joiner:"_"}):t=Object.assign({shorten:!1,joiner:"_"},t);const i=1===n.length?n[0]:n.join(t.joiner);if(e&&e>0&&i.length>e){if(!0===t.shorten){const t=(0,r.OV)(i);if(t.length<e)return t}return(0,r.vp)(i,{length:e})}return i}static buildColumnAlias({maxAliasLength:e},t,...n){return this.buildAlias({maxAliasLength:e},t,...n)}static parseConnectionUrl(e){const t=e.split(":")[0],n=e.indexOf("//"),r=e.substr(n+2),i=r.indexOf("/"),a=-1!==i?r.substr(0,i):r;let s=-1!==i?r.substr(i+1):void 0;s&&-1!==s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));const o=a.lastIndexOf("@"),c=a.substr(0,o),l=a.substr(o+1);let u=c,h="";const d=c.indexOf(":");-1!==d&&(u=c.substr(0,d),h=c.substr(d+1));const[p,m]=l.split(":");return{type:t,host:p,username:decodeURIComponent(u),password:decodeURIComponent(h),port:m?parseInt(m):void 0,database:s||void 0}}static parseMongoDBConnectionUrl(e){const t=e.split(":")[0],n=e.indexOf("//"),r=e.substr(n+2),i=r.indexOf("/"),a=-1!==i?r.substr(0,i):r;let s,o,c,l,u=-1!==i?r.substr(i+1):void 0,h="",d={};if(u&&-1!==u.indexOf("?")){h=u.substr(u.indexOf("?")+1,u.length);let e,t;h.split("&").forEach((n=>{e=n.split("=")[0],t=n.split("=")[1],d[e]=t})),l=d.replicaSet,u=u.substr(0,u.indexOf("?"))}const p=a.lastIndexOf("@"),m=a.substr(0,p),f=a.substr(p+1);let y=m,g="";const _=m.indexOf(":");-1!==_&&(y=m.substr(0,_),g=m.substr(_+1)),l?c=f:[s,o]=f.split(":");let b={type:t,host:s,hostReplicaSet:c,username:decodeURIComponent(y),password:decodeURIComponent(g),port:o?parseInt(o):void 0,database:u||void 0};for(const[e,t]of Object.entries(d))b[e]=t;return b}}},85554:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Cannot create a new connection named "${e}", because connection with such name already exist and it now has an active connection session.`)}}},742464:(e,t,n)=>{"use strict";n.d(t,{a:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Cannot attach entity "${e}" to its parent. Please make sure parent is saved in the database before saving children nodes.`)}}},726027:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super();const n=e.primaryColumns.reduce(((e,t,n)=>(t.setEntityValue(e,n+1),e)),{});this.message=`Cannot use given entity id "${t}" because "${e.targetName}" contains multiple primary columns, you must provide object in following form: ${JSON.stringify(n)} as an id.`}}},326618:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Cannot ${e}, given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.`)}}},778712:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Circular relations detected: ${e}. To resolve this issue you need to set nullable: true somewhere in this dependency structure.`)}}},893383:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super(`Column type for ${e.constructor.name}#${t} is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.`)}}},241836:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Connection with ${e} database is not established. Check connection configuration.`)}}},642888:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Connection "${e}" was not found.`)}}},583304:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Custom repository ${"function"==typeof e?e.name:e.constructor.name} does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? `)}}},962428:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Custom repository ${"function"==typeof e?e.name:e.constructor.name} was not found. Did you forgot to put @EntityRepository decorator on it?`)}}},861357:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});var r=n(584639);class i extends r.K{constructor(e,t,n){super();const r="string"==typeof t?t:t.name;this.message=`Data type "${r}" in "${e.entityMetadata.targetName}.${e.propertyName}" is not supported by "${n}" database.`}}},287293:(e,t,n)=>{"use strict";n.d(t,{f:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Driver option (${e}) is not set. Please set it to perform connection to the database.`)}}},447638:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super(`${e} package has not been found installed. Try to install it: npm install ${t} --save`)}}},517830:(e,t,n)=>{"use strict";n.d(t,{E:()=>s});var r=n(584639),i=n(503681),a=n(312758);class s extends r.K{constructor(e,t){super(),this.message=`Could not find any entity of type "${this.stringifyTarget(e)}" matching: ${this.stringifyCriteria(t)}`}stringifyTarget(e){return a.a.isEntitySchema(e)?e.options.name:"function"==typeof e||i.g.isObject(e)&&"name"in e?e.name:e}stringifyCriteria(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e}}},452257:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super(e),Object.setPrototypeOf(this,i.prototype),this.message=`Property "${e}" was not found in "${t.targetName}". Make sure your query is correct.`}}},382278:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(),1===e.length?this.message=`Relation "${e[0]}" was not found; please check if it is correct and really exists in your entity.`:this.message=`Relations ${e.map((e=>`"${e}"`)).join(", ")} were not found; please check if relations are correct and they exist in your entities.`}}},676938:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "${e.entityMetadata.targetName}#${e.propertyPath}". This is ORM requirement to make relations to work properly. Refer docs for more information.`)}}},299594:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});var r=n(584639);class i extends r.K{constructor(){super('Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')}}},883474:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Your database does not support LIMIT on UPDATE statements.")}}},685741:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Locking not supported on given driver.")}}},704480:(e,t,n)=>{"use strict";n.d(t,{d:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Entity "${e.name}" does not have delete date columns.`)}}},84468:(e,t,n)=>{"use strict";n.d(t,{R:()=>i});var r=n(584639);class i extends r.K{constructor(e,t=[]){super(`Wrong driver: "${e}" given. Supported drivers are: ${t.map((e=>`"${e}"`)).join(", ")}.`)}}},692261:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Entity "${e.name}" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.`)}}},12055:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super(`Cannot ${e}, given value must be an entity, instead "${t}" is given.`)}}},173493:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Option "${e}" is not set in your connection options, please define "${e}" option in your connection options or ormconfig.json`)}}},236352:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")}}},428761:(e,t,n)=>{"use strict";n.d(t,{f:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Entity ${e} does not have version or update date columns.`)}}},375e3:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});var r=n(584639);class i extends r.K{constructor(){super("RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")}}},336668:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});var r=n(584639);class i extends r.K{constructor(){super("The optimistic lock can be used only with getOne() method.")}}},969919:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(584639);class i extends r.K{constructor(e,t,n){super(`The optimistic lock on entity ${e} failed, version ${t} was expected, but is actually ${n}.`)}}},124758:(e,t,n)=>{"use strict";n.d(t,{G:()=>i});var r=n(584639);class i extends r.K{constructor(){super("An open transaction is required for pessimistic lock.")}}},901716:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});var r=n(584639);class i extends r.K{constructor(e,t){super(`Primary column ${e.constructor.name}#${t} cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.`)}}},224023:(e,t,n)=>{"use strict";n.d(t,{O:()=>a});var r=n(503681),i=n(584639);class a extends i.K{constructor(e,t,n){if(super(n.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,"")),this.query=e,this.parameters=t,this.driverError=n,n){const{name:e,...t}=n;r.g.assign(this,{...t})}}}},403975:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Query runner already released. Cannot run queries anymore.")}}},604484:(e,t,n)=>{"use strict";n.d(t,{i:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")}}},976588:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(584639);class i extends r.K{constructor(){super("OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL or MariaDB databases.")}}},843299:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Removed entity "${e.metadata.name}" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).`)}}},572974:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});var r=n(584639);class i extends r.K{constructor(e){super(`Internal error. Subject ${e.metadata.targetName} must have an identifier to perform operation.`)}}},831369:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(584639);class i extends r.K{constructor(){super("Transaction is not started yet, start transaction before committing or rolling it back.")}}},584639:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});class r extends Error{get name(){return this.constructor.name}constructor(e){super(e),Object.setPrototypeOf?Object.setPrototypeOf(this,new.target.prototype):this.__proto__=new.target.prototype}}},138946:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});var r=n(584639);class i extends r.K{constructor(){super('Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')}}},600706:(e,t,n)=>{"use strict";n.d(t,{nh:()=>a.n,aH:()=>x.a,Lo:()=>o,dN:()=>u.d,cC:()=>d.c,$X:()=>ue,dW:()=>$,XP:()=>i,u3:()=>I.u,sk:()=>oe.s,yn:()=>l.y,BX:()=>U.B,Re:()=>A,bh:()=>M.b,nJ:()=>f.n,qt:()=>J.q,fd:()=>H.f,zm:()=>j.z,tG:()=>w,EB:()=>_.E,B8:()=>q.B,PI:()=>Q.P,j4:()=>X.j,DK:()=>K.D,T6:()=>S.T,Ao:()=>c.A,o0:()=>h,BZ:()=>V,dh:()=>R.d,Rl:()=>B.R,im:()=>L,Eh:()=>Z,H5:()=>D.H,Bg:()=>E.B,CJ:()=>z,zx:()=>O,Hu:()=>he.H,rX:()=>te.r,f1:()=>F.f,Gy:()=>le.G,YL:()=>W.Y,Zf:()=>T.Z,C$:()=>ae,GC:()=>G.G,IQ:()=>N.I,Od:()=>ee.O,Yq:()=>ce.Y,iU:()=>C.i,cK:()=>Y,yl:()=>k.y,B0:()=>ie.B,Hl:()=>s.H,SF:()=>g,W5:()=>y.W,A:()=>m,K_:()=>r.K,yv:()=>p.y,Xk:()=>se,Tg:()=>ne,uP:()=>P,AV:()=>re});var r=n(584639);class i extends r.K{constructor(e,t){super(`Cannot get reflected type for a "${t}" method's parameter of "${e.name}" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.`)}}var a=n(85554),s=n(572974);class o extends r.K{constructor(e){super(`Cannot create a "${e}" connection because connection to the database already established.`)}}var c=n(685741),l=n(241836),u=n(726027);class h extends r.K{constructor(e,t,n){super(e+" metadata already exists for the class constructor "+JSON.stringify(t)+(n?" on property "+n:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."))}}var d=n(326618),p=n(138946);class m extends r.K{constructor(e){super(`Tree repositories are not supported in ${e.options.type} driver.`)}}var f=n(962428),y=n(831369);class g extends r.K{constructor(){super("Transaction already started for the given connection, commit current transaction before starting a new one.")}}var _=n(517830),b=n(503681),v=n(312758);class w extends r.K{constructor(e){super(),this.message=`No metadata for "${this.stringifyTarget(e)}" was found.`}stringifyTarget(e){return v.a.isEntitySchema(e)?e.options.name:"function"==typeof e||b.g.isObject(e)&&"name"in e?e.name:e}}var E=n(12055),T=n(969919),S=n(883474),N=n(901716);class A extends r.K{constructor(e){super(`Custom entity repository ${"function"==typeof e?e.name:e.constructor.name}  cannot inherit Repository class without entity being set in the @EntityRepository decorator.`)}}var C=n(604484),x=n(742464),M=n(583304),R=n(704480);class O extends r.K{constructor(e){super(`Cannot get a Repository for "${e} connection, because connection with the database is not established yet. Call connection#connect method to establish connection.`)}}var I=n(778712),k=n(976588);class P extends r.K{constructor(e,t){super(`Using JoinTable on ${e.name}#${t.propertyName} is wrong. ${e.name}#${t.propertyName} has ${t.relationType} relation, however you can use JoinTable only on many-to-many relations.`)}}class L extends r.K{constructor(e,t){super(),t.inverseRelation?this.message=`JoinColumn is missing on both sides of ${e.name}#${t.propertyName} and ${t.inverseEntityMetadata.name}#${t.inverseRelation.propertyName} one-to-one relationship. You need to put JoinColumn decorator on one of the sides.`:this.message=`JoinColumn is missing on ${e.name}#${t.propertyName} one-to-one relationship. You need to put JoinColumn decorator on it.`}}var D=n(692261),q=n(452257),B=n(84468),j=n(447638);class $ extends r.K{constructor(e){super(`Cannot get entity manager for "${e}" connection because connection is not yet established.`)}}var U=n(642888),F=n(428761),K=n(299594),W=n(336668);class V extends r.K{constructor(e,t){super(e+" metadata with such name "+t+" already exists. Do you apply decorator twice? Or maybe try to change a name?")}}var H=n(287293),Q=n(382278);class z extends r.K{constructor(e,t){super();const n="function"==typeof e?e.name:e;this.message=`Naming strategy "${n}" was not found. Looks like this naming strategy does not exist or it was not registered in current "${t}" connection?`}}var G=n(124758);class Y extends r.K{constructor(e){let t;super(),t=v.a.isEntitySchema(e)?e.options.name:"function"==typeof e||b.g.isObject(e)&&"name"in e?e.name:e,this.message=`Repository of the "${t}" class is not a TreeRepository. Try to apply @Tree decorator on your entity.`}}var J=n(861357),X=n(676938);class Z extends r.K{constructor(e,t){super(),t.inverseRelation?this.message=`JoinTable is missing on both sides of ${e.name}#${t.propertyName} and ${t.inverseEntityMetadata.name}#${t.inverseRelation.propertyName} many-to-many relationship. You need to put decorator decorator on one of the sides.`:this.message=`JoinTable is missing on ${e.name}#${t.propertyName} many-to-many relationship. You need to put JoinTable decorator on it.`}}var ee=n(224023),te=n(236352);class ne extends r.K{constructor(e,t){super(`Using JoinColumn is allowed only on one side of the one-to-one relationship. Both ${e.name}#${t.propertyName} and ${t.inverseEntityMetadata.name}#${t.inverseRelation.propertyName} has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.`)}}class re extends r.K{constructor(e,t){super(`Using JoinTable is allowed only on one side of the many-to-many relationship. Both ${e.name}#${t.propertyName} and ${t.inverseEntityMetadata.name}#${t.inverseRelation.propertyName} has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.`)}}var ie=n(843299);class ae extends r.K{constructor(){super("Internal error. Persisted entity was not found in the list of prepared operated entities.")}}class se extends r.K{constructor(e,t){super(`Using JoinColumn on ${e.name}#${t.propertyName} is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.`)}}var oe=n(893383),ce=n(403975),le=n(375e3);class ue extends r.K{constructor(e){super(`Cannot execute operation on "${e}" connection because connection is not yet established.`)}}var he=n(173493)},624331:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});var r=n(312758);class i{constructor(e,t,n=!0,r=!1,i,a){this["@instanceof"]=Symbol.for("FindOperator"),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r,this._getSql=i,this._objectLiteralParameters=a}get useParameter(){return r.a.isFindOperator(this._value)?this._value.useParameter:this._useParameter}get multipleParameters(){return r.a.isFindOperator(this._value)?this._value.multipleParameters:this._multipleParameters}get type(){return this._type}get value(){return r.a.isFindOperator(this._value)?this._value.value:this._value}get objectLiteralParameters(){return r.a.isFindOperator(this._value)?this._value.objectLiteralParameters:this._objectLiteralParameters}get child(){if(r.a.isFindOperator(this._value))return this._value}get getSql(){return r.a.isFindOperator(this._value)?this._value.getSql:this._getSql}}},653140:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(382278),i=n(407337);class a{static isFindOneOptions(e){const t=e;return t&&(Array.isArray(t.select)||Array.isArray(t.relations)||"object"==typeof t.select||"object"==typeof t.relations||"object"==typeof t.where||"object"==typeof t.join||"object"==typeof t.order||"object"==typeof t.cache||"boolean"==typeof t.cache||"number"==typeof t.cache||"string"==typeof t.comment||"object"==typeof t.lock||"object"==typeof t.loadRelationIds||"boolean"==typeof t.loadRelationIds||"boolean"==typeof t.loadEagerRelations||"boolean"==typeof t.withDeleted||"string"==typeof t.relationLoadStrategy||"boolean"==typeof t.transaction)}static isFindManyOptions(e){const t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)}static extractFindManyOptionsAlias(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias}static applyOptionsToTreeQueryBuilder(e,t){if(null==t?void 0:t.relations){const n=[...t.relations];if(a.applyRelationsRecursively(e,n,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),n.length>0)throw new r.P(n)}return e}static applyRelationsRecursively(e,t,n,r,a){let s=[];if(a){const e=new RegExp("^"+a.replace(".","\\.")+"\\.");s=t.filter((t=>t.match(e))).map((t=>t.replace(e,""))).filter((e=>r.findRelationWithPropertyPath(e)))}else s=t.filter((e=>r.findRelationWithPropertyPath(e)));s.forEach((s=>{let o=i.z.buildAlias(e.connection.driver,{joiner:"__"},n,s);const c=n+"."+s;e.leftJoinAndSelect(c,o),t.splice(t.indexOf(a?a+"."+s:s),1);const l=e.expressionMap.joinAttributes.find((e=>e.entityOrProperty===c));this.applyRelationsRecursively(e,t,l.alias.name,l.metadata,a?a+"."+s:s);const u=r.relations.find((e=>e.propertyName===s));u&&this.joinEagerRelations(e,o,u.inverseEntityMetadata)}))}static joinEagerRelations(e,t,n){n.eagerRelations.forEach((n=>{let r=i.z.buildAlias(e.connection.driver,e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath)),a=!0;for(const i of e.expressionMap.joinAttributes)if(void 0===i.condition&&void 0===i.mapToProperty&&void 0===i.isMappingMany&&"LEFT"===i.direction&&i.entityOrProperty===`${t}.${n.propertyPath}`){a=!1,r=i.alias.name;break}a&&e.leftJoin(t+"."+n.propertyPath,r);let s=!0;for(const t of e.expressionMap.selects)if(void 0===t.aliasName&&void 0===t.virtual&&t.selection===r){s=!1;break}s&&e.addSelect(r),this.joinEagerRelations(e,r,n.inverseEntityMetadata)}))}}},388577:(e,t,n)=>{"use strict";n.d(t,{In:()=>i});var r=n(624331);function i(e){return new r.J("in",e,!0,!0)}},137134:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AbstractRepository:()=>X,AdvancedConsoleLogger:()=>bn,AfterInsert:()=>or,AfterLoad:()=>cr,AfterRecover:()=>hr,AfterRemove:()=>lr,AfterSoftRemove:()=>ur,AfterUpdate:()=>dr,AlreadyHasActiveConnectionError:()=>u.nh,Any:()=>Ur,ArrayContainedBy:()=>Fr,ArrayContains:()=>Kr,ArrayOverlap:()=>Wr,AuroraMysqlDriver:()=>L.AuroraMysqlDriver,AuroraPostgresDriver:()=>L.AuroraPostgresDriver,BaseEntity:()=>ei,BeforeInsert:()=>pr,BeforeRecover:()=>yr,BeforeRemove:()=>mr,BeforeSoftRemove:()=>fr,BeforeUpdate:()=>gr,BetterSqlite3Driver:()=>L.BetterSqlite3Driver,Between:()=>Vr,Brackets:()=>oi.D,CannotAttachTreeChildrenEntityError:()=>u.aH,CannotConnectAlreadyConnectedError:()=>u.Lo,CannotCreateEntityIdMapError:()=>u.dN,CannotDetermineEntityError:()=>u.cC,CannotExecuteNotConnectedError:()=>u.$X,CannotGetEntityManagerNotConnectedError:()=>u.dW,CannotReflectMethodParameterTypeError:()=>u.XP,Check:()=>qr,ChildEntity:()=>xr,CircularRelationsError:()=>u.u3,CockroachDriver:()=>L.CockroachDriver,Column:()=>Jn,ColumnTypeUndefinedError:()=>u.sk,Connection:()=>ti,ConnectionIsNotSetError:()=>u.yn,ConnectionManager:()=>Ln,ConnectionNotFoundError:()=>u.BX,ConnectionOptionsReader:()=>s,CreateDateColumn:()=>Xn,CustomRepositoryCannotInheritRepositoryError:()=>u.Re,CustomRepositoryDoesNotHaveEntityError:()=>u.bh,CustomRepositoryNotFoundError:()=>u.nJ,DEFAULT_SQL_BATCH_SIZE:()=>U,DataSource:()=>In,DataTypeNotSupportedError:()=>u.qt,DefaultNamingStrategy:()=>l,DeleteDateColumn:()=>Zn,DeleteQueryBuilder:()=>ri.T,DeleteResult:()=>Ge.y,DriverOptionNotSetError:()=>u.fd,DriverPackageNotInstalledError:()=>u.zm,DummyLogger:()=>vn,Entity:()=>Cr,EntityManager:()=>Be,EntityMetadata:()=>Oe,EntityMetadataNotFoundError:()=>u.tG,EntityNotFoundError:()=>u.EB,EntityPropertyNotFoundError:()=>u.B8,EntityRepository:()=>$r,EntitySchema:()=>li,EntitySchemaEmbeddedColumnOptions:()=>ui,EntitySchemaOptions:()=>hi,Equal:()=>Qr,EqualOperator:()=>Hr,EventSubscriber:()=>_r,Exclusion:()=>Br,FileLogger:()=>wn,FindOperator:()=>Ue.J,FindOptionsUtils:()=>q.Z,FindRelationsNotFoundError:()=>u.PI,Generated:()=>jr,ILike:()=>Yr,In:()=>zr.In,Index:()=>Lr,InitializedRelationError:()=>u.j4,InsertQueryBuilder:()=>ii.O,InsertResult:()=>$e.t,InsertValuesMissingError:()=>u.DK,InstanceChecker:()=>w.a,IsNull:()=>Gr,JoinColumn:()=>br,JoinTable:()=>vr,LessThan:()=>Fe,LessThanOrEqual:()=>Ke,Like:()=>Jr,LimitOnUpdateNotSupportedError:()=>u.T6,LockNotSupportedOnGivenDriverError:()=>u.Ao,ManyToMany:()=>wr,ManyToOne:()=>Er,MetadataAlreadyExistsError:()=>u.o0,MetadataWithSuchNameAlreadyExistsError:()=>u.BZ,Migration:()=>b,MigrationExecutor:()=>E,MissingDeleteDateColumnError:()=>u.dh,MissingDriverError:()=>u.Rl,MissingJoinColumnError:()=>u.im,MissingJoinTableError:()=>u.Eh,MissingPrimaryColumnError:()=>u.H5,MongoDriver:()=>L.MongoDriver,MongoEntityManager:()=>L.MongoEntityManager,MongoQueryRunner:()=>L.MongoQueryRunner,MongoRepository:()=>L.MongoRepository,MoreThan:()=>We,MoreThanOrEqual:()=>Ve,MssqlParameter:()=>v,MustBeEntityError:()=>u.Bg,MysqlDriver:()=>L.MysqlDriver,NamingStrategyNotFoundError:()=>u.CJ,NoConnectionForRepositoryError:()=>u.zx,NoConnectionOptionError:()=>u.Hu,NoNeedToReleaseEntityManagerError:()=>u.rX,NoVersionOrUpdateDateColumnError:()=>u.f1,Not:()=>Xr,NotBrackets:()=>ci,ObjectIdColumn:()=>sr,OffsetWithoutLimitNotSupportedError:()=>u.Gy,OneToMany:()=>Tr,OneToOne:()=>Sr,OptimisticLockCanNotBeUsedError:()=>u.YL,OptimisticLockVersionMismatchError:()=>u.Zf,OracleDriver:()=>L.OracleDriver,PersistedEntityNotFoundError:()=>u.C$,PessimisticLockTransactionRequiredError:()=>u.GC,PostgresDriver:()=>L.PostgresDriver,PrimaryColumn:()=>nr,PrimaryColumnCannotBeNullableError:()=>u.IQ,PrimaryGeneratedColumn:()=>er,QueryBuilder:()=>ni.z,QueryFailedError:()=>u.Od,QueryResult:()=>dt,QueryRunnerAlreadyReleasedError:()=>u.Yq,QueryRunnerProviderAlreadyReleasedError:()=>u.iU,Raw:()=>Zr,RelationCount:()=>Nr,RelationId:()=>Ar,RelationQueryBuilder:()=>si.K,Repository:()=>K,RepositoryNotTreeError:()=>u.cK,ReturningStatementNotSupportedError:()=>u.yl,SapDriver:()=>L.SapDriver,SelectQueryBuilder:()=>gn.Z,SimpleConsoleLogger:()=>_n,SqlServerDriver:()=>L.SqlServerDriver,SqliteDriver:()=>L.SqliteDriver,SubjectRemovedAndUpdatedError:()=>u.B0,SubjectWithoutIdentifierError:()=>u.Hl,TOO_MANY_PARAMS_QUERY_THRESHOLD:()=>F,Table:()=>_,TableCheck:()=>y,TableColumn:()=>h,TableExclusion:()=>g,TableForeignKey:()=>p,TableIndex:()=>d,TableInheritance:()=>Mr,TableUnique:()=>f,TransactionAlreadyStartedError:()=>u.SF,TransactionNotStartedError:()=>u.W5,Tree:()=>Pr,TreeChildren:()=>kr,TreeLevelColumn:()=>Or,TreeParent:()=>Ir,TreeRepository:()=>W,TreeRepositoryNotSupportedError:()=>u.A,TreeRepositoryUtils:()=>B,TypeORMError:()=>u.K_,Unique:()=>Dr,UpdateDateColumn:()=>rr,UpdateQueryBuilder:()=>ai.T,UpdateResult:()=>ze.s,UpdateValuesMissingError:()=>u.yv,UsingJoinColumnIsNotAllowedError:()=>u.Xk,UsingJoinColumnOnlyOnOneSideAllowedError:()=>u.Tg,UsingJoinTableIsNotAllowedError:()=>u.uP,UsingJoinTableOnlyOnOneSideAllowedError:()=>u.AV,VersionColumn:()=>ir,ViewColumn:()=>ar,ViewEntity:()=>Rr,createConnection:()=>jn,createConnections:()=>$n,createQueryBuilder:()=>Gn,getConnection:()=>Un,getConnectionManager:()=>Bn,getConnectionOptions:()=>qn,getCustomRepository:()=>Qn,getFromContainer:()=>Gt,getManager:()=>Fn,getMetadataArgsStorage:()=>Dn,getMongoManager:()=>Kn,getMongoRepository:()=>zn,getRepository:()=>Vn,getSqljsManager:()=>Wn,getTreeRepository:()=>Hn,useContainer:()=>zt});n(201738);class r{static getInheritanceTree(e){const t=[e],n=e=>{const r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t}static isInherited(e,t){return e.prototype instanceof t}static filterByTarget(e,t){return t?e.filter((e=>e.target&&-1!==t.indexOf(e.target))):e}}class i{constructor(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}filterTables(e){return this.filterByTarget(this.tables,e)}filterColumns(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)}findGenerated(e,t){return this.generations.find((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t))}findTree(e){return this.trees.find((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterRelations(e){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,e)}filterRelationIds(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)}filterRelationCounts(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)}filterIndices(e){return this.indices.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterUniques(e){return this.uniques.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterChecks(e){return this.checks.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterExclusions(e){return this.exclusions.filter((t=>Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e))}filterListeners(e){return this.filterByTarget(this.entityListeners,e)}filterEmbeddeds(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)}findJoinTable(e,t){return this.joinTables.find((n=>n.target===e&&n.propertyName===t))}filterJoinColumns(e,t){return this.joinColumns.filter((n=>n.target===e&&n.propertyName===t))}filterSubscribers(e){return this.filterByTarget(this.entitySubscribers,e)}filterNamingStrategies(e){return this.filterByTarget(this.namingStrategies,e)}filterTransactionEntityManagers(e,t){return this.transactionEntityManagers.filter((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t))}filterTransactionRepository(e,t){return this.transactionRepositories.filter((n=>(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t))}filterSingleTableChildren(e){return this.tables.filter((t=>"function"==typeof t.target&&"function"==typeof e&&r.isInherited(t.target,e)&&"entity-child"===t.type))}findInheritanceType(e){return this.inheritances.find((t=>t.target===e))}findDiscriminatorValue(e){return this.discriminatorValues.find((t=>t.target===e))}filterByTarget(e,t){return e.filter((e=>Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t))}filterByTargetAndWithoutDuplicateProperties(e,t){const n=[];return e.forEach((e=>{(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((t=>t.propertyName===e.propertyName))||n.push(e))})),n}filterByTargetAndWithoutDuplicateRelationProperties(e,t){const n=[];return e.forEach((e=>{if(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t){const r=n.findIndex((t=>t.propertyName===e.propertyName));if(Array.isArray(t)&&-1!==r&&t.indexOf(e.target)<t.indexOf(n[r].target)){const t=Object.create(n[r]);t.type=e.type,n[r]=t}else-1===r&&n.push(e)}})),n}filterByTargetAndWithoutDuplicateEmbeddedProperties(e,t){const n=[];return e.forEach((e=>{if(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t){n.find((t=>t.prefix===e.prefix&&t.propertyName===e.propertyName))||n.push(e)}})),n}}class a{static getGlobalVariable(){return"undefined"!=typeof window?window:n.g}static load(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: require("${e}").`);return""}static pathNormalize(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.normalize("${e}").`);return""}static pathExtname(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.extname("${e}").`);return""}static pathResolve(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: path.resolve("${e}").`);return""}static fileExist(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.existsSync("${e}").`);return!1}static dotenv(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "${e}" }).`)}static getEnvVariable(e){}static readFileSync(e){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("${e}").`);return null}static appendFileSync(e,t){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("${e}").`)}static writeFile(e,t){if("browser"===this.type)throw new Error(`This option/function is not supported in the browser environment. Failed operation: fs.writeFile("${e}").`);return Promise.reject(null)}static highlightSql(e){return e}static highlightJson(e){return e}static logInfo(e,t){console.info(e+" ",t)}static logError(e,t){console.error(e+" ",t)}static logWarn(e,t){console.warn(e+" ",t)}static log(e){console.log(e)}static warn(e){return e}}a.type="browser";"undefined"!=typeof window&&(window.Buffer=n(348834).Buffer),void 0!==n.g&&(n.g.Buffer=n(348834).Buffer);class s{async all(){throw new Error("Cannot read connection options in a browser context.")}async get(){throw new Error("Cannot read connection options in a browser context.")}async has(){throw new Error("Cannot read connection options in a browser context.")}}class o{static sha1(e){let t,n,r,i,a,s,o,c,l,u=function(e,t){return e<<t|e>>>32-t},h=function(e){let t,n,r="";for(t=7;t>=0;t--)n=e>>>4*t&15,r+=n.toString(16);return r},d=new Array(80),p=1732584193,m=4023233417,f=2562383102,y=271733878,g=3285377520,_=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<_-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(_%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(_-1)<<24|8388608;break;case 2:n=e.charCodeAt(_-2)<<24|e.charCodeAt(_-1)<<16|32768;break;case 3:n=e.charCodeAt(_-3)<<24|e.charCodeAt(_-2)<<16|e.charCodeAt(_-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(_>>>29),b.push(_<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)d[n]=b[t+n];for(n=16;n<=79;n++)d[n]=u(d[n-3]^d[n-8]^d[n-14]^d[n-16],1);for(i=p,a=m,s=f,o=y,c=g,n=0;n<=19;n++)l=u(i,5)+(a&s|~a&o)+c+d[n]+1518500249&4294967295,c=o,o=s,s=u(a,30),a=i,i=l;for(n=20;n<=39;n++)l=u(i,5)+(a^s^o)+c+d[n]+1859775393&4294967295,c=o,o=s,s=u(a,30),a=i,i=l;for(n=40;n<=59;n++)l=u(i,5)+(a&s|a&o|s&o)+c+d[n]+2400959708&4294967295,c=o,o=s,s=u(a,30),a=i,i=l;for(n=60;n<=79;n++)l=u(i,5)+(a^s^o)+c+d[n]+3395469782&4294967295,c=o,o=s,s=u(a,30),a=i,i=l;p=p+i&4294967295,m=m+a&4294967295,f=f+s&4294967295,y=y+o&4294967295,g=g+c&4294967295}return l=h(p)+h(m)+h(f)+h(y)+h(g),l.toLowerCase()}}var c=n(116188);class l{constructor(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}getTableName(e){return"string"!=typeof e&&(e=e.name),e.split(".").pop()}tableName(e,t){return t||(0,c.fu)(e)}closureJunctionTableName(e){return e+"_closure"}columnName(e,t,n){const r=t||e;return n.length?(0,c.eV)(n.join("_"))+(0,c.Qs)(r):r}relationName(e){return e}primaryKeyName(e,t){const n=[...t];n.sort();const r=`${this.getTableName(e).replace(".","_")}_${n.join("_")}`;return"PK_"+o.sha1(r).substr(0,27)}uniqueConstraintName(e,t){const n=[...t];n.sort();const r=`${this.getTableName(e).replace(".","_")}_${n.join("_")}`;return"UQ_"+o.sha1(r).substr(0,27)}relationConstraintName(e,t,n){const r=[...t];r.sort();let i=`${this.getTableName(e).replace(".","_")}_${r.join("_")}`;return n&&(i+=`_${n}`),"REL_"+o.sha1(i).substr(0,26)}defaultConstraintName(e,t){const n=`${this.getTableName(e).replace(".","_")}_${t}`;return"DF_"+o.sha1(n).substr(0,27)}foreignKeyName(e,t,n,r){const i=[...t];i.sort();const a=`${this.getTableName(e).replace(".","_")}_${i.join("_")}`;return"FK_"+o.sha1(a).substr(0,27)}indexName(e,t,n){const r=[...t];r.sort();let i=`${this.getTableName(e).replace(".","_")}_${r.join("_")}`;return n&&(i+=`_${n}`),"IDX_"+o.sha1(i).substr(0,26)}checkConstraintName(e,t,n){const r=`${this.getTableName(e).replace(".","_")}_${t}`,i="CHK_"+o.sha1(r).substr(0,26);return n?`${i}_ENUM`:i}exclusionConstraintName(e,t){const n=`${this.getTableName(e).replace(".","_")}_${t}`;return"XCL_"+o.sha1(n).substr(0,26)}joinColumnName(e,t){return(0,c.eV)(e+"_"+t)}joinTableName(e,t,n,r){return(0,c.fu)(e+"_"+n.replace(/\./gi,"_")+"_"+t)}joinTableColumnDuplicationPrefix(e,t){return e+"_"+t}joinTableColumnName(e,t,n){return(0,c.eV)(e+"_"+(n||t))}joinTableInverseColumnName(e,t,n){return this.joinTableColumnName(e,t,n)}prefixTableName(e,t){return e+t}eagerJoinRelationAlias(e,t){return e+"_"+t.replace(".","_")}}var u=n(600706);class h{constructor(e){this["@instanceof"]=Symbol.for("TableColumn"),this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||(e.unsigned||!1),this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.generatedIdentity=e.generatedIdentity,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.primaryKeyConstraintName=e.primaryKeyConstraintName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}clone(){return new h({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,primaryKeyConstraintName:this.primaryKeyConstraintName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,generatedIdentity:this.generatedIdentity,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})}}class d{constructor(e){this["@instanceof"]=Symbol.for("TableIndex"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.isNullFiltered=!!e.isNullFiltered,this.parser=e.parser,this.where=e.where?e.where:""}clone(){return new d({name:this.name,columnNames:[...this.columnNames],isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,isNullFiltered:this.isNullFiltered,parser:this.parser,where:this.where})}static create(e){return new d({name:e.name,columnNames:e.columns.map((e=>e.databaseName)),isUnique:e.isUnique,isSpatial:e.isSpatial,isFulltext:e.isFulltext,isNullFiltered:e.isNullFiltered,parser:e.parser,where:e.where})}}class p{constructor(e){this["@instanceof"]=Symbol.for("TableForeignKey"),this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedDatabase=e.referencedDatabase,this.referencedSchema=e.referencedSchema,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}clone(){return new p({name:this.name,columnNames:[...this.columnNames],referencedColumnNames:[...this.referencedColumnNames],referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})}static create(e,t){return new p({name:e.name,columnNames:e.columnNames,referencedColumnNames:e.referencedColumnNames,referencedDatabase:e.referencedEntityMetadata.database,referencedSchema:e.referencedEntityMetadata.schema,referencedTableName:e.referencedTablePath,onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable})}}class m{static createTableColumnOptions(e,t){return{name:e.databaseName,length:t.getColumnLength(e),width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,generatedIdentity:e.generatedIdentity,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map((e=>e+"")):e.enum,enumName:e.enumName,primaryKeyConstraintName:e.primaryKeyConstraintName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}}}class f{constructor(e){this["@instanceof"]=Symbol.for("TableUnique"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.deferrable=e.deferrable}clone(){return new f({name:this.name,columnNames:[...this.columnNames],deferrable:this.deferrable})}static create(e){return new f({name:e.name,columnNames:e.columns.map((e=>e.databaseName)),deferrable:e.deferrable})}}class y{constructor(e){this["@instanceof"]=Symbol.for("TableCheck"),this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}clone(){return new y({name:this.name,columnNames:this.columnNames?[...this.columnNames]:[],expression:this.expression})}static create(e){return new y({name:e.name,expression:e.expression})}}class g{constructor(e){this["@instanceof"]=Symbol.for("TableExclusion"),this.name=e.name,this.expression=e.expression}clone(){return new g({name:this.name,expression:this.expression})}static create(e){return new g({name:e.name,expression:e.expression})}}class _{constructor(e){this["@instanceof"]=Symbol.for("Table"),this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,this.withoutRowid=!1,e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,e.columns&&(this.columns=e.columns.map((e=>new h(e)))),e.indices&&(this.indices=e.indices.map((e=>new d(e)))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map((t=>new p({...t,referencedDatabase:(null==t?void 0:t.referencedDatabase)||e.database,referencedSchema:(null==t?void 0:t.referencedSchema)||e.schema})))),e.uniques&&(this.uniques=e.uniques.map((e=>new f(e)))),e.checks&&(this.checks=e.checks.map((e=>new y(e)))),e.exclusions&&(this.exclusions=e.exclusions.map((e=>new g(e)))),void 0!==e.justCreated&&(this.justCreated=e.justCreated),e.withoutRowid&&(this.withoutRowid=e.withoutRowid),this.engine=e.engine)}get primaryColumns(){return this.columns.filter((e=>e.isPrimary))}clone(){return new _({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map((e=>e.clone())),indices:this.indices.map((e=>e.clone())),foreignKeys:this.foreignKeys.map((e=>e.clone())),uniques:this.uniques.map((e=>e.clone())),checks:this.checks.map((e=>e.clone())),exclusions:this.exclusions.map((e=>e.clone())),justCreated:this.justCreated,withoutRowid:this.withoutRowid,engine:this.engine})}addColumn(e){this.columns.push(e)}removeColumn(e){const t=this.columns.find((t=>t.name===e.name));t&&this.columns.splice(this.columns.indexOf(t),1)}addUniqueConstraint(e){if(this.uniques.push(e),1===e.columnNames.length){const t=this.columns.find((t=>t.name===e.columnNames[0]));t&&(t.isUnique=!0)}}removeUniqueConstraint(e){const t=this.uniques.find((t=>t.name===e.name));if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){const e=this.columns.find((e=>e.name===t.columnNames[0]));e&&(e.isUnique=!1)}}addCheckConstraint(e){this.checks.push(e)}removeCheckConstraint(e){const t=this.checks.find((t=>t.name===e.name));t&&this.checks.splice(this.checks.indexOf(t),1)}addExclusionConstraint(e){this.exclusions.push(e)}removeExclusionConstraint(e){const t=this.exclusions.find((t=>t.name===e.name));t&&this.exclusions.splice(this.exclusions.indexOf(t),1)}addForeignKey(e){this.foreignKeys.push(e)}removeForeignKey(e){const t=this.foreignKeys.find((t=>t.name===e.name));t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)}addIndex(e,t=!1){if(this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){const t=this.columns.find((t=>t.name===e.columnNames[0]));t&&(t.isUnique=!0)}}removeIndex(e,t=!1){const n=this.indices.find((t=>t.name===e.name));if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){const e=this.columns.find((e=>e.name===n.columnNames[0]));e&&(e.isUnique=this.indices.some((t=>1===t.columnNames.length&&t.columnNames[0]===e.name&&!!n.isUnique)))}}findColumnByName(e){return this.columns.find((t=>t.name===e))}findColumnIndices(e){return this.indices.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnForeignKeys(e){return this.foreignKeys.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnUniques(e){return this.uniques.filter((t=>!!t.columnNames.find((t=>t===e.name))))}findColumnChecks(e){return this.checks.filter((t=>!!t.columnNames.find((t=>t===e.name))))}static create(e,t){const n=e.database===t.database?void 0:e.database,r=e.schema===t.options.schema?void 0:e.schema,i={database:e.database,schema:e.schema,name:t.buildTableName(e.tableName,r,n),withoutRowid:e.withoutRowid,engine:e.engine,columns:e.columns.filter((e=>e)).map((e=>m.createTableColumnOptions(e,t))),indices:e.indices.filter((e=>!0===e.synchronize)).map((e=>d.create(e))),uniques:e.uniques.map((e=>f.create(e))),checks:e.checks.map((e=>y.create(e))),exclusions:e.exclusions.map((e=>g.create(e)))};return new _(i)}}class b{constructor(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r}}class v{constructor(e,t,...n){this.value=e,this.type=t,this["@instanceof"]=Symbol.for("MssqlParameter"),this.params=[],this.params=n||[]}}var w=n(312758);class E{constructor(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";const{schema:n}=this.connection.driver.options,r=this.connection.driver.database;this.migrationsDatabase=r,this.migrationsSchema=n,this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n,r)}async executeMigration(e){return this.withQueryRunner((async t=>(await this.createMigrationsTableIfNotExist(t),await t.beforeMigration(),await e.instance.up(t),await t.afterMigration(),await this.insertExecutedMigration(t,e),e)))}async getAllMigrations(){return Promise.resolve(this.getMigrations())}async getExecutedMigrations(){return this.withQueryRunner((async e=>(await this.createMigrationsTableIfNotExist(e),await this.loadExecutedMigrations(e))))}async getPendingMigrations(){const e=await this.getAllMigrations(),t=await this.getExecutedMigrations();return e.filter((e=>!t.find((t=>t.name===e.name))))}insertMigration(e){return this.withQueryRunner((t=>this.insertExecutedMigration(t,e)))}deleteMigration(e){return this.withQueryRunner((t=>this.deleteExecutedMigration(t,e)))}async showMigrations(){let e=!1;const t=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(t);const n=await this.loadExecutedMigrations(t),r=this.getMigrations();for(const t of r){n.find((e=>e.name===t.name))?this.connection.logger.logSchemaBuild(`[X] ${t.name}`):(e=!0,this.connection.logger.logSchemaBuild(`[ ] ${t.name}`))}return this.queryRunner||await t.release(),e}async executePendingMigrations(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const t=this.connection.driver.createSchemaBuilder();w.a.isRdbmsSchemaBuilder(t)&&await t.createMetadataTableIfNecessary(e);const n=await this.loadExecutedMigrations(e);let r=this.getLatestTimestampMigration(n);const i=this.getMigrations(),a=[],s=i.filter((e=>!n.find((t=>t.name===e.name))));if(!s.length)return this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner||await e.release(),[];this.connection.logger.logSchemaBuild(`${n.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${i.length} migrations were found in the source code.`),r&&this.connection.logger.logSchemaBuild(`${r.name} is the last executed migration. It was executed on ${new Date(r.timestamp).toString()}.`),this.connection.logger.logSchemaBuild(`${s.length} migrations are new migrations must be executed.`);let o=!1;"all"!==this.transaction||e.isTransactionActive||(await e.startTransaction(),o=!0);try{for(const t of s)this.fake?await this.insertExecutedMigration(e,t):("each"!==this.transaction||e.isTransactionActive||(await e.startTransaction(),o=!0),await t.instance.up(e).catch((e=>{throw this.connection.logger.logMigration(`Migration "${t.name}" failed, error: ${null==e?void 0:e.message}`),e})).then((async()=>{await this.insertExecutedMigration(e,t),"each"===this.transaction&&o&&await e.commitTransaction()})).then((()=>{a.push(t),this.connection.logger.logSchemaBuild(`Migration ${t.name} has been ${this.fake?"(fake)":""} executed successfully.`)})));"all"===this.transaction&&o&&await e.commitTransaction()}catch(t){if(o)try{await e.rollbackTransaction()}catch(e){}throw t}finally{this.queryRunner||await e.release()}return a}async undoLastMigration(){const e=this.queryRunner||this.connection.createQueryRunner();await this.createMigrationsTableIfNotExist(e);const t=await this.loadExecutedMigrations(e);let n=this.getLatestExecutedMigration(t);if(!n)return void this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!");const r=this.getMigrations().find((e=>e.name===n.name));if(!r)throw new u.K_(`No migration ${n.name} was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.`);this.connection.logger.logSchemaBuild(`${t.length} migrations are already loaded in the database.`),this.connection.logger.logSchemaBuild(`${n.name} is the last executed migration. It was executed on ${new Date(n.timestamp).toString()}.`),this.connection.logger.logSchemaBuild("Now reverting it...");let i=!1;"none"===this.transaction||e.isTransactionActive||(await e.startTransaction(),i=!0);try{this.fake||(await e.beforeMigration(),await r.instance.down(e),await e.afterMigration()),await this.deleteExecutedMigration(e,r),this.connection.logger.logSchemaBuild(`Migration ${r.name} has been ${this.fake?"(fake)":""} reverted successfully.`),i&&await e.commitTransaction()}catch(t){if(i)try{await e.rollbackTransaction()}catch(e){}throw t}finally{this.queryRunner||await e.release()}}async createMigrationsTableIfNotExist(e){if("mongodb"===this.connection.driver.options.type)return;await e.hasTable(this.migrationsTable)||await e.createTable(new _({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))}async loadExecutedMigrations(e){if("mongodb"===this.connection.driver.options.type){const t=e;return await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()}return(await this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()).map((e=>new b(parseInt(e.id),parseInt(e.timestamp),e.name)))}getMigrations(){const e=this.connection.migrations.map((e=>{const t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new u.K_(`${t} migration name is wrong. Migration class name should have a JavaScript timestamp appended.`);return new b(void 0,n,t,e)}));return this.checkForDuplicateMigrations(e),e.sort(((e,t)=>e.timestamp-t.timestamp))}checkForDuplicateMigrations(e){const t=e.map((e=>e.name)),n=Array.from(new Set(t.filter(((e,n)=>t.indexOf(e)<n))));if(n.length>0)throw Error(`Duplicate migrations: ${n.join(", ")}`)}getLatestTimestampMigration(e){const t=e.map((e=>e)).sort(((e,t)=>-1*(e.timestamp-t.timestamp)));return t.length>0?t[0]:void 0}getLatestExecutedMigration(e){return e.length>0?e[0]:void 0}async insertExecutedMigration(e,t){const n={};if("mssql"===this.connection.driver.options.type?(n.timestamp=new v(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),"mongodb"===this.connection.driver.options.type){const t=e;await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(n)}else{const t=e.manager.createQueryBuilder();await t.insert().into(this.migrationsTable).values(n).execute()}}async deleteExecutedMigration(e,t){const n={};if("mssql"===this.connection.driver.options.type?(n.timestamp=new v(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),"mongodb"===this.connection.driver.options.type){const t=e;await t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)}else{const t=e.manager.createQueryBuilder();await t.delete().from(this.migrationsTable).where(`${t.escape("timestamp")} = :timestamp`).andWhere(`${t.escape("name")} = :name`).setParameters(n).execute()}}async withQueryRunner(e){const t=this.queryRunner||this.connection.createQueryRunner();try{return e(t)}finally{this.queryRunner||await t.release()}}}var T=n(692261),S=n(778712);function N(e,t,n){let r=[],i={};return function a(s){i[s]=!0,r.push(s),e[s].forEach((function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new u.K_(`Dependency Cycle Found: ${r.join(" -> ")}`)}else a(e)})),r.pop(),t&&0!==e[s].length||-1!==n.indexOf(s)||n.push(s)}}class A{constructor(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}addNode(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])}removeNode(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach((function(t){Object.keys(t).forEach((function(n){let r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)}),this)})))}hasNode(e){return this.nodes.hasOwnProperty(e)}getNodeData(e){if(this.hasNode(e))return this.nodes[e];throw new u.K_(`Node does not exist: ${e}`)}setNodeData(e,t){if(!this.hasNode(e))throw new u.K_(`Node does not exist: ${e}`);this.nodes[e]=t}addDependency(e,t){if(!this.hasNode(e))throw new u.K_(`Node does not exist: ${e}`);if(!this.hasNode(t))throw new u.K_(`Node does not exist: ${t}`);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0}removeDependency(e,t){let n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t),n>=0&&this.outgoingEdges[e].splice(n,1)),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e),n>=0&&this.incomingEdges[t].splice(n,1))}dependenciesOf(e,t){if(this.hasNode(e)){let n=[];N(this.outgoingEdges,t,n)(e);let r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new u.K_(`Node does not exist: ${e}`)}dependantsOf(e,t){if(this.hasNode(e)){let n=[];N(this.incomingEdges,t,n)(e);let r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new u.K_(`Node does not exist: ${e}`)}overallOrder(e){let t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;{let i=N(this.outgoingEdges,!1,[]);r.forEach((function(e){i(e)}));let a=N(this.outgoingEdges,e,n);return r.filter((function(e){return 0===t.incomingEdges[e].length})).forEach((function(e){a(e)})),n}}}var C=n(861357),x=n(173493),M=n(676938),R=n(407337);class O{validateMany(e,t){e.forEach((n=>this.validate(n,e,t))),this.validateDependencies(e),this.validateEagerRelations(e)}validate(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new T.H(e);if(e.primaryColumns.length>1){if(!e.primaryColumns.every(((e,t,n)=>e.primaryKeyConstraintName===n[0].primaryKeyConstraintName)))throw new u.K_(`Entity ${e.name} has multiple primary columns with different constraint names. Constraint names should be the equal.`)}if("STI"===e.inheritancePattern||"entity-child"===e.tableType){if(!e.discriminatorColumn)throw new u.K_(`Entity ${e.name} using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?`);if(void 0===e.discriminatorValue)throw new u.K_(`Entity ${e.name} has an undefined discriminator value. Discriminator value should be defined.`);const n=t.find((t=>t!==e&&("STI"===t.inheritancePattern||"entity-child"===t.tableType)&&t.tableName===e.tableName&&t.discriminatorValue===e.discriminatorValue&&t.inheritanceTree.some((t=>-1!==e.inheritanceTree.indexOf(t)))));if(n)throw new u.K_(`Entities ${e.name} and ${n.name} have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.`)}if(e.relationCounts.forEach((e=>{if(e.relation.isManyToOne||e.relation.isOneToOne)throw new u.K_("Relation count can not be implemented on ManyToOne or OneToOne relations.")})),"mongodb"!==n.options.type&&e.columns.forEach((t=>{const r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new C.q(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new u.K_(`Column ${t.propertyName} of Entity ${e.name} does not support length property.`);if("enum"===t.type&&!t.enum&&!t.enumName)throw new u.K_(`Column "${t.propertyName}" of Entity "${e.name}" is defined as enum, but missing "enum" or "enumName" properties.`)})),R.z.isMySQLFamily(n)||"aurora-mysql"===n.options.type){if(e.columns.filter((e=>e.isGenerated&&"uuid"!==e.generationStrategy)).length>1)throw new u.K_(`Error in ${e.name} entity. There can be only one auto-increment column in MySql table.`)}if(R.z.isMySQLFamily(n)){if(0===t.filter((e=>e.database)).length&&!n.database)throw new x.H("database")}if("mssql"===n.options.type){if(e.columns.filter((e=>e.charset)).length>1)throw new u.K_("Character set specifying is not supported in Sql Server")}if("postgres"===n.options.type){const t=e.columns.find((e=>e.asExpression&&(!e.generatedType||"VIRTUAL"===e.generatedType)));if(t)throw new u.K_(`Column "${t.propertyName}" of Entity "${e.name}" is defined as VIRTUAL, but Postgres supports only STORED generated columns.`)}const r=e.create(void 0,{fromDeserializer:!0});e.relations.forEach((e=>{if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;const t=e.getEntityValue(r);if(Array.isArray(t))throw new M.j(e)}})),e.relations.forEach((e=>{})),e.relations.forEach((t=>{if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new u.K_(`Relation ${e.name}#${t.propertyName} and ${t.inverseRelation.entityMetadata.name}#${t.inverseRelation.propertyName} both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.`)})),e.eagerRelations.forEach((e=>{}))}validateDependencies(e){const t=new A;e.forEach((e=>{t.addNode(e.name)})),e.forEach((e=>{e.relationsWithJoinColumns.filter((e=>!e.isNullable)).forEach((n=>{t.addDependency(e.name,n.inverseEntityMetadata.name)}))}));try{t.overallOrder()}catch(e){throw new S.u(e.toString().replace("Error: Dependency Cycle Found: ",""))}}validateEagerRelations(e){e.forEach((e=>{e.eagerRelations.forEach((t=>{if(t.inverseRelation&&t.inverseRelation.isEager)throw new u.K_(`Circular eager relations are disallowed. ${e.targetName}#${t.propertyPath} contains "eager: true", and its inverse side ${t.inverseEntityMetadata.targetName}#${t.inverseRelation.propertyPath} contains "eager: true" as well. Remove "eager: true" from one side of the relation.`)}))}))}}var I=n(517830),k=n(604484),P=n(236352),L=n(251279),D=n(584639),q=n(653140);class B{static createRelationMaps(e,t,n,r){return r.map((r=>{const i=t.treeParentRelation.joinColumns[0],a=i.givenDatabaseName||i.databaseName,s=r[n+"_"+t.primaryColumns[0].databaseName],o=r[n+"_"+a];return{id:e.connection.driver.prepareHydratedValue(s,t.primaryColumns[0]),parentId:e.connection.driver.prepareHydratedValue(o,i)}}))}static buildChildrenEntityTree(e,t,n,r,i){const a=e.treeChildrenRelation.propertyName;if(0===i.depth)return void(t[a]=[]);const s=e.primaryColumns[0].getEntityValue(t),o=r.filter((e=>e.parentId===s)),c=new Set(o.map((e=>e.id)));t[a]=n.filter((t=>c.has(e.primaryColumns[0].getEntityValue(t)))),t[a].forEach((t=>{B.buildChildrenEntityTree(e,t,n,r,{...i,depth:i.depth-1})}))}static buildParentEntityTree(e,t,n,r){const i=e.treeParentRelation.propertyName,a=e.primaryColumns[0].getEntityValue(t),s=r.find((e=>e.id===a)),o=n.find((t=>!!s&&e.primaryColumns[0].getEntityValue(t)===s.parentId));o&&(t[i]=o,B.buildParentEntityTree(e,t[i],n,r))}}var j=n(173964),$=n.n(j);const U=50,F=20;class K{constructor(e,t,n){this.target=e,this.manager=t,this.queryRunner=n}get metadata(){return this.manager.connection.getMetadata(this.target)}createQueryBuilder(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)}hasId(e){return this.manager.hasId(this.metadata.target,e)}getId(e){return this.manager.getId(this.metadata.target,e)}create(e){return this.manager.create(this.metadata.target,e)}merge(e,...t){return this.manager.merge(this.metadata.target,e,...t)}preload(e){return this.manager.preload(this.metadata.target,e)}save(e,t){return this.manager.save(this.metadata.target,e,t)}remove(e,t){return this.manager.remove(this.metadata.target,e,t)}softRemove(e,t){return this.manager.softRemove(this.metadata.target,e,t)}recover(e,t){return this.manager.recover(this.metadata.target,e,t)}insert(e){return this.manager.insert(this.metadata.target,e)}update(e,t){return this.manager.update(this.metadata.target,e,t)}upsert(e,t){return this.manager.upsert(this.metadata.target,e,t)}batchUpsert(e,t,n=U){return 0===e.length?[]:$()(e,n).map((e=>this.upsert(e,t)))}delete(e){return this.manager.delete(this.metadata.target,e)}deleteEntities(e,t=U){const n=e.map((e=>e.id));return $()(n,t).map((e=>this.delete(e)))}softDelete(e){return this.manager.softDelete(this.metadata.target,e)}isNull(){return!1}restore(e){return this.manager.restore(this.metadata.target,e)}count(e){return this.manager.count(this.metadata.target,e)}countBy(e){return this.manager.countBy(this.metadata.target,e)}async find(e){return this.manager.find(this.metadata.target,e)}async findBy(e){return this.manager.findBy(this.metadata.target,e)}findAndCount(e){return this.manager.findAndCount(this.metadata.target,e)}findAndCountBy(e){return this.manager.findAndCountBy(this.metadata.target,e)}async findByIds(e){return this.manager.findByIds(this.metadata.target,e)}async findOne(e){return this.manager.findOne(this.metadata.target,e)}async findOneBy(e){return this.manager.findOneBy(this.metadata.target,e)}async findOneById(e){return this.manager.findOneById(this.metadata.target,e)}async findOneOrFail(e){return this.manager.findOneOrFail(this.metadata.target,e)}async findOneByOrFail(e){return this.manager.findOneByOrFail(this.metadata.target,e)}query(e,t){return this.manager.query(e,t)}clear(){return this.manager.clear(this.metadata.target)}increment(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)}decrement(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)}extend(e){const t=this.constructor,{target:n,manager:r,queryRunner:i}=this,a=new class extends t{}(n,r,i);return Object.assign(a,e),a}}class W extends K{async findTrees(e){const t=await this.findRoots(e);return await Promise.all(t.map((t=>this.findDescendantsTree(t,e)))),t}findRoots(e){const t=this.metadata.treeParentRelation.joinColumns[0],n=t.givenDatabaseName||t.databaseName,r=this.createQueryBuilder("treeEntity");return q.Z.applyOptionsToTreeQueryBuilder(r,e),r.where(`${(e=>this.manager.connection.driver.escape(e))("treeEntity")}.${(e=>this.manager.connection.driver.escape(e))(n)} IS NULL`).getMany()}findDescendants(e,t){const n=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);return q.Z.applyOptionsToTreeQueryBuilder(n,t),n.getMany()}async findDescendantsTree(e,t){const n=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e);q.Z.applyOptionsToTreeQueryBuilder(n,t);const r=await n.getRawAndEntities(),i=B.createRelationMaps(this.manager,this.metadata,"treeEntity",r.raw);return B.buildChildrenEntityTree(this.metadata,e,r.entities,i,{depth:-1,...t}),e}countDescendants(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()}createDescendantsQueryBuilder(e,t,n){const r=e=>this.manager.connection.driver.escape(e);if("closure-table"===this.metadata.treeType){const i=this.metadata.closureJunctionTable.descendantColumns.map((n=>r(t)+"."+r(n.propertyPath)+" = "+r(e)+"."+r(n.referencedColumn.propertyPath))).join(" AND "),a={},s=this.metadata.closureJunctionTable.ancestorColumns.map((e=>(a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),r(t)+"."+r(e.propertyPath)+" = :"+e.referencedColumn.propertyName))).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(s).setParameters(a)}if("nested-set"===this.metadata.treeType){const t=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath,r={},i=this.metadata.treeParentRelation.joinColumns.map((e=>{const t=e.referencedColumn.propertyPath.replace(".","_");return r[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",t).where(i,r)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((t=>{const r=t.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(n));return R.z.isSQLiteFamily(this.manager.connection.driver)?`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE ${r.getQuery()} || '%'`:`${e}.${this.metadata.materializedPathColumn.propertyPath} LIKE NULLIF(CONCAT(${r.getQuery()}, '%'), '%')`}));throw new D.K("Supported only in tree entities")}findAncestors(e,t){const n=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);return q.Z.applyOptionsToTreeQueryBuilder(n,t),n.getMany()}async findAncestorsTree(e,t){const n=this.createAncestorsQueryBuilder("treeEntity","treeClosure",e);q.Z.applyOptionsToTreeQueryBuilder(n,t);const r=await n.getRawAndEntities(),i=B.createRelationMaps(this.manager,this.metadata,"treeEntity",r.raw);return B.buildParentEntityTree(this.metadata,e,r.entities,i),e}countAncestors(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()}createAncestorsQueryBuilder(e,t,n){if("closure-table"===this.metadata.treeType){const r=this.metadata.closureJunctionTable.ancestorColumns.map((n=>t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath)).join(" AND "),i={},a=this.metadata.closureJunctionTable.descendantColumns.map((e=>(i[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName))).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,r).where(a).setParameters(i)}if("nested-set"===this.metadata.treeType){const t="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath,r={},i=this.metadata.treeParentRelation.joinColumns.map((e=>{const t=e.referencedColumn.propertyPath.replace(".","_");return r[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",t).where(i,r)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((t=>{const r=t.subQuery().select(`${this.metadata.targetName}.${this.metadata.materializedPathColumn.propertyPath}`,"path").from(this.metadata.target,this.metadata.targetName).whereInIds(this.metadata.getEntityIdMap(n));return R.z.isSQLiteFamily(this.manager.connection.driver)?`${r.getQuery()} LIKE ${e}.${this.metadata.materializedPathColumn.propertyPath} || '%'`:`${r.getQuery()} LIKE CONCAT(${e}.${this.metadata.materializedPathColumn.propertyPath}, '%')`}));throw new D.K("Supported only in tree entities")}extend(e){const t=this.constructor,{target:n,manager:r,queryRunner:i}=this,a=new class extends t{}(n,r,i);return Object.assign(a,e),a}}var V=n(503681);class H{transform(e,t,n,r=!1){return this.groupAndTransform(e,t,n,r),e}groupAndTransform(e,t,n,r=!1){n.nonVirtualColumns.forEach((n=>{const r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)})),n.relations.length&&n.relations.forEach((n=>{let i=n.getEntityValue(e);const a=n.getEntityValue(t,r);if(void 0!==a)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(a))return;i||(i=[],n.setEntityValue(e,i)),a.forEach((e=>{let t=i.find((t=>n.inverseEntityMetadata.compareEntities(e,t)));t||(t=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),i.push(t)),this.groupAndTransform(t,e,n.inverseEntityMetadata,r)}))}else{if(!V.g.isObject(a))return void(V.g.isObject(i)||n.setEntityValue(e,a));i||(i=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),n.setEntityValue(e,i)),this.groupAndTransform(i,a,n.inverseEntityMetadata,r)}}))}}class Q{constructor(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}get target(){return this.metadata.target}get id(){return this.metadata.getEntityIdMixedMap(this.plainEntity)}}class z{constructor(){this.loadMapItems=[]}get mainLoadMapItem(){return this.loadMapItems.find((e=>!e.relation&&!e.parentLoadMapItem))}addLoadMap(e){this.loadMapItems.find((t=>t.target===e.target&&t.id===e.id))||this.loadMapItems.push(e)}fillEntities(e,t){t.forEach((t=>{const n=this.loadMapItems.find((n=>n.target===e&&n.metadata.compareEntities(t,n.plainEntity)));n&&(n.entity=t)}))}groupByTargetIds(){const e=[];return this.loadMapItems.forEach((t=>{let n=e.find((e=>e.target===t.target));n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)})),e}}class G{constructor(e){this.manager=e}async transform(e,t){if(!t.hasAllPrimaryKeys(e))return Promise.reject("Given object does not have a primary column, cannot transform it to database entity.");const n=new z,r=(e,i,a,s)=>{const o=new Q(e,i,a,s);n.addLoadMap(o),i.extractRelationValuesFromEntity(e,t.relations).filter((e=>null!=e)).forEach((([e,t,n])=>r(t,n,o,e)))};return r(e,t),await Promise.all(n.groupByTargetIds().map((e=>this.manager.findByIds(e.target,e.ids).then((t=>n.fillEntities(e.target,t)))))),n.loadMapItems.forEach((e=>{e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)})),n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0}}var Y=n(583304),J=n(962428);class X{get repository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new Y.b(this.constructor);return this.manager.getRepository(e)}get treeRepository(){const e=this.getCustomRepositoryTarget(this);if(!e)throw new Y.b(this.constructor);return this.manager.getTreeRepository(e)}createQueryBuilder(e){const t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new Y.b(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)}createQueryBuilderFor(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)}getRepositoryFor(e){return this.manager.getRepository(e)}getTreeRepositoryFor(e){return this.manager.getTreeRepository(e)}getCustomRepositoryTarget(e){const t=Dn().entityRepositories.find((t=>t.target===("function"==typeof e?e:e.constructor)));if(!t)throw new J.n(e);return t.entity}}var Z=n(12055);class ee{constructor(e){this.subjects=[...e],this.metadatas=this.getUniqueMetadatas(this.subjects)}sort(e){if(!this.metadatas.length)return this.subjects;const t=[];if("delete"===e){const e=this.subjects.filter((e=>!e.entity&&!e.databaseEntity));t.push(...e),this.removeAlreadySorted(e)}const n=this.getNonNullableDependencies();let r=this.toposort(n);"insert"===e&&(r=r.reverse()),r.forEach((e=>{const n=this.subjects.filter((t=>{var n;return t.metadata.targetName===e||(null===(n=t.metadata.parentEntityMetadata)||void 0===n?void 0:n.targetName)===e}));t.push(...n),this.removeAlreadySorted(n)}));const i=this.getDependencies();let a=this.toposort(i);return"insert"===e&&(a=a.reverse()),a.forEach((e=>{const n=this.subjects.filter((t=>t.metadata.targetName===e));t.push(...n),this.removeAlreadySorted(n)})),t.push(...this.subjects),t}removeAlreadySorted(e){e.forEach((e=>{this.subjects.splice(this.subjects.indexOf(e),1)}))}getUniqueMetadatas(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e.metadata)&&t.push(e.metadata)})),t}getNonNullableDependencies(){return this.metadatas.reduce(((e,t)=>(t.relationsWithJoinColumns.forEach((n=>{n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e)),[])}getDependencies(){return this.metadatas.reduce(((e,t)=>(t.relationsWithJoinColumns.forEach((n=>{n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e)),[])}toposort(e){const t=function(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];t.indexOf(r[0])<0&&t.push(r[0]),t.indexOf(r[1])<0&&t.push(r[1])}return t}(e);let n=t.length,r=new Array(n),i={},a=n;for(;a--;)i[a]||s(t[a],a,[]);function s(a,o,c){if(c.indexOf(a)>=0)throw new u.K_("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new u.K_("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(i[o])return;i[o]=!0;let l=e.filter((function(e){return e[0]===a}));if(o=l.length){let e=c.concat(a);do{let n=l[--o][1];s(n,t.indexOf(n),e)}while(o)}r[--n]=a}return r}}Math.pow(10,8);var te=6e4,ne=36e5;function re(e,t){var n;!function(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}(1,arguments);var r=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}(null!==(n=null==t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==r&&1!==r&&0!==r)throw new RangeError("additionalDigits must be 0, 1 or 2");if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var i,a=function(e){var t,n={},r=e.split(ie.dateTimeDelimiter);if(r.length>2)return n;/:/.test(r[0])?t=r[0]:(n.date=r[0],t=r[1],ie.timeZoneDelimiter.test(n.date)&&(n.date=e.split(ie.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length)));if(t){var i=ie.timezone.exec(t);i?(n.time=t.replace(i[1],""),n.timezone=i[1]):n.time=t}return n}(e);if(a.date){var s=function(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};var i=r[1]?parseInt(r[1]):null,a=r[2]?parseInt(r[2]):null;return{year:null===a?i:100*a,restDateString:e.slice((r[1]||r[2]).length)}}(a.date,r);i=function(e,t){if(null===t)return new Date(NaN);var n=e.match(ae);if(!n)return new Date(NaN);var r=!!n[4],i=ce(n[1]),a=ce(n[2])-1,s=ce(n[3]),o=ce(n[4]),c=ce(n[5])-1;if(r)return function(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}(0,o,c)?function(e,t,n){var r=new Date(0);r.setUTCFullYear(e,0,4);var i=r.getUTCDay()||7,a=7*(t-1)+n+1-i;return r.setUTCDate(r.getUTCDate()+a),r}(t,o,c):new Date(NaN);var l=new Date(0);return function(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(ue[t]||(he(e)?29:28))}(t,a,s)&&function(e,t){return t>=1&&t<=(he(e)?366:365)}(t,i)?(l.setUTCFullYear(t,a,Math.max(i,s)),l):new Date(NaN)}(s.restDateString,s.year)}if(!i||isNaN(i.getTime()))return new Date(NaN);var o,c=i.getTime(),l=0;if(a.time&&(l=function(e){var t=e.match(se);if(!t)return NaN;var n=le(t[1]),r=le(t[2]),i=le(t[3]);if(!function(e,t,n){if(24===e)return 0===t&&0===n;return n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}(n,r,i))return NaN;return n*ne+r*te+1e3*i}(a.time),isNaN(l)))return new Date(NaN);if(!a.timezone){var u=new Date(c+l),h=new Date(0);return h.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),h.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),h}return o=function(e){if("Z"===e)return 0;var t=e.match(oe);if(!t)return 0;var n="+"===t[1]?-1:1,r=parseInt(t[2]),i=t[3]&&parseInt(t[3])||0;if(!function(e,t){return t>=0&&t<=59}(0,i))return NaN;return n*(r*ne+i*te)}(a.timezone),isNaN(o)?new Date(NaN):new Date(c+l+o)}var ie={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ae=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,se=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,oe=/^([+-])(\d{2})(?::?(\d{2}))?$/;function ce(e){return e?parseInt(e):1}function le(e){return e&&parseFloat(e.replace(",","."))||0}var ue=[31,null,31,30,31,30,31,31,30,31,30,31];function he(e){return e%400==0||e%4==0&&e%100!=0}class de{static normalizeHydratedDate(e){return e&&"string"==typeof e?new Date(e):e}static mixedDateToDateString(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e}static mixedDateToDate(e,t=!1,n=!0){let r="string"==typeof e?re(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r}static mixedDateToTimeString(e,t=!1){return e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e}static mixedTimeToDate(e){if("string"==typeof e){const[t,n,r]=e.split(":"),i=new Date;return t&&i.setHours(parseInt(t)),n&&i.setMinutes(parseInt(n)),r&&i.setSeconds(parseInt(r)),i}return e}static mixedTimeToString(e,t=!1){return"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map((e=>1===e.length?"0"+e:e)).join(":"):e}static mixedDateToDatetimeString(e,t){if("string"==typeof e&&(e=new Date(e)),e instanceof Date){let n=this.formatZerolessValue(e.getFullYear(),4)+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+=`.${this.formatMilliseconds(e.getMilliseconds())}`),e=n}return e}static mixedDateToUtcDatetimeString(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear(),4)+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e}static simpleArrayToString(e){return Array.isArray(e)?e.map((e=>String(e))).join(","):e}static stringToSimpleArray(e){return"string"==typeof e?e.length>0?e.split(","):[]:e}static simpleJsonToString(e){return JSON.stringify(e)}static stringToSimpleJson(e){return"string"==typeof e?JSON.parse(e):e}static simpleEnumToString(e){return""+e}static stringToSimpleEnum(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e}static formatZerolessValue(e,t=2){const n="0".repeat(t);return String(`${n}${e}`).slice(-t)}static formatMilliseconds(e){return e<10?"00"+e:e<100?"0"+e:String(e)}}var pe=n(234769),me=n(900924),fe=n(348834).Buffer;class ye{compute(e){e.forEach((t=>{this.computeDiffColumns(t),this.computeDiffRelationalColumns(e,t)}))}computeDiffColumns(e){e.entity&&e.metadata.columns.forEach((t=>{if(t.isVirtual||t.isDiscriminator)return;const n=e.changeMaps.find((e=>e.column===t));n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);const r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){const n="json"!==t.type&&"jsonb"!==t.type;let i=t.getEntityValue(e.databaseEntity,n);if(t.relationMetadata){const n=t.relationMetadata.getEntityValue(e.entity);if(null!=n)return}let a=r;if(null!==r){switch(t.type){case"date":a=de.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":a=de.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":a=de.mixedDateToUtcDatetimeString(r),i=de.mixedDateToUtcDatetimeString(i);break;case"json":case"jsonb":if(pe.s.deepCompare(r,i))return;break;case"simple-array":a=de.simpleArrayToString(r),i=de.simpleArrayToString(i);break;case"simple-enum":a=de.simpleEnumToString(r),i=de.simpleEnumToString(i);break;case"simple-json":a=de.simpleJsonToString(r),i=de.simpleJsonToString(i)}t.transformer&&(a=me.A.transformTo(t.transformer,r))}if(fe.isBuffer(a)&&fe.isBuffer(i)){if(a.equals(i))return}else if(a===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}))}computeDiffRelationalColumns(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach((n=>{let r=n.getEntityValue(t.entity);if(void 0===r)return;if(t.databaseEntity){let e=r;null!==e&&V.g.isObject(e)&&(e=n.getRelationIdMap(e));const i=n.getEntityValue(t.databaseEntity);if(pe.s.compareIds(e,i))return;t.diffRelations.push(n)}const i=e.find((e=>e.mustBeInserted&&e.entity===r));i&&(r=i);const a=t.changeMaps.find((e=>e.relation===n));a?a.value=r:t.changeMaps.push({relation:n,value:r})}))}}var ge=n(572974),_e=n(843299),be=n(172943);class ve extends D.K{constructor(){super("Nested sets do not support multiple root entities.")}}class we{constructor(e){this.queryRunner=e}async insert(e){const t=e=>this.queryRunner.connection.driver.escape(e),n=this.getTableName(e.metadata.tablePath),r=t(e.metadata.nestedSetLeftColumn.databaseName),i=t(e.metadata.nestedSetRightColumn.databaseName);let a=e.metadata.treeParentRelation.getEntityValue(e.entity);!a&&e.parentSubject&&e.parentSubject.entity&&(a=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const s=e.metadata.getEntityIdMap(a);let o;if(s&&(o=await this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then((e=>{const t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t}))),void 0!==o)await this.queryRunner.query(`UPDATE ${n} SET ${r} = CASE WHEN ${r} > ${o} THEN ${r} + 2 ELSE ${r} END,${i} = ${i} + 2 WHERE ${i} >= ${o}`),pe.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(o),e.metadata.nestedSetRightColumn.createValueMap(o+1));else{if(!await this.isUniqueRootEntity(e,a))throw new ve;pe.s.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2))}}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;if(!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n))))),void 0===n||void 0===t)return;const r=e.metadata.treeParentRelation.getEntityValue(n),i=e.metadata.getEntityIdMap(r),a=e.metadata.getEntityIdMap(t);if(!pe.s.compareIds(i,a))if(t){const t=e=>this.queryRunner.connection.driver.escape(e),r=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),s=t(e.metadata.nestedSetRightColumn.databaseName),o=e.metadata.getEntityIdMap(n);let c,l;if(o&&(c=(await this.getNestedSetIds(e.metadata,o))[0]),a&&(l=(await this.getNestedSetIds(e.metadata,a))[0]),void 0!==c&&void 0!==l){const e=l.left>c.left,t=c.right-c.left+1;let n;n=e?l.left-c.right:l.right-c.left;const a=`WHEN ${i} >= ${c.left} AND ${i} < ${c.right} THEN ${i} + ${n} `,o=`WHEN ${s} > ${c.left} AND ${s} <= ${c.right} THEN ${s} + ${n} `;e?await this.queryRunner.query(`UPDATE ${r} SET ${i} = CASE WHEN ${i} > ${c.right} AND ${i} <= ${l.left} THEN ${i} - ${t} `+a+`ELSE ${i} END, `+`${s} = CASE `+`WHEN ${s} > ${c.right} AND `+`${s} < ${l.left} `+`THEN ${s} - ${t} `+o+`ELSE ${s} END`):await this.queryRunner.query(`UPDATE ${r} SET ${i} = CASE WHEN ${i} < ${c.left} AND ${i} > ${l.right} THEN ${i} + ${t} `+a+`ELSE ${i} END, `+`${s} = CASE `+`WHEN ${s} < ${c.left} AND `+`${s} >= ${l.right} `+`THEN ${s} + ${t} `+o+`ELSE ${s} END`)}}else{if(!await this.isUniqueRootEntity(e,t))throw new ve}}async remove(e){Array.isArray(e)||(e=[e]);const t=e[0].metadata,n=e=>this.queryRunner.connection.driver.escape(e),r=this.getTableName(t.tablePath),i=n(t.nestedSetLeftColumn.databaseName),a=n(t.nestedSetRightColumn.databaseName);let s=[];for(const n of e){const e=t.getEntityIdMap(n.entity);e&&s.push(e)}let o=await this.getNestedSetIds(t,s);for(const e of o){const t=e.right-e.left+1;await this.queryRunner.query(`UPDATE ${r} SET ${i} = CASE WHEN ${i} > ${e.left} THEN ${i} - ${t} ELSE ${i} END, ${a} = CASE WHEN ${a} > ${e.right} THEN ${a} - ${t} ELSE ${a} END`)}}getNestedSetIds(e,t){const n={left:`${e.targetName}.${e.nestedSetLeftColumn.propertyPath}`,right:`${e.targetName}.${e.nestedSetRightColumn.propertyPath}`},r=this.queryRunner.manager.createQueryBuilder();return Object.entries(n).forEach((([e,t])=>{r.addSelect(t,e)})),r.from(e.target,e.targetName).whereInIds(t).orderBy(n.right,"DESC").getRawMany().then((e=>{const t=[];for(const r of e){const e={};for(const t of Object.keys(n)){const n=r?r[t]:void 0;e[t]="string"==typeof n?parseInt(n):n}t.push(e)}return t}))}async isUniqueRootEntity(e,t){const n=e=>this.queryRunner.connection.driver.escape(e),r=this.getTableName(e.metadata.tablePath),i=[],a=e.metadata.treeParentRelation.joinColumns.map((e=>{const r=n(e.databaseName),a=e.getEntityValue(t);if(null==a)return`${r} IS NULL`;i.push(a);return`${r} = ${this.queryRunner.connection.driver.createParameter("entity_"+e.databaseName,i.length-1)}`})).join(" AND "),s="count",o=await this.queryRunner.query(`SELECT COUNT(1) AS ${n(s)} FROM ${r} WHERE ${a}`,i,!0);return 0===parseInt(o.records[0][s])}getTableName(e){return e.split(".").map((e=>""===e?e:this.queryRunner.connection.driver.escape(e))).join(".")}}var Ee=n(742464);class Te{constructor(e){this.queryRunner=e}async insert(e){const t={};e.metadata.closureJunctionTable.ancestorColumns.forEach((n=>{t[n.databaseName]=e.identifier})),e.metadata.closureJunctionTable.descendantColumns.forEach((n=>{t[n.databaseName]=e.identifier})),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute();let n=e.metadata.treeParentRelation.getEntityValue(e.entity);if(!n&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n){const t=e=>this.queryRunner.connection.driver.escape(e),r=this.getTableName(e.metadata.closureJunctionTable.tablePath),i=[],a=e.metadata.closureJunctionTable.ancestorColumns.map((e=>t(e.databaseName))),s=e.metadata.closureJunctionTable.descendantColumns.map((e=>t(e.databaseName))),o=e.metadata.primaryColumns.map((t=>(i.push(t.getEntityValue(e.insertedValueSet?e.insertedValueSet:e.entity)),this.queryRunner.connection.driver.createParameter("child_entity_"+t.databaseName,i.length-1)))),c=e.metadata.closureJunctionTable.descendantColumns.map((r=>{const a=t(r.databaseName),s=r.referencedColumn.getEntityValue(n);if(!s)throw new Ee.a(e.metadata.name);i.push(s);return`${a} = ${this.queryRunner.connection.driver.createParameter("parent_entity_"+r.referencedColumn.databaseName,i.length-1)}`}));await this.queryRunner.query(`INSERT INTO ${r} (${[...a,...s].join(", ")}) SELECT ${a.join(", ")}, ${o.join(", ")} FROM ${r} WHERE ${c.join(" AND ")}`,i)}}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;if(!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n))))),void 0===n||void 0===t)return;const r=e.metadata.treeParentRelation.getEntityValue(n),i=e.metadata.getEntityIdMap(r),a=e.metadata.getEntityIdMap(t);if(pe.s.compareIds(i,a))return;const s=e=>this.queryRunner.connection.driver.escape(e),o=e.metadata.closureJunctionTable,c=o.ancestorColumns.map((e=>s(e.databaseName))),l=o.descendantColumns.map((e=>s(e.databaseName))),u=(e,t)=>{const n=`sub${t}`,r=e.createQueryBuilder().select(l.join(", ")).from(o.tablePath,n);for(const e of o.ancestorColumns)r.andWhere(`${s(n)}.${s(e.databaseName)} = :value_${e.referencedColumn.databaseName}`);return e.createQueryBuilder().select(l.join(", ")).from(`(${r.getQuery()})`,t).setParameters(r.getParameters()).getQuery()},h={};for(const t of e.metadata.primaryColumns)h[`value_${t.databaseName}`]=n[t.databaseName];if(await this.queryRunner.manager.createQueryBuilder().delete().from(o.tablePath).where((e=>`(${l.join(", ")}) IN (${u(e,"descendant")})`)).andWhere((e=>`(${c.join(", ")}) NOT IN (${u(e,"ancestor")})`)).setParameters(h).execute(),t){const r=[],i=this.getTableName(o.tablePath),a=s("supertree"),u=s("subtree"),h=[...c.map((e=>`${a}.${e}`)),...l.map((e=>`${u}.${e}`))],d=e.metadata.closureJunctionTable.ancestorColumns.map((e=>{const t=s(e.databaseName),i=e.referencedColumn.getEntityValue(n);r.push(i);const a=this.queryRunner.connection.driver.createParameter("entity_"+e.referencedColumn.databaseName,r.length-1);return`${u}.${t} = ${a}`})),p=e.metadata.closureJunctionTable.descendantColumns.map((n=>{const i=s(n.databaseName),o=n.referencedColumn.getEntityValue(t);if(!o)throw new Ee.a(e.metadata.name);r.push(o);const c=this.queryRunner.connection.driver.createParameter("parent_entity_"+n.referencedColumn.databaseName,r.length-1);return`${a}.${i} = ${c}`}));await this.queryRunner.query(`INSERT INTO ${i} (${[...c,...l].join(", ")}) SELECT ${h.join(", ")} FROM ${i} AS ${a}, ${i} AS ${u} WHERE ${[...d,...p].join(" AND ")}`,r)}}async remove(e){if("mssql"!==this.queryRunner.connection.driver.options.type)return;Array.isArray(e)||(e=[e]);const t=e=>this.queryRunner.connection.driver.escape(e),n=e.map((e=>e.identifier)),r=e[0].metadata.closureJunctionTable,i=e=>e.map((e=>{const r=n.map((t=>t[e.referencedColumn.databaseName]));return`${t(e.databaseName)} IN (${r.join(", ")})`})).join(" AND "),a=i(r.ancestorColumns),s=i(r.descendantColumns);await this.queryRunner.manager.createQueryBuilder().delete().from(r.tablePath).where(a).orWhere(s).execute()}getTableName(e){return e.split(".").map((e=>""===e?e:this.queryRunner.connection.driver.escape(e))).join(".")}}class Se{constructor(e){this.queryRunner=e}async insert(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity);const n=e.metadata.getEntityIdMap(t);let r="";n&&(r=await this.getEntityPath(e,n));const i=e.metadata.treeParentRelation.joinColumns.map((t=>t.referencedColumn.getEntityValue(e.insertedValueSet))).join("_");await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[e.metadata.materializedPathColumn.propertyPath]:r+i+"."}).where(e.identifier).execute()}async update(e){let t=e.metadata.treeParentRelation.getEntityValue(e.entity);!t&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity);let n=e.databaseEntity;!n&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((t=>Object.entries(e.identifier).every((([e,n])=>t[e]===n)))));const r=e.metadata.treeParentRelation.getEntityValue(n),i=e.metadata.getEntityIdMap(r),a=e.metadata.getEntityIdMap(t);if(pe.s.compareIds(i,a))return;let s="";a&&(s=await this.getEntityPath(e,a));let o="";i&&(o=await this.getEntityPath(e,i)||"");const c=e.metadata.treeParentRelation.joinColumns.map((e=>e.referencedColumn.getEntityValue(n))).join("_"),l=e.metadata.materializedPathColumn.propertyPath;await this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set({[l]:()=>`REPLACE(${l}, '${o}${c}.', '${s}${c}.')`}).where(`${l} LIKE :path`,{path:`${o}${c}.%`}).execute()}getEntityPath(e,t){return this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(t).getRawOne().then((e=>e?e.path:""))}}class Ne{constructor(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}async execute(){let e;this.options&&!1===this.options.listeners||(e=this.broadcastBeforeEventsForAll(),e.promises.length>0&&await Promise.all(e.promises)),e&&e.count>0&&(this.insertSubjects.forEach((e=>e.recompute())),this.updateSubjects.forEach((e=>e.recompute())),this.removeSubjects.forEach((e=>e.recompute())),this.softRemoveSubjects.forEach((e=>e.recompute())),this.recoverSubjects.forEach((e=>e.recompute())),this.recompute()),this.insertSubjects=new ee(this.insertSubjects).sort("insert"),await this.executeInsertOperations(),this.updateSubjects=this.allSubjects.filter((e=>e.mustBeUpdated)),await this.executeUpdateOperations(),this.removeSubjects=new ee(this.removeSubjects).sort("delete"),await this.executeRemoveOperations(),this.softRemoveSubjects=this.allSubjects.filter((e=>e.mustBeSoftRemoved)),await this.executeSoftRemoveOperations(),this.recoverSubjects=this.allSubjects.filter((e=>e.mustBeRecovered)),await this.executeRecoverOperations(),await this.updateSpecialColumnsInPersistedEntities(),this.options&&!1===this.options.listeners||(e=this.broadcastAfterEventsForAll(),e.promises.length>0&&await Promise.all(e.promises))}validate(){this.allSubjects.forEach((e=>{if(e.mustBeUpdated&&e.mustBeRemoved)throw new _e.B(e)}))}recompute(){(new ye).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter((e=>e.mustBeInserted)),this.updateSubjects=this.allSubjects.filter((e=>e.mustBeUpdated)),this.removeSubjects=this.allSubjects.filter((e=>e.mustBeRemoved)),this.softRemoveSubjects=this.allSubjects.filter((e=>e.mustBeSoftRemoved)),this.recoverSubjects=this.allSubjects.filter((e=>e.mustBeRecovered)),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0}broadcastBeforeEventsForAll(){const e=new be.D;return this.insertSubjects.length&&this.insertSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeInsertEvent(e,t.metadata,t.entity))),this.updateSubjects.length&&this.updateSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,t.metadata,t.entity,t.databaseEntity,t.diffColumns,t.diffRelations))),this.removeSubjects.length&&this.removeSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeSoftRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.recoverSubjects.length&&this.recoverSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastBeforeRecoverEvent(e,t.metadata,t.entity,t.databaseEntity))),e}broadcastAfterEventsForAll(){const e=new be.D;return this.insertSubjects.length&&this.insertSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterInsertEvent(e,t.metadata,t.entity))),this.updateSubjects.length&&this.updateSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,t.metadata,t.entity,t.databaseEntity,t.diffColumns,t.diffRelations))),this.removeSubjects.length&&this.removeSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterSoftRemoveEvent(e,t.metadata,t.entity,t.databaseEntity))),this.recoverSubjects.length&&this.recoverSubjects.forEach((t=>this.queryRunner.broadcaster.broadcastAfterRecoverEvent(e,t.metadata,t.entity,t.databaseEntity))),e}async executeInsertOperations(){const[e,t]=this.groupBulkSubjects(this.insertSubjects,"insert");for(const n of t){const t=e[n],r=[],i=[],a=[];if("mongodb"===this.queryRunner.connection.driver.options.type?t.forEach((e=>{e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),i.push(e),r.push(e.entity)})):"oracle"===this.queryRunner.connection.driver.options.type?t.forEach((e=>{a.push(e)})):t.forEach((e=>{0===e.changeMaps.length||e.metadata.treeType||"oracle"===this.queryRunner.connection.driver.options.type||"sap"===this.queryRunner.connection.driver.options.type?a.push(e):(i.push(e),r.push(e.createValueSetAndPopChangeMap()))})),w.a.isMongoEntityManager(this.queryRunner.manager)){const e=await this.queryRunner.manager.insert(t[0].metadata.target,r);t.forEach(((t,n)=>{t.identifier=e.identifiers[n],t.generatedMap=e.generatedMaps[n],t.insertedValueSet=r[n]}))}else{if(r.length>0){const e=await this.queryRunner.manager.createQueryBuilder().insert().into(t[0].metadata.target).values(r).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute();i.forEach(((t,n)=>{t.identifier=e.identifiers[n],t.generatedMap=e.generatedMaps[n],t.insertedValueSet=r[n]}))}if(a.length>0)for(const e of a)e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"===e.metadata.treeType&&await new we(this.queryRunner).insert(e),await this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute().then((t=>{e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]})),"closure-table"===e.metadata.treeType?await new Te(this.queryRunner).insert(e):"materialized-path"===e.metadata.treeType&&await new Se(this.queryRunner).insert(e)}t.forEach((e=>{e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const r=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))}))}}async executeUpdateOperations(){const e=async e=>{if(!e.identifier)throw new ge.H(e);if(w.a.isMongoEntityManager(this.queryRunner.manager)){const t=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete t[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete t[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(t[e.metadata.updateDateColumn.propertyName]=new Date);const n=this.queryRunner.manager;await n.update(e.metadata.target,e.identifier,t)}else{const t=e.createValueSetAndPopChangeMap();switch(e.metadata.treeType){case"nested-set":await new we(this.queryRunner).update(e);break;case"closure-table":await new Te(this.queryRunner).update(e);break;case"materialized-path":await new Se(this.queryRunner).update(e)}const n=this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set(t).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier);let r=(await n.execute()).generatedMaps[0];r&&(e.metadata.columns.forEach((e=>{const t=e.getEntityValue(r);if(null!=t){const n=this.queryRunner.connection.driver.prepareHydratedValue(t,e);e.setEntityValue(r,n)}})),e.generatedMap||(e.generatedMap={}),Object.assign(e.generatedMap,r))}},t=[],n=[];for(const e of this.updateSubjects)"nested-set"===e.metadata.treeType?t.push(e):n.push(e);const r=new Promise((async(n,r)=>{for(const n of t)try{await e(n)}catch(e){r(e)}n()}));await Promise.all([...n.map(e),r])}async executeRemoveOperations(){const[e,t]=this.groupBulkSubjects(this.removeSubjects,"delete");for(const n of t){const t=e[n],r=t.map((e=>{if(!e.identifier)throw new ge.H(e);return e.identifier}));if(w.a.isMongoEntityManager(this.queryRunner.manager)){const e=this.queryRunner.manager;await e.delete(t[0].metadata.target,r)}else{switch(t[0].metadata.treeType){case"nested-set":await new we(this.queryRunner).remove(t);break;case"closure-table":await new Te(this.queryRunner).remove(t)}await this.queryRunner.manager.createQueryBuilder().delete().from(t[0].metadata.target).where(r).callListeners(!1).execute()}}}cloneMongoSubjectEntity(e){const t={};if(e.entity)for(const n of e.metadata.columns)pe.s.mergeDeep(t,n.getEntityValueMap(e.entity));return t}async executeSoftRemoveOperations(){await Promise.all(this.softRemoveSubjects.map((async e=>{if(!e.identifier)throw new ge.H(e);let t;if(w.a.isMongoEntityManager(this.queryRunner.manager)){const n=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete n[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete n[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(n[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(n[e.metadata.deleteDateColumn.propertyName]=new Date);const r=this.queryRunner.manager;t=await r.update(e.metadata.target,e.identifier,n)}else{const n=this.queryRunner.manager.createQueryBuilder().softDelete().from(e.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier),t=await n.execute()}e.generatedMap=t.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const r=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))})))}async executeRecoverOperations(){await Promise.all(this.recoverSubjects.map((async e=>{if(!e.identifier)throw new ge.H(e);let t;if(w.a.isMongoEntityManager(this.queryRunner.manager)){const n=this.cloneMongoSubjectEntity(e);e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete n[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete n[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(n[e.metadata.updateDateColumn.propertyName]=new Date),e.metadata.deleteDateColumn&&e.metadata.deleteDateColumn.propertyName&&(n[e.metadata.deleteDateColumn.propertyName]=null);const r=this.queryRunner.manager;t=await r.update(e.metadata.target,e.identifier,n)}else{const n=this.queryRunner.manager.createQueryBuilder().restore().from(e.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1);e.entity?n.whereEntity(e.identifier):n.where(e.identifier),t=await n.execute()}e.generatedMap=t.generatedMaps[0],e.generatedMap&&e.metadata.columns.forEach((t=>{const n=t.getEntityValue(e.generatedMap);if(null!=n){const r=this.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))})))}updateSpecialColumnsInPersistedEntities(){this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.softRemoveSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.recoverSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach((e=>{e.entity&&e.metadata.primaryColumns.forEach((t=>{t.setEntityValue(e.entity,void 0)}))})),this.allSubjects.forEach((e=>{e.entity&&(e.metadata.relationIds.forEach((t=>{t.setValue(e.entity)})),w.a.isMongoEntityManager(this.queryRunner.manager)&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.databaseName&&e.metadata.objectIdColumn.databaseName!==e.metadata.objectIdColumn.propertyName&&delete e.entity[e.metadata.objectIdColumn.databaseName])}))}updateSpecialColumnsInInsertedAndUpdatedEntities(e){e.forEach((e=>{e.entity&&(e.metadata.columns.forEach((t=>{if(!(e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map((e=>e.target)).indexOf(t.target)||t.isVirtual)){if(t.isNullable){void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null)}e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach((t=>{t.relation.joinColumns.forEach((n=>{!0!==n.isVirtual&&n.setEntityValue(e.entity,V.g.isObject(t.value)?n.referencedColumn.getEntityValue(t.value):t.value)}))}))}})),e.generatedMap&&this.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))}))}groupBulkSubjects(e,t){const n={},r=[],i=e.some((e=>e.metadata.getInsertionReturningColumns().length>0)),a="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported("insert")||!1===i;return e.forEach(((e,t)=>{const i=a||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[i]?n[i].push(e):(n[i]=[e],r.push(i))})),[n,r]}}var Ae=n(326618),Ce=n(348834).Buffer;class xe{constructor(e){this["@instanceof"]=Symbol.for("Subject"),this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&this.changeMaps.push(...e.changeMaps),this.recompute()}get mustBeInserted(){return this.canBeInserted&&!this.databaseEntity}get mustBeUpdated(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0}get mustBeSoftRemoved(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)}get mustBeRecovered(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)}createValueSetAndPopChangeMap(){const e=[],t=this.changeMaps.reduce(((t,n)=>{let r,i=n.value;if(w.a.isSubject(i)&&(i=i.insertedValueSet?i.insertedValueSet:i.entity),this.metadata.isJunction&&n.column)r=n.column.createValueMap(n.column.referencedColumn.getEntityValue(i));else if(n.column)r=n.column.createValueMap(i);else if(n.relation)if(V.g.isObject(i)&&!Ce.isBuffer(i)){const a=n.relation.getRelationIdMap(i);if(void 0===a)return e.push(n),this.canBeUpdated=!0,t;r=n.relation.createValueMap(a),this.updatedRelationMaps.push({relation:n.relation,value:a})}else r=n.relation.createValueMap(i),this.updatedRelationMaps.push({relation:n.relation,value:i});return pe.s.mergeDeep(t,r),t}),{});return this.changeMaps=e,t}recompute(){this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach((e=>{if(e.relationMetadata&&e.relationMetadata.inverseEntityMetadata===this.parentSubject.metadata){const t=e.referencedColumn.getEntityValue(this.parentSubject.entity);e.setEntityValue(this.entityWithFulfilledIds,t)}})),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))}}var Me=n(726027),Re=n(452257);class Oe{constructor(e){this["@instanceof"]=Symbol.for("EntityMetadata"),this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.beforeSoftRemoveListeners=[],this.beforeRecoverListeners=[],this.afterRemoveListeners=[],this.afterSoftRemoveListeners=[],this.afterRecoverListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid,this.dependsOn=this.tableMetadataArgs.dependsOn}create(e,t){const n=!(!t||!0!==t.pojo);let r;return r="function"!=typeof this.target||n?{}:!(null==t?void 0:t.fromDeserializer)||this.isAlwaysUsingConstructor?new this.target:Object.create(this.target.prototype),this.connection.options.typename&&(r[this.connection.options.typename]=this.targetName),this.lazyRelations.forEach((t=>this.connection.relationLoader.enableLazyLoad(t,r,e))),r}hasId(e){return!!e&&this.primaryColumns.every((t=>{const n=t.getEntityValue(e);return null!=n&&""!==n}))}hasAllPrimaryKeys(e){return this.primaryColumns.every((t=>{const n=t.getEntityValue(e);return null!=n}))}ensureEntityIdMap(e){if(V.g.isObject(e))return e;if(this.hasMultiplePrimaryKeys)throw new Me.d(this,e);return this.primaryColumns[0].createValueMap(e)}getEntityIdMap(e){if(e)return Oe.getValueMap(e,this.primaryColumns,{skipNulls:!0})}getEntityIdMixedMap(e){if(!e)return e;const t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t}compareEntities(e,t){const n=this.getEntityIdMap(e);if(!n)return!1;const r=this.getEntityIdMap(t);return!!r&&pe.s.compareIds(n,r)}findColumnWithPropertyName(e){return this.columns.find((t=>t.propertyName===e))}findColumnWithDatabaseName(e){return this.columns.find((t=>t.databaseName===e))}hasColumnWithPropertyPath(e){return this.columns.some((t=>t.propertyPath===e))||this.hasRelationWithPropertyPath(e)}findColumnWithPropertyPath(e){const t=this.columns.find((t=>t.propertyPath===e));if(t)return t;const n=this.relations.find((t=>t.propertyPath===e));return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0}findColumnWithPropertyPathStrict(e){return this.columns.find((t=>t.propertyPath===e))}findColumnsWithPropertyPath(e){const t=this.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.findRelationWithPropertyPath(e);return n&&n.joinColumns?n.joinColumns:[]}hasRelationWithPropertyPath(e){return this.relations.some((t=>t.propertyPath===e))}findRelationWithPropertyPath(e){return this.relations.find((t=>t.propertyPath===e))}hasEmbeddedWithPropertyPath(e){return this.allEmbeddeds.some((t=>t.propertyPath===e))}findEmbeddedWithPropertyPath(e){return this.allEmbeddeds.find((t=>t.propertyPath===e))}mapPropertyPathsToColumns(e){return e.map((e=>{const t=this.findColumnWithPropertyPath(e);if(null==t)throw new Re.B(e,this);return t}))}extractRelationValuesFromEntity(e,t){const n=[];return t.forEach((t=>{const r=t.getEntityValue(e);Array.isArray(r)?r.forEach((e=>n.push([t,e,this.getInverseEntityMetadata(e,t)]))):r&&n.push([t,r,this.getInverseEntityMetadata(r,t)])})),n}getInverseEntityMetadata(e,t){const n=t.inverseEntityMetadata.childEntityMetadatas.find((t=>t.target===e.constructor));return n||t.inverseEntityMetadata}static createPropertyPath(e,t,n=""){const r=[];return Object.keys(t).forEach((i=>{const a=n?n+"."+i:i;if(e.hasEmbeddedWithPropertyPath(a)){const n=this.createPropertyPath(e,t[i],a);r.push(...n)}else{const e=n?n+"."+i:i;r.push(e)}})),r}static difference(e,t){return e.filter((e=>!t.find((t=>pe.s.compareIds(e,t)))))}static getValueMap(e,t,n){return t.reduce(((t,r)=>{const i=r.getEntityValueMap(e,n);if(void 0!==t&&null!=i)return pe.s.mergeDeep(t,i)}),{})}build(){var e;const t=this.connection.namingStrategy,n=this.connection.options.entityPrefix,r=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:(null===(e=this.connection.options)||void 0===e?void 0:e.hasOwnProperty("schema"))&&(this.schema=this.connection.options.schema),this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName="function"==typeof this.tableMetadataArgs.target?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=t.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=t.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=t.tableName(this.targetName,this.givenTableName),"junction"===this.tableMetadataArgs.type&&this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,c.OV)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy="function"==typeof this.tableMetadataArgs.orderBy?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,void 0!==r&&(this.isAlwaysUsingConstructor=!r),this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type}registerColumn(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce(((e,t)=>e.concat(t.columnsFromTree)),this.ownColumns),this.primaryColumns=this.columns.filter((e=>e.isPrimary)),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter((e=>e.isGenerated||"uuid"===e.generationStrategy)).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach((t=>t.registerColumn(e))))}createPropertiesMap(){const e={};return this.columns.forEach((t=>pe.s.mergeDeep(e,t.createValueMap(t.propertyPath)))),this.relations.forEach((t=>pe.s.mergeDeep(e,t.createValueMap(t.propertyPath)))),e}getInsertionReturningColumns(){return this.columns.filter((e=>void 0!==e.default||e.isGenerated||e.isCreateDate||e.isUpdateDate||e.isDeleteDate||e.isVersion))}}class Ie{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.metadata.oneToManyRelations.forEach((t=>{!1!==t.persistenceEnabled&&this.buildForSubjectRelation(e,t)}))}))}buildForSubjectRelation(e,t){let n=[];if(e.databaseEntity){const r=t.getEntityValue(e.databaseEntity);r&&(n=r.map((e=>t.inverseEntityMetadata.getEntityIdMap(e))))}let r=t.getEntityValue(e.entity);if(null===r&&(r=[]),void 0===r)return;const i=[];r.forEach((r=>{let a=t.inverseEntityMetadata.getEntityIdMap(r),s=this.subjects.find((e=>e.entity===r));if(s&&(a=s.identifier),!a){if(!s)return;return void s.changeMaps.push({relation:t.inverseRelation,value:e})}n.find((e=>pe.s.compareIds(a,e)))||(s||(s=new xe({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:a}),this.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),i.push(a)})),Oe.difference(n,i).forEach((n=>{const r=new xe({metadata:t.inverseEntityMetadata,parentSubject:e,identifier:n});t.inverseRelation&&"nullify"!==t.inverseRelation.orphanedRowAction?"delete"===t.inverseRelation.orphanedRowAction?r.mustBeRemoved=!0:"soft-delete"===t.inverseRelation.orphanedRowAction&&(r.canBeSoftRemoved=!0):(r.canBeUpdated=!0,r.changeMaps=[{relation:t.inverseRelation,value:null}]),this.subjects.push(r)}))}}class ke{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.metadata.oneToOneRelations.forEach((t=>{t.isOwning||!1===t.persistenceEnabled||this.buildForSubjectRelation(e,t)}))}))}buildForSubjectRelation(e,t){let n;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));let r=t.getEntityValue(e.entity);if(void 0===r)return;if(null===r){if(n){const r=new xe({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(r)}return}let i=t.inverseEntityMetadata.getEntityIdMap(r),a=this.subjects.find((e=>!!e.entity&&e.entity===r));if(a&&(i=a.identifier),!i){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&pe.s.compareIds(i,n)||(a||(a=new xe({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}}class Pe{constructor(e){this.subjects=e}build(){this.subjects.forEach((e=>{e.entity&&e.metadata.manyToManyRelations.forEach((t=>{!1!==t.persistenceEnabled&&this.buildForSubjectRelation(e,t)}))}))}buildForAllRemoval(e){e.databaseEntity&&e.metadata.manyToManyRelations.forEach((t=>{if(!1===t.persistenceEnabled)return;t.getEntityValue(e.databaseEntity).forEach((n=>{const r=new xe({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,t,n)});this.subjects.push(r)}))}))}buildForSubjectRelation(e,t){let n=[];e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));let r=t.getEntityValue(e.entity);if(null===r&&(r=[]),!Array.isArray(r))return;r.forEach((r=>{let i=t.inverseEntityMetadata.getEntityIdMap(r);const a=this.subjects.find((e=>e.entity===r));if(a&&(i=a.identifier),!i&&!a)return;if(n.find((e=>pe.s.compareIds(e,i))))return;const s=t.isOwning?e:a||r,o=t.isOwning?a||r:e,c=new xe({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});this.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach((e=>{c.changeMaps.push({column:e,value:s})})),t.junctionEntityMetadata.inverseColumns.forEach((e=>{c.changeMaps.push({column:e,value:o})}))}));const i=[];r.forEach((e=>{let n=t.inverseEntityMetadata.getEntityIdMap(e);const r=this.subjects.find((t=>t.entity===e));r&&(n=r.identifier),null!=n&&i.push(n)}));n.filter((e=>!i.find((t=>pe.s.compareIds(t,e))))).forEach((n=>{const r=new xe({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:this.buildJunctionIdentifier(e,t,n)});this.subjects.push(r)}))}buildJunctionIdentifier(e,t,n){const r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach((e=>{pe.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))})),t.junctionEntityMetadata.inverseColumns.forEach((e=>{pe.s.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))})),a}}class Le{constructor(e,t){this.queryRunner=e,this.subjects=t}async load(e){const t=this.groupByEntityTargets().map((async t=>{const n=[],r=[];if(t.subjects.forEach((e=>{!e.databaseEntity&&e.identifier&&(n.push(e.identifier),r.push(e))})),!n.length)return;const i=[];"save"===e||"soft-remove"===e||"recover"===e?t.subjects.forEach((e=>{e.metadata.relations.forEach((t=>{void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===i.indexOf(t.propertyPath)&&i.push(t.propertyPath)}))})):i.push(...t.subjects[0].metadata.manyToManyRelations.map((e=>e.propertyPath)));const a={loadEagerRelations:!1,loadRelationIds:{relations:i,disableMixedMap:!0},withDeleted:!0};let s=[];if("mongodb"===this.queryRunner.connection.driver.options.type){const e=this.queryRunner.manager.getRepository(t.target);s=await e.findByIds(n,a)}else s=await this.queryRunner.manager.getRepository(t.target).createQueryBuilder().setFindOptions(a).whereInIds(n).getMany();s.forEach((e=>{this.findByPersistEntityLike(t.target,e).forEach((t=>{t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)}))}));for(let e of r)e.databaseEntityLoaded=!0}));await Promise.all(t)}findByPersistEntityLike(e,t){return this.subjects.filter((n=>!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))))}groupByEntityTargets(){return this.subjects.reduce(((e,t)=>{let n=e.find((e=>e.target===t.metadata.target));return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e}),[])}}class De{constructor(e){this.allSubjects=e}build(e,t){e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach((([n,r,i])=>{if(null==r||!n.isCascadeInsert&&!n.isCascadeUpdate&&!n.isCascadeSoftRemove&&!n.isCascadeRecover)return;if(!V.g.isObject(r))return;const a=this.findByPersistEntityLike(i.target,r);if(a)return!1===a.canBeInserted&&(a.canBeInserted=!0===n.isCascadeInsert&&"save"===t),!1===a.canBeUpdated&&(a.canBeUpdated=!0===n.isCascadeUpdate&&"save"===t),!1===a.canBeSoftRemoved&&(a.canBeSoftRemoved=!0===n.isCascadeSoftRemove&&"soft-remove"===t),void(!1===a.canBeRecovered&&(a.canBeRecovered=!0===n.isCascadeRecover&&"recover"===t));const s=new xe({metadata:i,parentSubject:e,entity:r,canBeInserted:!0===n.isCascadeInsert&&"save"===t,canBeUpdated:!0===n.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===n.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===n.isCascadeRecover&&"recover"===t});this.allSubjects.push(s),this.build(s,t)}))}findByPersistEntityLike(e,t){return this.allSubjects.find((n=>!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))))}}class qe{constructor(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}async execute(){if(!this.entity||"object"!=typeof this.entity)return Promise.reject(new Z.B(this.mode,this.entity));await Promise.resolve();const e=this.queryRunner||this.connection.createQueryRunner();let t=e.data;this.options&&this.options.data&&(e.data=this.options.data);try{const t=Array.isArray(this.entity)?this.entity:[this.entity],n=this.options&&this.options.chunk&&this.options.chunk>0?pe.s.chunk(t,this.options.chunk):[t],r=await Promise.all(n.map((async t=>{const n=[];t.forEach((e=>{const t=this.target?this.target:e.constructor;if(t===Object)throw new Ae.c(this.mode);let r=this.connection.getMetadata(t);if("STI"===r.inheritancePattern&&r.childEntityMetadatas.length>0){const t=r.childEntityMetadatas.find((t=>e.constructor===t.target));t&&(r=t)}n.push(new xe({metadata:r,entity:e,canBeInserted:"save"===this.mode,canBeUpdated:"save"===this.mode,mustBeRemoved:"remove"===this.mode,canBeSoftRemoved:"soft-remove"===this.mode,canBeRecovered:"recover"===this.mode}))}));const r=new De(n);return n.forEach((e=>{r.build(e,this.mode)})),await new Le(e,n).load(this.mode),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new Ie(n).build(),new ke(n).build(),new Pe(n).build()):n.forEach((e=>{e.mustBeRemoved&&new Pe(n).buildForAllRemoval(e)})),new Ne(e,n,this.options)}))),i=r.filter((e=>e.hasExecutableOperations));if(0===i.length)return;let a=!1;try{e.isTransactionActive||this.options&&!1===this.options.transaction||(a=!0,await e.startTransaction());for(const e of i)await e.execute();!0===a&&await e.commitTransaction()}catch(t){if(a)try{await e.rollbackTransaction()}catch(e){}throw t}}finally{e.data=t,this.queryRunner||await e.release()}}}class Be{constructor(e,t){this["@instanceof"]=Symbol.for("EntityManager"),this.repositories=[],this.treeRepositories=[],this.plainObjectToEntityTransformer=new H,this.connection=e,t&&(this.queryRunner=t,V.g.assign(this.queryRunner,{manager:this}))}async transaction(e,t){const n="string"==typeof e?e:void 0,r="function"==typeof e?e:t;if(!r)throw new u.K_("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new k.i;const i=this.queryRunner||this.connection.createQueryRunner();try{await i.startTransaction(n);const e=await r(i.manager);return await i.commitTransaction(),e}catch(e){try{await i.rollbackTransaction()}catch(e){}throw e}finally{this.queryRunner||await i.release()}}async query(e,t){return this.connection.query(e,t,this.queryRunner)}createQueryBuilder(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)}hasId(e,t){const n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)}getId(e,t){const n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)}create(e,t){const n=this.connection.getMetadata(e);if(!t)return n.create(this.queryRunner);if(Array.isArray(t))return t.map((t=>this.create(e,t)));const r=n.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(r,t,n,!0),r}merge(e,t,...n){const r=this.connection.getMetadata(e);return n.forEach((e=>this.plainObjectToEntityTransformer.transform(t,e,r))),t}async preload(e,t){const n=this.connection.getMetadata(e),r=new G(this.connection.manager),i=await r.transform(t,n);if(i)return this.merge(e,i,t)}save(e,t,n){let r=arguments.length>1&&("function"==typeof e||w.a.isEntitySchema(e)||"string"==typeof e)?e:void 0;const i=r?t:e,a=r?n:t;return w.a.isEntitySchema(r)&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new qe(this.connection,this.queryRunner,"save",r,i,a).execute().then((()=>i))}remove(e,t,n){const r=arguments.length>1&&("function"==typeof e||w.a.isEntitySchema(e)||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new qe(this.connection,this.queryRunner,"remove",r,i,a).execute().then((()=>i))}softRemove(e,t,n){let r=arguments.length>1&&("function"==typeof e||w.a.isEntitySchema(e)||"string"==typeof e)?e:void 0;const i=r?t:e,a=r?n:t;return w.a.isEntitySchema(r)&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new qe(this.connection,this.queryRunner,"soft-remove",r,i,a).execute().then((()=>i))}recover(e,t,n){let r=arguments.length>1&&("function"==typeof e||w.a.isEntitySchema(e)||"string"==typeof e)?e:void 0;const i=r?t:e,a=r?n:t;return w.a.isEntitySchema(r)&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new qe(this.connection,this.queryRunner,"recover",r,i,a).execute().then((()=>i))}async insert(e,t){return this.createQueryBuilder().insert().into(e).values(t).execute()}async upsert(e,t,n){const r=this.connection.getMetadata(e);let i,a;i=Array.isArray(n)?{conflictPaths:n}:n,a=Array.isArray(t)?t:[t];const s=r.mapPropertyPathsToColumns(i.conflictPaths),o=r.columns.filter((e=>!s.includes(e)&&a.some((t=>void 0!==e.getEntityValue(t)))));return this.createQueryBuilder().insert().into(e).values(a).orUpdate([...s,...o].map((e=>e.databaseName)),s.map((e=>e.databaseName)),{skipUpdateIfNoValuesChanged:i.skipUpdateIfNoValuesChanged}).execute()}update(e,t,n){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new u.K_("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()}delete(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new u.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()}softDelete(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new u.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()}restore(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new u.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()}count(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,q.Z.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getCount()}countBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getCount()}async find(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,q.Z.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getMany()}async findBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getMany()}findAndCount(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,q.Z.extractFindManyOptionsAlias(t)||n.name).setFindOptions(t||{}).getManyAndCount()}findAndCountBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t}).getManyAndCount()}async findByIds(e,t){if(!t.length)return Promise.resolve([]);const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).andWhereInIds(t).getMany()}async findOne(e,t){let n=this.connection.getMetadata(e).name;if(t&&t.join&&(n=t.join.alias),!t.where)throw new Error("You must provide selection conditions in order to find a single row.");return this.createQueryBuilder(e,n).setFindOptions({...t,take:1}).getOne()}async findOneBy(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({where:t,take:1}).getOne()}async findOneById(e,t){const n=this.connection.getMetadata(e);return this.createQueryBuilder(e,n.name).setFindOptions({take:1}).whereInIds(n.ensureEntityIdMap(t)).getOne()}async findOneOrFail(e,t){return this.findOne(e,t).then((n=>null===n?Promise.reject(new I.E(e,t)):Promise.resolve(n)))}async findOneByOrFail(e,t){return this.findOneBy(e,t).then((n=>null===n?Promise.reject(new I.E(e,t)):Promise.resolve(n)))}async clear(e){const t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner();try{return await n.clearTable(t.tablePath)}finally{this.queryRunner||await n.release()}}async increment(e,t,n,r){const i=this.connection.getMetadata(e),a=i.findColumnWithPropertyPath(n);if(!a)throw new u.K_(`Column ${n} was not found in ${i.targetName} entity.`);if(isNaN(Number(r)))throw new u.K_(`Value "${r}" is not a number.`);const s=n.split(".").reduceRight(((e,t)=>({[t]:e})),(()=>this.connection.driver.escape(a.databaseName)+" + "+r));return this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()}async decrement(e,t,n,r){const i=this.connection.getMetadata(e),a=i.findColumnWithPropertyPath(n);if(!a)throw new u.K_(`Column ${n} was not found in ${i.targetName} entity.`);if(isNaN(Number(r)))throw new u.K_(`Value "${r}" is not a number.`);const s=n.split(".").reduceRight(((e,t)=>({[t]:e})),(()=>this.connection.driver.escape(a.databaseName)+" - "+r));return this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()}getRepository(e){const t=this.repositories.find((t=>t.target===e));if(t)return t;if("mongodb"===this.connection.driver.options.type){const t=new L.MongoRepository(e,this,this.queryRunner);return this.repositories.push(t),t}{const t=new K(e,this,this.queryRunner);return this.repositories.push(t),t}}getTreeRepository(e){if(!1===this.connection.driver.treeSupport)throw new u.A(this.connection.driver);const t=this.treeRepositories.find((t=>t.target===e));if(t)return t;const n=new W(e,this,this.queryRunner);return this.treeRepositories.push(n),n}getMongoRepository(e){return this.connection.getMongoRepository(e)}withRepository(e){const t=e.constructor,{target:n,manager:r,queryRunner:i,...a}=e;return Object.assign(new t(e.target,this),{...a})}getCustomRepository(e){const t=Dn().entityRepositories.find((t=>t.target===("function"==typeof e?e:e.constructor)));if(!t)throw new u.nJ(e);const n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof X)r.manager||(r.manager=this);else{if(!n)throw new u.Re(e);r.manager=this,r.metadata=n}return r}async release(){if(!this.queryRunner)throw new P.r;return this.queryRunner.release()}}class je extends Be{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("SqljsEntityManager"),this.driver=e.driver}async loadDatabase(e){await this.driver.load(e)}async saveDatabase(e){await this.driver.save(e)}exportDatabase(){return this.driver.export()}}var $e=n(787493),Ue=n(624331);function Fe(e){return new Ue.J("lessThan",e)}function Ke(e){return new Ue.J("lessThanOrEqual",e)}function We(e){return new Ue.J("moreThan",e)}function Ve(e){return new Ue.J("moreThanOrEqual",e)}const He=(e,t)=>n=>{if(w.a.isFindOperator(t))switch(t.type){case"not":if(w.a.isFindOperator(t._value)){const r=Qe(t._value,t.value);return He(e,r)(n)}return n[e]!==t.value;case"equal":return n[e]===t.value;case"lessThan":return n[e]<t.value;case"lessThanOrEqual":return n[e]<=t.value;case"moreThan":return n[e]>t.value;case"moreThanOrEqual":return n[e]>=t.value;case"between":return n[e]>=t.value[0]&&n[e]<=t.value[1];case"notBetween":return n[e]<t.value[0]||n[e]>t.value[1];case"in":case"any":return"string"==typeof n[e]?t.value.map((e=>e.toString().toLowerCase())).includes(n[e].toLowerCase()):t.value.includes(n[e]);case"exclude":return"string"==typeof n[e]?!t.value.map((e=>e.toString().toLowerCase())).includes(n[e].toLowerCase()):!t.value.includes(n[e]);case"isNull":return null===n[e]||void 0===n[e];case"notNull":return null!==n[e]&&void 0!==n[e];case"arrayContains":case"arrayContainedBy":case"arrayOverlap":case"raw":case"ilike":case"like":throw new Error("Not supported for IndexedDB");default:return!1}return n[e]===t},Qe=(e,t)=>"lessThan"===e.type?Ve(t):"lessThanOrEqual"===e.type?We(t):"moreThan"===e.type?Ke(t):"moreThanOrEqual"===e.type?Fe(t):"between"===e.type?new Ue.J("notBetween",t):"any"===e.type||"in"===e.type?new Ue.J("exclude",t):"isNull"===e.type&&new Ue.J("notNull",t);var ze=n(231134),Ge=n(100698);class Ye extends Be{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("IndexedDbEntityManager")}count(e,t){return this.getDexieTableForTarget(e).count()}async insert(e,t){const n=this.getDexieTableForTarget(e);return Array.isArray(t)?await n.bulkAdd(t):await n.add(t),new $e.t}async find(e,t){return this.executeFind(e,t)}async findByIds(e,t,n){throw new Error("findByIds is deprecated. use findBy method instead in conjunction with In operator")}async findBy(e,t){return this.executeFind(e,t)}async findOne(e,t){return this.executeFindOne(e,t)}async findOneBy(e,t){return this.executeFindOne(e,t)}async findOneById(e,t){return this.executeFindOne(e,{where:{id:t}})}async update(e,t,n){const r=new ze.s,i=this.getDexieTableForTarget(e),a=Object.keys(t),s=Object.values(t);try{const e=await i.where(a).equals(s).modify(n);r.affected=e}catch(e){r.affected=0}return r}async upsert(e,t,n){const r=new $e.t,i=this.getDexieTableForTarget(e),a=Array.isArray(n)?n:n.conflictPaths;try{if(Array.isArray(t)){const e=await i.bulkPut(t,{allKeys:!0});for(const t of e)r.identifiers.push({id:(t||[]).join(",")})}else{const e=await i.put(t,a);r.identifiers.push({id:(e||[]).join(",")})}}catch(e){r.identifiers=[]}return r}async delete(e,t){const n=new Ge.y,r=this.getDexieTableForTarget(e);return"string"==typeof t||"number"==typeof t||t instanceof Date?n.affected=await r.where(["id"]).equals([t.toString()]).delete():Array.isArray(t)?await Promise.all(t.map((e=>r.where(["id"]).equals([e.toString()]).delete()))):n.affected=await r.where(Object.keys(t)).equals(Object.values(t)).delete(),n}async transaction(e,t){if("string"==typeof e)throw new u.K_("Cannot specify Isolation level for IndexedDB");const n="function"==typeof e?e:t,r="object"==typeof t?t:void 0;if(!n)throw new u.K_("Transaction method requires callback in second parameter if isolation level is supplied.");if(this.queryRunner&&this.queryRunner.isReleased)throw new u.iU;const i=this.queryRunner||this.connection.createQueryRunner(),a=this.connection.driver.dexie;let s;const o=r?r.entitiesToLock:Object.keys(a._allTables);return await a.transaction("rw",o,(async()=>{s=await n(i.manager)})),s}getDexieTableForTarget(e){const t=this.connection.driver,n=this.connection.getMetadata(e);return t.dexie._allTables[n.tableName]}async executeFind(e,t){const n=this.getDexieTableForTarget(e),r=this.convertPredicateToIndexedDbQuery(t),i=this.convertPredicateToIndexedDbSortingOptions(t);if(!r){let e=await this.applyTableSorting(n,i);return e=this.applyPagination(e,t),e.toArray()}if(this.requiresOptimizingForInOperator(r))return this.optimizeAnyOfIntoParallelQueries(n,r);let a=this.applyQueryFilter(n,r);return a=this.applyPagination(a,t),this.applyCollectionSorting(a,i)}async executeFindOne(e,t){const n=this.getDexieTableForTarget(e),r=this.convertPredicateToIndexedDbQuery(t);if(!r||0===Object.keys(r).length){const e=await n.limit(1).toArray();return e.length>0?e[0]:null}let i=await this.applyQueryFilter(n,r).limit(1).toArray();return i.length>0?i[0]:null}convertPredicateToIndexedDbQuery(e){if(e)return q.Z.isFindManyOptions(e)?"string"==typeof e.where?{}:e.where:e}convertPredicateToIndexedDbSortingOptions(e){var t;let n={enabled:!1,columns:[],direction:"ASC"};if((q.Z.isFindManyOptions(e)||q.Z.isFindOneOptions(e))&&e.order){const r=Object.keys(e.order),i=Object.values(e.order);n.enabled=r.length>0,n.columns=r,n.direction=null!==(t=i[0])&&void 0!==t?t:"ASC"}return n}applyQueryFilter(e,t){let n=null;for(const[r,i]of Object.entries(t)){const t=He(r,i);n=n?n.and(t):e.filter(t)}return null==n?e.toCollection():n}applyPagination(e,t){return q.Z.isFindManyOptions(t)&&(t.skip&&(e=e.offset(t.skip)),t.take&&(e=e.limit(t.take))),e}async applyTableSorting(e,t){if(!t.enabled)return e.toCollection();let n=e.orderBy(t.columns);return"DESC"===t.direction&&(n=n.reverse()),n}async applyCollectionSorting(e,t){if(!t.enabled||0===t.columns.length)return e.toArray();return("DESC"===t.direction?e.reverse():e).sortBy(t.columns[0])}requiresOptimizingForInOperator(e){const t=Object.values(e).filter((e=>w.a.isFindOperator(e)));return 1===t.length&&null!=t.find((e=>"in"===e.type))}async optimizeAnyOfIntoParallelQueries(e,t){const n=Object.keys(t)[0],r=t[n].value,i=await Promise.allSettled(r.map((async t=>e.where({[n]:t}).toArray()))),a=i.reduce(((e,t)=>("rejected"===t.status&&e.push(t),e)),[]);if(a.length>0&&/KeyPath (\w*) on object store (\w*) is not indexed/gi.test(a[0].reason))throw Error(a[0].reason);return(e=>e.reduce(((e,t)=>("fulfilled"===t.status&&e.push(...t.value),e)),[]))(i)}}class Je{create(e,t){return"mongodb"===e.driver.options.type?new L.MongoEntityManager(e):"sqljs"===e.driver.options.type?new je(e,t):"indexeddb"===e.driver.options.type?new Ye(e,t):new Be(e,t)}}var Xe=n(84468);class Ze{constructor(e){this["@instanceof"]=Symbol.for("View"),e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}clone(){return new Ze({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})}static create(e,t){const n={database:e.database,schema:e.schema,name:t.buildTableName(e.tableName,e.schema,e.database),expression:e.expression,materialized:e.tableMetadataArgs.materialized};return new Ze(n)}}class et{static viewMetadataCmp(e,t){return e&&t?e.dependsOn&&(e.dependsOn.has(t.target)||e.dependsOn.has(t.name))?1:t.dependsOn&&(t.dependsOn.has(e.target)||t.dependsOn.has(e.name))?-1:0:0}}class tt{constructor(e){this.connection=e,this["@instanceof"]=Symbol.for("RdbmsSchemaBuilder")}async build(){this.queryRunner=this.connection.createQueryRunner(),this.currentDatabase=this.connection.driver.database,this.currentSchema=this.connection.driver.schema;const e=!("cockroachdb"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type||"none"===this.connection.options.migrationsTransactionMode);await this.queryRunner.beforeMigration(),e&&await this.queryRunner.startTransaction();try{await this.createMetadataTableIfNecessary(this.queryRunner);const t=this.entityToSyncMetadatas.map((e=>this.getTablePath(e)));await this.queryRunner.getTables(t),await this.queryRunner.getViews([]),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),e&&await this.queryRunner.commitTransaction()}catch(t){try{e&&await this.queryRunner.rollbackTransaction()}catch(e){}throw t}finally{await this.queryRunner.afterMigration(),await this.queryRunner.release()}}async createMetadataTableIfNecessary(e){(this.viewEntityToSyncMetadatas.length>0||this.hasGeneratedColumns())&&await this.createTypeormMetadataTable(e)}async log(){this.queryRunner=this.connection.createQueryRunner();try{const e=this.entityToSyncMetadatas.map((e=>this.getTablePath(e)));return await this.queryRunner.getTables(e),await this.queryRunner.getViews([]),this.queryRunner.enableSqlMemory(),await this.executeSchemaSyncOperationsInProperOrder(),this.connection.queryResultCache&&await this.connection.queryResultCache.synchronize(this.queryRunner),this.queryRunner.getMemorySql()}finally{this.queryRunner.disableSqlMemory(),await this.queryRunner.release()}}get entityToSyncMetadatas(){return this.connection.entityMetadatas.filter((e=>e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType))}get viewEntityToSyncMetadatas(){return this.connection.entityMetadatas.filter((e=>"view"===e.tableType&&e.synchronize)).sort(et.viewMetadataCmp)}hasGeneratedColumns(){return this.connection.entityMetadatas.some((e=>e.columns.some((e=>e.generatedType))))}async executeSchemaSyncOperationsInProperOrder(){await this.dropOldViews(),await this.dropOldForeignKeys(),await this.dropOldIndices(),await this.dropOldChecks(),await this.dropOldExclusions(),await this.dropCompositeUniqueConstraints(),await this.renameColumns(),await this.createNewTables(),await this.dropRemovedColumns(),await this.addNewColumns(),await this.updatePrimaryKeys(),await this.updateExistColumns(),await this.createNewIndices(),await this.createNewChecks(),await this.createNewExclusions(),await this.createCompositeUniqueConstraints(),await this.createForeignKeys(),await this.createViews()}getTablePath(e){const t=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(t.tableName,t.schema||this.currentSchema,t.database||this.currentDatabase)}async dropOldForeignKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.foreignKeys.filter((t=>{const n=e.foreignKeys.find((e=>t.name===e.name&&this.getTablePath(t)===this.getTablePath(e.referencedEntityMetadata)));return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate}));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old foreign keys of ${t.name}: ${n.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropForeignKeys(t,n))}}async renameTables(){}async renameColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;if(e.columns.length!==t.columns.length)continue;const n=e.columns.filter((e=>!t.columns.find((t=>t.name===e.databaseName&&t.type===this.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===this.connection.driver.normalizeIsUnique(e)))));if(0===n.length||n.length>1)continue;const r=t.columns.filter((t=>!e.columns.find((e=>e.databaseName===t.name&&this.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&this.connection.driver.normalizeIsUnique(e)===t.isUnique))));if(0===r.length||r.length>1)continue;const i=r[0].clone();i.name=n[0].databaseName,this.connection.logger.logSchemaBuild(`renaming column "${r[0].name}" in to "${i.name}"`),await this.queryRunner.renameColumn(t,r[0],i)}}async dropOldIndices(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.indices.filter((t=>{const n=e.indices.find((e=>e.name===t.name));return!n||!1!==n.synchronize&&(n.isUnique!==t.isUnique||(n.isSpatial!==t.isSpatial||(!(!this.connection.driver.isFullTextColumnTypeSupported()||n.isFulltext===t.isFulltext)||(n.columns.length!==t.columnNames.length||!n.columns.every((e=>-1!==t.columnNames.indexOf(e.databaseName)))))))})).map((async e=>{this.connection.logger.logSchemaBuild(`dropping an index: "${e.name}" from table ${t.name}`),await this.queryRunner.dropIndex(t,e)}));await Promise.all(n)}}async dropOldChecks(){if(!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.checks.filter((t=>!e.checks.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old check constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropCheckConstraints(t,n))}}async dropCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.uniques.filter((t=>t.columnNames.length>1&&!e.uniques.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old unique constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropUniqueConstraints(t,n))}}async dropOldExclusions(){if("postgres"===this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.exclusions.filter((t=>!e.exclusions.find((e=>e.name===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`dropping old exclusion constraint: ${n.map((e=>`"${e.name}"`)).join(", ")} from table "${t.name}"`),await this.queryRunner.dropExclusionConstraints(t,n))}}async createNewTables(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(t)continue;this.connection.logger.logSchemaBuild(`creating a new table: ${this.getTablePath(e)}`);const n=_.create(e,this.connection.driver);await this.queryRunner.createTable(n,!1,!1),this.queryRunner.loadedTables.push(n)}}async createViews(){for(const e of this.viewEntityToSyncMetadatas){const t=this.queryRunner.loadedViews.find((t=>{const n="string"==typeof t.expression?t.expression.trim():t.expression(this.connection).getQuery(),r="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.getTablePath(t)===this.getTablePath(e)&&n===r}));if(t)continue;this.connection.logger.logSchemaBuild(`creating a new view: ${this.getTablePath(e)}`);const n=Ze.create(e,this.connection.driver);await this.queryRunner.createView(n),this.queryRunner.loadedViews.push(n)}}async dropOldViews(){const e=[],t=this.viewEntityToSyncMetadatas,n=new Map;for(const e of this.queryRunner.loadedViews){const r=t.find((t=>this.getTablePath(e)===this.getTablePath(t)));r&&n.set(e,r)}for(const t of this.queryRunner.loadedViews){const r=n.get(t);if(!r)continue;("string"==typeof t.expression?t.expression.trim():t.expression(this.connection).getQuery())!==("string"==typeof r.expression?r.expression.trim():r.expression(this.connection).getQuery())&&(this.connection.logger.logSchemaBuild(`dropping an old view: ${t.name}`),e.push(t))}const r=e=>{const t=n.get(e);let i=[e];if(!t)return i;for(const[a,s]of n.entries())a!==e&&s.dependsOn&&(s.dependsOn.has(t.target)||s.dependsOn.has(t.name))&&(i=i.concat(r(a)));return i},i=new Set(e.map((e=>r(e))).reduce(((e,t)=>e.concat(t)),[]).sort(((e,t)=>et.viewMetadataCmp(n.get(e),n.get(t)))).reverse());for(const e of i)await this.queryRunner.dropView(e);this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter((e=>!i.has(e)))}async dropRemovedColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=t.columns.filter((t=>!e.columns.find((e=>e.databaseName===t.name))));0!==n.length&&(this.connection.logger.logSchemaBuild(`columns dropped in ${t.name}: `+n.map((e=>e.name)).join(", ")),await this.queryRunner.dropColumns(t,n))}}async addNewColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.columns.filter((e=>!t.columns.find((t=>t.name===e.databaseName))));if(0===n.length)continue;const r=this.metadataColumnsToTableColumnOptions(n).map((e=>new h(e)));0!==r.length&&(this.connection.logger.logSchemaBuild("new columns added: "+n.map((e=>e.databaseName)).join(", ")),await this.queryRunner.addColumns(t,r))}}async updatePrimaryKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.columns.filter((e=>e.isPrimary));if(t.columns.filter((e=>e.isPrimary)).length!==n.length&&n.length>1){const e=n.map((e=>new h(m.createTableColumnOptions(e,this.connection.driver))));await this.queryRunner.updatePrimaryKeys(t,e)}}}async updateExistColumns(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=this.connection.driver.findChangedColumns(t.columns,e.columns);if(0===n.length)continue;for(const t of n)await this.dropColumnReferencedForeignKeys(this.getTablePath(e),t.databaseName);for(const t of n)await this.dropColumnCompositeIndices(this.getTablePath(e),t.databaseName);if(!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type)for(const t of n)await this.dropColumnCompositeUniques(this.getTablePath(e),t.databaseName);const r=n.map((e=>{const n=t.columns.find((t=>t.name===e.databaseName)),r=m.createTableColumnOptions(e,this.connection.driver);return{oldColumn:n,newColumn:new h(r)}}));0!==r.length&&(this.connection.logger.logSchemaBuild(`columns changed in "${t.name}". updating: `+n.map((e=>e.databaseName)).join(", ")),await this.queryRunner.changeColumns(t,r))}}async createNewIndices(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.indices.filter((e=>!t.indices.find((t=>t.name===e.name))&&!0===e.synchronize)).map((e=>d.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new indices ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createIndices(t,n))}}async createNewChecks(){if(!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.checks.filter((e=>!t.checks.find((t=>t.name===e.name)))).map((e=>y.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new check constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createCheckConstraints(t,n))}}async createCompositeUniqueConstraints(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.uniques.filter((e=>e.columns.length>1&&!t.uniques.find((t=>t.name===e.name)))).map((e=>f.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new unique constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createUniqueConstraints(t,n))}}async createNewExclusions(){if("postgres"===this.connection.driver.options.type)for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.exclusions.filter((e=>!t.exclusions.find((t=>t.name===e.name)))).map((e=>g.create(e)));0!==n.length&&(this.connection.logger.logSchemaBuild(`adding new exclusion constraints: ${n.map((e=>`"${e.name}"`)).join(", ")} in table "${t.name}"`),await this.queryRunner.createExclusionConstraints(t,n))}}async createForeignKeys(){for(const e of this.entityToSyncMetadatas){const t=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===this.getTablePath(e)));if(!t)continue;const n=e.foreignKeys.filter((e=>!t.foreignKeys.find((t=>t.name===e.name&&this.getTablePath(t)===this.getTablePath(e.referencedEntityMetadata)))));if(0===n.length)continue;const r=n.map((e=>p.create(e,this.connection.driver)));this.connection.logger.logSchemaBuild(`creating a foreign keys: ${n.map((e=>e.name)).join(", ")} on table "${t.name}"`),await this.queryRunner.createForeignKeys(t,r)}}async dropColumnReferencedForeignKeys(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const r=[],i=n.foreignKeys.find((e=>-1!==e.columnNames.indexOf(t)));if(i){const e=n.clone();e.foreignKeys=[i],r.push(e),n.removeForeignKey(i)}for(const n of this.queryRunner.loadedTables){const i=n.foreignKeys.filter((n=>this.getTablePath(n)===e&&-1!==n.referencedColumnNames.indexOf(t)));if(i.length>0){const e=n.clone();e.foreignKeys=i,r.push(e),i.forEach((e=>n.removeForeignKey(e)))}}if(r.length>0)for(const e of r)this.connection.logger.logSchemaBuild(`dropping related foreign keys of ${e.name}: ${e.foreignKeys.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropForeignKeys(e,e.foreignKeys)}async dropColumnCompositeIndices(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const r=n.indices.filter((e=>e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)));0!==r.length&&(this.connection.logger.logSchemaBuild(`dropping related indices of "${e}"."${t}": ${r.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropIndices(n,r))}async dropColumnCompositeUniques(e,t){const n=this.queryRunner.loadedTables.find((t=>this.getTablePath(t)===e));if(!n)return;const r=n.uniques.filter((e=>e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)));0!==r.length&&(this.connection.logger.logSchemaBuild(`dropping related unique constraints of "${e}"."${t}": ${r.map((e=>e.name)).join(", ")}`),await this.queryRunner.dropUniqueConstraints(n,r))}metadataColumnsToTableColumnOptions(e){return e.map((e=>m.createTableColumnOptions(e,this.connection.driver)))}async createTypeormMetadataTable(e){const t=this.currentSchema,n=this.currentDatabase,r=this.connection.driver.buildTableName(this.connection.metadataTableName,t,n),i="spanner"===this.connection.driver.options.type;await e.createTable(new _({database:n,schema:t,name:r,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1,isPrimary:i},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0,isPrimary:i},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0,isPrimary:i},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0,isPrimary:i},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0,isPrimary:i},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0,isPrimary:i}]}),!0)}}class nt{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.supportedUpsertType="on-conflict-do-update",this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.cteCapabilities={enabled:!0,requiresRecursiveHint:!0},this.attachedDatabases={},this.connection=e,this.options=e.options,this.database=R.z.buildDriverOptions(this.options).database}async connect(){this.databaseConnection=await this.createDatabaseConnection()}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise(((e,t)=>{this.queryRunner=void 0,this.databaseConnection.close((n=>n?t(n):e()))}))}hasAttachedDatabases(){return!!Object.keys(this.attachedDatabases).length}getAttachedDatabaseHandleByRelativePath(e){var t,n;return null===(n=null===(t=this.attachedDatabases)||void 0===t?void 0:t[e])||void 0===n?void 0:n.attachHandle}getAttachedDatabasePathRelativeByHandle(e){var t;return null===(t=Object.values(this.attachedDatabases).find((({attachHandle:t})=>e===t)))||void 0===t?void 0:t.attachFilepathRelative}createSchemaBuilder(){return new tt(this.connection)}preparePersistentValue(e,t){return t.transformer&&(e=me.A.transformTo(t.transformer,e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?de.mixedDateToDateString(e):"time"===t.type?de.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?de.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?de.simpleArrayToString(e):"simple-json"===t.type?de.simpleJsonToString(e):"simple-enum"===t.type?de.simpleEnumToString(e):e}prepareHydratedValue(e,t){return null==e?t.transformer?me.A.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=de.normalizeHydratedDate(e)):"date"===t.type?e=de.mixedDateToDateString(e):"time"===t.type?e=de.mixedTimeToString(e):"simple-array"===t.type?e=de.stringToSimpleArray(e):"simple-json"===t.type?e=de.stringToSimpleJson(e):"simple-enum"===t.type&&(e=de.stringToSimpleEnum(e,t)),t.transformer&&(e=me.A.transformFrom(t.transformer,e)),e)}escapeQueryWithParameters(e,t,n){const r=Object.keys(n).map((e=>"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]instanceof Date?de.mixedDateToUtcDatetimeString(n[e]):n[e]));return t&&Object.keys(t).length?[e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,i)=>{if(!t.hasOwnProperty(i))return e;let a=t[i];return n?a.map((e=>(r.push(e),this.createParameter(i,r.length-1)))).join(", "):"function"==typeof a?a():"number"==typeof a?String(a):a instanceof Date?(r.push(de.mixedDateToUtcDatetimeString(a)),this.createParameter(i,r.length-1)):(r.push(a),this.createParameter(i,r.length-1))})),r]:[e,r]}escape(e){return'"'+e+'"'}buildTableName(e,t,n){return e}parseTableName(e){var t;const n=this.database,r=void 0;if(w.a.isTable(e)||w.a.isView(e)){const t=this.parseTableName(e.schema?`"${e.schema}"."${e.name}"`:e.name);return{database:e.database||t.database||n,schema:e.schema||t.schema||r,tableName:t.tableName}}if(w.a.isTableForeignKey(e)){const t=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||t.database||n,schema:e.referencedSchema||t.schema||r,tableName:t.tableName}}if(w.a.isEntityMetadata(e))return{database:e.database||n,schema:e.schema||r,tableName:e.tableName};const i=e.split(".");if(3===i.length)return{database:i[0]||n,schema:i[1]||r,tableName:i[2]};if(2===i.length){return{database:null!==(t=this.getAttachedDatabasePathRelativeByHandle(i[0]))&&void 0!==t?t:n,schema:i[0],tableName:i[1]}}return{database:n,schema:r,tableName:e}}normalizeType(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""}normalizeDefault(e){const t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?t?"1":"0":"function"==typeof t?t():"string"==typeof t?`'${t}'`:null!=t?`${t}`:void 0}normalizeIsUnique(e){return e.entityMetadata.uniques.some((t=>1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){let t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,t,n,r){const i=e.generatedColumns.reduce(((e,i)=>{let a;return"increment"===i.generationStrategy&&t&&(a=t-r+n+1),a?pe.s.mergeDeep(e,i.createValueMap(a)):e}),{});return Object.keys(i).length>0?i:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;return n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==t.length||n.precision!==t.precision||n.scale!==t.scale||this.normalizeDefault(t)!==n.default||n.isPrimary!==t.isPrimary||n.isNullable!==t.isNullable||n.generatedType!==t.generatedType||n.asExpression!==t.asExpression||n.isUnique!==this.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&n.isGenerated!==t.isGenerated}))}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return"?"}createDatabaseConnection(){throw new u.K_("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")}loadDependencies(){}}var rt,it=n(403975),at=n(224023),st=n(831369);class ot{constructor(e,t){this.query=e,this.parameters=t,this["@instanceof"]=Symbol.for("Query")}}class ct{constructor(){this.upQueries=[],this.downQueries=[]}}class lt{constructor(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new ct,this.transactionDepth=0,this.cachedTablePaths={}}async beforeMigration(){}async afterMigration(){}async getTable(e){return this.loadedTables=await this.loadTables([e]),this.loadedTables.length>0?this.loadedTables[0]:void 0}async getTables(e){return e?(this.loadedTables=await this.loadTables(e),this.loadedTables):await this.loadTables(e)}async getView(e){return this.loadedViews=await this.loadViews([e]),this.loadedViews.length>0?this.loadedViews[0]:void 0}async getViews(e){return this.loadedViews=await this.loadViews(e),this.loadedViews}enableSqlMemory(){this.sqlInMemory=new ct,this.sqlMemoryMode=!0}disableSqlMemory(){this.sqlInMemory=new ct,this.sqlMemoryMode=!1}clearSqlMemory(){this.sqlInMemory=new ct}getMemorySql(){return this.sqlInMemory}async executeMemoryUpSql(){for(const{query:e,parameters:t}of this.sqlInMemory.upQueries)await this.query(e,t)}async executeMemoryDownSql(){for(const{query:e,parameters:t}of this.sqlInMemory.downQueries.reverse())await this.query(e,t)}getReplicationMode(){return this.mode}async getCachedView(e){const t=this.loadedViews.find((t=>t.name===e));if(t)return t;const n=await this.loadViews([e]);if(n.length>0)return this.loadedViews.push(n[0]),n[0];throw new D.K(`View "${e}" does not exist.`)}async getCachedTable(e){if(e in this.cachedTablePaths){const t=this.cachedTablePaths[e],n=this.loadedTables.find((e=>this.getTablePath(e)===t));if(n)return n}const t=await this.loadTables([e]);if(t.length>0){const n=this.getTablePath(t[0]),r=this.loadedTables.find((e=>this.getTablePath(e)===n));return r||(this.cachedTablePaths[e]=this.getTablePath(t[0]),this.loadedTables.push(t[0]),t[0])}throw new D.K(`Table "${e}" does not exist.`)}replaceCachedTable(e,t){const n=this.getTablePath(e),r=this.loadedTables.find((e=>this.getTablePath(e)===n));for(const[e,r]of Object.entries(this.cachedTablePaths))r===n&&(this.cachedTablePaths[e]=this.getTablePath(t));r&&(r.database=t.database,r.schema=t.schema,r.name=t.name,r.columns=t.columns,r.indices=t.indices,r.foreignKeys=t.foreignKeys,r.uniques=t.uniques,r.checks=t.checks,r.justCreated=t.justCreated,r.engine=t.engine)}getTablePath(e){const t=this.connection.driver.parseTableName(e);return this.connection.driver.buildTableName(t.tableName,t.schema,t.database)}getTypeormMetadataTableName(){const e=this.connection.driver.options;return this.connection.driver.buildTableName(this.connection.metadataTableName,e.schema,e.database)}selectTypeormMetadataSql({database:e,schema:t,table:n,type:r,name:i}){const a=this.connection.createQueryBuilder(),s=a.select().from(this.getTypeormMetadataTableName(),"t").where(`${a.escape("type")} = :type`,{type:r}).andWhere(`${a.escape("name")} = :name`,{name:i});e&&s.andWhere(`${a.escape("database")} = :database`,{database:e}),t&&s.andWhere(`${a.escape("schema")} = :schema`,{schema:t}),n&&s.andWhere(`${a.escape("table")} = :table`,{table:n});const[o,c]=s.getQueryAndParameters();return new ot(o,c)}insertTypeormMetadataSql({database:e,schema:t,table:n,type:r,name:i,value:a}){const[s,o]=this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({database:e,schema:t,table:n,type:r,name:i,value:a}).getQueryAndParameters();return new ot(s,o)}deleteTypeormMetadataSql({database:e,schema:t,table:n,type:r,name:i}){const a=this.connection.createQueryBuilder(),s=a.delete().from(this.getTypeormMetadataTableName()).where(`${a.escape("type")} = :type`,{type:r}).andWhere(`${a.escape("name")} = :name`,{name:i});e&&s.andWhere(`${a.escape("database")} = :database`,{database:e}),t&&s.andWhere(`${a.escape("schema")} = :schema`,{schema:t}),n&&s.andWhere(`${a.escape("table")} = :table`,{table:n});const[o,c]=s.getQueryAndParameters();return new ot(o,c)}isColumnChanged(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||!pe.s.isArraysEqual(e.enum||[],t.enum||[])}isDefaultColumnLength(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n){if(this.connection.driver.getColumnLength(n))return!1}}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()}isDefaultColumnPrecision(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&null!==n.precision&&void 0!==n.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n}isDefaultColumnScale(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&null!==n.scale&&void 0!==n.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n}async executeQueries(e,t){if(w.a.isQuery(e)&&(e=[e]),w.a.isQuery(t)&&(t=[t]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...t),!0===this.sqlMemoryMode)return Promise.resolve();for(const{query:t,parameters:n}of e)await this.query(t,n)}generateIndexName(e,t){return this.connection.namingStrategy.indexName(e,t.columnNames,t.where)}}!function(e){e.VIEW="VIEW",e.MATERIALIZED_VIEW="MATERIALIZED_VIEW",e.GENERATED_COLUMN="GENERATED_COLUMN"}(rt||(rt={}));class ut extends lt{constructor(){super(),this.transactionPromise=null}connect(){return Promise.resolve(this.driver.databaseConnection)}release(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()}async startTransaction(e){if("none"===this.driver.transactionSupport)throw new u.K_(`Transactions aren't supported by ${this.connection.driver.options.type}.`);if(this.isTransactionActive&&"simple"===this.driver.transactionSupport)throw new u.SF;if(e&&"READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new u.K_("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?(e&&("READ UNCOMMITTED"===e?await this.query("PRAGMA read_uncommitted = true"):await this.query("PRAGMA read_uncommitted = false")),await this.query("BEGIN TRANSACTION")):await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("COMMIT"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("ROLLBACK"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}stream(e,t,n,r){throw new u.K_("Stream is not supported by sqlite driver.")}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return Promise.resolve(!1)}async getCurrentDatabase(){return Promise.resolve(void 0)}async hasSchema(e){throw new u.K_("This driver does not support table schemas")}async getCurrentSchema(){return Promise.resolve(void 0)}async hasTable(e){const t=`SELECT * FROM "sqlite_master" WHERE "type" = 'table' AND "name" = '${w.a.isTable(e)?e.name:e}'`;return!!(await this.query(t)).length}async hasColumn(e,t){const n=w.a.isTable(e)?e.name:e,r=`PRAGMA table_xinfo(${this.escapePath(n)})`;return!!(await this.query(r)).find((e=>e.name===t))}async createDatabase(e,t){return Promise.resolve()}async dropDatabase(e,t){return Promise.resolve()}async createSchema(e,t){return Promise.resolve()}async dropSchema(e,t){return Promise.resolve()}async createTable(e,t=!1,n=!0,r=!0){const i=[],a=[];if(t){if(await this.hasTable(e))return Promise.resolve()}i.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),r&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),i.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(t))}));const s=e.columns.filter((e=>e.generatedType&&e.asExpression));for(const t of s){const n=this.insertTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),r=this.deleteTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name});i.push(n),a.push(r)}await this.executeQueries(i,a)}async dropTable(e,t,n=!0,r=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const i=n,a=w.a.isTable(e)?e:await this.getCachedTable(e),s=[],o=[];r&&a.indices.forEach((e=>{s.push(this.dropIndexSql(e)),o.push(this.createIndexSql(a,e))})),s.push(this.dropTableSql(a,t)),o.push(this.createTableSql(a,i));const c=a.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of c){const t=this.deleteTypeormMetadataSql({table:a.name,type:rt.GENERATED_COLUMN,name:e.name}),n=this.insertTypeormMetadataSql({table:a.name,type:rt.GENERATED_COLUMN,name:e.name,value:e.asExpression});s.push(t),o.push(n)}await this.executeQueries(s,o)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=w.a.isView(e)?e.name:e,n=await this.getCachedView(t),r=[],i=[];r.push(this.deleteViewDefinitionSql(n)),r.push(this.dropViewSql(n)),i.push(this.insertViewDefinitionSql(n)),i.push(this.createViewSql(n)),await this.executeQueries(r,i)}async renameTable(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();r.name=t;const i=new ot(`ALTER TABLE ${this.escapePath(n.name)} RENAME TO ${this.escapePath(t)}`),a=new ot(`ALTER TABLE ${this.escapePath(t)} RENAME TO ${this.escapePath(n.name)}`);await this.executeQueries(i,a),r.uniques.forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(n,e.columnNames);e.name===t&&(e.name=this.connection.namingStrategy.uniqueConstraintName(r,e.columnNames))})),r.foreignKeys.forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(n,e.columnNames,this.getTablePath(e),e.referencedColumnNames);e.name===t&&(e.name=this.connection.namingStrategy.foreignKeyName(r,e.columnNames,this.getTablePath(e),e.referencedColumnNames))})),r.indices.forEach((e=>{const t=this.connection.namingStrategy.indexName(n,e.columnNames,e.where);e.name===t&&(e.name=this.connection.namingStrategy.indexName(r,e.columnNames,e.where))})),n.name=r.name,await this.recreateTable(r,n)}async addColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);return this.addColumns(n,[t])}async addColumns(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.addColumn(e))),await this.recreateTable(r,n)}async renameColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e),i=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!i)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);let a;return w.a.isTableColumn(n)?a=n:(a=i.clone(),a.name=n),this.changeColumn(r,i,a)}async changeColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e),i=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!i)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);await this.changeColumns(r,[{oldColumn:i,newColumn:n}])}async changeColumns(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>{e.newColumn.name!==e.oldColumn.name&&(r.findColumnUniques(e.oldColumn).forEach((t=>{const i=this.connection.namingStrategy.uniqueConstraintName(n,t.columnNames);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===i&&(t.name=this.connection.namingStrategy.uniqueConstraintName(r,t.columnNames))})),r.findColumnForeignKeys(e.oldColumn).forEach((t=>{const i=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===i&&(t.name=this.connection.namingStrategy.foreignKeyName(r,t.columnNames,this.getTablePath(t),t.referencedColumnNames))})),r.findColumnIndices(e.oldColumn).forEach((t=>{const i=this.connection.namingStrategy.indexName(n,t.columnNames,t.where);t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name===i&&(t.name=this.connection.namingStrategy.indexName(r,t.columnNames,t.where))})));const t=r.columns.find((t=>t.name===e.oldColumn.name));t&&(r.columns[r.columns.indexOf(t)]=e.newColumn)})),await this.recreateTable(r,n)}async dropColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableColumn(t)?t:n.findColumnByName(t);if(!r)throw new u.K_(`Column "${t}" was not found in table "${n.name}"`);await this.dropColumns(n,[r])}async dropColumns(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>{const t=w.a.isTableColumn(e)?e:n.findColumnByName(e);if(!t)throw new Error(`Column "${e}" was not found in table "${n.name}"`);r.removeColumn(t),r.findColumnUniques(t).forEach((e=>r.removeUniqueConstraint(e))),r.findColumnIndices(t).forEach((e=>r.removeIndex(e))),r.findColumnForeignKeys(t).forEach((e=>r.removeForeignKey(e)))})),await this.recreateTable(r,n)}async createPrimaryKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();r.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)})),await this.recreateTable(r,n),n.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)}))}async updatePrimaryKeys(e,t){await Promise.resolve()}async dropPrimaryKey(e){const t=w.a.isTable(e)?e:await this.getCachedTable(e),n=t.clone();n.primaryColumns.forEach((e=>{e.isPrimary=!1})),await this.recreateTable(n,t),t.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){await this.createUniqueConstraints(e,[t])}async createUniqueConstraints(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.addUniqueConstraint(e))),await this.recreateTable(r,n)}async dropUniqueConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableUnique(t)?t:n.uniques.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied unique constraint was not found in table ${n.name}`);await this.dropUniqueConstraints(n,[r])}async dropUniqueConstraints(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.removeUniqueConstraint(e))),await this.recreateTable(r,n)}async createCheckConstraint(e,t){await this.createCheckConstraints(e,[t])}async createCheckConstraints(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.addCheckConstraint(e))),await this.recreateTable(r,n)}async dropCheckConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableCheck(t)?t:n.checks.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied check constraint was not found in table ${n.name}`);await this.dropCheckConstraints(n,[r])}async dropCheckConstraints(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.removeCheckConstraint(e))),await this.recreateTable(r,n)}async createExclusionConstraint(e,t){throw new u.K_("Sqlite does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new u.K_("Sqlite does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new u.K_("Sqlite does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new u.K_("Sqlite does not support exclusion constraints.")}async createForeignKey(e,t){await this.createForeignKeys(e,[t])}async createForeignKeys(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.addForeignKey(e))),await this.recreateTable(r,n)}async dropForeignKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied foreign key was not found in table ${n.name}`);await this.dropForeignKeys(e,[r])}async dropForeignKeys(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone();t.forEach((e=>r.removeForeignKey(e))),await this.recreateTable(r,n)}async createIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const r=this.createIndexSql(n,t),i=this.dropIndexSql(t);await this.executeQueries(r,i),n.addIndex(t)}async createIndices(e,t){const n=t.map((t=>this.createIndex(e,t)));await Promise.all(n)}async dropIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied index ${t} was not found in table ${n.name}`);r.name||(r.name=this.generateIndexName(n,r));const i=this.dropIndexSql(r),a=this.createIndexSql(n,r);await this.executeQueries(i,a),n.removeIndex(r)}async dropIndices(e,t){const n=t.map((t=>this.dropIndex(e,t)));await Promise.all(n)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)}`)}async clearDatabase(e){let t;e&&this.driver.getAttachedDatabaseHandleByRelativePath(e)&&(t=this.driver.getAttachedDatabaseHandleByRelativePath(e)),await this.query("PRAGMA foreign_keys = OFF");const n=this.isTransactionActive;n||await this.startTransaction();try{const e=t?`SELECT 'DROP VIEW "${t}"."' || name || '";' as query FROM "${t}"."sqlite_master" WHERE "type" = 'view'`:"SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'",r=await this.query(e);await Promise.all(r.map((e=>this.query(e.query))));const i=t?`SELECT 'DROP TABLE "${t}"."' || name || '";' as query FROM "${t}"."sqlite_master" WHERE "type" = 'table' AND "name" != 'sqlite_sequence'`:"SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",a=await this.query(i);await Promise.all(a.map((e=>this.query(e.query)))),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}finally{await this.query("PRAGMA foreign_keys = ON")}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=e.map((e=>"'"+e+"'")).join(", ");let n=`SELECT "t".* FROM "${this.getTypeormMetadataTableName()}" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = 'view' WHERE "t"."type" = '${rt.VIEW}'`;t.length>0&&(n+=` AND "t"."name" IN (${t})`);return(await this.query(n)).map((e=>{const t=new Ze;return t.name=e.name,t.expression=e.value,t}))}async loadTableRecords(e,t){let n;const[r,i]=this.splitTablePath(e);r&&this.driver.getAttachedDatabasePathRelativeByHandle(r)&&(n=this.driver.getAttachedDatabasePathRelativeByHandle(r));return await this.query(`SELECT ${n?`'${n}'`:null} as database, ${r?`'${r}'`:null} as schema, * FROM ${r?`"${r}".`:""}${this.escapePath("sqlite_master")} WHERE "type" = '${t}' AND "${"table"===t?"name":"tbl_name"}" IN ('${i}')`)}async loadPragmaRecords(e,t){const[,n]=this.splitTablePath(e);return await this.query(`PRAGMA ${t}("${n}")`)}async loadTables(e){if(e&&0===e.length)return[];let t,n=[];if(e)n=(await Promise.all(e.map((e=>this.loadTableRecords(e,"table"))))).reduce(((e,t)=>[...e,...t]),[]).filter(Boolean),t=(await Promise.all((null!=e?e:[]).map((e=>this.loadTableRecords(e,"index"))))).reduce(((e,t)=>[...e,...t]),[]).filter(Boolean);else{const e='SELECT * FROM "sqlite_master" WHERE "type" = \'table\'';n.push(...await this.query(e));const r=n.map((({name:e})=>`'${e}'`)).join(", ");t=await this.query(`SELECT * FROM "sqlite_master" WHERE "type" = 'index' AND "tbl_name" IN (${r})`)}return 0===n.length?[]:Promise.all(n.map((async e=>{const n=e.database&&this.driver.getAttachedDatabaseHandleByRelativePath(e.database)?`${this.driver.getAttachedDatabaseHandleByRelativePath(e.database)}.${e.name}`:e.name,r=e.sql,i=r.includes("WITHOUT ROWID"),a=new _({name:n,withoutRowid:i}),[s,o,c]=await Promise.all([this.loadPragmaRecords(n,"table_xinfo"),this.loadPragmaRecords(n,"index_list"),this.loadPragmaRecords(n,"foreign_key_list")]);let l;const u=e.sql;let m,g=u.toUpperCase().indexOf("AUTOINCREMENT");if(-1!==g){l=u.substr(0,g);const e=l.lastIndexOf(","),t=l.lastIndexOf("(");-1!==e?(l=l.substr(e),l=l.substr(0,l.lastIndexOf('"')),l=l.substr(l.indexOf('"')+1)):-1!==t&&(l=l.substr(t),l=l.substr(0,l.lastIndexOf('"')),l=l.substr(l.indexOf('"')+1))}a.columns=await Promise.all(s.map((async e=>{const t=new h;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=l===e.name,t.isGenerated&&(t.generationStrategy="increment"),2===e.hidden||3===e.hidden){t.generatedType=2===e.hidden?"VIRTUAL":"STORED";const n=await this.selectTypeormMetadataSql({table:a.name,type:rt.GENERATED_COLUMN,name:t.name}),r=await this.query(n.query,n.parameters);r[0]&&r[0].value?t.asExpression=r[0].value:t.asExpression=""}if("varchar"===t.type){const e=r.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\"\\1\"\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));e&&(t.enum=e[2].substr(1,e[2].length-2).split("','"))}let n=t.type.indexOf("(");if(-1!==n){const e=t.type;let r=e.substr(0,n);if(this.driver.withLengthColumnTypes.find((e=>e===r))){let i=parseInt(e.substring(n+1,e.length-1));i&&(t.length=i.toString(),t.type=r)}if(this.driver.withPrecisionColumnTypes.find((e=>e===r))){const n=new RegExp(`^${r}\\((\\d+),?\\s?(\\d+)?\\)`),i=e.match(n);i&&i[1]&&(t.precision=+i[1]),this.driver.withScaleColumnTypes.find((e=>e===r))&&i&&i[2]&&(t.scale=+i[2]),t.type=r}}return t})));const b=[],v=/CONSTRAINT "([^"]*)" FOREIGN KEY ?\((.*?)\) REFERENCES "([^"]*)"/g;for(;null!==(m=v.exec(r));)b.push({name:m[1],columns:m[2].substr(1,m[2].length-2).split('", "'),referencedTableName:m[3]});const w=pe.s.uniq(c,(e=>e.id));let E;a.foreignKeys=w.map((e=>{const t=c.filter((t=>t.id===e.id&&t.table===e.table)),n=t.map((e=>e.from)),r=t.map((e=>e.to)),i=b.find((t=>t.referencedTableName===e.table&&t.columns.every((e=>-1!==n.indexOf(e)))));return new p({name:i.name,columnNames:n,referencedTableName:e.table,referencedColumnNames:r,onDelete:e.on_delete,onUpdate:e.on_update})}));const T=[],S=/CONSTRAINT "([^"]*)" UNIQUE ?\((.*?)\)/g;for(;null!==(E=S.exec(r));)T.push({name:E[1],columns:E[2].substr(1,E[2].length-2).split('", "')});const N=o.filter((e=>"u"===e.origin)).map((e=>e.name)).filter(((e,t,n)=>n.indexOf(e)===t)).map((async e=>{const t=o.find((t=>t.name===e)),n=(await this.query(`PRAGMA index_info("${t.name}")`)).sort(((e,t)=>parseInt(e.seqno)-parseInt(t.seqno))).map((e=>e.name));if(1===n.length){const e=a.columns.find((e=>!!n.find((t=>t===e.name))));e&&(e.isUnique=!0)}const r=T.find((e=>e.columns.every((e=>-1!==n.indexOf(e)))));return new f({name:r?r.name:this.connection.namingStrategy.uniqueConstraintName(a,n),columnNames:n})}));let A;a.uniques=await Promise.all(N);const C=/CONSTRAINT "([^"]*)" CHECK ?(\(.*?\))([,]|[)]$)/g;for(;null!==(A=C.exec(r));)a.checks.push(new y({name:A[1],expression:A[2]}));const x=o.filter((e=>"c"===e.origin)).map((e=>e.name)).filter(((e,t,n)=>n.indexOf(e)===t)).map((async n=>{const r=t.find((e=>e.name===n)),i=/WHERE (.*)/.exec(r.sql),s=o.find((e=>e.name===n)),c=(await this.query(`PRAGMA index_info("${s.name}")`)).sort(((e,t)=>parseInt(e.seqno)-parseInt(t.seqno))).map((e=>e.name)),l=`${e.database?`${e.database}.`:""}${s.name}`,u="1"===s.unique||1===s.unique;return new d({table:a,name:l,columnNames:c,isUnique:u,where:i?i[1]:void 0})})),M=await Promise.all(x);return a.indices=M.filter((e=>!!e)),a})))}createTableSql(e,t,n){const r=e.columns.filter((e=>e.isPrimary)),i=r.find((e=>e.isGenerated&&"increment"===e.generationStrategy)),a=r.length>1;if(a&&i)throw new u.K_("Sqlite does not support AUTOINCREMENT on composite primary key");const s=e.columns.map((e=>this.buildCreateColumnSql(e,a))).join(", "),[o]=this.splitTablePath(e.name);let c=`CREATE TABLE ${this.escapePath(e.name)} (${s}`,[l,h]=this.splitTablePath(e.name);const d=n?`${l?`${l}.`:""}${h.replace(/^temporary_/,"")}`:e.name;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{e.uniques.some((e=>1===e.columnNames.length&&e.columnNames[0]===t.name))||e.uniques.push(new f({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){c+=`, ${e.uniques.map((e=>`CONSTRAINT "${e.name?e.name:this.connection.namingStrategy.uniqueConstraintName(d,e.columnNames)}" UNIQUE (${e.columnNames.map((e=>`"${e}"`)).join(", ")})`)).join(", ")}`}if(e.checks.length>0){c+=`, ${e.checks.map((e=>`CONSTRAINT "${e.name?e.name:this.connection.namingStrategy.checkConstraintName(d,e.expression)}" CHECK (${e.expression})`)).join(", ")}`}if(e.foreignKeys.length>0&&t){c+=`, ${e.foreignKeys.filter((e=>{const[t]=this.splitTablePath(e.referencedTableName);return t===o})).map((e=>{const[,t]=this.splitTablePath(e.referencedTableName),n=e.columnNames.map((e=>`"${e}"`)).join(", ");e.name||(e.name=this.connection.namingStrategy.foreignKeyName(d,e.columnNames,this.getTablePath(e),e.referencedColumnNames));const r=e.referencedColumnNames.map((e=>`"${e}"`)).join(", ");let i=`CONSTRAINT "${e.name}" FOREIGN KEY (${n}) REFERENCES "${t}" (${r})`;return e.onDelete&&(i+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(i+=` ON UPDATE ${e.onUpdate}`),i})).join(", ")}`}if(r.length>1){c+=`, PRIMARY KEY (${r.map((e=>`"${e.name}"`)).join(", ")})`}return c+=")",e.withoutRowid&&(c+=" WITHOUT ROWID"),new ot(c)}dropTableSql(e,t){const n=w.a.isTable(e)?e.name:e,r=t?`DROP TABLE IF EXISTS ${this.escapePath(n)}`:`DROP TABLE ${this.escapePath(n)}`;return new ot(r)}createViewSql(e){return"string"==typeof e.expression?new ot(`CREATE VIEW "${e.name}" AS ${e.expression}`):new ot(`CREATE VIEW "${e.name}" AS ${e.expression(this.connection).getQuery()}`)}insertViewDefinitionSql(e){const t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:rt.VIEW,name:e.name,value:t})}dropViewSql(e){const t=w.a.isView(e)?e.name:e;return new ot(`DROP VIEW "${t}"`)}deleteViewDefinitionSql(e){const t=w.a.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:rt.VIEW,name:t})}createIndexSql(e,t){const n=t.columnNames.map((e=>`"${e}"`)).join(", "),[r,i]=this.splitTablePath(e.name);return new ot(`CREATE ${t.isUnique?"UNIQUE ":""}INDEX ${r?`"${r}".`:""}${this.escapePath(t.name)} ON "${i}" (${n}) ${t.where?"WHERE "+t.where:""}`)}dropIndexSql(e){let t=w.a.isTableIndex(e)?e.name:e;return new ot(`DROP INDEX ${this.escapePath(t)}`)}buildCreateColumnSql(e,t){let n='"'+e.name+'"';return w.a.isColumnMetadata(e)?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=' CHECK( "'+e.name+'" IN ('+e.enum.map((e=>"'"+e+"'")).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),e.asExpression?n+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`:void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n}async recreateTable(e,t,n=!0){const r=[],i=[];t.indices.forEach((e=>{r.push(this.dropIndexSql(e)),i.push(this.createIndexSql(t,e))}));let[a,s]=this.splitTablePath(e.name),[,o]=this.splitTablePath(t.name);if(e.name=s=`${a?`${a}.`:""}temporary_${s}`,r.push(this.createTableSql(e,!0,!0)),i.push(this.dropTableSql(e)),n){let n=e.columns.filter((e=>!e.generatedType)).map((e=>`"${e.name}"`)),a=t.columns.filter((e=>!e.generatedType)).map((e=>`"${e.name}"`));a.length<n.length?n=e.columns.filter((e=>{const n=t.columns.find((t=>t.name===e.name));return(!n||!n.generatedType)&&(!e.generatedType&&n)})).map((e=>`"${e.name}"`)):a.length>n.length&&(a=t.columns.filter((t=>!t.generatedType&&e.columns.find((e=>e.name===t.name)))).map((e=>`"${e.name}"`))),r.push(new ot(`INSERT INTO ${this.escapePath(e.name)}(${n.join(", ")}) SELECT ${a.join(", ")} FROM ${this.escapePath(t.name)}`)),i.push(new ot(`INSERT INTO ${this.escapePath(t.name)}(${a.join(", ")}) SELECT ${n.join(", ")} FROM ${this.escapePath(e.name)}`))}r.push(this.dropTableSql(t)),i.push(this.createTableSql(t,!0)),r.push(new ot(`ALTER TABLE ${this.escapePath(e.name)} RENAME TO ${this.escapePath(o)}`)),i.push(new ot(`ALTER TABLE ${this.escapePath(t.name)} RENAME TO ${this.escapePath(s)}`)),e.name=t.name,e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),r.push(this.createIndexSql(e,t)),i.push(this.dropIndexSql(t))})),t.columns.filter((t=>{const n=e.columns.find((e=>e.name===t.name));return t.generatedType&&t.asExpression&&(!n||!n.generatedType&&!n.asExpression)})).forEach((e=>{const n=this.deleteTypeormMetadataSql({table:t.name,type:rt.GENERATED_COLUMN,name:e.name}),a=this.insertTypeormMetadataSql({table:t.name,type:rt.GENERATED_COLUMN,name:e.name,value:e.asExpression});r.push(n),i.push(a)})),e.columns.filter((e=>e.generatedType&&e.asExpression&&!t.columns.some((t=>t.name===e.name)))).forEach((t=>{const n=this.insertTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),a=this.deleteTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name});r.push(n),i.push(a)})),e.columns.filter((e=>e.generatedType&&e.asExpression)).forEach((n=>{const a=t.columns.find((e=>e.name===n.name&&e.generatedType&&n.generatedType&&e.asExpression!==n.asExpression));if(!a)return;const s=this.deleteTypeormMetadataSql({table:t.name,type:rt.GENERATED_COLUMN,name:a.name}),o=this.insertTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:n.name,value:n.asExpression});r.push(s),r.push(o);const c=this.insertTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:a.name,value:a.asExpression}),l=this.deleteTypeormMetadataSql({table:t.name,type:rt.GENERATED_COLUMN,name:n.name});i.push(c),i.push(l)})),await this.executeQueries(r,i),this.replaceCachedTable(t,e)}splitTablePath(e){return-1!==e.indexOf(".")?e.split("."):[void 0,e]}escapePath(e,t){return(w.a.isTable(e)||w.a.isView(e)?e.name:e).replace(/^\.+|\.+$/g,"").split(".").map((e=>t?e:`"${e}"`)).join(".")}}class ht{constructor(e){this.queryRunner=e}async broadcast(e,...t){const n=new be.D,r=this[`broadcast${e}Event`];"function"==typeof r&&r.call(this,n,...t),await n.wait()}broadcastBeforeInsertEvent(e,t,n){n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.beforeInsert){const i=r.beforeInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t});i instanceof Promise&&e.promises.push(i),e.count++}}))}broadcastBeforeUpdateEvent(e,t,n,r,i,a){n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((s=>{if(this.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){const o=s.beforeUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});o instanceof Promise&&e.promises.push(o),e.count++}}))}broadcastBeforeRemoveEvent(e,t,n,r){n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.beforeRemove){const a=i.beforeRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastBeforeSoftRemoveEvent(e,t,n,r){n&&t.beforeSoftRemoveListeners.length&&t.beforeSoftRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.beforeSoftRemove){const a=i.beforeSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastBeforeRecoverEvent(e,t,n,r){n&&t.beforeRecoverListeners.length&&t.beforeRecoverListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.beforeRecover){const a=i.beforeRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterInsertEvent(e,t,n){n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((r=>{if(this.isAllowedSubscriber(r,t.target)&&r.afterInsert){const i=r.afterInsert({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t});i instanceof Promise&&e.promises.push(i),e.count++}}))}broadcastBeforeTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionStart){const n=t.beforeTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionStartEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionStart){const n=t.afterTransactionStart({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastBeforeTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionCommit){const n=t.beforeTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionCommitEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionCommit){const n=t.afterTransactionCommit({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastBeforeTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.beforeTransactionRollback){const n=t.beforeTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterTransactionRollbackEvent(e){this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((t=>{if(t.afterTransactionRollback){const n=t.afterTransactionRollback({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});n instanceof Promise&&e.promises.push(n),e.count++}}))}broadcastAfterUpdateEvent(e,t,n,r,i,a){n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((s=>{if(this.isAllowedSubscriber(s,t.target)&&s.afterUpdate){const o=s.afterUpdate({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});o instanceof Promise&&e.promises.push(o),e.count++}}))}broadcastAfterRemoveEvent(e,t,n,r){n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.afterRemove){const a=i.afterRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterSoftRemoveEvent(e,t,n,r){n&&t.afterSoftRemoveListeners.length&&t.afterSoftRemoveListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.afterSoftRemove){const a=i.afterSoftRemove({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastAfterRecoverEvent(e,t,n,r){n&&t.afterRecoverListeners.length&&t.afterRecoverListeners.forEach((t=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((i=>{if(this.isAllowedSubscriber(i,t.target)&&i.afterRecover){const a=i.afterRecover({connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});a instanceof Promise&&e.promises.push(a),e.count++}}))}broadcastLoadEventsForAll(e,t,n){return this.broadcastLoadEvent(e,t,n)}broadcastLoadEvent(e,t,n){const r=this.queryRunner.connection.subscribers.filter((e=>this.isAllowedSubscriber(e,t.target)&&e.afterLoad));if(t.relations.length||t.afterLoadListeners.length||r.length){const i=n.filter((e=>!(e instanceof Promise)));t.relations.length&&t.relations.forEach((t=>{i.forEach((n=>{if(t.isLazy&&!n.hasOwnProperty(t.propertyName))return;const r=t.getEntityValue(n);V.g.isObject(r)&&this.broadcastLoadEvent(e,t.inverseEntityMetadata,Array.isArray(r)?r:[r])}))})),t.afterLoadListeners.length&&t.afterLoadListeners.forEach((t=>{i.forEach((n=>{if(t.isAllowed(n)){const r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}))})),r.forEach((n=>{i.forEach((r=>{const i=n.afterLoad(r,{entity:r,metadata:t,connection:this.queryRunner.connection,queryRunner:this.queryRunner,manager:this.queryRunner.manager});i instanceof Promise&&e.promises.push(i),e.count++}))}))}}isAllowedSubscriber(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)}}class dt{constructor(){this.records=[]}}class pt extends ut{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new ht(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const i=+new Date;try{const a=await new Promise((async(n,i)=>{r.executeSql(e,t,(e=>n(e)),(e=>i(e)))})),s=this.driver.options.maxQueryExecutionTime,o=+new Date-i;s&&o>s&&this.driver.connection.logger.logQuerySlow(o,e,t,this);const c=new dt;if("INSERT INTO"===e.substr(0,11))c.raw=a.insertId;else{let e=[];for(let t=0;t<a.rows.length;t++)e.push(a.rows.item(t));c.records=e,c.raw=e}return n?c:c.raw}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}async startTransaction(){throw new u.K_("Transactions are not supported by the Cordova driver")}async commitTransaction(){throw new u.K_("Transactions are not supported by the Cordova driver")}async rollbackTransaction(){throw new u.K_("Transactions are not supported by the Cordova driver")}async clearDatabase(){await this.query("PRAGMA foreign_keys = OFF");try{const e="SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'",t=await this.query(e),n="SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",r=await this.query(n);await Promise.all(t.map((e=>this.query(e.query)))),await Promise.all(r.map((e=>this.query(e.query))))}finally{await this.query("PRAGMA foreign_keys = ON")}}parametrize(e,t=0){return Object.keys(e).map(((e,t)=>`"${e}"=?`))}}var mt=n(287293),ft=n(447638);class yt extends nt{constructor(e){if(super(e),this.database=this.options.database,!this.options.database)throw new mt.f("database");if(!this.options.location)throw new mt.f("location");this.loadDependencies()}async disconnect(){return this.queryRunner=void 0,new Promise(((e,t)=>{this.databaseConnection.close(e,t)}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new pt(this)),this.queryRunner}async createDatabaseConnection(){const e=Object.assign({},{name:this.options.database,location:this.options.location},this.options.extra||{}),t=await new Promise((t=>{this.sqlite.openDatabase(e,(e=>t(e)))}));return await new Promise(((e,n)=>{t.executeSql("PRAGMA foreign_keys = ON",[],(()=>e()),(e=>n(e)))})),t}loadDependencies(){try{const e=this.options.driver||window.sqlitePlugin;this.sqlite=e}catch(e){throw new ft.z("Cordova-SQLite","cordova-sqlite-storage")}}}class gt extends ut{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new ht(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=this.driver.connection;return new Promise((async(i,a)=>{const s=await this.connect(),o="INSERT INTO"===e.substr(0,11);r.logger.logQuery(e,t,this);const c=(s,c)=>{const u=this.driver.options.maxQueryExecutionTime,h=+new Date-l;u&&h>u&&r.logger.logQuerySlow(h,e,t,this),s&&(r.logger.logQueryError(s,e,t,this),a(new at.O(e,t,s)));const d=new dt;d.raw=c,!o&&Array.isArray(c)&&(d.records=c),i(n?d:d.raw)},l=+new Date;o?s.execSQL(e,t,c):s.all(e,t,c)}))}parametrize(e,t=0){return Object.keys(e).map(((e,t)=>`"${e}"=?`))}}var _t=n(348834).Buffer;class bt extends nt{constructor(e){if(super(e),this.connection=e,this.options=e.options,this.database=this.options.database,this.driver=this.options.driver,!this.options.database)throw new mt.f("database");this.loadDependencies()}async disconnect(){return new Promise(((e,t)=>{this.queryRunner=void 0,this.databaseConnection.close().then(e).catch(t)}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new gt(this)),this.queryRunner}normalizeType(e){return e.type===_t?"blob":super.normalizeType(e)}createDatabaseConnection(){return new Promise(((e,t)=>{const n=Object.assign({},{readOnly:this.options.readOnly,key:this.options.key,multithreading:this.options.multithreading,migrate:this.options.migrate,iosFlags:this.options.iosFlags,androidFlags:this.options.androidFlags},this.options.extra||{});new this.sqlite(this.options.database,n,((n,r)=>{if(n)return t(n);r.resultType(this.sqlite.RESULTSASOBJECT),r.execSQL("PRAGMA foreign_keys = ON",[],((n,i)=>{if(n)return t(n);e(r)}))}))}))}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new ft.z("Nativescript","nativescript-sqlite")}}class vt extends ut{constructor(e){super(),this.isDirty=!1,this.driver=e,this.connection=e.connection,this.broadcaster=new ht(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async flush(){this.isDirty&&(await this.driver.autoSave(),this.isDirty=!1)}async release(){return await this.flush(),super.release()}async commitTransaction(){await super.commitTransaction(),await this.flush()}async query(e,t=[],n=!1){if(this.isReleased)throw new it.Y;const r=e.trim().split(" ",1)[0],i=this.driver.databaseConnection;this.driver.connection.logger.logQuery(e,t,this);const a=+new Date;let s;try{s=i.prepare(e),t&&(t=t.map((e=>void 0!==e?e:null)),s.bind(t));const o=this.driver.options.maxQueryExecutionTime,c=+new Date-a;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=[];for(;s.step();)l.push(s.getAsObject());const u=new dt;return u.affected=i.getRowsModified(),u.records=l,u.raw=l,s.free(),"SELECT"!==r&&(this.isDirty=!0),n?u:u.raw}catch(n){throw s&&s.free(),this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}}var wt=n(348834).Buffer;class Et extends nt{constructor(e){if(super(e),this.options.autoSave&&!this.options.location&&!this.options.autoSaveCallback)throw new mt.f("location or autoSaveCallback");this.loadDependencies()}async connect(){this.databaseConnection=await this.createDatabaseConnection()}async disconnect(){this.queryRunner=void 0,this.databaseConnection.close()}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new vt(this)),this.queryRunner}async load(e,t=!0){if("string"==typeof e){if("node"===a.type){if(a.fileExist(e)){const t=a.readFileSync(e);return this.createDatabaseConnectionWithImport(t)}if(t)throw new u.K_(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}{let n=null;if(this.options.useLocalForage){if(!window.localforage)throw new u.K_("localforage is not defined - please import localforage.js into your site");n=await window.localforage.getItem(e)}else n=a.getGlobalVariable().localStorage.getItem(e);if(null!=n)return this.createDatabaseConnectionWithImport(JSON.parse(n));if(t)throw new u.K_(`File ${e} does not exist`);return this.createDatabaseConnectionWithImport()}}return this.createDatabaseConnectionWithImport(e)}async save(e){if(!e&&!this.options.location)throw new u.K_("No location is set, specify a location parameter or add the location option to your configuration");let t="";if(e?t=e:this.options.location&&(t=this.options.location),"node"===a.type)try{const e=wt.from(this.databaseConnection.export());await a.writeFile(t,e)}catch(e){throw new u.K_(`Could not save database, error: ${e}`)}else{const e=this.databaseConnection.export(),n=[].slice.call(e);if(this.options.useLocalForage){if(!window.localforage)throw new u.K_("localforage is not defined - please import localforage.js into your site");await window.localforage.setItem(t,JSON.stringify(n))}else a.getGlobalVariable().localStorage.setItem(t,JSON.stringify(n))}}async autoSave(){this.options.autoSave&&(this.options.autoSaveCallback?await this.options.autoSaveCallback(this.export()):await this.save())}export(){return this.databaseConnection.export()}createGeneratedMap(e,t){const n=e.generatedColumns.reduce(((e,t)=>{if(t.isPrimary&&"increment"===t.generationStrategy){const n="SELECT last_insert_rowid()";try{let r=this.databaseConnection.exec(n);return this.connection.logger.logQuery(n),pe.s.mergeDeep(e,t.createValueMap(r[0].values[0][0]))}catch(e){this.connection.logger.logQueryError(e,n,[])}}return e}),{});return Object.keys(n).length>0?n:void 0}createDatabaseConnection(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)}async createDatabaseConnectionWithImport(e){const t="function"==typeof this.sqlite.Database?this.sqlite:await this.sqlite(this.options.sqlJsConfig);return e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,this.databaseConnection.exec("PRAGMA foreign_keys = ON"),this.databaseConnection}loadDependencies(){if("browser"===a.type){const e=this.options.driver||window.SQL;this.sqlite=e}else try{const e=this.options.driver||a.load("sql.js");this.sqlite=e}catch(e){throw new ft.z("sql.js","sql.js")}}}class Tt extends ut{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new ht(this)}async startTransaction(){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive&&void 0===this.transaction)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive&&void 0===this.transaction)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transaction=void 0,this.isTransactionActive=!1,this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async beforeMigration(){const e=await this.connect();return new Promise(((t,n)=>{e.exec([{sql:"PRAGMA foreign_keys = OFF",args:[]}],!1,(e=>e?n(e):t()))}))}async afterMigration(){const e=await this.connect();return new Promise(((t,n)=>{e.exec([{sql:"PRAGMA foreign_keys = ON",args:[]}],!1,(e=>e?n(e):t()))}))}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;return new Promise((async(r,i)=>{const a=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const s=+new Date;a.transaction((async a=>{void 0===this.transaction&&(await this.startTransaction(),this.transaction=a),this.transaction.executeSql(e,t,((i,a)=>{const o=this.driver.options.maxQueryExecutionTime,c=+new Date-s;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=new dt;if((null==a?void 0:a.hasOwnProperty("rowsAffected"))&&(l.affected=a.rowsAffected),null==a?void 0:a.hasOwnProperty("rows")){let e=[];for(let t=0;t<a.rows.length;t++)e.push(a.rows.item(t));l.raw=e,l.records=e}e.startsWith("INSERT INTO")&&(l.raw=a.insertId),r(n?l:l.raw)}),((n,r)=>{this.driver.connection.logger.logQueryError(r,e,t,this),i(new at.O(e,t,r))}))}),(async e=>{await this.rollbackTransaction(),i(e)}),(()=>{this.isTransactionActive=!1,this.transaction=void 0}))}))}}class St extends nt{constructor(e){if(super(e),this.database=this.options.database,!this.options.database)throw new mt.f("database");if(!this.options.driver)throw new mt.f("driver");this.sqlite=this.options.driver}async disconnect(){return new Promise(((e,t)=>{try{this.queryRunner=void 0,this.databaseConnection._db.close(),this.databaseConnection=void 0,e()}catch(e){t(e)}}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new Tt(this)),this.queryRunner}createDatabaseConnection(){return new Promise(((e,t)=>{try{const n=this.sqlite.openDatabase(this.options.database);n.transaction((r=>{r.executeSql("PRAGMA foreign_keys = ON",[],((t,r)=>{e(n)}),((e,n)=>{t({transaction:e,error:n})}))}),(e=>{t(e)}))}catch(e){t(e)}}))}}class Nt extends lt{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.client=t,this.broadcaster=new ht(this)}async connect(){return{}}release(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?await this.client.startTransaction():await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.commitTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.rollbackTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=await this.client.query(e,t),i=new dt;return i.raw=r,(null==r?void 0:r.hasOwnProperty("records"))&&Array.isArray(r.records)&&(i.records=r.records),(null==r?void 0:r.hasOwnProperty("numberOfRecordsUpdated"))&&(i.affected=r.numberOfRecordsUpdated),n?i:i.raw}stream(e,t,n,r){if(this.isReleased)throw new it.Y;return new Promise((async(i,a)=>{try{const a=(await this.connect()).query(e,t);n&&a.on("end",n),r&&a.on("error",r),i(a)}catch(e){a(e)}}))}async getDatabases(){return Promise.resolve([])}async getSchemas(e){throw new u.K_("MySql driver does not support table schemas")}async hasDatabase(e){return!!(await this.query(`SELECT * FROM \`INFORMATION_SCHEMA\`.\`SCHEMATA\` WHERE \`SCHEMA_NAME\` = '${e}'`)).length}async getCurrentDatabase(){return(await this.query("SELECT DATABASE() AS `db_name`"))[0].db_name}async hasSchema(e){throw new u.K_("MySql driver does not support table schemas")}async getCurrentSchema(){return(await this.query("SELECT SCHEMA() AS `schema_name`"))[0].schema_name}async hasTable(e){const t=this.driver.parseTableName(e),n=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${t.database}' AND \`TABLE_NAME\` = '${t.tableName}'`;return!!(await this.query(n)).length}async hasColumn(e,t){const n=this.driver.parseTableName(e),r=w.a.isTableColumn(t)?t.name:t,i=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_SCHEMA\` = '${n.database}' AND \`TABLE_NAME\` = '${n.tableName}' AND \`COLUMN_NAME\` = '${r}'`;return!!(await this.query(i)).length}async createDatabase(e,t){const n=t?`CREATE DATABASE IF NOT EXISTS \`${e}\``:`CREATE DATABASE \`${e}\``,r=`DROP DATABASE \`${e}\``;await this.executeQueries(new ot(n),new ot(r))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS \`${e}\``:`DROP DATABASE \`${e}\``,r=`CREATE DATABASE \`${e}\``;await this.executeQueries(new ot(n),new ot(r))}async createSchema(e,t){throw new u.K_("Schema create queries are not supported by MySql driver.")}async dropSchema(e,t){throw new u.K_("Schema drop queries are not supported by MySql driver.")}async createTable(e,t=!1,n=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const r=[],i=[];return r.push(this.createTableSql(e,n)),i.push(this.dropTableSql(e)),e.indices.forEach((t=>i.push(this.dropIndexSql(e,t)))),n&&e.foreignKeys.forEach((t=>i.push(this.dropForeignKeySql(e,t)))),this.executeQueries(r,i)}async dropTable(e,t,n=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const r=n,i=this.getTablePath(e),a=await this.getCachedTable(i),s=[],o=[];n&&a.foreignKeys.forEach((e=>s.push(this.dropForeignKeySql(a,e)))),a.indices.forEach((e=>s.push(this.dropIndexSql(a,e)))),s.push(this.dropTableSql(a)),o.push(this.createTableSql(a,r)),await this.executeQueries(s,o)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=w.a.isView(e)?e.name:e,n=await this.getCachedView(t),r=[],i=[];r.push(await this.deleteViewDefinitionSql(n)),r.push(this.dropViewSql(n)),i.push(await this.insertViewDefinitionSql(n)),i.push(this.createViewSql(n)),await this.executeQueries(r,i)}async renameTable(e,t){const n=[],r=[],i=w.a.isTable(e)?e:await this.getCachedTable(e),a=i.clone(),{database:s}=this.driver.parseTableName(i);a.name=s?`${s}.${t}`:t,n.push(new ot(`RENAME TABLE ${this.escapePath(i)} TO ${this.escapePath(a)}`)),r.push(new ot(`RENAME TABLE ${this.escapePath(a)} TO ${this.escapePath(i)}`)),a.indices.forEach((e=>{const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),i=this.connection.namingStrategy.indexName(a,e.columnNames,e.where);let s="";e.isUnique&&(s+="UNIQUE "),e.isSpatial&&(s+="SPATIAL "),e.isFulltext&&(s+="FULLTEXT "),n.push(new ot(`ALTER TABLE ${this.escapePath(a)} DROP INDEX \`${e.name}\`, ADD ${s}INDEX \`${i}\` (${t})`)),r.push(new ot(`ALTER TABLE ${this.escapePath(a)} DROP INDEX \`${i}\`, ADD ${s}INDEX \`${e.name}\` (${t})`)),e.name=i})),a.foreignKeys.forEach((e=>{const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),i=e.referencedColumnNames.map((e=>`\`${e}\``)).join(","),s=this.connection.namingStrategy.foreignKeyName(a,e.columnNames);let o=`ALTER TABLE ${this.escapePath(a)} DROP FOREIGN KEY \`${e.name}\`, ADD CONSTRAINT \`${s}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${i})`;e.onDelete&&(o+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(o+=` ON UPDATE ${e.onUpdate}`);let c=`ALTER TABLE ${this.escapePath(a)} DROP FOREIGN KEY \`${s}\`, ADD CONSTRAINT \`${e.name}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${i})`;e.onDelete&&(c+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(c+=` ON UPDATE ${e.onUpdate}`),n.push(new ot(o)),r.push(new ot(c)),e.name=s})),await this.executeQueries(n,r),i.name=a.name,this.replaceCachedTable(i,a)}async addColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone(),i=[],a=[],s=r.primaryColumns.length>0;if(i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(t,s,!1)}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN \`${t.name}\``)),t.isPrimary&&s){const e=r.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const r=e.clone();r.isGenerated=!1,r.generationStrategy=void 0,i.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(r,!0)}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${r.name}\` ${this.buildCreateColumnSql(t,!0)}`))}const s=r.primaryColumns;let o=s.map((e=>`\`${e.name}\``)).join(", ");if(i.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${o})`)),s.push(t),o=s.map((e=>`\`${e.name}\``)).join(", "),i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${o})`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),e){const r=e.clone();r.isGenerated=!1,r.generationStrategy=void 0,i.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${r.name}\` ${this.buildCreateColumnSql(t,!0)}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(r,!0)}`))}}const o=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(o)i.push(this.createIndexSql(n,o)),a.push(this.dropIndexSql(n,o));else if(t.isUnique){const e=new d({name:this.connection.namingStrategy.indexName(n,[t.name]),columnNames:[t.name],isUnique:!0});r.indices.push(e),r.uniques.push(new f({name:e.name,columnNames:e.columnNames})),i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD UNIQUE INDEX \`${e.name}\` (\`${t.name}\`)`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP INDEX \`${e.name}\``))}await this.executeQueries(i,a),r.addColumn(t),this.replaceCachedTable(n,r)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e),i=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!i)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);let a;w.a.isTableColumn(n)?a=n:(a=i.clone(),a.name=n),await this.changeColumn(r,i,a)}async changeColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e);let i=r.clone();const a=[],s=[],o=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!o)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);if(n.isGenerated!==o.isGenerated&&"uuid"!==n.generationStrategy||o.type!==n.type||o.length!==n.length||o.generatedType!==n.generatedType)await this.dropColumn(r,o),await this.addColumn(r,n),i=r.clone();else{if(n.name!==o.name){a.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${o.name}\` \`${n.name}\` ${this.buildCreateColumnSql(o,!0,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${n.name}\` \`${o.name}\` ${this.buildCreateColumnSql(o,!0,!0)}`)),i.findColumnIndices(o).forEach((e=>{e.columnNames.splice(e.columnNames.indexOf(o.name),1),e.columnNames.push(n.name);const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),c=this.connection.namingStrategy.indexName(i,e.columnNames,e.where);let l="";e.isUnique&&(l+="UNIQUE "),e.isSpatial&&(l+="SPATIAL "),e.isFulltext&&(l+="FULLTEXT "),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP INDEX \`${e.name}\`, ADD ${l}INDEX \`${c}\` (${t})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP INDEX \`${c}\`, ADD ${l}INDEX \`${e.name}\` (${t})`)),e.name=c})),i.findColumnForeignKeys(o).forEach((e=>{e.columnNames.splice(e.columnNames.indexOf(o.name),1),e.columnNames.push(n.name);const t=e.columnNames.map((e=>`\`${e}\``)).join(", "),c=e.referencedColumnNames.map((e=>`\`${e}\``)).join(","),l=this.connection.namingStrategy.foreignKeyName(i,e.columnNames);let u=`ALTER TABLE ${this.escapePath(r)} DROP FOREIGN KEY \`${e.name}\`, ADD CONSTRAINT \`${l}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${c})`;e.onDelete&&(u+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(u+=` ON UPDATE ${e.onUpdate}`);let h=`ALTER TABLE ${this.escapePath(r)} DROP FOREIGN KEY \`${l}\`, ADD CONSTRAINT \`${e.name}\` FOREIGN KEY (${t}) REFERENCES ${this.escapePath(this.getTablePath(e))}(${c})`;e.onDelete&&(h+=` ON DELETE ${e.onDelete}`),e.onUpdate&&(h+=` ON UPDATE ${e.onUpdate}`),a.push(new ot(u)),s.push(new ot(h)),e.name=l}));const e=i.columns.find((e=>e.name===o.name));i.columns[i.columns.indexOf(e)].name=n.name,o.name=n.name}if(this.isColumnChanged(o,n,!0)&&(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${o.name}\` ${this.buildCreateColumnSql(n,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${n.name}\` ${this.buildCreateColumnSql(o,!0)}`))),n.isPrimary!==o.isPrimary){const e=i.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`))}const t=i.primaryColumns;if(t.length>0){const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP PRIMARY KEY`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD PRIMARY KEY (${e})`))}if(!0===n.isPrimary){t.push(n);i.columns.find((e=>e.name===n.name)).isPrimary=!0;const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD PRIMARY KEY (${e})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP PRIMARY KEY`))}else{const e=t.find((e=>e.name===n.name));t.splice(t.indexOf(e),1);if(i.columns.find((e=>e.name===n.name)).isPrimary=!1,t.length>0){const e=t.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD PRIMARY KEY (${e})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP PRIMARY KEY`))}}if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`))}}if(n.isUnique!==o.isUnique)if(!0===n.isUnique){const e=new d({name:this.connection.namingStrategy.indexName(r,[n.name]),columnNames:[n.name],isUnique:!0});i.indices.push(e),i.uniques.push(new f({name:e.name,columnNames:e.columnNames})),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD UNIQUE INDEX \`${e.name}\` (\`${n.name}\`)`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP INDEX \`${e.name}\``))}else{const e=i.indices.find((e=>1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((e=>e===n.name))));i.indices.splice(i.indices.indexOf(e),1);const t=i.uniques.find((t=>t.name===e.name));i.uniques.splice(i.uniques.indexOf(t),1),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP INDEX \`${e.name}\``)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD UNIQUE INDEX \`${e.name}\` (\`${n.name}\`)`))}}await this.executeQueries(a,s),this.replaceCachedTable(r,i)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:r}of t)await this.changeColumn(e,n,r)}async dropColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableColumn(t)?t:n.findColumnByName(t);if(!r)throw new u.K_(`Column "${t}" was not found in table "${n.name}"`);const i=n.clone(),a=[],s=[];if(r.isPrimary){const e=i.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(e){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`))}const t=i.primaryColumns.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(i)} DROP PRIMARY KEY`)),s.push(new ot(`ALTER TABLE ${this.escapePath(i)} ADD PRIMARY KEY (${t})`));if(i.findColumnByName(r.name).isPrimary=!1,i.primaryColumns.length>0){const e=i.primaryColumns.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(i)} ADD PRIMARY KEY (${e})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(i)} DROP PRIMARY KEY`))}if(e&&e.name!==r.name){const t=e.clone();t.isGenerated=!1,t.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${t.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(t,!0)}`))}}const o=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===r.name));if(o)i.indices.splice(i.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o));else if(r.isUnique){const e=this.connection.namingStrategy.uniqueConstraintName(n,[r.name]),t=i.uniques.find((t=>t.name===e));t&&i.uniques.splice(i.uniques.indexOf(t),1);const o=this.connection.namingStrategy.indexName(n,[r.name]),c=i.indices.find((e=>e.name===o));c&&i.indices.splice(i.indices.indexOf(c),1),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP INDEX \`${o}\``)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD UNIQUE INDEX \`${o}\` (\`${r.name}\`)`))}a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN \`${r.name}\``)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(r,!0)}`)),await this.executeQueries(a,s),i.removeColumn(r),this.replaceCachedTable(n,i)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone(),i=this.createPrimaryKeySql(n,t),a=this.dropPrimaryKeySql(n);await this.executeQueries(i,a),r.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)})),this.replaceCachedTable(n,r)}async updatePrimaryKeys(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone(),i=t.map((e=>e.name)),a=[],s=[],o=r.columns.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(o){const e=o.clone();e.isGenerated=!1,e.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${o.name}\` ${this.buildCreateColumnSql(e,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(o,!0)}`))}const c=r.primaryColumns;if(c.length>0){const e=c.map((e=>`\`${e.name}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${e})`))}r.columns.filter((e=>-1!==i.indexOf(e.name))).forEach((e=>e.isPrimary=!0));const l=i.map((e=>`\`${e}\``)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD PRIMARY KEY (${l})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP PRIMARY KEY`));const u=o||t.find((e=>e.isGenerated&&"increment"===e.generationStrategy));if(u){const e=u.clone();e.isGenerated=!1,e.generationStrategy=void 0,a.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${e.name}\` ${this.buildCreateColumnSql(u,!0)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} CHANGE \`${u.name}\` ${this.buildCreateColumnSql(e,!0)}`));const t=r.columns.find((e=>e.name===u.name));t.isGenerated=!0,t.generationStrategy="increment"}await this.executeQueries(a,s),this.replaceCachedTable(n,r)}async dropPrimaryKey(e){const t=w.a.isTable(e)?e:await this.getCachedTable(e),n=this.dropPrimaryKeySql(t),r=this.createPrimaryKeySql(t,t.primaryColumns.map((e=>e.name)));await this.executeQueries(n,r),t.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){throw new u.K_("MySql does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,t){throw new u.K_("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,t){throw new u.K_("MySql does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,t){throw new u.K_("MySql does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,t){throw new u.K_("MySql does not support check constraints.")}async createCheckConstraints(e,t){throw new u.K_("MySql does not support check constraints.")}async dropCheckConstraint(e,t){throw new u.K_("MySql does not support check constraints.")}async dropCheckConstraints(e,t){throw new u.K_("MySql does not support check constraints.")}async createExclusionConstraint(e,t){throw new u.K_("MySql does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new u.K_("MySql does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new u.K_("MySql does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new u.K_("MySql does not support exclusion constraints.")}async createForeignKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames));const r=this.createForeignKeySql(n,t),i=this.dropForeignKeySql(n,t);await this.executeQueries(r,i),n.addForeignKey(t)}async createForeignKeys(e,t){const n=t.map((t=>this.createForeignKey(e,t)));await Promise.all(n)}async dropForeignKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied foreign key was not found in table ${n.name}`);const i=this.dropForeignKeySql(n,r),a=this.createForeignKeySql(n,r);await this.executeQueries(i,a),n.removeForeignKey(r)}async dropForeignKeys(e,t){const n=t.map((t=>this.dropForeignKey(e,t)));await Promise.all(n)}async createIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const r=this.createIndexSql(n,t),i=this.dropIndexSql(n,t);await this.executeQueries(r,i),n.addIndex(t,!0)}async createIndices(e,t){const n=t.map((t=>this.createIndex(e,t)));await Promise.all(n)}async dropIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied index ${t} was not found in table ${n.name}`);r.name||(r.name=this.generateIndexName(n,r));const i=this.dropIndexSql(n,r),a=this.createIndexSql(n,r);await this.executeQueries(i,a),n.removeIndex(r,!0)}async dropIndices(e,t){const n=t.map((t=>this.dropIndex(e,t)));await Promise.all(n)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(e){const t=e||this.driver.database;if(!t)throw new u.K_("Can not clear database. No database is specified");if(!await this.hasDatabase(t))return Promise.resolve();const n=this.isTransactionActive;n||await this.startTransaction();try{const e=`SELECT concat('DROP VIEW IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`VIEWS\` WHERE \`TABLE_SCHEMA\` = '${t}'`,r=await this.query(e);await Promise.all(r.map((e=>this.query(e.query))));const i="SET FOREIGN_KEY_CHECKS = 0;",a=`SELECT concat('DROP TABLE IF EXISTS \`', table_schema, '\`.\`', table_name, '\`') AS \`query\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_SCHEMA\` = '${t}'`,s="SET FOREIGN_KEY_CHECKS = 1;";await this.query(i);const o=await this.query(a);await Promise.all(o.map((e=>this.query(e.query)))),await this.query(s),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=await this.getCurrentDatabase(),n=e.map((e=>{let{database:n,tableName:r}=this.driver.parseTableName(e);return n||(n=t),`(\`t\`.\`schema\` = '${n}' AND \`t\`.\`name\` = '${r}')`})).join(" OR "),r=`SELECT \`t\`.*, \`v\`.\`check_option\` FROM ${this.escapePath(this.getTypeormMetadataTableName())} \`t\` INNER JOIN \`information_schema\`.\`views\` \`v\` ON \`v\`.\`table_schema\` = \`t\`.\`schema\` AND \`v\`.\`table_name\` = \`t\`.\`name\` WHERE \`t\`.\`type\` = '${rt.VIEW}' ${n?`AND (${n})`:""}`;return(await this.query(r)).map((e=>{const n=new Ze,r=e.schema===t?void 0:e.schema;return n.database=e.schema,n.name=this.driver.buildTableName(e.name,void 0,r),n.expression=e.value,n}))}async loadTables(e){if(e&&0===e.length)return[];const t=[],n=await this.getCurrentDatabase();if(e){const r="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES` WHERE "+e.map((e=>{let[t,r]=e.split(".");return r||(r=t,t=this.driver.database||n),`(\`TABLE_SCHEMA\` = '${t}' AND \`TABLE_NAME\` = '${r}')`})).join(" OR ");t.push(...await this.query(r))}else{const e="SELECT TABLE_NAME, TABLE_SCHEMA FROM `INFORMATION_SCHEMA`.`TABLES`";t.push(...await this.query(e))}if(0===t.length)return[];const r=t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`TABLE_SCHEMA\` = '${t}' AND \`TABLE_NAME\` = '${e}')`)).join(" OR "),i="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE "+r,a=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` WHERE \`CONSTRAINT_NAME\` = 'PRIMARY' AND (${r})`,s=`SELECT \`s\`.* FROM \`INFORMATION_SCHEMA\`.\`STATISTICS\` \`s\` LEFT JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`rc\` ON \`s\`.\`INDEX_NAME\` = \`rc\`.\`CONSTRAINT_NAME\` WHERE (${t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`s\`.\`TABLE_SCHEMA\` = '${t}' AND \`s\`.\`TABLE_NAME\` = '${e}')`)).join(" OR ")}) AND \`s\`.\`INDEX_NAME\` != 'PRIMARY' AND \`rc\`.\`CONSTRAINT_NAME\` IS NULL`,o="SELECT `kcu`.`TABLE_SCHEMA`, `kcu`.`TABLE_NAME`, `kcu`.`CONSTRAINT_NAME`, `kcu`.`COLUMN_NAME`, `kcu`.`REFERENCED_TABLE_SCHEMA`, `kcu`.`REFERENCED_TABLE_NAME`, `kcu`.`REFERENCED_COLUMN_NAME`, `rc`.`DELETE_RULE` `ON_DELETE`, `rc`.`UPDATE_RULE` `ON_UPDATE` FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` `kcu` INNER JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `rc`.`constraint_name` = `kcu`.`constraint_name` WHERE "+t.map((({TABLE_NAME:e,TABLE_SCHEMA:t})=>`(\`kcu\`.\`TABLE_SCHEMA\` = '${t}' AND \`kcu\`.\`TABLE_NAME\` = '${e}')`)).join(" OR "),[c,l,u,m,f]=await Promise.all([this.query(i),this.query(a),this.query("SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`"),this.query(s),this.query(o)]);return Promise.all(t.map((async e=>{const t=new _,r=u.find((t=>t.SCHEMA_NAME===e.TABLE_SCHEMA)),i=r.COLLATION,a=r.CHARSET,s=e.TABLE_SCHEMA===n?void 0:e.TABLE_SCHEMA;t.database=e.TABLE_SCHEMA,t.name=this.driver.buildTableName(e.TABLE_NAME,void 0,s),t.columns=c.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)).map((n=>{const r=m.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.COLUMN_NAME===n.COLUMN_NAME&&0===parseInt(t.NON_UNIQUE,10))),s=this.connection.entityMetadatas.find((e=>this.getTablePath(t)===this.getTablePath(e))),o=r.length>0&&s&&s.indices.some((e=>r.some((t=>e.name===t.INDEX_NAME&&!1===e.synchronize)))),c=r.every((e=>m.some((t=>t.INDEX_NAME===e.INDEX_NAME&&t.COLUMN_NAME!==n.COLUMN_NAME)))),u=new h;if(u.name=n.COLUMN_NAME,u.type=n.DATA_TYPE.toLowerCase(),-1!==this.driver.withWidthColumnTypes.indexOf(u.type)){const e=n.COLUMN_TYPE.substring(n.COLUMN_TYPE.indexOf("(")+1,n.COLUMN_TYPE.indexOf(")"));u.width=e&&!this.isDefaultColumnWidth(t,u,parseInt(e))?parseInt(e):void 0}if(null===n.COLUMN_DEFAULT||void 0===n.COLUMN_DEFAULT?u.default=void 0:u.default="CURRENT_TIMESTAMP"===n.COLUMN_DEFAULT?n.COLUMN_DEFAULT:`'${n.COLUMN_DEFAULT}'`,-1!==n.EXTRA.indexOf("on update")&&(u.onUpdate=n.EXTRA.substring(n.EXTRA.indexOf("on update")+10)),n.GENERATION_EXPRESSION&&(u.asExpression=n.GENERATION_EXPRESSION,u.generatedType=-1!==n.EXTRA.indexOf("VIRTUAL")?"VIRTUAL":"STORED"),u.isUnique=r.length>0&&!o&&!c,u.isNullable="YES"===n.IS_NULLABLE,u.isPrimary=l.some((e=>e.TABLE_NAME===n.TABLE_NAME&&e.TABLE_SCHEMA===n.TABLE_SCHEMA&&e.COLUMN_NAME===n.COLUMN_NAME)),u.zerofill=-1!==n.COLUMN_TYPE.indexOf("zerofill"),u.unsigned=!!u.zerofill||-1!==n.COLUMN_TYPE.indexOf("unsigned"),u.isGenerated=-1!==n.EXTRA.indexOf("auto_increment"),u.isGenerated&&(u.generationStrategy="increment"),u.comment="string"==typeof n.COLUMN_COMMENT&&0===n.COLUMN_COMMENT.length?void 0:n.COLUMN_COMMENT,n.CHARACTER_SET_NAME&&(u.charset=n.CHARACTER_SET_NAME===a?void 0:n.CHARACTER_SET_NAME),n.COLLATION_NAME&&(u.collation=n.COLLATION_NAME===i?void 0:n.COLLATION_NAME),-1!==this.driver.withLengthColumnTypes.indexOf(u.type)&&n.CHARACTER_MAXIMUM_LENGTH){const e=n.CHARACTER_MAXIMUM_LENGTH.toString();u.length=this.isDefaultColumnLength(t,u,e)?"":e}if("decimal"!==u.type&&"double"!==u.type&&"float"!==u.type||(null===n.NUMERIC_PRECISION||this.isDefaultColumnPrecision(t,u,n.NUMERIC_PRECISION)||(u.precision=parseInt(n.NUMERIC_PRECISION)),null===n.NUMERIC_SCALE||this.isDefaultColumnScale(t,u,n.NUMERIC_SCALE)||(u.scale=parseInt(n.NUMERIC_SCALE))),"enum"===u.type||"simple-enum"===u.type||"set"===u.type){const e=n.COLUMN_TYPE,t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(",");u.enum=t.map((e=>e.substring(1,e.length-1))),u.length=""}return"datetime"!==u.type&&"time"!==u.type&&"timestamp"!==u.type||null===n.DATETIME_PRECISION||void 0===n.DATETIME_PRECISION||this.isDefaultColumnPrecision(t,u,parseInt(n.DATETIME_PRECISION))||(u.precision=parseInt(n.DATETIME_PRECISION)),u}));const o=pe.s.uniq(f.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)),(e=>e.CONSTRAINT_NAME));t.foreignKeys=o.map((e=>{const t=f.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME)),r=e.REFERENCED_TABLE_SCHEMA===n?void 0:e.REFERENCED_TABLE_SCHEMA,i=this.driver.buildTableName(e.REFERENCED_TABLE_NAME,void 0,r);return new p({name:e.CONSTRAINT_NAME,columnNames:t.map((e=>e.COLUMN_NAME)),referencedDatabase:e.REFERENCED_TABLE_SCHEMA,referencedTableName:i,referencedColumnNames:t.map((e=>e.REFERENCED_COLUMN_NAME)),onDelete:e.ON_DELETE,onUpdate:e.ON_UPDATE})}));const y=pe.s.uniq(m.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.TABLE_SCHEMA===e.TABLE_SCHEMA)),(e=>e.INDEX_NAME));return t.indices=y.map((e=>{const n=m.filter((t=>t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME)),r=parseInt(e.NON_UNIQUE,10);return new d({table:t,name:e.INDEX_NAME,columnNames:n.map((e=>e.COLUMN_NAME)),isUnique:0===r,isSpatial:"SPATIAL"===e.INDEX_TYPE,isFulltext:"FULLTEXT"===e.INDEX_TYPE})})),t})))}createTableSql(e,t){const n=e.columns.map((e=>this.buildCreateColumnSql(e,!0))).join(", ");let r=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{const n=e.indices.some((e=>1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name))),r=e.uniques.some((e=>1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)));n||r||e.indices.push(new d({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((t=>{e.indices.some((e=>e.name===t.name))||e.indices.push(new d({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.indices.length>0){r+=`, ${e.indices.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where));let r="";return t.isUnique&&(r+="UNIQUE "),t.isSpatial&&(r+="SPATIAL "),t.isFulltext&&(r+="FULLTEXT "),`${r}INDEX \`${t.name}\` (${n})`})).join(", ")}`}if(e.foreignKeys.length>0&&t){r+=`, ${e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames));const r=t.referencedColumnNames.map((e=>`\`${e}\``)).join(", ");let i=`CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${r})`;return t.onDelete&&(i+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(i+=` ON UPDATE ${t.onUpdate}`),i})).join(", ")}`}if(e.primaryColumns.length>0){r+=`, PRIMARY KEY (${e.primaryColumns.map((e=>`\`${e.name}\``)).join(", ")})`}return r+=`) ENGINE=${e.engine||"InnoDB"}`,new ot(r)}dropTableSql(e){return new ot(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){return"string"==typeof e.expression?new ot(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression}`):new ot(`CREATE VIEW ${this.escapePath(e)} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const t=await this.getCurrentDatabase(),n="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:rt.VIEW,schema:t,name:e.name,value:n})}dropViewSql(e){return new ot(`DROP VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const t=await this.getCurrentDatabase(),n=w.a.isView(e)?e.name:e;return this.deleteTypeormMetadataSql({type:rt.VIEW,schema:t,name:n})}createIndexSql(e,t){const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");let r="";return t.isUnique&&(r+="UNIQUE "),t.isSpatial&&(r+="SPATIAL "),t.isFulltext&&(r+="FULLTEXT "),new ot(`CREATE ${r}INDEX \`${t.name}\` ON ${this.escapePath(e)} (${n})`)}dropIndexSql(e,t){let n=w.a.isTableIndex(t)?t.name:t;return new ot(`DROP INDEX \`${n}\` ON ${this.escapePath(e)}`)}createPrimaryKeySql(e,t){const n=t.map((e=>`\`${e}\``)).join(", ");return new ot(`ALTER TABLE ${this.escapePath(e)} ADD PRIMARY KEY (${n})`)}dropPrimaryKeySql(e){return new ot(`ALTER TABLE ${this.escapePath(e)} DROP PRIMARY KEY`)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>`\`${e}\``)).join(", "),r=t.referencedColumnNames.map((e=>`\`${e}\``)).join(",");let i=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))}(${r})`;return t.onDelete&&(i+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(i+=` ON UPDATE ${t.onUpdate}`),new ot(i)}dropForeignKeySql(e,t){const n=w.a.isTableForeignKey(t)?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP FOREIGN KEY \`${n}\``)}escapeComment(e){return e&&0!==e.length?`'${e=e.replace(/\\/g,"\\\\").replace(/'/g,"''").replace(/\u0000/g,"")}'`:"''"}escapePath(e){const{database:t,tableName:n}=this.driver.parseTableName(e);return t&&t!==this.driver.database?`\`${t}\`.\`${n}\``:`\`${n}\``}buildCreateColumnSql(e,t,n=!1){let r="";return r=n?this.connection.driver.createFullType(e):`\`${e.name}\` ${this.connection.driver.createFullType(e)}`,e.asExpression&&(r+=` AS (${e.asExpression}) ${e.generatedType?e.generatedType:"VIRTUAL"}`),e.zerofill?r+=" ZEROFILL":e.unsigned&&(r+=" UNSIGNED"),e.enum&&(r+=` (${e.enum.map((e=>"'"+e+"'")).join(", ")})`),e.charset&&(r+=` CHARACTER SET "${e.charset}"`),e.collation&&(r+=` COLLATE "${e.collation}"`),e.isNullable||(r+=" NOT NULL"),e.isNullable&&(r+=" NULL"),e.isPrimary&&!t&&(r+=" PRIMARY KEY"),e.isGenerated&&"increment"===e.generationStrategy&&(r+=" AUTO_INCREMENT"),e.comment&&(r+=` COMMENT ${this.escapeComment(e.comment)}`),void 0!==e.default&&null!==e.default&&(r+=` DEFAULT ${e.default}`),e.onUpdate&&(r+=` ON UPDATE ${e.onUpdate}`),r}isDefaultColumnWidth(e,t,n){if(this.connection.hasMetadata(e.name)){const n=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(n&&n.width)return!1}const r=this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].width;return!!r&&r===n}}var At=n(348834).Buffer;class Ct{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="nested",this.supportedDataTypes=["bit","int","integer","tinyint","smallint","mediumint","bigint","float","double","double precision","real","decimal","dec","numeric","fixed","bool","boolean","date","datetime","timestamp","time","year","char","nchar","national char","varchar","nvarchar","national varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","set","binary","varbinary","json","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.supportedUpsertType="on-duplicate-key-update",this.spatialTypes=["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.withLengthColumnTypes=["char","varchar","nvarchar","binary","varbinary"],this.withWidthColumnTypes=["bit","tinyint","smallint","mediumint","int","integer","bigint"],this.withPrecisionColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real","time","datetime","timestamp"],this.withScaleColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real"],this.unsignedAndZerofillTypes=["int","integer","smallint","tinyint","mediumint","bigint","decimal","dec","numeric","fixed","float","double","double precision","real"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",deleteDate:"datetime",deleteDatePrecision:6,deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255},"national varchar":{length:255},char:{length:1},binary:{length:1},varbinary:{length:255},decimal:{precision:10,scale:0},dec:{precision:10,scale:0},numeric:{precision:10,scale:0},fixed:{precision:10,scale:0},float:{precision:12},double:{precision:22},time:{precision:0},datetime:{precision:0},timestamp:{precision:0},bit:{width:1},int:{width:11},integer:{width:11},tinyint:{width:4},smallint:{width:6},mediumint:{width:9},bigint:{width:20}},this.maxAliasLength=63,this.cteCapabilities={enabled:!1},this.connection=e,this.options=e.options,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),this.database=R.z.buildDriverOptions(this.options).database}async connect(){if(!this.database){const e=await this.createQueryRunner("master");this.database=await e.getCurrentDatabase(),await e.release()}}afterConnect(){return Promise.resolve()}async disconnect(){}createSchemaBuilder(){return new tt(this.connection)}createQueryRunner(e){return new Nt(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions))}escapeQueryWithParameters(e,t,n){const r=Object.keys(n).map((e=>n[e]));return t&&Object.keys(t).length?[e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,i)=>{if(!t.hasOwnProperty(i))return e;let a=t[i];return n?a.map((e=>(r.push(e),this.createParameter(i,r.length-1)))).join(", "):"function"==typeof a?a():(r.push(a),this.createParameter(i,r.length-1))})),r]:[e,r]}escape(e){return"`"+e+"`"}buildTableName(e,t,n){let r=[e];return n&&r.unshift(n),r.join(".")}parseTableName(e){const t=this.database,n=void 0;if(w.a.isTable(e)||w.a.isView(e)){const r=this.parseTableName(e.name);return{database:e.database||r.database||t,schema:e.schema||r.schema||n,tableName:r.tableName}}if(w.a.isTableForeignKey(e)){const r=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||r.database||t,schema:e.referencedSchema||r.schema||n,tableName:r.tableName}}if(w.a.isEntityMetadata(e))return{database:e.database||t,schema:e.schema||n,tableName:e.tableName};const r=e.split(".");return{database:(r.length>1?r[0]:void 0)||t,schema:n,tableName:r.length>1?r[1]:r[0]}}preparePersistentValue(e,t){return t.transformer&&(e=me.A.transformTo(t.transformer,e)),this.options.formatOptions&&!1===this.options.formatOptions.castParameters?null==e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?de.mixedDateToDateString(e):"time"===t.type?de.mixedDateToTimeString(e):"json"===t.type?JSON.stringify(e):"timestamp"===t.type||"datetime"===t.type||t.type===Date?de.mixedDateToDate(e):"simple-array"===t.type||"set"===t.type?de.simpleArrayToString(e):"simple-json"===t.type?de.simpleJsonToString(e):"enum"===t.type||"simple-enum"===t.type?""+e:e:this.client.preparePersistentValue(e,t)}prepareHydratedValue(e,t){return null==e?t.transformer?me.A.transformFrom(t.transformer,e):e:this.options.formatOptions&&!1===this.options.formatOptions.castParameters?(t.type===Boolean||"bool"===t.type||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?e=de.normalizeHydratedDate(e):"date"===t.type?e=de.mixedDateToDateString(e):"json"===t.type?e="string"==typeof e?JSON.parse(e):e:"time"===t.type?e=de.mixedTimeToString(e):"simple-array"===t.type||"set"===t.type?e=de.stringToSimpleArray(e):"simple-json"===t.type?e=de.stringToSimpleJson(e):("enum"===t.type||"simple-enum"===t.type)&&t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),t.transformer&&(e=me.A.transformFrom(t.transformer,e)),e):this.client.prepareHydratedValue(e,t)}normalizeType(e){return e.type===Number||"integer"===e.type?"int":e.type===String?"varchar":e.type===Date?"datetime":e.type===At?"blob":e.type===Boolean?"tinyint":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"enum":"double precision"===e.type||"real"===e.type?"double":"dec"===e.type||"numeric"===e.type||"fixed"===e.type?"decimal":"bool"===e.type||"boolean"===e.type?"tinyint":"nvarchar"===e.type||"national varchar"===e.type?"varchar":"nchar"===e.type||"national char"===e.type?"char":e.type||""}normalizeDefault(e){const t=e.default;if(null!==t){if(("enum"===e.type||"simple-enum"===e.type)&&void 0!==t)return`'${t}'`;if("set"===e.type&&void 0!==t)return`'${de.simpleArrayToString(t)}'`;if("number"==typeof t)return`${t}`;if("boolean"==typeof t)return t?"1":"0";if("function"==typeof t)return t();if("string"==typeof t)return`'${t}'`;if(void 0!==t)return`${t}`}}normalizeIsUnique(e){return e.entityMetadata.indices.some((t=>t.isUnique&&1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case String:case"varchar":case"nvarchar":case"national varchar":case"varbinary":return"255";default:return""}}createFullType(e){let t=e.type;return this.getColumnLength(e)?t+=`(${this.getColumnLength(e)})`:e.width?t+=`(${e.width})`:null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=`(${e.precision},${e.scale})`:null!==e.precision&&void 0!==e.precision&&(t+=`(${e.precision})`),e.isArray&&(t+=" array"),t}obtainMasterConnection(){return new Promise(((e,t)=>{this.poolCluster?this.poolCluster.getConnection("MASTER",((n,r)=>{n?t(n):e(this.prepareDbConnection(r))})):this.pool?this.pool.getConnection(((n,r)=>{n?t(n):e(this.prepareDbConnection(r))})):t(new u.K_("Connection is not established with mysql database"))}))}obtainSlaveConnection(){return this.poolCluster?new Promise(((e,t)=>{this.poolCluster.getConnection("SLAVE*",((n,r)=>{n?t(n):e(this.prepareDbConnection(r))}))})):this.obtainMasterConnection()}createGeneratedMap(e,t,n){const r=e.generatedColumns.reduce(((e,r)=>{let i;return"increment"===r.generationStrategy&&t.insertId&&(i=t.insertId+n),pe.s.mergeDeep(e,r.createValueMap(i))}),{});return Object.keys(r).length>0?r:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;let r=t.length;return r||"uuid"!==t.generationStrategy||(r=this.getColumnLength(t)),n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==r||n.width!==t.width||n.precision!==t.precision||n.scale!==t.scale||n.zerofill!==t.zerofill||n.unsigned!==t.unsigned||n.asExpression!==t.asExpression||n.generatedType!==t.generatedType||n.comment!==this.escapeComment(t.comment)||!this.compareDefaultValues(this.normalizeDefault(t),n.default)||n.enum&&t.enum&&!pe.s.isArraysEqual(n.enum,t.enum.map((e=>e+"")))||n.onUpdate!==t.onUpdate||n.isPrimary!==t.isPrimary||n.isNullable!==t.isNullable||n.isUnique!==this.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&n.isGenerated!==t.isGenerated}))}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!0}createParameter(e,t){return"?"}loadDependencies(){const e=this.options.driver||a.load("typeorm-aurora-data-api-driver");this.DataApiDriver=e,this.DataApiDriver=this.DataApiDriver.default||this.DataApiDriver}createConnectionOptions(e,t){return t=Object.assign({},t,R.z.buildDriverOptions(t)),Object.assign({},{resourceArn:e.resourceArn,secretArn:e.secretArn,database:e.database,region:e.region,type:e.type},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})}async createPool(e){return{}}prepareDbConnection(e){const{logger:t}=this.connection;return 0===e.listeners("error").length&&e.on("error",(e=>t.log("warn",`MySQL connection raised an error. ${e}`))),e}compareDefaultValues(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t}escapeComment(e){return e?e=e.replace(/\u0000/g,""):e}}var xt=n(754881);class Mt extends lt{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.mode=t,this.broadcaster=new ht(this)}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((([e,t])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const n=e=>this.releasePostgresConnection(e);return this.releaseCallback=e=>{this.databaseConnection.removeListener("error",n),t(e)},this.databaseConnection.on("error",n),this.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((([e,t])=>{this.driver.connectedQueryRunners.push(this),this.databaseConnection=e;const n=e=>this.releasePostgresConnection(e);return this.releaseCallback=e=>{this.databaseConnection.removeListener("error",n),t(e)},this.databaseConnection.on("error",n),this.databaseConnection}))),this.databaseConnectionPromise)}async releasePostgresConnection(e){if(this.isReleased)return;this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0);const t=this.driver.connectedQueryRunners.indexOf(this);-1!==t&&this.driver.connectedQueryRunners.splice(t,1)}release(){return this.releasePostgresConnection()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?(await this.query("START TRANSACTION"),e&&await this.query("SET TRANSACTION ISOLATION LEVEL "+e)):await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("COMMIT"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.query("ROLLBACK"),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=await this.connect();this.driver.connection.logger.logQuery(e,t,this);try{const i=+new Date,a=await r.query(e,t),s=this.driver.options.maxQueryExecutionTime,o=+new Date-i;s&&o>s&&this.driver.connection.logger.logQuerySlow(o,e,t,this);const c=new dt;if(a){switch(a.hasOwnProperty("rows")&&(c.records=a.rows),a.hasOwnProperty("rowCount")&&(c.affected=a.rowCount),a.command){case"DELETE":case"UPDATE":c.raw=[a.rows,a.rowCount];break;default:c.raw=a.rows}if(!n)return c.raw}return c}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}async stream(e,t,n,r){const i=this.driver.loadStreamDependency();if(this.isReleased)throw new it.Y;const a=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const s=a.query(new i(e,t));return n&&s.on("end",n),r&&s.on("error",r),s}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){return!!(await this.query(`SELECT * FROM pg_database WHERE datname='${e}';`)).length}async getCurrentDatabase(){return(await this.query("SELECT * FROM current_database()"))[0].current_database}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){return(await this.query("SELECT * FROM current_schema()"))[0].current_schema}async hasTable(e){const t=this.driver.parseTableName(e);t.schema||(t.schema=await this.getCurrentSchema());const n=`SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '${t.schema}' AND "table_name" = '${t.tableName}'`;return!!(await this.query(n)).length}async hasColumn(e,t){const n=this.driver.parseTableName(e);n.schema||(n.schema=await this.getCurrentSchema());const r=`SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '${n.schema}' AND "table_name" = '${n.tableName}' AND "column_name" = '${t}'`;return!!(await this.query(r)).length}async createDatabase(e,t){if(t){if(await this.hasDatabase(e))return Promise.resolve()}const n=`CREATE DATABASE "${e}"`,r=`DROP DATABASE "${e}"`;await this.executeQueries(new ot(n),new ot(r))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,r=`CREATE DATABASE "${e}"`;await this.executeQueries(new ot(n),new ot(r))}async createSchema(e,t){const n=-1===e.indexOf(".")?e:e.split(".")[1],r=t?`CREATE SCHEMA IF NOT EXISTS "${n}"`:`CREATE SCHEMA "${n}"`,i=`DROP SCHEMA "${n}" CASCADE`;await this.executeQueries(new ot(r),new ot(i))}async dropSchema(e,t,n){const r=-1===e.indexOf(".")?e:e.split(".")[1],i=t?`DROP SCHEMA IF EXISTS "${r}" ${n?"CASCADE":""}`:`DROP SCHEMA "${r}" ${n?"CASCADE":""}`,a=`CREATE SCHEMA "${r}"`;await this.executeQueries(new ot(i),new ot(a))}async createTable(e,t=!1,n=!0,r=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const i=[],a=[],s=e.columns.filter((e=>"enum"===e.type||"simple-enum"===e.type)),o=[];for(const t of s){const n=await this.hasEnumType(e,t),r=this.buildEnumName(e,t);n||-1!==o.indexOf(r)||(o.push(r),i.push(this.createEnumTypeSql(e,t,r)),a.push(this.dropEnumTypeSql(e,t,r)))}const c=e.columns.filter((e=>"STORED"===e.generatedType&&e.asExpression));for(const t of c){const n=(await this.getTableNameWithSchema(e.name)).split("."),r=n[1],s=n[0],o=this.insertTypeormMetadataSql({database:this.driver.database,schema:s,table:r,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),c=this.deleteTypeormMetadataSql({database:this.driver.database,schema:s,table:r,type:rt.GENERATED_COLUMN,name:t.name});i.push(o),a.push(c)}i.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((t=>a.push(this.dropForeignKeySql(e,t)))),r&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),i.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(e,t))})),await this.executeQueries(i,a)}async dropTable(e,t,n=!0,r=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const i=n,a=this.getTablePath(e),s=await this.getCachedTable(a),o=[],c=[];r&&s.indices.forEach((e=>{o.push(this.dropIndexSql(s,e)),c.push(this.createIndexSql(s,e))})),n&&s.foreignKeys.forEach((e=>o.push(this.dropForeignKeySql(s,e)))),o.push(this.dropTableSql(s)),c.push(this.createTableSql(s,i));const l=s.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of l){const t=(await this.getTableNameWithSchema(s.name)).split("."),n=t[1],r=t[0],i=this.deleteTypeormMetadataSql({database:this.driver.database,schema:r,table:n,type:rt.GENERATED_COLUMN,name:e.name}),a=this.insertTypeormMetadataSql({database:this.driver.database,schema:r,table:n,type:rt.GENERATED_COLUMN,name:e.name,value:e.asExpression});o.push(i),c.push(a)}await this.executeQueries(o,c)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=w.a.isView(e)?e.name:e,n=await this.getCachedView(t),r=[],i=[];r.push(await this.deleteViewDefinitionSql(n)),r.push(this.dropViewSql(n)),i.push(await this.insertViewDefinitionSql(n)),i.push(this.createViewSql(n)),await this.executeQueries(r,i)}async renameTable(e,t){const n=[],r=[],i=w.a.isTable(e)?e:await this.getCachedTable(e),a=i.clone(),{schema:s,tableName:o}=this.driver.parseTableName(i);if(a.name=s?`${s}.${t}`:t,n.push(new ot(`ALTER TABLE ${this.escapePath(i)} RENAME TO "${t}"`)),r.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME TO "${o}"`)),a.primaryColumns.length>0&&!a.primaryColumns[0].primaryKeyConstraintName){const e=a.primaryColumns.map((e=>e.name)),t=this.connection.namingStrategy.primaryKeyName(i,e),s=this.connection.namingStrategy.primaryKeyName(a,e);n.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${t}" TO "${s}"`)),r.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${t}"`))}a.columns.map((e=>{if(e.isGenerated&&"increment"===e.generationStrategy){const t=this.buildSequencePath(i,e.name),s=this.buildSequenceName(i,e.name),o=this.buildSequencePath(a,e.name),c=this.buildSequenceName(a,e.name),l=`ALTER SEQUENCE ${this.escapePath(t)} RENAME TO "${c}"`,u=`ALTER SEQUENCE ${this.escapePath(o)} RENAME TO "${s}"`;n.push(new ot(l)),r.push(new ot(u))}})),a.uniques.forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(i,e.columnNames);if(e.name!==t)return;const s=this.connection.namingStrategy.uniqueConstraintName(a,e.columnNames);n.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${e.name}" TO "${s}"`)),r.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${e.name}"`)),e.name=s})),a.indices.forEach((e=>{const t=this.connection.namingStrategy.indexName(i,e.columnNames,e.where);if(e.name!==t)return;const{schema:s}=this.driver.parseTableName(a),o=this.connection.namingStrategy.indexName(a,e.columnNames,e.where),c=s?`ALTER INDEX "${s}"."${e.name}" RENAME TO "${o}"`:`ALTER INDEX "${e.name}" RENAME TO "${o}"`,l=s?`ALTER INDEX "${s}"."${o}" RENAME TO "${e.name}"`:`ALTER INDEX "${o}" RENAME TO "${e.name}"`;n.push(new ot(c)),r.push(new ot(l)),e.name=o})),a.foreignKeys.forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(i,e.columnNames,this.getTablePath(e),e.referencedColumnNames);if(e.name!==t)return;const s=this.connection.namingStrategy.foreignKeyName(a,e.columnNames,this.getTablePath(e),e.referencedColumnNames);n.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${e.name}" TO "${s}"`)),r.push(new ot(`ALTER TABLE ${this.escapePath(a)} RENAME CONSTRAINT "${s}" TO "${e.name}"`)),e.name=s}));const c=a.columns.filter((e=>"enum"===e.type||"simple-enum"===e.type));for(let e of c){if(e.enumName)continue;const t=await this.getUserDefinedTypeName(i,e);n.push(new ot(`ALTER TYPE "${t.schema}"."${t.name}" RENAME TO ${this.buildEnumName(a,e,!1)}`)),r.push(new ot(`ALTER TYPE ${this.buildEnumName(a,e)} RENAME TO "${t.name}"`))}await this.executeQueries(n,r)}async addColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone(),i=[],a=[];if("enum"===t.type||"simple-enum"===t.type){await this.hasEnumType(n,t)||(i.push(this.createEnumTypeSql(n,t)),a.push(this.dropEnumTypeSql(n,t)))}if(i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(n,t)}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN "${t.name}"`)),t.isPrimary){const e=r.primaryColumns;if(e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,e.map((e=>e.name))),s=e.map((e=>`"${e.name}"`)).join(", ");i.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${t}"`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${t}" PRIMARY KEY (${s})`))}e.push(t);const s=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,e.map((e=>e.name))),o=e.map((e=>`"${e.name}"`)).join(", ");i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${s}" PRIMARY KEY (${o})`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${s}"`))}const s=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(s&&(i.push(this.createIndexSql(n,s)),a.push(this.dropIndexSql(n,s))),t.isUnique){const e=new f({name:this.connection.namingStrategy.uniqueConstraintName(n,[t.name]),columnNames:[t.name]});r.uniques.push(e),i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${e.name}" UNIQUE ("${t.name}")`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${e.name}"`))}if("STORED"===t.generatedType&&t.asExpression){const e=(await this.getTableNameWithSchema(n.name)).split("."),r=e[1],s=e[0],o=this.insertTypeormMetadataSql({database:this.driver.database,schema:s,table:r,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),c=this.deleteTypeormMetadataSql({database:this.driver.database,schema:s,table:r,type:rt.GENERATED_COLUMN,name:t.name});i.push(o),a.push(c)}t.comment&&(i.push(new ot(`COMMENT ON COLUMN ${this.escapePath(n)}."${t.name}" IS ${this.escapeComment(t.comment)}`)),a.push(new ot(`COMMENT ON COLUMN ${this.escapePath(n)}."${t.name}" IS ${this.escapeComment(t.comment)}`))),await this.executeQueries(i,a),r.addColumn(t),this.replaceCachedTable(n,r)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e),i=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!i)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);let a;return w.a.isTableColumn(n)?a=n:(a=i.clone(),a.name=n),this.changeColumn(r,i,a)}async changeColumn(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e);let i=r.clone();const a=[],s=[];let o=!1;const c=w.a.isTableColumn(t)?t:r.columns.find((e=>e.name===t));if(!c)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);if(c.type!==n.type||c.length!==n.length||n.isArray!==c.isArray||!c.generatedType&&"STORED"===n.generatedType||c.asExpression!==n.asExpression&&"STORED"===n.generatedType)await this.dropColumn(r,c),await this.addColumn(r,n),i=r.clone();else{if(c.name!==n.name){if(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME COLUMN "${c.name}" TO "${n.name}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME COLUMN "${n.name}" TO "${c.name}"`)),"enum"===c.type||"simple-enum"===c.type){const e=await this.getUserDefinedTypeName(r,c);a.push(new ot(`ALTER TYPE "${e.schema}"."${e.name}" RENAME TO ${this.buildEnumName(r,n,!1)}`)),s.push(new ot(`ALTER TYPE ${this.buildEnumName(r,n)} RENAME TO "${e.name}"`))}if(!0===c.isPrimary&&!c.primaryKeyConstraintName){const e=i.primaryColumns.map((e=>e.name)),t=this.connection.namingStrategy.primaryKeyName(i,e);e.splice(e.indexOf(c.name),1),e.push(n.name);const o=this.connection.namingStrategy.primaryKeyName(i,e);a.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${t}" TO "${o}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${o}" TO "${t}"`))}if(!0===c.isGenerated&&"increment"===n.generationStrategy){const e=this.buildSequencePath(r,c.name),t=this.buildSequenceName(r,c.name),i=this.buildSequencePath(r,n.name),o=this.buildSequenceName(r,n.name),l=`ALTER SEQUENCE ${this.escapePath(e)} RENAME TO "${o}"`,u=`ALTER SEQUENCE ${this.escapePath(i)} RENAME TO "${t}"`;a.push(new ot(l)),s.push(new ot(u))}i.findColumnUniques(c).forEach((e=>{const t=this.connection.namingStrategy.uniqueConstraintName(i,e.columnNames);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const o=this.connection.namingStrategy.uniqueConstraintName(i,e.columnNames);a.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${e.name}" TO "${o}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${o}" TO "${e.name}"`)),e.name=o})),i.findColumnIndices(c).forEach((e=>{const t=this.connection.namingStrategy.indexName(i,e.columnNames,e.where);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const{schema:o}=this.driver.parseTableName(r),l=this.connection.namingStrategy.indexName(i,e.columnNames,e.where),u=o?`ALTER INDEX "${o}"."${e.name}" RENAME TO "${l}"`:`ALTER INDEX "${e.name}" RENAME TO "${l}"`,h=o?`ALTER INDEX "${o}"."${l}" RENAME TO "${e.name}"`:`ALTER INDEX "${l}" RENAME TO "${e.name}"`;a.push(new ot(u)),s.push(new ot(h)),e.name=l})),i.findColumnForeignKeys(c).forEach((e=>{const t=this.connection.namingStrategy.foreignKeyName(i,e.columnNames,this.getTablePath(e),e.referencedColumnNames);if(e.name!==t)return;e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);const o=this.connection.namingStrategy.foreignKeyName(i,e.columnNames,this.getTablePath(e),e.referencedColumnNames);a.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${e.name}" TO "${o}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME CONSTRAINT "${o}" TO "${e.name}"`)),e.name=o}));const e=i.columns.find((e=>e.name===c.name));i.columns[i.columns.indexOf(e)].name=n.name,c.name=n.name}if(n.precision===c.precision&&n.scale===c.scale||(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(c)}`))),!("enum"!==n.type&&"simple-enum"!==n.type||"enum"!==c.type&&"simple-enum"!==c.type||pe.s.isArraysEqual(n.enum,c.enum)&&n.enumName===c.enumName)){const e=n.isArray?"[]":"",t=this.buildEnumName(r,n),i=this.buildEnumName(r,c),l=this.buildEnumName(r,c,!1),u=this.buildEnumName(r,c,!0,!1,!0),h=this.buildEnumName(r,c,!1,!1,!0);a.push(new ot(`ALTER TYPE ${i} RENAME TO ${h}`)),s.push(new ot(`ALTER TYPE ${u} RENAME TO ${l}`)),a.push(this.createEnumTypeSql(r,n,t)),s.push(this.dropEnumTypeSql(r,n,t)),null!==c.default&&void 0!==c.default&&(o=!0,a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" SET DEFAULT ${c.default}`)));const d=`${t}${e} USING "${n.name}"::"text"::${t}${e}`,p=`${u}${e} USING "${n.name}"::"text"::${u}${e}`;a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${d}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${p}`)),null!==n.default&&void 0!==n.default&&(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${n.default}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`))),a.push(this.dropEnumTypeSql(r,c,u)),s.push(this.createEnumTypeSql(r,c,u))}if(c.isNullable!==n.isNullable&&(n.isNullable?(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" DROP NOT NULL`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" SET NOT NULL`))):(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" SET NOT NULL`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" DROP NOT NULL`)))),c.comment!==n.comment&&(a.push(new ot(`COMMENT ON COLUMN ${this.escapePath(r)}."${c.name}" IS ${this.escapeComment(n.comment)}`)),s.push(new ot(`COMMENT ON COLUMN ${this.escapePath(r)}."${n.name}" IS ${this.escapeComment(c.comment)}`))),n.isPrimary!==c.isPrimary){const e=i.primaryColumns;if(e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,e.map((e=>e.name))),n=e.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${t}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${t}" PRIMARY KEY (${n})`))}if(!0===n.isPrimary){e.push(n);i.columns.find((e=>e.name===n.name)).isPrimary=!0;const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,e.map((e=>e.name))),o=e.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${t}" PRIMARY KEY (${o})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${t}"`))}else{const t=e.find((e=>e.name===n.name));e.splice(e.indexOf(t),1);if(i.columns.find((e=>e.name===n.name)).isPrimary=!1,e.length>0){const t=e[0].primaryKeyConstraintName?e[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,e.map((e=>e.name))),n=e.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${t}" PRIMARY KEY (${n})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${t}"`))}}}if(n.isUnique!==c.isUnique)if(!0===n.isUnique){const e=new f({name:this.connection.namingStrategy.uniqueConstraintName(r,[n.name]),columnNames:[n.name]});i.uniques.push(e),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${e.name}" UNIQUE ("${n.name}")`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${e.name}"`))}else{const e=i.uniques.find((e=>1===e.columnNames.length&&!!e.columnNames.find((e=>e===n.name))));i.uniques.splice(i.uniques.indexOf(e),1),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP CONSTRAINT "${e.name}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD CONSTRAINT "${e.name}" UNIQUE ("${n.name}")`))}if(c.isGenerated!==n.isGenerated&&(c.isGenerated&&("uuid"===c.generationStrategy?(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${c.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):"increment"===c.generationStrategy&&(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(r,n))}')`)),a.push(new ot(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(r,n))}`)),s.push(new ot(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(r,n))} OWNED BY ${this.escapePath(r)}."${n.name}"`)))),"uuid"===n.generationStrategy?!0===n.isGenerated?(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${this.driver.uuidGenerator}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${this.driver.uuidGenerator}`))):"increment"===n.generationStrategy&&(!0===n.isGenerated?(a.push(new ot(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(r,n))} OWNED BY ${this.escapePath(r)}."${n.name}"`)),s.push(new ot(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(r,n))}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(r,n))}')`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT nextval('${this.escapePath(this.buildSequencePath(r,n))}')`)),a.push(new ot(`DROP SEQUENCE ${this.escapePath(this.buildSequencePath(r,n))}`)),s.push(new ot(`CREATE SEQUENCE IF NOT EXISTS ${this.escapePath(this.buildSequencePath(r,n))} OWNED BY ${this.escapePath(r)}."${n.name}"`))))),n.default===c.default||o||(null!==n.default&&void 0!==n.default?(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${n.default}`)),null!==c.default&&void 0!==c.default?s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${c.default}`)):s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`))):null!==c.default&&void 0!==c.default&&(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" DROP DEFAULT`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" SET DEFAULT ${c.default}`)))),(n.spatialFeatureType||"").toLowerCase()===(c.spatialFeatureType||"").toLowerCase()&&n.srid===c.srid||(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(c)}`))),n.generatedType!==c.generatedType&&(!n.generatedType||"VIRTUAL"===n.generatedType)){const e=(await this.getTableNameWithSchema(r.name)).split("."),t=e[1],i=e[0];a.push(new ot(`ALTER TABLE ${this.escapePath(r)} RENAME COLUMN "${c.name}" TO "TEMP_OLD_${c.name}"`)),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD ${this.buildCreateColumnSql(r,n)}`)),a.push(new ot(`UPDATE ${this.escapePath(r)} SET "${n.name}" = "TEMP_OLD_${c.name}"`)),a.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP COLUMN "TEMP_OLD_${c.name}"`)),a.push(this.deleteTypeormMetadataSql({database:this.driver.database,schema:i,table:t,type:rt.GENERATED_COLUMN,name:c.name})),s.push(this.insertTypeormMetadataSql({database:this.driver.database,schema:i,table:t,type:rt.GENERATED_COLUMN,name:c.name,value:c.asExpression})),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ADD ${this.buildCreateColumnSql(r,c)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} DROP COLUMN "${n.name}"`))}}await this.executeQueries(a,s),this.replaceCachedTable(r,i)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:r}of t)await this.changeColumn(e,n,r)}async dropColumn(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableColumn(t)?t:n.findColumnByName(t);if(!r)throw new u.K_(`Column "${t}" was not found in table "${n.name}"`);const i=n.clone(),a=[],s=[];if(r.isPrimary){const e=r.primaryKeyConstraintName?r.primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,i.primaryColumns.map((e=>e.name))),t=i.primaryColumns.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${e}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`));if(i.findColumnByName(r.name).isPrimary=!1,i.primaryColumns.length>0){const e=i.primaryColumns[0].primaryKeyConstraintName?i.primaryColumns[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(i,i.primaryColumns.map((e=>e.name))),t=i.primaryColumns.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(i)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(i)} DROP CONSTRAINT "${e}"`))}}const o=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===r.name));o&&(i.indices.splice(i.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o)));const c=i.checks.find((e=>!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===r.name));c&&(i.checks.splice(i.checks.indexOf(c),1),a.push(this.dropCheckConstraintSql(n,c)),s.push(this.createCheckConstraintSql(n,c)));const l=i.uniques.find((e=>1===e.columnNames.length&&e.columnNames[0]===r.name));if(l&&(i.uniques.splice(i.uniques.indexOf(l),1),a.push(this.dropUniqueConstraintSql(n,l)),s.push(this.createUniqueConstraintSql(n,l))),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN "${r.name}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(n,r)}`)),"enum"===r.type||"simple-enum"===r.type){if(await this.hasEnumType(n,r)){const e=await this.getUserDefinedTypeName(n,r),t=`"${e.schema}"."${e.name}"`;a.push(this.dropEnumTypeSql(n,r,t)),s.push(this.createEnumTypeSql(n,r,t))}}if("STORED"===r.generatedType){const e=(await this.getTableNameWithSchema(n.name)).split("."),t=e[1],i=e[0],o=this.deleteTypeormMetadataSql({database:this.driver.database,schema:i,table:t,type:rt.GENERATED_COLUMN,name:r.name}),c=this.insertTypeormMetadataSql({database:this.driver.database,schema:i,table:t,type:rt.GENERATED_COLUMN,name:r.name,value:r.asExpression});a.push(o),s.push(c)}await this.executeQueries(a,s),i.removeColumn(r),this.replaceCachedTable(n,i)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t,n){const r=w.a.isTable(e)?e:await this.getCachedTable(e),i=r.clone(),a=this.createPrimaryKeySql(r,t,n);i.columns.forEach((e=>{t.find((t=>t===e.name))&&(e.isPrimary=!0)}));const s=this.dropPrimaryKeySql(i);await this.executeQueries(a,s),this.replaceCachedTable(r,i)}async updatePrimaryKeys(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=n.clone(),i=t.map((e=>e.name)),a=[],s=[],o=r.primaryColumns;if(o.length>0){const e=o[0].primaryKeyConstraintName?o[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,o.map((e=>e.name))),t=o.map((e=>`"${e.name}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${e}"`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${e}" PRIMARY KEY (${t})`))}r.columns.filter((e=>-1!==i.indexOf(e.name))).forEach((e=>e.isPrimary=!0));const c=o[0].primaryKeyConstraintName?o[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(r,i),l=i.map((e=>`"${e}"`)).join(", ");a.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD CONSTRAINT "${c}" PRIMARY KEY (${l})`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP CONSTRAINT "${c}"`)),await this.executeQueries(a,s),this.replaceCachedTable(n,r)}async dropPrimaryKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=this.dropPrimaryKeySql(n),i=this.createPrimaryKeySql(n,n.primaryColumns.map((e=>e.name)),t);await this.executeQueries(r,i),n.primaryColumns.forEach((e=>{e.isPrimary=!1}))}async createUniqueConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n,t.columnNames));const r=this.createUniqueConstraintSql(n,t),i=this.dropUniqueConstraintSql(n,t);await this.executeQueries(r,i),n.addUniqueConstraint(t)}async createUniqueConstraints(e,t){for(const n of t)await this.createUniqueConstraint(e,n)}async dropUniqueConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableUnique(t)?t:n.uniques.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied unique constraint was not found in table ${n.name}`);const i=this.dropUniqueConstraintSql(n,r),a=this.createUniqueConstraintSql(n,r);await this.executeQueries(i,a),n.removeUniqueConstraint(r)}async dropUniqueConstraints(e,t){for(const n of t)await this.dropUniqueConstraint(e,n)}async createCheckConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n,t.expression));const r=this.createCheckConstraintSql(n,t),i=this.dropCheckConstraintSql(n,t);await this.executeQueries(r,i),n.addCheckConstraint(t)}async createCheckConstraints(e,t){const n=t.map((t=>this.createCheckConstraint(e,t)));await Promise.all(n)}async dropCheckConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableCheck(t)?t:n.checks.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied check constraint was not found in table ${n.name}`);const i=this.dropCheckConstraintSql(n,r),a=this.createCheckConstraintSql(n,r);await this.executeQueries(i,a),n.removeCheckConstraint(r)}async dropCheckConstraints(e,t){const n=t.map((t=>this.dropCheckConstraint(e,t)));await Promise.all(n)}async createExclusionConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.exclusionConstraintName(n,t.expression));const r=this.createExclusionConstraintSql(n,t),i=this.dropExclusionConstraintSql(n,t);await this.executeQueries(r,i),n.addExclusionConstraint(t)}async createExclusionConstraints(e,t){const n=t.map((t=>this.createExclusionConstraint(e,t)));await Promise.all(n)}async dropExclusionConstraint(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableExclusion(t)?t:n.exclusions.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied exclusion constraint was not found in table ${n.name}`);const i=this.dropExclusionConstraintSql(n,r),a=this.createExclusionConstraintSql(n,r);await this.executeQueries(i,a),n.removeExclusionConstraint(r)}async dropExclusionConstraints(e,t){const n=t.map((t=>this.dropExclusionConstraint(e,t)));await Promise.all(n)}async createForeignKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const r=this.createForeignKeySql(n,t),i=this.dropForeignKeySql(n,t);await this.executeQueries(r,i),n.addForeignKey(t)}async createForeignKeys(e,t){for(const n of t)await this.createForeignKey(e,n)}async dropForeignKey(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableForeignKey(t)?t:n.foreignKeys.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied foreign key was not found in table ${n.name}`);const i=this.dropForeignKeySql(n,r),a=this.createForeignKeySql(n,r);await this.executeQueries(i,a),n.removeForeignKey(r)}async dropForeignKeys(e,t){for(const n of t)await this.dropForeignKey(e,n)}async createIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const r=this.createIndexSql(n,t),i=this.dropIndexSql(n,t);await this.executeQueries(r,i),n.addIndex(t)}async createIndices(e,t){for(const n of t)await this.createIndex(e,n)}async dropIndex(e,t){const n=w.a.isTable(e)?e:await this.getCachedTable(e),r=w.a.isTableIndex(t)?t:n.indices.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied index ${t} was not found in table ${n.name}`);r.name||(r.name=this.generateIndexName(n,r));const i=this.dropIndexSql(n,r),a=this.createIndexSql(n,r);await this.executeQueries(i,a),n.removeIndex(r)}async dropIndices(e,t){for(const n of t)await this.dropIndex(e,n)}async clearTable(e){await this.query(`TRUNCATE TABLE ${this.escapePath(e)}`)}async clearDatabase(){const e=[];this.connection.entityMetadatas.filter((e=>e.schema)).forEach((t=>{!!e.find((e=>e===t.schema))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema()");const t=e.map((e=>"current_schema()"===e?e:"'"+e+"'")).join(", "),n=this.isTransactionActive;n||await this.startTransaction();try{const e=await this.getVersion(),r=`SELECT 'DROP VIEW IF EXISTS "' || schemaname || '"."' || viewname || '" CASCADE;' as "query" FROM "pg_views" WHERE "schemaname" IN (${t}) AND "viewname" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')`,i=await this.query(r);if(await Promise.all(i.map((e=>this.query(e.query)))),xt.m.isGreaterOrEqual(e,"9.3")){const e=`SELECT 'DROP MATERIALIZED VIEW IF EXISTS "' || schemaname || '"."' || matviewname || '" CASCADE;' as "query" FROM "pg_matviews" WHERE "schemaname" IN (${t})`,n=await this.query(e);await Promise.all(n.map((e=>this.query(e.query))))}const a=`SELECT 'DROP TABLE IF EXISTS "' || schemaname || '"."' || tablename || '" CASCADE;' as "query" FROM "pg_tables" WHERE "schemaname" IN (${t}) AND "tablename" NOT IN ('spatial_ref_sys')`,s=await this.query(a);await Promise.all(s.map((e=>this.query(e.query)))),await this.dropEnumTypes(t),n||await this.commitTransaction()}catch(e){try{n||await this.rollbackTransaction()}catch(e){}throw e}}async loadViews(e){if(!await this.hasTable(this.getTypeormMetadataTableName()))return[];e||(e=[]);const t=await this.getCurrentDatabase(),n=await this.getCurrentSchema(),r=0===e.length?"1=1":e.map((e=>this.driver.parseTableName(e))).map((({schema:e,tableName:t})=>(e||(e=this.driver.options.schema||n),`("t"."schema" = '${e}' AND "t"."name" = '${t}')`))).join(" OR "),i=`SELECT "t".* FROM ${this.escapePath(this.getTypeormMetadataTableName())} "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN ('${rt.VIEW}', '${rt.MATERIALIZED_VIEW}') ${r?`AND (${r})`:""}`;return(await this.query(i)).map((e=>{const r=new Ze,i=e.schema!==n||this.driver.options.schema?e.schema:void 0;return r.database=t,r.schema=e.schema,r.name=this.driver.buildTableName(e.name,i),r.expression=e.value,r.materialized=e.type===rt.MATERIALIZED_VIEW,r}))}async loadTables(e){if(e&&0===e.length)return[];const t=await this.getCurrentSchema(),n=await this.getCurrentDatabase(),r=[];if(e){const n='SELECT "table_schema", "table_name" FROM "information_schema"."tables" WHERE '+e.map((e=>this.driver.parseTableName(e))).map((({schema:e,tableName:n})=>`("table_schema" = '${e||t}' AND "table_name" = '${n}')`)).join(" OR ");r.push(...await this.query(n))}else{const e='SELECT "table_schema", "table_name" FROM "information_schema"."tables"';r.push(...await this.query(e))}if(0===r.length)return[];const i='SELECT columns.*, pg_catalog.col_description((\'"\' || table_catalog || \'"."\' || table_schema || \'"."\' || table_name || \'"\')::regclass::oid, ordinal_position) AS description, (\'"\' || "udt_schema" || \'"."\' || "udt_name" || \'"\')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE '+r.map((({table_schema:e,table_name:t})=>`("table_schema" = '${e}' AND "table_name" = '${t}')`)).join(" OR "),a=r.map((({table_schema:e,table_name:t})=>`("ns"."nspname" = '${e}' AND "t"."relname" = '${t}')`)).join(" OR "),s=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN 'p' THEN 'PRIMARY' WHEN 'u' THEN 'UNIQUE' WHEN 'c' THEN 'CHECK' WHEN 'x' THEN 'EXCLUDE' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN ('r', 'p') AND (${a})`,o=`SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN 't' THEN 'TRUE' ELSE'FALSE' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN ('r', 'p') AND "cnst"."contype" IS NULL AND (${a})`,c=`SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN 'INITIALLY DEFERRED' ELSE 'INITIALLY IMMEDIATE' END as condeferred, CASE "con1"."confdeltype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confdeltype", CASE "con1"."confupdtype" WHEN 'a' THEN 'NO ACTION' WHEN 'r' THEN 'RESTRICT' WHEN 'c' THEN 'CASCADE' WHEN 'n' THEN 'SET NULL' WHEN 'd' THEN 'SET DEFAULT' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = 'f' AND (${r.map((({table_schema:e,table_name:t})=>`("ns"."nspname" = '${e}' AND "cl"."relname" = '${t}')`)).join(" OR ")}) ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" ${await this.hasSupportForPartitionedTables()?' AND "cl"."relispartition" = \'f\'':""}INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"`,[l,u,m,b]=await Promise.all([this.query(i),this.query(s),this.query(o),this.query(c)]);return Promise.all(r.map((async e=>{const r=new _,i=(e,n)=>e[n]!==t||this.driver.options.schema&&this.driver.options.schema!==t?e[n]:void 0,a=i(e,"table_schema");r.database=n,r.schema=e.table_schema,r.name=this.driver.buildTableName(e.table_name,a),r.columns=await Promise.all(l.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)).map((async t=>{const i=u.filter((e=>e.table_name===t.table_name&&e.table_schema===t.table_schema&&e.column_name===t.column_name)),a=new h;if(a.name=t.column_name,a.type=t.regtype.toLowerCase(),"numeric"!==a.type&&"decimal"!==a.type&&"float"!==a.type||(null===t.numeric_precision||this.isDefaultColumnPrecision(r,a,t.numeric_precision)?null===t.numeric_scale||this.isDefaultColumnScale(r,a,t.numeric_scale)||(a.precision=void 0):a.precision=t.numeric_precision,null===t.numeric_scale||this.isDefaultColumnScale(r,a,t.numeric_scale)?null===t.numeric_precision||this.isDefaultColumnPrecision(r,a,t.numeric_precision)||(a.scale=void 0):a.scale=t.numeric_scale),"interval"!==a.type&&"time without time zone"!==a.type&&"time with time zone"!==a.type&&"timestamp without time zone"!==a.type&&"timestamp with time zone"!==a.type||(a.precision=this.isDefaultColumnPrecision(r,a,t.datetime_precision)?void 0:t.datetime_precision),"USER-DEFINED"===t.data_type||"ARRAY"===t.data_type){const{name:n}=await this.getUserDefinedTypeName(r,a),i=this.buildEnumName(r,a,!1,!0)!==n?n:void 0,s=`SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${e.table_schema}' AND "t"."typname" = '${i||n}'`,o=await this.query(s);if(o.length&&(a.type="enum",a.enum=o.map((e=>e.value)),a.enumName=i),"ARRAY"===t.data_type){a.isArray=!0;const e=a.type.replace("[]","");a.type=this.connection.driver.normalizeType({type:e})}}if("geometry"===a.type){const e=`SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geometry_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geometry_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = '${t.column_name}' AND\n                          "table_schema" = '${t.table_schema}' AND\n                          "table_name" = '${t.table_name}'`,n=await this.query(e);n.length>0&&(a.spatialFeatureType=n[0].type,a.srid=n[0].srid)}if("geography"===a.type){const e=`SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geography_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geography_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = '${t.column_name}' AND\n                          "table_schema" = '${t.table_schema}' AND\n                          "table_name" = '${t.table_name}'`,n=await this.query(e);n.length>0&&(a.spatialFeatureType=n[0].type,a.srid=n[0].srid)}if(-1!==this.driver.withLengthColumnTypes.indexOf(a.type)){let e;if(a.isArray){const n=/\((\d+)\)/.exec(t.format_type);e=n?n[1]:void 0}else t.character_maximum_length&&(e=t.character_maximum_length.toString());e&&(a.length=this.isDefaultColumnLength(r,a,e)?"":e)}a.isNullable="YES"===t.is_nullable;const s=i.find((e=>"PRIMARY"===e.constraint_type));if(s){a.isPrimary=!0;const e=u.filter((e=>e.table_name===t.table_name&&e.table_schema===t.table_schema&&e.column_name!==t.column_name&&"PRIMARY"===e.constraint_type)).map((e=>e.column_name));e.push(t.column_name);const n=this.connection.namingStrategy.primaryKeyName(r,e);s.constraint_name!==n&&(a.primaryKeyConstraintName=s.constraint_name)}const o=i.filter((e=>"UNIQUE"===e.constraint_type)),c=o.every((e=>u.some((n=>"UNIQUE"===n.constraint_type&&n.constraint_name===e.constraint_name&&n.column_name!==t.column_name))));if(a.isUnique=o.length>0&&!c,"YES"===t.is_identity)a.isGenerated=!0,a.generationStrategy="identity",a.generatedIdentity=t.identity_generation;else if(null!==t.column_default&&void 0!==t.column_default){const e=`nextval('${this.buildSequenceName(r,t.column_name)}'::regclass)`,n=`nextval('${this.buildSequencePath(r,t.column_name)}'::regclass)`,i=t.column_default.replace(/"/g,"");i===e||i===n?(a.isGenerated=!0,a.generationStrategy="increment"):"gen_random_uuid()"===t.column_default||/^uuid_generate_v\d\(\)/.test(t.column_default)?"uuid"===a.type?(a.isGenerated=!0,a.generationStrategy="uuid"):a.default=t.column_default:"now()"===t.column_default||-1!==t.column_default.indexOf("'now'::text")?a.default=t.column_default:(a.default=t.column_default.replace(/::[\w\s\.\[\]\"]+/g,""),a.default=a.default.replace(/^(-?\d+)$/,"'$1'"))}if("ALWAYS"===t.is_generated&&t.generation_expression){a.generatedType="STORED";const t=await this.selectTypeormMetadataSql({database:n,schema:e.table_schema,table:e.table_name,type:rt.GENERATED_COLUMN,name:a.name}),r=await this.query(t.query,t.parameters);r[0]&&r[0].value?a.asExpression=r[0].value:a.asExpression=""}return a.comment=t.description?t.description:void 0,t.character_set_name&&(a.charset=t.character_set_name),t.collation_name&&(a.collation=t.collation_name),a})));const s=pe.s.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"UNIQUE"===t.constraint_type)),(e=>e.constraint_name));r.uniques=s.map((e=>{const t=u.filter((t=>t.constraint_name===e.constraint_name));return new f({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),deferrable:e.deferrable?e.deferred:void 0})}));const o=pe.s.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"CHECK"===t.constraint_type)),(e=>e.constraint_name));r.checks=o.map((e=>{const t=u.filter((t=>t.constraint_name===e.constraint_name));return new y({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),expression:e.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})}));const c=pe.s.uniq(u.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema&&"EXCLUDE"===t.constraint_type)),(e=>e.constraint_name));r.exclusions=c.map((e=>new g({name:e.constraint_name,expression:e.expression.substring(8)})));const v=pe.s.uniq(b.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)),(e=>e.constraint_name));r.foreignKeys=v.map((e=>{const t=b.filter((t=>t.constraint_name===e.constraint_name)),n=i(e,"referenced_table_schema"),r=this.driver.buildTableName(e.referenced_table_name,n);return new p({name:e.constraint_name,columnNames:t.map((e=>e.column_name)),referencedSchema:e.referenced_table_schema,referencedTableName:r,referencedColumnNames:t.map((e=>e.referenced_column_name)),onDelete:e.on_delete,onUpdate:e.on_update,deferrable:e.deferrable?e.deferred:void 0})}));const w=pe.s.uniq(m.filter((t=>t.table_name===e.table_name&&t.table_schema===e.table_schema)),(e=>e.constraint_name));return r.indices=w.map((e=>{const t=m.filter((t=>t.table_schema===e.table_schema&&t.table_name===e.table_name&&t.constraint_name===e.constraint_name));return new d({table:r,name:e.constraint_name,columnNames:t.map((e=>e.column_name)),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:t.every((e=>this.driver.spatialTypes.indexOf(e.type_name)>=0)),isFulltext:!1})})),r})))}createTableSql(e,t){const n=e.columns.map((t=>this.buildCreateColumnSql(e,t))).join(", ");let r=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{e.uniques.some((e=>1===e.columnNames.length&&e.columnNames[0]===t.name))||e.uniques.push(new f({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){const t=e.uniques.map((t=>{let n=`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.uniqueConstraintName(e,t.columnNames)}" UNIQUE (${t.columnNames.map((e=>`"${e}"`)).join(", ")})`;return t.deferrable&&(n+=` DEFERRABLE ${t.deferrable}`),n})).join(", ");r+=`, ${t}`}if(e.checks.length>0){const t=e.checks.map((t=>`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.checkConstraintName(e,t.expression)}" CHECK (${t.expression})`)).join(", ");r+=`, ${t}`}if(e.exclusions.length>0){const t=e.exclusions.map((t=>`CONSTRAINT "${t.name?t.name:this.connection.namingStrategy.exclusionConstraintName(e,t.expression)}" EXCLUDE ${t.expression}`)).join(", ");r+=`, ${t}`}if(e.foreignKeys.length>0&&t){const t=e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`"${e}"`)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const r=t.referencedColumnNames.map((e=>`"${e}"`)).join(", ");let i=`CONSTRAINT "${t.name}" FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${r})`;return t.onDelete&&(i+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(i+=` ON UPDATE ${t.onUpdate}`),t.deferrable&&(i+=` DEFERRABLE ${t.deferrable}`),i})).join(", ");r+=`, ${t}`}const i=e.columns.filter((e=>e.isPrimary));if(i.length>0){const t=i[0].primaryKeyConstraintName?i[0].primaryKeyConstraintName:this.connection.namingStrategy.primaryKeyName(e,i.map((e=>e.name))),n=i.map((e=>`"${e.name}"`)).join(", ");r+=`, CONSTRAINT "${t}" PRIMARY KEY (${n})`}return r+=")",e.columns.filter((e=>e.comment)).forEach((t=>r+=`; COMMENT ON COLUMN ${this.escapePath(e)}."${t.name}" IS ${this.escapeComment(t.comment)}`)),new ot(r)}async getVersion(){return(await this.query("SELECT version()"))[0].version.replace(/^PostgreSQL ([\d\.]+) .*$/,"$1")}dropTableSql(e){return new ot(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e);return"string"==typeof e.expression?new ot(`CREATE ${t}VIEW ${n} AS ${e.expression}`):new ot(`CREATE ${t}VIEW ${n} AS ${e.expression(this.connection).getQuery()}`)}async insertViewDefinitionSql(e){const t=await this.getCurrentSchema();let{schema:n,tableName:r}=this.driver.parseTableName(e);n||(n=t);const i=e.materialized?rt.MATERIALIZED_VIEW:rt.VIEW,a="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:i,schema:n,name:r,value:a})}dropViewSql(e){const t=e.materialized?"MATERIALIZED ":"";return new ot(`DROP ${t}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){const t=await this.getCurrentSchema();let{schema:n,tableName:r}=this.driver.parseTableName(e);n||(n=t);const i=e.materialized?rt.MATERIALIZED_VIEW:rt.VIEW;return this.deleteTypeormMetadataSql({type:i,schema:n,name:r})}async dropEnumTypes(e){const t=`SELECT 'DROP TYPE IF EXISTS "' || n.nspname || '"."' || t.typname || '" CASCADE;' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN (${e}) GROUP BY "n"."nspname", "t"."typname"`,n=await this.query(t);await Promise.all(n.map((e=>this.query(e.query))))}async hasEnumType(e,t){let{schema:n}=this.driver.parseTableName(e);n||(n=await this.getCurrentSchema());const r=`SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = '${n}' AND "t"."typname" = '${this.buildEnumName(e,t,!1,!0)}'`;return!!(await this.query(r)).length}createEnumTypeSql(e,t,n){n||(n=this.buildEnumName(e,t));const r=t.enum.map((e=>`'${e.replace("'","''")}'`)).join(", ");return new ot(`CREATE TYPE ${n} AS ENUM(${r})`)}dropEnumTypeSql(e,t,n){return n||(n=this.buildEnumName(e,t)),new ot(`DROP TYPE ${n}`)}createIndexSql(e,t){const n=t.columnNames.map((e=>`"${e}"`)).join(", ");return new ot(`CREATE ${t.isUnique?"UNIQUE ":""}INDEX "${t.name}" ON ${this.escapePath(e)} ${t.isSpatial?"USING GiST ":""}(${n}) ${t.where?"WHERE "+t.where:""}`)}dropIndexSql(e,t){let n=w.a.isTableIndex(t)?t.name:t;const{schema:r}=this.driver.parseTableName(e);return new ot(r?`DROP INDEX "${r}"."${n}"`:`DROP INDEX "${n}"`)}createPrimaryKeySql(e,t,n){const r=n||this.connection.namingStrategy.primaryKeyName(e,t),i=t.map((e=>`"${e}"`)).join(", ");return new ot(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${r}" PRIMARY KEY (${i})`)}dropPrimaryKeySql(e){if(!e.primaryColumns.length)throw new u.K_(`Table ${e} has no primary keys.`);const t=e.primaryColumns.map((e=>e.name)),n=e.primaryColumns[0].primaryKeyConstraintName,r=n||this.connection.namingStrategy.primaryKeyName(e,t);return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${r}"`)}createUniqueConstraintSql(e,t){const n=t.columnNames.map((e=>'"'+e+'"')).join(", ");let r=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" UNIQUE (${n})`;return t.deferrable&&(r+=` DEFERRABLE ${t.deferrable}`),new ot(r)}dropUniqueConstraintSql(e,t){const n=w.a.isTableUnique(t)?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createCheckConstraintSql(e,t){return new ot(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" CHECK (${t.expression})`)}dropCheckConstraintSql(e,t){const n=w.a.isTableCheck(t)?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createExclusionConstraintSql(e,t){return new ot(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" EXCLUDE ${t.expression}`)}dropExclusionConstraintSql(e,t){const n=w.a.isTableExclusion(t)?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>'"'+e+'"')).join(", "),r=t.referencedColumnNames.map((e=>'"'+e+'"')).join(",");let i=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT "${t.name}" FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))}(${r})`;return t.onDelete&&(i+=` ON DELETE ${t.onDelete}`),t.onUpdate&&(i+=` ON UPDATE ${t.onUpdate}`),t.deferrable&&(i+=` DEFERRABLE ${t.deferrable}`),new ot(i)}dropForeignKeySql(e,t){const n=w.a.isTableForeignKey(t)?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT "${n}"`)}buildSequenceName(e,t){const{tableName:n}=this.driver.parseTableName(e),r=w.a.isTableColumn(t)?t.name:t;let i=`${n}_${r}_seq`;return i.length>this.connection.driver.maxAliasLength&&(i=`${n.substring(0,29)}_${r.substring(0,Math.max(29,63-e.name.length-5))}_seq`),i}buildSequencePath(e,t){const{schema:n}=this.driver.parseTableName(e);return n?`${n}.${this.buildSequenceName(e,t)}`:this.buildSequenceName(e,t)}buildEnumName(e,t,n=!0,r,i){const{schema:a,tableName:s}=this.driver.parseTableName(e);let o=t.enumName?t.enumName:`${s}_${t.name.toLowerCase()}_enum`;return a&&n&&(o=`${a}.${o}`),i&&(o+="_old"),o.split(".").map((e=>r?e:`"${e}"`)).join(".")}async getUserDefinedTypeName(e,t){let{schema:n,tableName:r}=this.driver.parseTableName(e);n||(n=await this.getCurrentSchema());const i=await this.query(`SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = '${n}' AND "table_name" = '${r}' AND "column_name"='${t.name}'`);let a=i[0].udt_name;return 0===a.indexOf("_")&&(a=a.substr(1,a.length)),{schema:i[0].udt_schema,name:a}}escapeComment(e){return e&&0!==e.length?`'${e=e.replace(/'/g,"''").replace(/\u0000/g,"")}'`:"NULL"}escapePath(e){const{schema:t,tableName:n}=this.driver.parseTableName(e);return t&&t!==this.driver.searchSchema?`"${t}"."${n}"`:`"${n}"`}async getTableNameWithSchema(e){const t=w.a.isTable(e)?e.name:e;if(-1===t.indexOf(".")){return`${(await this.query("SELECT current_schema()"))[0].current_schema}.${t}`}return`${t.split(".")[0]}.${t.split(".")[1]}`}buildCreateColumnSql(e,t){let n='"'+t.name+'"';if(!0===t.isGenerated&&"uuid"!==t.generationStrategy)if("identity"===t.generationStrategy){const e=t.generatedIdentity||"BY DEFAULT";n+=` ${t.type} GENERATED ${e} AS IDENTITY`}else"integer"!==t.type&&"int"!==t.type&&"int4"!==t.type||(n+=" SERIAL"),"smallint"!==t.type&&"int2"!==t.type||(n+=" SMALLSERIAL"),"bigint"!==t.type&&"int8"!==t.type||(n+=" BIGSERIAL");return"enum"===t.type||"simple-enum"===t.type?(n+=" "+this.buildEnumName(e,t),t.isArray&&(n+=" array")):t.isGenerated&&"uuid"!==t.type||(n+=" "+this.connection.driver.createFullType(t)),"STORED"===t.generatedType&&t.asExpression&&(n+=` GENERATED ALWAYS AS (${t.asExpression}) STORED`),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),!0!==t.isNullable&&(n+=" NOT NULL"),void 0!==t.default&&null!==t.default&&(n+=" DEFAULT "+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(n+=` DEFAULT ${this.driver.uuidGenerator}`),n}async hasSupportForPartitionedTables(){return!!(await this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")).length}}class Rt extends Mt{constructor(e,t){super(e,t)}}class Ot extends Rt{constructor(e,t,n){super(e,n),this.client=t}connect(){return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((([e,t])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=t,this.databaseConnection))):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((([e,t])=>(this.driver.connectedQueryRunners.push(this),this.databaseConnection=e,this.releaseCallback=t,this.databaseConnection)))),this.databaseConnectionPromise)}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}0===this.transactionDepth?await this.client.startTransaction():await this.query(`SAVEPOINT typeorm_${this.transactionDepth}`),this.transactionDepth+=1,await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),this.transactionDepth>1?await this.query("RELEASE SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.commitTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),this.transactionDepth>1?await this.query("ROLLBACK TO SAVEPOINT typeorm_"+(this.transactionDepth-1)):(await this.client.rollbackTransaction(),this.isTransactionActive=!1),this.transactionDepth-=1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=await this.client.query(e,t),i=new dt;return i.raw=r,(null==r?void 0:r.hasOwnProperty("records"))&&Array.isArray(r.records)&&(i.records=r.records),(null==r?void 0:r.hasOwnProperty("numberOfRecordsUpdated"))&&(i.affected=r.numberOfRecordsUpdated),n?i:i.raw}}class It extends L.PostgresDriver{}class kt extends It{constructor(e){super(),this.transactionSupport="nested",this.connection=e,this.options=e.options,this.isReplicated=!1,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),this.database=R.z.buildDriverOptions(this.options).database}async connect(){}async disconnect(){}createQueryRunner(e){return new Ot(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,((e,t)=>this.connection.logger.logQuery(e,t)),this.options.serviceConfigOptions,this.options.formatOptions),e)}preparePersistentValue(e,t){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?super.preparePersistentValue(e,t):(t.transformer&&(e=me.A.transformTo(t.transformer,e)),this.client.preparePersistentValue(e,t))}prepareHydratedValue(e,t){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?super.prepareHydratedValue(e,t):(t.transformer&&(e=me.A.transformFrom(t.transformer,e)),this.client.prepareHydratedValue(e,t))}loadDependencies(){const e=this.options.driver||a.load("typeorm-aurora-data-api-driver"),{pg:t}=e;this.DataApiDriver=t}executeQuery(e,t){return this.connection.query(t)}async afterConnect(){const e=await this.checkMetadataForExtensions();return e.hasExtensions&&await this.enableExtensions(e,this.connection),Promise.resolve()}}class Pt extends ut{constructor(e){super(),this.driver=e,this.connection=e.connection,this.broadcaster=new ht(this)}async beforeMigration(){await this.query("PRAGMA foreign_keys = OFF")}async afterMigration(){await this.query("PRAGMA foreign_keys = ON")}async executeSet(e){if(this.isReleased)throw new it.Y;return(await this.connect()).executeSet(e,!1)}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;const r=await this.connect();this.driver.connection.logger.logQuery(e,t,this);const i=e.substr(0,e.indexOf(" "));try{let a;a=-1!==["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(i)?await r.execute(e,!1):-1!==["INSERT","UPDATE","DELETE"].indexOf(i)?await r.run(e,t,!1):await r.query(e,t||[]);const s=new dt;return(null==a?void 0:a.hasOwnProperty("values"))&&(s.raw=a.values,s.records=a.values),(null==a?void 0:a.hasOwnProperty("changes"))&&(s.affected=a.changes.changes,s.raw=a.changes.lastId||a.changes.changes),n?s:s.raw}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}parametrize(e){return Object.keys(e).map((e=>`"${e}"=?`))}}class Lt extends nt{constructor(e){if(super(e),this.database=this.options.database,this.driver=this.options.driver,!this.options.database)throw new u.fd("database");if(!this.options.driver)throw new u.fd("driver");this.sqlite=this.options.driver}async connect(){this.databaseConnection=this.createDatabaseConnection(),await this.databaseConnection}async disconnect(){this.queryRunner=void 0;return(await this.databaseConnection).close().then((()=>{this.databaseConnection=void 0}))}createQueryRunner(e){return this.queryRunner||(this.queryRunner=new Pt(this)),this.queryRunner}async createDatabaseConnection(){const e=this.options.mode||"no-encryption",t="no-encryption"!==e,n=void 0===this.options.version?1:this.options.version,r=await this.sqlite.createConnection(this.options.database,t,e,n);return await r.open(),await r.query("PRAGMA foreign_keys = ON"),this.options.journalMode&&-1!==["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)&&await r.query(`PRAGMA journal_mode = ${this.options.journalMode}`),r}loadDependencies(){if(this.sqlite=this.driver,!this.driver)throw new u.zm("Capacitor","@capacitor-community/sqlite")}}class Dt extends lt{constructor(e,t){super(),this.driver=e,this.connection=e.connection,this.mode=t,this.broadcaster=new ht(this)}async connect(){if(this.session)return Promise.resolve(this.session);const[e]=await this.driver.instanceDatabase.createSession({});return this.session=e,this.sessionTransaction=await e.transaction(),this.session}async release(){return this.isReleased=!0,this.session&&await this.session.delete(),this.session=void 0,Promise.resolve()}async startTransaction(e){this.isTransactionActive=!0;try{await this.broadcaster.broadcast("BeforeTransactionStart")}catch(e){throw this.isTransactionActive=!1,e}await this.connect(),await this.sessionTransaction.begin(),this.connection.logger.logQuery("START TRANSACTION"),await this.broadcaster.broadcast("AfterTransactionStart")}async commitTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionCommit"),await this.sessionTransaction.commit(),this.connection.logger.logQuery("COMMIT"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionCommit")}async rollbackTransaction(){if(!this.isTransactionActive||!this.sessionTransaction)throw new st.W;await this.broadcaster.broadcast("BeforeTransactionRollback"),await this.sessionTransaction.rollback(),this.connection.logger.logQuery("ROLLBACK"),this.isTransactionActive=!1,await this.broadcaster.broadcast("AfterTransactionRollback")}async query(e,t,n=!1){if(this.isReleased)throw new it.Y;try{const r=+new Date;let i;await this.connect();const a=e.startsWith("SELECT"),s=a&&!this.isTransactionActive?this.driver.instanceDatabase:this.sessionTransaction;this.isTransactionActive||a||await this.sessionTransaction.begin();try{this.driver.connection.logger.logQuery(e,t,this),i=await s.run({sql:e,params:t?t.reduce(((e,t,n)=>(e["param"+n]=t,e)),{}):void 0,json:!0}),this.isTransactionActive||a||await this.sessionTransaction.commit()}catch(e){try{this.isTransactionActive||a||await this.sessionTransaction.rollback()}catch(e){}throw e}const o=this.driver.options.maxQueryExecutionTime,c=+new Date-r;o&&c>o&&this.driver.connection.logger.logQuerySlow(c,e,t,this);const l=new dt;return l.raw=i,l.records=i?i[0]:[],i&&i[1]&&i[1].rowCountExact&&(l.affected=parseInt(i[1].rowCountExact)),n?l:l.records}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}async updateDDL(e,t){if(this.isReleased)throw new it.Y;this.driver.connection.logger.logQuery(e,t,this);try{const n=+new Date,[r]=await this.driver.instanceDatabase.updateSchema(e);await r.promise();const i=this.driver.options.maxQueryExecutionTime,a=+new Date-n;i&&a>i&&this.driver.connection.logger.logQuerySlow(a,e,t,this)}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}async stream(e,t,n,r){if(this.isReleased)throw new it.Y;try{this.driver.connection.logger.logQuery(e,t,this);const i={sql:e,params:t?t.reduce(((e,t,n)=>(e["param"+n]=t,e)),{}):void 0,json:!0},a=this.driver.instanceDatabase.runStream(i);return n&&a.on("end",n),r&&a.on("error",r),a}catch(n){throw this.driver.connection.logger.logQueryError(n,e,t,this),new at.O(e,t,n)}}async getDatabases(){return Promise.resolve([])}async getSchemas(e){return Promise.resolve([])}async hasDatabase(e){throw new u.K_("Check database queries are not supported by Spanner driver.")}async getCurrentDatabase(){throw new u.K_("Check database queries are not supported by Spanner driver.")}async hasSchema(e){return!!(await this.query(`SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = '${e}'`)).length}async getCurrentSchema(){throw new u.K_("Check schema queries are not supported by Spanner driver.")}async hasTable(e){const t=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` = '${e instanceof _?e.name:e}'`;return!!(await this.query(t)).length}async hasColumn(e,t){const n=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` = '${e instanceof _?e.name:e}' AND \`COLUMN_NAME\` = '${t}'`;return!!(await this.query(n)).length}async createDatabase(e,t){if(t){if(await this.hasDatabase(e))return Promise.resolve()}const n=`CREATE DATABASE "${e}"`,r=`DROP DATABASE "${e}"`;await this.executeQueries(new ot(n),new ot(r))}async dropDatabase(e,t){const n=t?`DROP DATABASE IF EXISTS "${e}"`:`DROP DATABASE "${e}"`,r=`CREATE DATABASE "${e}"`;await this.executeQueries(new ot(n),new ot(r))}async createSchema(e,t){return Promise.resolve()}async dropSchema(e,t,n){return Promise.resolve()}async createTable(e,t=!1,n=!0,r=!0){if(t){if(await this.hasTable(e))return Promise.resolve()}const i=[],a=[];i.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((t=>a.push(this.dropForeignKeySql(e,t)))),r&&e.indices.forEach((t=>{t.name||(t.name=this.connection.namingStrategy.indexName(e,t.columnNames,t.where)),i.push(this.createIndexSql(e,t)),a.push(this.dropIndexSql(e,t))}));const s=e.columns.filter((e=>e.generatedType&&e.asExpression));for(const t of s){const n=this.insertTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),r=this.deleteTypeormMetadataSql({table:e.name,type:rt.GENERATED_COLUMN,name:t.name});i.push(n),a.push(r)}await this.executeQueries(i,a)}async dropTable(e,t,n=!0,r=!0){if(t){if(!await this.hasTable(e))return Promise.resolve()}const i=n,a=this.getTablePath(e),s=await this.getCachedTable(a),o=[],c=[];r&&s.indices.forEach((e=>{o.push(this.dropIndexSql(s,e)),c.push(this.createIndexSql(s,e))})),n&&s.foreignKeys.forEach((e=>o.push(this.dropForeignKeySql(s,e)))),o.push(this.dropTableSql(s)),c.push(this.createTableSql(s,i));const l=s.columns.filter((e=>e.generatedType&&e.asExpression));for(const e of l){const t=this.deleteTypeormMetadataSql({table:s.name,type:rt.GENERATED_COLUMN,name:e.name}),n=this.insertTypeormMetadataSql({table:s.name,type:rt.GENERATED_COLUMN,name:e.name,value:e.asExpression});o.push(t),c.push(n)}await this.executeQueries(o,c)}async createView(e){const t=[],n=[];t.push(this.createViewSql(e)),t.push(await this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(await this.deleteViewDefinitionSql(e)),await this.executeQueries(t,n)}async dropView(e){const t=e instanceof Ze?e.name:e,n=await this.getCachedView(t),r=[],i=[];r.push(await this.deleteViewDefinitionSql(n)),r.push(this.dropViewSql(n)),i.push(await this.insertViewDefinitionSql(n)),i.push(this.createViewSql(n)),await this.executeQueries(r,i)}async renameTable(e,t){throw new u.K_("Rename table queries are not supported by Spanner driver.")}async addColumn(e,t){const n=e instanceof _?e:await this.getCachedTable(e),r=n.clone(),i=[],a=[];i.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(t)}`)),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN ${this.driver.escape(t.name)}`));const s=r.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===t.name));if(s)i.push(this.createIndexSql(n,s)),a.push(this.dropIndexSql(n,s));else if(t.isUnique){const e=new d({name:this.connection.namingStrategy.indexName(n,[t.name]),columnNames:[t.name],isUnique:!0});r.indices.push(e),r.uniques.push(new f({name:e.name,columnNames:e.columnNames})),i.push(this.createIndexSql(n,e)),a.push(this.dropIndexSql(n,e))}if(t.generatedType&&t.asExpression){const e=this.insertTypeormMetadataSql({table:n.name,type:rt.GENERATED_COLUMN,name:t.name,value:t.asExpression}),r=this.deleteTypeormMetadataSql({table:n.name,type:rt.GENERATED_COLUMN,name:t.name});i.push(e),a.push(r)}await this.executeQueries(i,a),r.addColumn(t),this.replaceCachedTable(n,r)}async addColumns(e,t){for(const n of t)await this.addColumn(e,n)}async renameColumn(e,t,n){const r=e instanceof _?e:await this.getCachedTable(e),i=t instanceof h?t:r.columns.find((e=>e.name===t));if(!i)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);let a;return n instanceof h?a=n:(a=i.clone(),a.name=n),this.changeColumn(r,i,a)}async changeColumn(e,t,n){const r=e instanceof _?e:await this.getCachedTable(e);let i=r.clone();const a=[],s=[],o=t instanceof h?t:r.columns.find((e=>e.name===t));if(!o)throw new u.K_(`Column "${t}" was not found in the "${r.name}" table.`);if(o.name!==n.name||o.type!==n.type||o.length!==n.length||o.isArray!==n.isArray||o.generatedType!==n.generatedType||o.asExpression!==n.asExpression)await this.dropColumn(r,o),await this.addColumn(r,n),i=r.clone();else if(n.precision===o.precision&&n.scale===o.scale||(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(n)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${n.name}" TYPE ${this.driver.createFullType(o)}`))),o.isNullable!==n.isNullable&&(n.isNullable?(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${o.name}" DROP NOT NULL`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${o.name}" SET NOT NULL`))):(a.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${o.name}" SET NOT NULL`)),s.push(new ot(`ALTER TABLE ${this.escapePath(r)} ALTER COLUMN "${o.name}" DROP NOT NULL`)))),n.isUnique!==o.isUnique)if(!0===n.isUnique){const e=new d({name:this.connection.namingStrategy.indexName(r,[n.name]),columnNames:[n.name],isUnique:!0});i.indices.push(e),i.uniques.push(new f({name:e.name,columnNames:e.columnNames})),a.push(this.createIndexSql(r,e)),s.push(this.dropIndexSql(r,e))}else{const e=i.indices.find((e=>1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((e=>e===n.name))));i.indices.splice(i.indices.indexOf(e),1);const t=i.uniques.find((t=>t.name===e.name));i.uniques.splice(i.uniques.indexOf(t),1),a.push(this.dropIndexSql(r,e)),s.push(this.createIndexSql(r,e))}await this.executeQueries(a,s),this.replaceCachedTable(r,i)}async changeColumns(e,t){for(const{oldColumn:n,newColumn:r}of t)await this.changeColumn(e,n,r)}async dropColumn(e,t){const n=e instanceof _?e:await this.getCachedTable(e),r=t instanceof h?t:n.findColumnByName(t);if(!r)throw new u.K_(`Column "${t}" was not found in table "${n.name}"`);const i=n.clone(),a=[],s=[],o=i.indices.find((e=>1===e.columnNames.length&&e.columnNames[0]===r.name));o&&(i.indices.splice(i.indices.indexOf(o),1),a.push(this.dropIndexSql(n,o)),s.push(this.createIndexSql(n,o)));const c=i.checks.find((e=>!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===r.name));if(c&&(i.checks.splice(i.checks.indexOf(c),1),a.push(this.dropCheckConstraintSql(n,c)),s.push(this.createCheckConstraintSql(n,c))),a.push(new ot(`ALTER TABLE ${this.escapePath(n)} DROP COLUMN ${this.driver.escape(r.name)}`)),s.push(new ot(`ALTER TABLE ${this.escapePath(n)} ADD ${this.buildCreateColumnSql(r)}`)),r.generatedType&&r.asExpression){const e=this.deleteTypeormMetadataSql({table:n.name,type:rt.GENERATED_COLUMN,name:r.name}),t=this.insertTypeormMetadataSql({table:n.name,type:rt.GENERATED_COLUMN,name:r.name,value:r.asExpression});a.push(e),s.push(t)}await this.executeQueries(a,s),i.removeColumn(r),this.replaceCachedTable(n,i)}async dropColumns(e,t){for(const n of t)await this.dropColumn(e,n)}async createPrimaryKey(e,t){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async updatePrimaryKeys(e,t){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async dropPrimaryKey(e){throw new Error("The keys of a table can't change; you can't add a key column to an existing table or remove a key column from an existing table.")}async createUniqueConstraint(e,t){throw new u.K_("Spanner does not support unique constraints. Use unique index instead.")}async createUniqueConstraints(e,t){throw new u.K_("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraint(e,t){throw new u.K_("Spanner does not support unique constraints. Use unique index instead.")}async dropUniqueConstraints(e,t){throw new u.K_("Spanner does not support unique constraints. Use unique index instead.")}async createCheckConstraint(e,t){const n=e instanceof _?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n,t.expression));const r=this.createCheckConstraintSql(n,t),i=this.dropCheckConstraintSql(n,t);await this.executeQueries(r,i),n.addCheckConstraint(t)}async createCheckConstraints(e,t){const n=t.map((t=>this.createCheckConstraint(e,t)));await Promise.all(n)}async dropCheckConstraint(e,t){const n=e instanceof _?e:await this.getCachedTable(e),r=t instanceof y?t:n.checks.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied check constraint was not found in table ${n.name}`);const i=this.dropCheckConstraintSql(n,r),a=this.createCheckConstraintSql(n,r);await this.executeQueries(i,a),n.removeCheckConstraint(r)}async dropCheckConstraints(e,t){const n=t.map((t=>this.dropCheckConstraint(e,t)));await Promise.all(n)}async createExclusionConstraint(e,t){throw new u.K_("Spanner does not support exclusion constraints.")}async createExclusionConstraints(e,t){throw new u.K_("Spanner does not support exclusion constraints.")}async dropExclusionConstraint(e,t){throw new u.K_("Spanner does not support exclusion constraints.")}async dropExclusionConstraints(e,t){throw new u.K_("Spanner does not support exclusion constraints.")}async createForeignKey(e,t){const n=e instanceof _?e:await this.getCachedTable(e);t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const r=this.createForeignKeySql(n,t),i=this.dropForeignKeySql(n,t);await this.executeQueries(r,i),n.addForeignKey(t)}async createForeignKeys(e,t){for(const n of t)await this.createForeignKey(e,n)}async dropForeignKey(e,t){const n=e instanceof _?e:await this.getCachedTable(e),r=t instanceof p?t:n.foreignKeys.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied foreign key was not found in table ${n.name}`);const i=this.dropForeignKeySql(n,r),a=this.createForeignKeySql(n,r);await this.executeQueries(i,a),n.removeForeignKey(r)}async dropForeignKeys(e,t){for(const n of t)await this.dropForeignKey(e,n)}async createIndex(e,t){const n=e instanceof _?e:await this.getCachedTable(e);t.name||(t.name=this.generateIndexName(n,t));const r=this.createIndexSql(n,t),i=this.dropIndexSql(n,t);await this.executeQueries(r,i),n.addIndex(t)}async createIndices(e,t){for(const n of t)await this.createIndex(e,n)}async dropIndex(e,t){const n=e instanceof _?e:await this.getCachedTable(e),r=t instanceof d?t:n.indices.find((e=>e.name===t));if(!r)throw new u.K_(`Supplied index ${t} was not found in table ${n.name}`);r.name||(r.name=this.generateIndexName(n,r));const i=this.dropIndexSql(n,r),a=this.createIndexSql(n,r);await this.executeQueries(i,a),n.removeIndex(r)}async dropIndices(e,t){for(const n of t)await this.dropIndex(e,n)}async clearTable(e){await this.query(`DELETE FROM ${this.escapePath(e)} WHERE true`)}async clearDatabase(){const e=await this.query("SELECT concat('DROP INDEX `', INDEX_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`INDEXES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `INDEX_TYPE` = 'INDEX' AND `SPANNER_IS_MANAGED` = false"),t=await this.query("SELECT concat('ALTER TABLE `', TABLE_NAME, '`', ' DROP CONSTRAINT `', CONSTRAINT_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLE_CONSTRAINTS` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `CONSTRAINT_TYPE` = 'FOREIGN KEY'"),n=await this.query("SELECT concat('DROP TABLE `', TABLE_NAME, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'");if(!e.length&&!t.length&&!n.length)return;const r=this.isTransactionActive;r||await this.startTransaction();try{for(let t of e)await this.updateDDL(t.query);for(let e of t)await this.updateDDL(e.query);for(let e of n)await this.updateDDL(e.query);await this.commitTransaction()}catch(e){try{r||await this.rollbackTransaction()}catch(e){}throw e}}async executeMemoryUpSql(){for(const{query:e,parameters:t}of this.sqlInMemory.upQueries)this.isDMLQuery(e)?await this.query(e,t):await this.updateDDL(e,t)}async executeMemoryDownSql(){for(const{query:e,parameters:t}of this.sqlInMemory.downQueries.reverse())this.isDMLQuery(e)?await this.query(e,t):await this.updateDDL(e,t)}async loadViews(e){return Promise.resolve([])}async loadTables(e){if(e&&0===e.length)return[];const t=[];if(e&&e.length){const n=`SELECT \`TABLE_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLES\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_TYPE\` = 'BASE TABLE' AND \`TABLE_NAME\` IN (${e.map((e=>`'${e}'`)).join(", ")})`;t.push(...await this.query(n))}else{const e="SELECT `TABLE_NAME` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_CATALOG` = '' AND `TABLE_SCHEMA` = '' AND `TABLE_TYPE` = 'BASE TABLE'";t.push(...await this.query(e))}if(!t.length)return[];const n=t.map((e=>`'${e.TABLE_NAME}'`)).join(", "),r=`SELECT * FROM \`INFORMATION_SCHEMA\`.\`COLUMNS\` WHERE \`TABLE_CATALOG\` = '' AND \`TABLE_SCHEMA\` = '' AND \`TABLE_NAME\` IN (${n})`,i=`SELECT \`KCU\`.\`TABLE_NAME\`, \`KCU\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'PRIMARY KEY' AND \`TC\`.\`TABLE_NAME\` IN (${n})`,a=`SELECT \`I\`.\`TABLE_NAME\`, \`I\`.\`INDEX_NAME\`, \`I\`.\`IS_UNIQUE\`, \`I\`.\`IS_NULL_FILTERED\`, \`IC\`.\`COLUMN_NAME\` FROM \`INFORMATION_SCHEMA\`.\`INDEXES\` \`I\` INNER JOIN \`INFORMATION_SCHEMA\`.\`INDEX_COLUMNS\` \`IC\` ON \`IC\`.\`INDEX_NAME\` = \`I\`.\`INDEX_NAME\` AND \`IC\`.\`TABLE_NAME\` = \`I\`.\`TABLE_NAME\` WHERE \`I\`.\`TABLE_CATALOG\` = '' AND \`I\`.\`TABLE_SCHEMA\` = '' AND \`I\`.\`TABLE_NAME\` IN (${n}) AND \`I\`.\`INDEX_TYPE\` = 'INDEX' AND \`I\`.\`SPANNER_IS_MANAGED\` = false`,s=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`CC\`.\`CHECK_CLAUSE\`, \`CCU\`.\`COLUMN_NAME\`FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CHECK_CONSTRAINTS\` \`CC\` ON \`CC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'CHECK' AND \`TC\`.\`TABLE_NAME\` IN (${n}) AND \`TC\`.\`CONSTRAINT_NAME\` NOT LIKE 'CK_IS_NOT_NULL%'`,o=`SELECT \`TC\`.\`TABLE_NAME\`, \`TC\`.\`CONSTRAINT_NAME\`, \`KCU\`.\`COLUMN_NAME\`, \`CTU\`.\`TABLE_NAME\` AS \`REFERENCED_TABLE_NAME\`, \`CCU\`.\`COLUMN_NAME\` AS \`REFERENCED_COLUMN_NAME\`, \`RC\`.\`UPDATE_RULE\`, \`RC\`.\`DELETE_RULE\` FROM \`INFORMATION_SCHEMA\`.\`TABLE_CONSTRAINTS\` \`TC\` INNER JOIN \`INFORMATION_SCHEMA\`.\`KEY_COLUMN_USAGE\` \`KCU\` ON \`KCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_TABLE_USAGE\` \`CTU\` ON \`CTU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`REFERENTIAL_CONSTRAINTS\` \`RC\` ON \`RC\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` INNER JOIN \`INFORMATION_SCHEMA\`.\`CONSTRAINT_COLUMN_USAGE\` \`CCU\` ON \`CCU\`.\`CONSTRAINT_NAME\` = \`TC\`.\`CONSTRAINT_NAME\` WHERE \`TC\`.\`TABLE_CATALOG\` = '' AND \`TC\`.\`TABLE_SCHEMA\` = '' AND \`TC\`.\`CONSTRAINT_TYPE\` = 'FOREIGN KEY' AND \`TC\`.\`TABLE_NAME\` IN (${n})`,[c,l,u,m,f]=await Promise.all([this.query(r),this.query(i),this.query(a),this.query(s),this.query(o)]);return Promise.all(t.map((async e=>{const t=new _;t.name=this.driver.buildTableName(e.TABLE_NAME),t.columns=await Promise.all(c.filter((t=>t.TABLE_NAME===e.TABLE_NAME)).map((async n=>{const r=u.filter((t=>t.TABLE_NAME===e.TABLE_NAME&&t.COLUMN_NAME===n.COLUMN_NAME&&!0===t.IS_UNIQUE)),i=this.connection.entityMetadatas.find((e=>this.getTablePath(t)===this.getTablePath(e))),a=r.length>0&&i&&i.indices.some((e=>r.some((t=>e.name===t.INDEX_NAME&&!1===e.synchronize)))),s=r.every((e=>u.some((t=>t.INDEX_NAME===e.INDEX_NAME&&t.COLUMN_NAME!==n.COLUMN_NAME)))),o=new h;o.name=n.COLUMN_NAME;let c=n.SPANNER_TYPE.toLowerCase();if(-1!==c.indexOf("array")&&(o.isArray=!0,c=c.substring(c.indexOf("<")+1,c.indexOf(">"))),-1!==c.indexOf("(")?o.type=c.substring(0,c.indexOf("(")):o.type=c,-1!==this.driver.withLengthColumnTypes.indexOf(o.type)&&(o.length=c.substring(c.indexOf("(")+1,c.indexOf(")"))),"ALWAYS"===n.IS_GENERATED){o.asExpression=n.GENERATION_EXPRESSION,o.generatedType="STORED";const t=await this.selectTypeormMetadataSql({table:e.TABLE_NAME,type:rt.GENERATED_COLUMN,name:o.name}),r=await this.query(t.query,t.parameters);r[0]&&r[0].value?o.asExpression=r[0].value:o.asExpression=""}return o.isUnique=r.length>0&&!a&&!s,o.isNullable="YES"===n.IS_NULLABLE,o.isPrimary=l.some((e=>e.TABLE_NAME===n.TABLE_NAME&&e.COLUMN_NAME===n.COLUMN_NAME)),o})));const n=f.filter((t=>t.TABLE_NAME===e.TABLE_NAME));t.foreignKeys=pe.s.uniq(n,(e=>e.CONSTRAINT_NAME)).map((e=>{const t=n.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME));return new p({name:e.CONSTRAINT_NAME,columnNames:pe.s.uniq(t.map((e=>e.COLUMN_NAME))),referencedDatabase:e.REFERENCED_TABLE_SCHEMA,referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:pe.s.uniq(t.map((e=>e.REFERENCED_COLUMN_NAME))),onDelete:e.DELETE_RULE,onUpdate:e.UPDATE_RULE})}));const r=u.filter((t=>t.TABLE_NAME===e.TABLE_NAME));t.indices=pe.s.uniq(r,(e=>e.INDEX_NAME)).map((e=>{const n=r.filter((t=>t.INDEX_NAME===e.INDEX_NAME));return new d({table:t,name:e.INDEX_NAME,columnNames:n.map((e=>e.COLUMN_NAME)),isUnique:e.IS_UNIQUE,isNullFiltered:e.IS_NULL_FILTERED})}));const i=m.filter((t=>t.TABLE_NAME===e.TABLE_NAME));return t.checks=pe.s.uniq(i,(e=>e.CONSTRAINT_NAME)).map((e=>{const t=i.filter((t=>t.CONSTRAINT_NAME===e.CONSTRAINT_NAME));return new y({name:e.CONSTRAINT_NAME,columnNames:t.map((e=>e.COLUMN_NAME)),expression:e.CHECK_CLAUSE})})),t})))}createTableSql(e,t){const n=e.columns.map((e=>this.buildCreateColumnSql(e))).join(", ");let r=`CREATE TABLE ${this.escapePath(e)} (${n}`;if(e.columns.filter((e=>e.isUnique)).forEach((t=>{const n=e.indices.some((e=>1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name))),r=e.uniques.some((e=>1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)));n||r||e.indices.push(new d({name:this.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((t=>{e.indices.some((e=>e.name===t.name))||e.indices.push(new d({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.checks.length>0){r+=`, ${e.checks.map((t=>`CONSTRAINT \`${t.name?t.name:this.connection.namingStrategy.checkConstraintName(e,t.expression)}\` CHECK (${t.expression})`)).join(", ")}`}if(e.foreignKeys.length>0&&t){r+=`, ${e.foreignKeys.map((t=>{const n=t.columnNames.map((e=>`\`${e}\``)).join(", ");t.name||(t.name=this.connection.namingStrategy.foreignKeyName(e,t.columnNames,this.getTablePath(t),t.referencedColumnNames));const r=t.referencedColumnNames.map((e=>`\`${e}\``)).join(", ");return`CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${r})`})).join(", ")}`}r+=")";const i=e.columns.filter((e=>e.isPrimary));if(i.length>0){r+=` PRIMARY KEY (${i.map((e=>this.driver.escape(e.name))).join(", ")})`}return new ot(r)}dropTableSql(e){return new ot(`DROP TABLE ${this.escapePath(e)}`)}createViewSql(e){const t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e),r="string"==typeof e.expression?e.expression:e.expression(this.connection).getQuery();return new ot(`CREATE ${t}VIEW ${n} SQL SECURITY INVOKER AS ${r}`)}async insertViewDefinitionSql(e){let{schema:t,tableName:n}=this.driver.parseTableName(e);const r=e.materialized?rt.MATERIALIZED_VIEW:rt.VIEW,i="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery();return this.insertTypeormMetadataSql({type:r,schema:t,name:n,value:i})}dropViewSql(e){const t=e.materialized?"MATERIALIZED ":"";return new ot(`DROP ${t}VIEW ${this.escapePath(e)}`)}async deleteViewDefinitionSql(e){let{schema:t,tableName:n}=this.driver.parseTableName(e);const r=e.materialized?rt.MATERIALIZED_VIEW:rt.VIEW;return this.deleteTypeormMetadataSql({type:r,schema:t,name:n})}createIndexSql(e,t){const n=t.columnNames.map((e=>this.driver.escape(e))).join(", ");let r="";return t.isUnique&&(r+="UNIQUE "),t.isNullFiltered&&(r+="NULL_FILTERED "),new ot(`CREATE ${r}INDEX \`${t.name}\` ON ${this.escapePath(e)} (${n})`)}dropIndexSql(e,t){let n=t instanceof d?t.name:t;return new ot(`DROP INDEX \`${n}\``)}createCheckConstraintSql(e,t){return new ot(`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` CHECK (${t.expression})`)}dropCheckConstraintSql(e,t){const n=t instanceof y?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${n}\``)}createForeignKeySql(e,t){const n=t.columnNames.map((e=>this.driver.escape(e))).join(", "),r=t.referencedColumnNames.map((e=>this.driver.escape(e))).join(",");let i=`ALTER TABLE ${this.escapePath(e)} ADD CONSTRAINT \`${t.name}\` FOREIGN KEY (${n}) REFERENCES ${this.escapePath(this.getTablePath(t))} (${r})`;return new ot(i)}dropForeignKeySql(e,t){const n=t instanceof p?t.name:t;return new ot(`ALTER TABLE ${this.escapePath(e)} DROP CONSTRAINT \`${n}\``)}escapePath(e){const{tableName:t}=this.driver.parseTableName(e);return`\`${t}\``}buildCreateColumnSql(e){let t=`${this.driver.escape(e.name)} ${this.connection.driver.createFullType(e)}`;return"STORED"===e.generatedType&&e.asExpression?t+=` AS (${e.asExpression}) STORED`:e.isNullable||(t+=" NOT NULL"),t}async executeQueries(e,t){if(e instanceof ot&&(e=[e]),t instanceof ot&&(t=[t]),this.sqlInMemory.upQueries.push(...e),this.sqlInMemory.downQueries.push(...t),!0===this.sqlMemoryMode)return Promise.resolve();for(const{query:t,parameters:n}of e)this.isDMLQuery(t)?await this.query(t,n):await this.updateDDL(t,n)}isDMLQuery(e){return e.startsWith("INSERT")||e.startsWith("UPDATE")||e.startsWith("DELETE")}}var qt=n(348834).Buffer;class Bt{constructor(e){this.isReplicated=!1,this.treeSupport=!0,this.transactionSupport="none",this.supportedDataTypes=["bool","int64","float64","numeric","string","json","bytes","date","timestamp","array"],this.supportedUpsertType=void 0,this.spatialTypes=[],this.withLengthColumnTypes=["string","bytes"],this.withWidthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"",updateDate:"timestamp",updateDateDefault:"",deleteDate:"timestamp",deleteDateNullable:!0,version:"int64",treeLevel:"int64",migrationId:"int64",migrationName:"string",migrationTimestamp:"int64",cacheId:"string",cacheIdentifier:"string",cacheTime:"int64",cacheDuration:"int64",cacheQuery:"string",cacheResult:"string",metadataType:"string",metadataDatabase:"string",metadataSchema:"string",metadataTable:"string",metadataName:"string",metadataValue:"string"},this.dataTypeDefaults={},this.maxAliasLength=63,this.cteCapabilities={enabled:!0},this._isReturningSqlSupported={delete:!1,insert:!1,update:!1},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}async connect(){this.instance=this.spanner.instance(this.options.instanceId),this.instanceDatabase=this.instance.database(this.options.databaseId)}afterConnect(){return Promise.resolve()}async disconnect(){this.instanceDatabase.close()}createSchemaBuilder(){return new tt(this.connection)}createQueryRunner(e){return new Dt(this,e)}escapeQueryWithParameters(e,t,n){const r=Object.keys(n).map((e=>n[e]));return t&&Object.keys(t).length?[e=(e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,i)=>{if(!t.hasOwnProperty(i))return e;let a=t[i];return null===a?e:n?a.map((e=>(r.push(e),this.createParameter(i,r.length-1)))).join(", "):a instanceof Function?a():(r.push(a),this.createParameter(i,r.length-1))}))).replace(/([ ]+)?=([ ]+)?:(\.\.\.)?([A-Za-z0-9_.]+)/g,((e,n,r,i,a)=>{if(!t.hasOwnProperty(a))return e;return null===t[a]?" IS NULL":e})),r]:[e,r]}escape(e){return`\`${e}\``}buildTableName(e,t,n){let r=[e];return n&&r.unshift(n),r.join(".")}parseTableName(e){const t=this.database,n=void 0;if(e instanceof _||e instanceof Ze){const r=this.parseTableName(e.name);return{database:e.database||r.database||t,schema:e.schema||r.schema||n,tableName:r.tableName}}if(e instanceof p){const r=this.parseTableName(e.referencedTableName);return{database:e.referencedDatabase||r.database||t,schema:e.referencedSchema||r.schema||n,tableName:r.tableName}}if(e instanceof Oe)return{database:e.database||t,schema:e.schema||n,tableName:e.tableName};const r=e.split(".");return{database:(r.length>1?r[0]:void 0)||t,schema:n,tableName:r.length>1?r[1]:r[0]}}preparePersistentValue(e,t){if(t.transformer&&(e=me.A.transformTo(t.transformer,e)),null==e)return e;if("numeric"===t.type){return(this.options.driver||a.load("spanner")).Spanner.numeric(e)}return"date"===t.type?de.mixedDateToDateString(e):"json"===t.type?e:"timestamp"===t.type||t.type===Date?de.mixedDateToDate(e):e}prepareHydratedValue(e,t){return null==e?t.transformer?me.A.transformFrom(t.transformer,e):e:(t.type===Boolean||"bool"===t.type?e=!!e:"timestamp"===t.type||t.type===Date?e=new Date(e):"numeric"===t.type?e=e.value:"date"===t.type?e=de.mixedDateToDateString(e):"json"===t.type&&(e="string"==typeof e?JSON.parse(e):e),t.transformer&&(e=me.A.transformFrom(t.transformer,e)),e)}normalizeType(e){return e.type===Number?"int64":e.type===String||"uuid"===e.type?"string":e.type===Date?"timestamp":e.type===qt?"bytes":e.type===Boolean?"bool":e.type||""}normalizeDefault(e){return""===e.default?`"${e.default}"`:`${e.default}`}normalizeIsUnique(e){return e.entityMetadata.indices.some((t=>t.isUnique&&1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case String:case"string":case"bytes":return"max";default:return""}}createFullType(e){let t=e.type;return this.getColumnLength(e)?t+=`(${this.getColumnLength(e)})`:e.width?t+=`(${e.width})`:null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=`(${e.precision},${e.scale})`:null!==e.precision&&void 0!==e.precision&&(t+=`(${e.precision})`),e.isArray&&(t=`array<${t}>`),t}obtainMasterConnection(){return this.instanceDatabase}obtainSlaveConnection(){return this.instanceDatabase}createGeneratedMap(e,t,n){if(!t)return;if(void 0===t.insertId)return Object.keys(t).reduce(((n,r)=>{const i=e.findColumnWithDatabaseName(r);return i&&pe.s.mergeDeep(n,i.createValueMap(t[r])),n}),{});const r=e.generatedColumns.reduce(((e,r)=>{let i;return"increment"===r.generationStrategy&&t.insertId&&(i=t.insertId+n),pe.s.mergeDeep(e,r.createValueMap(i))}),{});return Object.keys(r).length>0?r:void 0}findChangedColumns(e,t){return t.filter((t=>{const n=e.find((e=>e.name===t.databaseName));if(!n)return!1;return n.name!==t.databaseName||n.type!==this.normalizeType(t)||n.length!==this.getColumnLength(t)||n.asExpression!==t.asExpression||n.generatedType!==t.generatedType||n.isPrimary!==t.isPrimary||!this.compareNullableValues(t,n)||n.isUnique!==this.normalizeIsUnique(t)}))}isReturningSqlSupported(e){return this._isReturningSqlSupported[e]}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return"@param"+t}loadDependencies(){try{const e=this.options.driver||a.load("spanner");this.spanner=new e.Spanner({projectId:this.options.projectId})}catch(e){throw console.error(e),new ft.z("Spanner","@google-cloud/spanner")}}compareNullableValues(e,t){return!!e.generatedType||e.isNullable===t.isNullable}compareDefaultValues(e,t){return"string"==typeof e&&"string"==typeof t&&(e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t}normalizeDatetimeFunction(e){if(!e)return e;if(-1!==e.toUpperCase().indexOf("CURRENT_TIMESTAMP")||-1!==e.toUpperCase().indexOf("NOW")){const t=e.match(/\(\d+\)/);return t?`CURRENT_TIMESTAMP${t[0]}`:"CURRENT_TIMESTAMP"}return e}escapeComment(e){return e?e=e.replace(/\u0000/g,""):e}}var jt=n(241836),$t=n(959085);class Ut{constructor(e){this.connection=e}async build(){const e={};this.connection.entityMetadatas.forEach((t=>{const n=[];t.primaryColumns.forEach((e=>{n.push(`&[${e.propertyName}]`)})),t.indices.forEach((e=>{const t=[];for(const n of e.columns)t.push(n.propertyName);const r=e.isUnique?"&":"";n.push(`${r}[${t.join("+")}]`),1===t.length&&n.push(`${r}${t.join("+")}`)})),e[t.tableName]=n.join(",")}));const t=this.connection.createQueryRunner(),n=this.connection.options;await t.applySchemas(e,n.version)}log(){return Promise.resolve(new ct)}}class Ft{constructor(e,t){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.connection=e,this.databaseConnection=t,this.broadcaster=new ht(this)}async beforeMigration(){}async afterMigration(){}async applySchemas(e,t){const n=this.connection.driver;n.dexie.isOpen()&&await n.dexie.close(),n.dexie.version(t).stores(e),await n.dexie.open()}async clearDatabase(){await this.databaseConnection.delete()}async connect(){}async release(){}async startTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}async commitTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}async rollbackTransaction(){throw Error("Dont start transaction from IndexedDbQueryRunner. Use IndexedEntityManager instead")}query(e,t){throw new u.K_("Executing SQL query is not supported by IndexedDb driver.")}stream(e,t,n,r){throw new u.K_("Stream is not supported by IndexedDb driver.")}async getDatabases(){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async getSchemas(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async getTable(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async getTables(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async getView(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async getViews(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}getReplicationMode(){return"master"}async hasDatabase(e){throw new u.K_("Check database queries are not supported by IndexedDb driver.")}async getCurrentDatabase(){throw new u.K_("Check database queries are not supported by IndexedDb driver.")}async hasSchema(e){throw new u.K_("Check schema queries are not supported by IndexedDb driver.")}async getCurrentSchema(){throw new u.K_("Check schema queries are not supported by IndexedDb driver.")}async hasTable(e){throw new u.K_("Check schema queries are not supported by IndexedDb driver.")}async hasColumn(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createDatabase(e){throw new u.K_("Database create queries are not supported by IndexedDb driver.")}async dropDatabase(e,t){throw new u.K_("Database drop queries are not supported by IndexedDb driver.")}async createSchema(e,t){throw new u.K_("Schema create queries are not supported by IndexedDb driver.")}async dropSchema(e,t){throw new u.K_("Schema drop queries are not supported by IndexedDb driver.")}async createTable(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropTable(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createView(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropView(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async renameTable(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async addColumn(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async addColumns(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async renameColumn(e,t,n){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async changeColumn(e,t,n){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async changeColumns(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropColumn(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropColumns(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createPrimaryKey(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async updatePrimaryKeys(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropPrimaryKey(e){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createUniqueConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createUniqueConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropUniqueConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropUniqueConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createCheckConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createCheckConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropCheckConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropCheckConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createExclusionConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createExclusionConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropExclusionConstraint(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropExclusionConstraints(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createForeignKey(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createForeignKeys(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropForeignKey(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropForeignKeys(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createIndex(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async createIndices(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropIndex(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async dropIndices(e,t){throw new u.K_("Schema update queries are not supported by IndexedDb driver.")}async clearTable(e){await this.databaseConnection._allTables[e].clear()}enableSqlMemory(){throw new u.K_("This operation is not supported by IndexedDb driver.")}disableSqlMemory(){throw new u.K_("This operation is not supported by IndexedDb driver.")}clearSqlMemory(){throw new u.K_("This operation is not supported by IndexedDb driver.")}getMemorySql(){throw new u.K_("This operation is not supported by IndexedDb driver.")}async executeMemoryUpSql(){throw new u.K_("This operation is not supported by IndexedDb driver.")}async executeMemoryDownSql(){throw new u.K_("This operation is not supported by IndexedDb driver.")}}class Kt{constructor(e){var t;this.connection=e,this.isReplicated=!1,this.treeSupport=!1,this.transactionSupport="simple",this.supportedDataTypes=["int","integer","tinyint","bigint","varchar","text","boolean","date","datetime"],this.spatialTypes=[],this.withLengthColumnTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:(new Date).toISOString(),updateDate:"datetime",updateDatePrecision:6,updateDateDefault:(new Date).toISOString(),deleteDate:"datetime",deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"int",migrationTimestamp:"int",cacheId:"int",cacheIdentifier:"int",cacheTime:"int",cacheDuration:"int",cacheQuery:"int",cacheResult:"int",metadataType:"int",metadataDatabase:"int",metadataSchema:"int",metadataTable:"int",metadataName:"int",metadataValue:"int"},this.validOptionNames=[],this.cteCapabilities={enabled:!1},this.options=e.options,this.loadDependencies();const n=null!==(t=this.options.database)&&void 0!==t?t:"default";this.dexie=new $t.default(n,{...this.options.dexieJsConfig})}async connect(){this.queryRunner=new Ft(this.connection,this.dexie)}afterConnect(){return Promise.resolve()}async disconnect(){return new Promise(((e,t)=>{if(!this.queryRunner)return t(new jt.y("indexeddb"));this.queryRunner.databaseConnection.close(),this.queryRunner=void 0}))}createSchemaBuilder(){return new Ut(this.connection)}createQueryRunner(e){return this.queryRunner}escapeQueryWithParameters(e,t,n){throw new u.K_("This operation is not supported by IndexedDB.")}escape(e){return e}buildTableName(e,t,n){return e}parseTableName(e){return w.a.isEntityMetadata(e)?{tableName:e.tableName}:w.a.isTable(e)||w.a.isView(e)?{tableName:e.name}:w.a.isTableForeignKey(e)?{tableName:e.referencedTableName}:{tableName:e}}preparePersistentValue(e,t){return t.transformer&&(e=me.A.transformTo(t.transformer,e)),e}prepareHydratedValue(e,t){return t.transformer&&(e=me.A.transformFrom(t.transformer,e)),e}normalizeType(e){return e.type===Number||"int"===e.type||"integer"===e.type||"tinyint"===e.type?"integer":e.type===String||"varchar"===e.type||"bigint"===e.type?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":e.type||""}normalizeDefault(e){const t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?t?"1":"0":"function"==typeof t?t():"string"==typeof t?`'${t}'`:null!=t?`${t}`:void 0}normalizeIsUnique(e){return e.entityMetadata.uniques.some((t=>1===t.columns.length&&t.columns[0]===e))}getColumnLength(e){return e.length?e.length.toString():""}createFullType(e){throw new u.K_("IndexedDB is schema-less, not supported by this driver.")}obtainMasterConnection(){return Promise.resolve()}obtainSlaveConnection(){return Promise.resolve()}createGeneratedMap(e,t){return e.objectIdColumn.createValueMap(t)}findChangedColumns(e,t){throw new u.K_("IndexedDB is schema-less, not supported by this driver.")}isReturningSqlSupported(){return!1}isUUIDGenerationSupported(){return!1}isFullTextColumnTypeSupported(){return!1}createParameter(e,t){return""}loadDependencies(){try{const e=n(959085);this.dexie=e}catch(e){throw new ft.z("IndexedDb","dexie")}}}class Wt{create(e){const{type:t}=e.options;if("indexeddb"===t)return new Kt(e);if("react-native"===t){const{ReactNativeDriver:t}=n(251279);return new t(e)}switch(t){case"mysql":case"mariadb":return new L.MysqlDriver(e);case"postgres":return new L.PostgresDriver(e);case"cockroachdb":return new L.CockroachDriver(e);case"sap":return new L.SapDriver(e);case"sqlite":return new L.SqliteDriver(e);case"better-sqlite3":return new L.BetterSqlite3Driver(e);case"cordova":return new yt(e);case"nativescript":return new bt(e);case"sqljs":return new Et(e);case"oracle":return new L.OracleDriver(e);case"mssql":return new L.SqlServerDriver(e);case"mongodb":return new L.MongoDriver(e);case"expo":return new St(e);case"aurora-mysql":return new Ct(e);case"aurora-postgres":return new kt(e);case"capacitor":return new Lt(e);case"spanner":return new Bt(e);default:throw new Xe.R(t,["aurora-mysql","aurora-postgres","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs","indexeddb","spanner"])}}}const Vt=new class{constructor(){this.instances=[]}get(e){let t=this.instances.find((t=>t.type===e));return t||(t={type:e,object:new e},this.instances.push(t)),t.object}};let Ht,Qt;function zt(e,t){Ht=e,Qt=t}function Gt(e){if(Ht)try{const t=Ht.get(e);if(t)return t;if(!Qt||!Qt.fallback)return t}catch(e){if(!Qt||!Qt.fallbackOnErrors)throw e}return Vt.get(e)}var Yt=n(348834).Buffer;class Jt{constructor(e){this["@instanceof"]=Symbol.for("ColumnMetadata"),this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),e.args.options.generatedIdentity&&(this.generatedIdentity=e.args.options.generatedIdentity),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),null!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(V.g.isObject(e.args.options.enum)&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter((t=>isNaN(+t)&&"function"!=typeof e.args.options.enum[t])).map((t=>e.args.options.enum[t])):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.primaryKeyConstraintName&&(this.primaryKeyConstraintName=e.args.options.primaryKeyConstraintName),e.args.options.foreignKeyConstraintName&&(this.foreignKeyConstraintName=e.args.options.foreignKeyConstraintName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.createDateDefault),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=()=>e.connection.driver.mappedDataTypes.updateDateDefault),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}createValueMap(e,t=!1){if(this.embeddedMetadata){const n=[...this.embeddedMetadata.parentPropertyNames],r=(n,i)=>{const a=n.shift();return a?(i[a]={},r(n,i[a]),i):("increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),i[t?this.databaseName:this.propertyName]=e,i)};return r(n,{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),{[t?this.databaseName:this.propertyName]:e}}getEntityValueMap(e,t){var n;if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],n=this.embeddedMetadata.isArray,r=(e,t)=>{if(void 0===t)return{};const i=e.shift();if(i){const n=r(e,t[i]);return Object.keys(n).length>0?{[i]:n}:{}}return n&&Array.isArray(t)?t.map((e=>({[this.propertyName]:e[this.propertyName]}))):void 0!==t[this.propertyName]?{[this.propertyName]:t[this.propertyName]}:{}},i=r(t,e);return Object.keys(i).length>0?i:void 0}if(this.relationMetadata&&!(null===(n=Object.getOwnPropertyDescriptor(e,this.relationMetadata.propertyName))||void 0===n?void 0:n.get)&&e[this.relationMetadata.propertyName]&&V.g.isObject(e[this.relationMetadata.propertyName])){const t=this.relationMetadata.joinColumns.reduce(((t,n)=>{const r=n.referencedColumn.getEntityValueMap(e[this.relationMetadata.propertyName]);return void 0===r?t:pe.s.mergeDeep(t,r)}),{});return Object.keys(t).length>0?{[this.propertyName]:t}:void 0}return void 0!==e[this.propertyName]?{[this.propertyName]:e[this.propertyName]}:void 0}getEntityValue(e,t=!1){if(null==e)return;let n;if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],r=this.embeddedMetadata.isArray,i=(e,t)=>{const n=e.shift();return n&&t?i(e,t[n]):t},a=i(t,e);if(a)if(this.relationMetadata&&this.referencedColumn){const e=this.relationMetadata.getEntityValue(a);n=e&&V.g.isObject(e)&&!w.a.isFindOperator(e)&&!Yt.isBuffer(e)?this.referencedColumn.getEntityValue(e):!a[this.propertyName]||!V.g.isObject(a[this.propertyName])||w.a.isFindOperator(a[this.propertyName])||Yt.isBuffer(a[this.propertyName])||a[this.propertyName]instanceof Date?a[this.propertyName]:this.referencedColumn.getEntityValue(a[this.propertyName])}else n=this.referencedColumn?this.referencedColumn.getEntityValue(a[this.propertyName]):r&&Array.isArray(a)?a.map((e=>e[this.propertyName])):a[this.propertyName]}else if(this.relationMetadata&&this.referencedColumn){const t=this.relationMetadata.getEntityValue(e);n=t&&V.g.isObject(t)&&!w.a.isFindOperator(t)&&"function"!=typeof t&&!Yt.isBuffer(t)?this.referencedColumn.getEntityValue(t):!e[this.propertyName]||!V.g.isObject(e[this.propertyName])||w.a.isFindOperator(e[this.propertyName])||"function"==typeof e[this.propertyName]||Yt.isBuffer(e[this.propertyName])||e[this.propertyName]instanceof Date?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName])}else n=this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName];return t&&this.transformer&&(n=me.A.transformTo(this.transformer,n)),n}setEntityValue(e,t){if(this.embeddedMetadata){const n=(e,r)=>{const i=e.shift();return i?(r[i.propertyName]||(r[i.propertyName]=i.create()),n(e,r[i.propertyName]),r):(r[this.propertyName]=t,r)};return n([...this.embeddedMetadata.embeddedMetadataTree],e)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=t):e[this.propertyName]=t}compareEntityValue(e,t){const n=this.getEntityValue(e);return V.g.isObject(n)?n.equals(t):n===t}build(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this}buildPropertyPath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e}buildDatabasePath(){let e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e}buildDatabaseName(e){let t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return"mongodb"===e.driver.options.type&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)}}class Xt{constructor(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.isNullFiltered=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.isNullFiltered=!!e.args.nullFiltered,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}build(e){if(!1===this.synchronize)return this.name=this.givenName,this;const t={};if(this.givenColumnNames){let e=[];if(Array.isArray(this.givenColumnNames))e=this.givenColumnNames.map((e=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+e:e.trim())),e.forEach((e=>t[e]=1));else{const n=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(n)?(e=n.map((e=>String(e))),e.forEach((e=>t[e]=1))):(e=Object.keys(n).map((e=>String(e))),Object.keys(n).forEach((e=>t[e]=n[e])))}this.columns=e.map((e=>{const t=this.entityMetadata.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.entityMetadata.relations.find((t=>t.isWithJoinColumn&&t.propertyName===e));if(n)return n.joinColumns;const r=this.givenName?'"'+this.givenName+'" ':"",i=this.entityMetadata.targetName;throw new u.K_(`Index ${r}contains column that is missing in the entity (${i}): `+e)})).reduce(((e,t)=>e.concat(t)))}return this.columnNamesWithOrderingMap=Object.keys(t).reduce(((e,n)=>{const r=this.entityMetadata.columns.find((e=>e.propertyPath===n));return r&&(e[r.databasePath]=t[n]),e}),{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tableName,this.columns.map((e=>e.databaseName)),this.where),this}}class Zt{constructor(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;const t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.createForeignKeyConstraints=!1!==t.options.createForeignKeyConstraints,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.orphanedRowAction=t.options.orphanedRowAction||"nullify",this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,"function"==typeof t.type?this.type="function"==typeof t.type?t.type():t.type:w.a.isEntitySchema(t.type)?this.type=t.type.options.name:V.g.isObject(t.type)&&"string"==typeof t.type.name?this.type=t.type.name:this.type=t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}getRelationIdMap(e){const t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((e=>e.referencedColumn));return Oe.getValueMap(e,t)}ensureRelationIdMap(e){if(V.g.isObject(e))return e;const t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((e=>e.referencedColumn));if(t.length>1)throw new u.K_("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)}getEntityValue(e,t=!1){if(null!=e){if(this.embeddedMetadata){const n=[...this.embeddedMetadata.parentPropertyNames],r=(e,t)=>{const n=e.shift();return n?t[n]?r(e,t[n]):void 0:t},i=r(n,e);return this.isLazy?void 0!==i["__"+this.propertyName+"__"]?i["__"+this.propertyName+"__"]:!0===t?i[this.propertyName]:void 0:i?i[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}}setEntityValue(e,t){const n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){const r=(e,i)=>{const a=e.shift();return a?(i[a.propertyName]||(i[a.propertyName]=a.create()),r(e,i[a.propertyName]),i):(i[n]=t,i)};return r([...this.embeddedMetadata.embeddedMetadataTree],e)}e[n]=t}createValueMap(e){if(this.embeddedMetadata){const t=[...this.embeddedMetadata.parentPropertyNames],n=(t,r)=>{const i=t.shift();return i?(r[i]={},n(t,r[i]),r):(r[this.propertyName]=e,r)};return n(t,{})}return{[this.propertyName]:e}}build(){this.propertyPath=this.buildPropertyPath()}registerForeignKeys(...e){this.foreignKeys.push(...e)}registerJoinColumns(e=[],t=[]){this.joinColumns=e,this.inverseJoinColumns=t,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner}registerJunctionEntityMetadata(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)}buildInverseSidePropertyPath(){if(this.givenInverseSidePropertyFactory){const e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""}buildPropertyPath(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName}}class en{constructor(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}create(e){return"function"!=typeof this.type?{}:!(null==e?void 0:e.fromDeserializer)||this.isAlwaysUsingConstructor?new this.type:Object.create(this.type.prototype)}build(e){return this.embeddeds.forEach((t=>t.build(e))),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),e.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!e.options.entitySkipConstructor),this}buildPartialPrefix(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new u.K_(`Invalid prefix option given for ${this.entityMetadata.targetName}#${this.propertyName}`)}buildPrefix(e){if("mongodb"===e.driver.options.type)return this.propertyName;let t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push(...this.buildPartialPrefix()),t.join("_")}buildParentPropertyNames(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]}buildParentPrefixes(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()}buildEmbeddedMetadataTree(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]}buildColumnsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildColumnsFromTree())),this.columns)}buildRelationsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationsFromTree())),this.relations)}buildListenersFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildListenersFromTree())),this.listeners)}buildIndicesFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildIndicesFromTree())),this.indices)}buildUniquesFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildUniquesFromTree())),this.uniques)}buildRelationIdsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationIdsFromTree())),this.relationIds)}buildRelationCountsFromTree(){return this.embeddeds.reduce(((e,t)=>e.concat(t.buildRelationCountsFromTree())),this.relationCounts)}}class tn{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}setValue(e){const t=this.relation.getEntityValue(e);if(Array.isArray(t))e[this.propertyName]=t.map((e=>this.relation.inverseEntityMetadata.getEntityIdMixedMap(e))).filter((e=>null!=e));else{const n=this.relation.inverseEntityMetadata.getEntityIdMixedMap(t);void 0!==n&&(e[this.propertyName]=n)}}build(){const e="function"==typeof this.relationNameOrFactory?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new u.K_(`Cannot find relation ${e}. Wrong relation specified for @RelationId decorator.`);this.relation=t}}class nn{constructor(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}build(){const e="function"==typeof this.relationNameOrFactory?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new u.K_(`Cannot find relation ${e}. Wrong relation specified for @RelationCount decorator.`);this.relation=t}}class rn{}rn.AFTER_LOAD="after-load",rn.BEFORE_INSERT="before-insert",rn.AFTER_INSERT="after-insert",rn.BEFORE_UPDATE="before-update",rn.AFTER_UPDATE="after-update",rn.BEFORE_REMOVE="before-remove",rn.AFTER_REMOVE="after-remove",rn.BEFORE_SOFT_REMOVE="before-soft-remove",rn.AFTER_SOFT_REMOVE="after-soft-remove",rn.BEFORE_RECOVER="before-recover",rn.AFTER_RECOVER="after-recover";class an{constructor(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,this.givenName=e.name,e.namingStrategy&&this.build(e.namingStrategy)}build(e){this.columnNames=this.columns.map((e=>e.databaseName)),this.referencedColumnNames=this.referencedColumns.map((e=>e.databaseName)),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=this.givenName?this.givenName:e.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)}}class sn{constructor(e){this.connection=e}build(e,t){var n,r;const i=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),s=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),o=new Oe({connection:this.connection,args:{target:"",name:s,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});o.build();const c=i.map((n=>{const r=t.joinColumns?t.joinColumns.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))):void 0,i=r&&r.name?r.name:this.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new Jt({connection:this.connection,entityMetadata:o,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:i,options:{name:i,length:n.length||!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,type:n.type,precision:n.precision,scale:n.scale,charset:n.charset,collation:n.collation,zerofill:n.zerofill,unsigned:!!n.zerofill||n.unsigned,enum:n.enum,enumName:n.enumName,foreignKeyConstraintName:null==r?void 0:r.foreignKeyConstraintName,nullable:!1,primary:!0}}})})),l=a.map((n=>{const r=t.inverseJoinColumns?t.inverseJoinColumns.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))):void 0,i=r&&r.name?r.name:this.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,n.propertyName,n.databaseName);return new Jt({connection:this.connection,entityMetadata:o,referencedColumn:n,args:{target:"",mode:"virtual",propertyName:i,options:{length:n.length||!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,type:n.type,precision:n.precision,scale:n.scale,charset:n.charset,collation:n.collation,zerofill:n.zerofill,unsigned:!!n.zerofill||n.unsigned,enum:n.enum,enumName:n.enumName,foreignKeyConstraintName:null==r?void 0:r.foreignKeyConstraintName,name:i,nullable:!1,primary:!0}}})}));return this.changeDuplicatedColumnNames(c,l),o.ownerColumns=c,o.inverseColumns=l,o.ownColumns=[...c,...l],o.ownColumns.forEach((t=>t.relationMetadata=e)),o.foreignKeys=e.createForeignKeyConstraints?[new an({entityMetadata:o,referencedEntityMetadata:e.entityMetadata,columns:c,referencedColumns:i,name:null===(n=c[0])||void 0===n?void 0:n.foreignKeyConstraintName,onDelete:"spanner"===this.connection.driver.options.type?"NO ACTION":e.onDelete||"CASCADE",onUpdate:"oracle"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?"NO ACTION":e.onUpdate||"CASCADE"}),new an({entityMetadata:o,referencedEntityMetadata:e.inverseEntityMetadata,columns:l,referencedColumns:a,name:null===(r=l[0])||void 0===r?void 0:r.foreignKeyConstraintName,onDelete:"spanner"===this.connection.driver.options.type?"NO ACTION":e.inverseRelation?e.inverseRelation.onDelete:"CASCADE",onUpdate:"oracle"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?"NO ACTION":e.inverseRelation?e.inverseRelation.onUpdate:"CASCADE"})]:[],o.ownIndices=[new Xt({entityMetadata:o,columns:c,args:{target:o.target,synchronize:!0}}),new Xt({entityMetadata:o,columns:l,args:{target:o.target,synchronize:!0}})],o}collectReferencedColumns(e,t){const n=!!t.joinColumns&&t.joinColumns.find((e=>!!e.referencedColumnName));return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter((e=>e.isPrimary)):t.joinColumns.map((t=>{const n=e.entityMetadata.columns.find((e=>e.propertyName===t.referencedColumnName));if(!n)throw new u.K_(`Referenced column ${t.referencedColumnName} was not found in entity ${e.entityMetadata.name}`);return n}))}collectInverseReferencedColumns(e,t){const n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find((e=>!!e.referencedColumnName));return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map((t=>{const n=e.inverseEntityMetadata.ownColumns.find((e=>e.propertyName===t.referencedColumnName));if(!n)throw new u.K_(`Referenced column ${t.referencedColumnName} was not found in entity ${e.inverseEntityMetadata.name}`);return n}))}changeDuplicatedColumnNames(e,t){e.forEach((e=>{t.forEach((t=>{if(e.givenDatabaseName===t.givenDatabaseName){const n=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=n,e.givenDatabaseName=n;const r=this.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=r,t.givenDatabaseName=r}}))}))}}class on{constructor(e){this.connection=e}build(e){const t=new Oe({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return t.build(),e.primaryColumns.forEach((n=>{t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,closureType:"ancestor",referencedColumn:n,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(n):n.propertyName+"_ancestor",options:{primary:!0,length:n.length,type:n.type}}})),t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,closureType:"descendant",referencedColumn:n,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(n):n.propertyName+"_descendant",options:{primary:!0,length:n.length,type:n.type}}}))})),t.ownIndices=[new Xt({entityMetadata:t,columns:[t.ownColumns[0]],args:{target:t.target,synchronize:!0}}),new Xt({entityMetadata:t,columns:[t.ownColumns[1]],args:{target:t.target,synchronize:!0}})],e.treeLevelColumn&&t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),t.foreignKeys=[new an({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[0]],referencedColumns:e.primaryColumns,onDelete:"mssql"===this.connection.driver.options.type?"NO ACTION":"CASCADE"}),new an({entityMetadata:t,referencedEntityMetadata:e,columns:[t.ownColumns[1]],referencedColumns:e.primaryColumns,onDelete:"mssql"===this.connection.driver.options.type?"NO ACTION":"CASCADE"})],t}}class cn{constructor(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns,this.deferrable=e.args.deferrable)}build(e){const t={};if(this.givenColumnNames){let e=[];if(Array.isArray(this.givenColumnNames))e=this.givenColumnNames.map((e=>this.embeddedMetadata?this.embeddedMetadata.propertyPath+"."+e:e.trim())),e.forEach((e=>t[e]=1));else{const n=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(n)?(e=n.map((e=>String(e))),e.forEach((e=>t[e]=1))):(e=Object.keys(n).map((e=>String(e))),Object.keys(n).forEach((e=>t[e]=n[e])))}this.columns=e.map((e=>{const t=this.entityMetadata.columns.find((t=>t.propertyPath===e));if(t)return[t];const n=this.entityMetadata.relations.find((t=>t.isWithJoinColumn&&t.propertyName===e));if(n)return n.joinColumns;const r=this.givenName?'"'+this.givenName+'" ':"",i=this.entityMetadata.targetName;throw new u.K_(`Unique constraint ${r}contains column that is missing in the entity (${i}): `+e)})).reduce(((e,t)=>e.concat(t)))}return this.columnNamesWithOrderingMap=Object.keys(t).reduce(((e,n)=>{const r=this.entityMetadata.columns.find((e=>e.propertyPath===n));return r&&(e[r.databasePath]=t[n]),e}),{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map((e=>e.databaseName))),this}}class ln{constructor(e){this.connection=e}build(e,t){var n;const r=this.collectReferencedColumns(e,t),i=this.collectColumns(e,t,r);if(!r.length||!t.createForeignKeyConstraints)return{foreignKey:void 0,columns:i,uniqueConstraint:void 0};const a=new an({name:null===(n=e[0])||void 0===n?void 0:n.foreignKeyConstraintName,entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:i,referencedColumns:r,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if("oracle"===this.connection.driver.options.type&&i.every((e=>e.isPrimary)))return{foreignKey:a,columns:i,uniqueConstraint:void 0};if(r.length>0&&t.isOneToOne){const e=new cn({entityMetadata:t.entityMetadata,columns:a.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tableName,a.columns.map((e=>e.databaseName))),target:t.entityMetadata.target}});return e.build(this.connection.namingStrategy),{foreignKey:a,columns:i,uniqueConstraint:e}}return{foreignKey:a,columns:i,uniqueConstraint:void 0}}collectReferencedColumns(e,t){const n=e.find((e=>!!e.referencedColumnName)),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map((e=>{const n=t.inverseEntityMetadata.ownColumns.find((t=>t.propertyName===e.referencedColumnName));if(!n)throw new u.K_(`Referenced column ${e.referencedColumnName} was not found in entity ${t.inverseEntityMetadata.name}`);return n}))}collectColumns(e,t,n){return n.map((n=>{const r=e.find((e=>!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name))),i=r?r.name:this.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName);let a=(t.embeddedMetadata?t.embeddedMetadata.columns:t.entityMetadata.ownColumns).find((e=>e.databaseNameWithoutPrefixes===i));return a||(a=new Jt({connection:this.connection,entityMetadata:t.entityMetadata,embeddedMetadata:t.embeddedMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:i,type:n.type,length:n.length||!R.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,enum:n.enum,enumName:n.enumName,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(a)),a.referencedColumn=n,a.type=n.type,a.relationMetadata=t,a.build(this.connection),a}))}}class un{constructor(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}isAllowed(e){return this.entityMetadata.target===e.constructor||"function"==typeof this.entityMetadata.target&&e.constructor.prototype instanceof this.entityMetadata.target}execute(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))}callEntityEmbeddedMethod(e,t){const n=t.shift();n&&e[n]&&(0===t.length?Array.isArray(e[n])?e[n].map((e=>e[this.propertyName]())):e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))}}class hn{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tableName,this.expression),this}}class dn{constructor(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}build(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this}}class pn{constructor(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new sn(e),this.closureJunctionEntityMetadataBuilder=new on(e),this.relationJoinColumnBuilder=new ln(e)}build(e){const t=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter((e=>"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type)).map((e=>this.createEntityMetadata(e)));return t.forEach((e=>this.computeParentEntityMetadata(t,e))),t.forEach((e=>{e.childEntityMetadatas=t.filter((t=>"function"==typeof e.target&&"function"==typeof t.target&&r.isInherited(t.target,e.target)))})),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>e.build())),t.filter((e=>"entity-child"===e.tableType)).forEach((e=>e.build())),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>this.computeEntityMetadataStep1(t,e))),t.filter((e=>"entity-child"===e.tableType)).forEach((e=>this.computeEntityMetadataStep1(t,e))),t.forEach((e=>this.computeEntityMetadataStep2(e))),t.forEach((e=>this.computeInverseProperties(e,t))),t.filter((e=>"entity-child"!==e.tableType)).forEach((e=>{e.relations.filter((e=>e.isOneToOne||e.isManyToOne)).forEach((t=>{const n=this.metadataArgsStorage.filterJoinColumns(t.target,t.propertyName),{foreignKey:r,columns:i,uniqueConstraint:a}=this.relationJoinColumnBuilder.build(n,t);if(r&&(t.registerForeignKeys(r),e.foreignKeys.push(r)),i&&t.registerJoinColumns(i),a)if(R.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"mssql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){const n=new Xt({entityMetadata:a.entityMetadata,columns:a.columns,args:{target:a.target,name:a.name,unique:!0,synchronize:!0}});"mssql"===this.connection.driver.options.type&&(n.where=n.columns.map((e=>`${this.connection.driver.escape(e.databaseName)} IS NOT NULL`)).join(" AND ")),"spanner"===this.connection.driver.options.type&&(n.isNullFiltered=!0),t.embeddedMetadata?t.embeddedMetadata.indices.push(n):t.entityMetadata.ownIndices.push(n),this.computeEntityMetadataStep2(e)}else t.embeddedMetadata?t.embeddedMetadata.uniques.push(a):t.entityMetadata.ownUniques.push(a),this.computeEntityMetadataStep2(e);if(r&&"cockroachdb"===this.connection.driver.options.type){const n=new Xt({entityMetadata:t.entityMetadata,columns:r.columns,args:{target:t.entityMetadata.target,synchronize:!0}});t.embeddedMetadata?t.embeddedMetadata.indices.push(n):t.entityMetadata.ownIndices.push(n),this.computeEntityMetadataStep2(e)}})),e.relations.filter((e=>e.isManyToMany)).forEach((e=>{const n=this.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(!n)return;const r=this.junctionEntityMetadataBuilder.build(e,n);e.registerForeignKeys(...r.foreignKeys),e.registerJoinColumns(r.ownIndices[0].columns,r.ownIndices[1].columns),e.registerJunctionEntityMetadata(r),this.computeEntityMetadataStep2(r),this.computeInverseProperties(r,t),t.push(r)}))})),t.forEach((e=>{e.relationsWithJoinColumns=e.relations.filter((e=>e.isWithJoinColumn)),e.hasNonNullableRelations=e.relationsWithJoinColumns.some((e=>!e.isNullable||e.isPrimary))})),t.filter((e=>"closure-table"===e.treeType)).forEach((e=>{const n=this.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=n,this.computeEntityMetadataStep2(n),this.computeInverseProperties(n,t),t.push(n)})),t.filter((e=>"STI"===e.inheritancePattern&&e.discriminatorColumn)).forEach((e=>this.createKeysForTableInheritance(e))),t.forEach((e=>{e.indices.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.uniques.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.checks.forEach((e=>e.build(this.connection.namingStrategy)))})),t.forEach((e=>{e.exclusions.forEach((e=>e.build(this.connection.namingStrategy)))})),t.filter((e=>"function"==typeof e.target)).forEach((e=>{e.relations.filter((e=>e.isLazy)).forEach((t=>{this.connection.relationLoader.enableLazyLoad(t,e.target.prototype)}))})),t.forEach((e=>{e.columns.forEach((t=>{const n=this.metadataArgsStorage.findGenerated(t.target,t.propertyName);n&&(t.isGenerated=!0,t.generationStrategy=n.strategy,"uuid"===n.strategy?t.type="uuid":"rowid"===n.strategy?t.type="int":t.type=t.type||Number,t.build(this.connection),this.computeEntityMetadataStep2(e))}))})),t}createEntityMetadata(e){const t="function"==typeof e.target?r.getInheritanceTree(e.target):[e.target],n=this.metadataArgsStorage.findInheritanceType(e.target),i=this.metadataArgsStorage.findTree(e.target);let a;return(n&&"STI"===n.pattern||"entity-child"===e.type)&&(a=this.metadataArgsStorage.filterSingleTableChildren(e.target).map((e=>e.target)).filter((e=>"function"==typeof e)),t.push(...a)),new Oe({connection:this.connection,args:e,inheritanceTree:t,tableTree:i,inheritancePattern:n?n.pattern:void 0})}computeParentEntityMetadata(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find((e=>-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern)))}computeEntityMetadataStep1(e,t){const n=this.metadataArgsStorage.findInheritanceType(t.target),r=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=void 0!==r?r.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map((e=>("STI"===t.inheritancePattern&&(e.columns=e.columns.map((e=>(e.isNullable=!0,e)))),e))),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map((n=>{if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find((e=>e.propertyName===n.propertyName));const r=new Jt({connection:this.connection,entityMetadata:t,args:n});return e.find((e=>"entity-child"===e.tableType&&e.target===n.target))&&(r.isNullable=!0),r})),n&&n.column){const e=n.column&&n.column.name?n.column.name:"type";let r=t.ownColumns.find((t=>t.propertyName===e));r?r.isDiscriminator=!0:(r=new Jt({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:e,options:n.column||{name:e,type:"varchar",nullable:!1}}}),r.isVirtual=!0,r.isDiscriminator=!0,t.ownColumns.push(r))}if("entity-child"===t.tableType){const e=t.parentEntityMetadata.ownColumns.find((e=>e.isDiscriminator));e&&!t.ownColumns.find((t=>t===e))&&t.ownColumns.push(e)}const{namingStrategy:i}=this.connection;if("materialized-path"===t.treeType)t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:i.materializedPathColumnName,type:String,nullable:!0,default:""}}}));else if("nested-set"===t.treeType){const{left:e,right:n}=i.nestedSetColumnNames;t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:e,options:{name:e,type:Number,nullable:!1,default:1}}})),t.ownColumns.push(new Jt({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:n,options:{name:n,type:Number,nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map((e=>{if("entity-child"===t.tableType){const n=t.parentEntityMetadata.ownRelations.find((t=>t.propertyName===e.propertyName)),r="function"==typeof e.type?e.type():e.type;if(n.type!==r){const e=Object.create(n);return e.type=r,e}return n}return new Zt({entityMetadata:t,args:e})})),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map((e=>"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find((t=>t.propertyName===e.propertyName)):new tn({entityMetadata:t,args:e}))),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map((e=>"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find((t=>t.propertyName===e.propertyName)):new nn({entityMetadata:t,args:e}))),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map((e=>new un({entityMetadata:t,args:e}))),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map((e=>new hn({entityMetadata:t,args:e}))),"postgres"===this.connection.driver.options.type&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map((e=>new dn({entityMetadata:t,args:e})))),"cockroachdb"===this.connection.driver.options.type){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((e=>!e.unique)).map((e=>new Xt({entityMetadata:t,args:e})));const e=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((e=>e.unique)).map((e=>new cn({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})));t.ownUniques.push(...e)}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map((e=>new Xt({entityMetadata:t,args:e})));if(R.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){const e=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((e=>new Xt({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})));t.ownIndices.push(...e)}else{const e=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((e=>new cn({entityMetadata:t,args:e})));t.ownUniques.push(...e)}}createEmbeddedsRecursively(e,t){return t.map((t=>{const n=new en({entityMetadata:e,args:t}),i="function"==typeof n.type?r.getInheritanceTree(n.type):[n.type];return n.columns=this.metadataArgsStorage.filterColumns(i).map((t=>new Jt({connection:this.connection,entityMetadata:e,embeddedMetadata:n,args:t}))),n.relations=this.metadataArgsStorage.filterRelations(i).map((t=>new Zt({entityMetadata:e,embeddedMetadata:n,args:t}))),n.listeners=this.metadataArgsStorage.filterListeners(i).map((t=>new un({entityMetadata:e,embeddedMetadata:n,args:t}))),n.indices=this.metadataArgsStorage.filterIndices(i).map((t=>new Xt({entityMetadata:e,embeddedMetadata:n,args:t}))),n.uniques=this.metadataArgsStorage.filterUniques(i).map((t=>new cn({entityMetadata:e,embeddedMetadata:n,args:t}))),n.relationIds=this.metadataArgsStorage.filterRelationIds(i).map((t=>new tn({entityMetadata:e,args:t}))),n.relationCounts=this.metadataArgsStorage.filterRelationCounts(i).map((t=>new nn({entityMetadata:e,args:t}))),n.embeddeds=this.createEmbeddedsRecursively(e,this.metadataArgsStorage.filterEmbeddeds(i)),n.embeddeds.forEach((e=>e.parentEmbeddedMetadata=n)),e.allEmbeddeds.push(n),n}))}computeEntityMetadataStep2(e){e.embeddeds.forEach((e=>e.build(this.connection))),e.embeddeds.forEach((e=>{e.columnsFromTree.forEach((e=>e.build(this.connection))),e.relationsFromTree.forEach((e=>e.build()))})),e.ownColumns.forEach((e=>e.build(this.connection))),e.ownRelations.forEach((e=>e.build())),e.relations=e.embeddeds.reduce(((e,t)=>e.concat(t.relationsFromTree)),e.ownRelations),e.eagerRelations=e.relations.filter((e=>e.isEager)),e.lazyRelations=e.relations.filter((e=>e.isLazy)),e.oneToOneRelations=e.relations.filter((e=>e.isOneToOne)),e.oneToManyRelations=e.relations.filter((e=>e.isOneToMany)),e.manyToOneRelations=e.relations.filter((e=>e.isManyToOne)),e.manyToManyRelations=e.relations.filter((e=>e.isManyToMany)),e.ownerOneToOneRelations=e.relations.filter((e=>e.isOneToOneOwner)),e.ownerManyToManyRelations=e.relations.filter((e=>e.isManyToManyOwner)),e.treeParentRelation=e.relations.find((e=>e.isTreeParent)),e.treeChildrenRelation=e.relations.find((e=>e.isTreeChildren)),e.columns=e.embeddeds.reduce(((e,t)=>e.concat(t.columnsFromTree)),e.ownColumns),e.listeners=e.embeddeds.reduce(((e,t)=>e.concat(t.listenersFromTree)),e.ownListeners),e.afterLoadListeners=e.listeners.filter((e=>e.type===rn.AFTER_LOAD)),e.afterInsertListeners=e.listeners.filter((e=>e.type===rn.AFTER_INSERT)),e.afterUpdateListeners=e.listeners.filter((e=>e.type===rn.AFTER_UPDATE)),e.afterRemoveListeners=e.listeners.filter((e=>e.type===rn.AFTER_REMOVE)),e.afterSoftRemoveListeners=e.listeners.filter((e=>e.type===rn.AFTER_SOFT_REMOVE)),e.afterRecoverListeners=e.listeners.filter((e=>e.type===rn.AFTER_RECOVER)),e.beforeInsertListeners=e.listeners.filter((e=>e.type===rn.BEFORE_INSERT)),e.beforeUpdateListeners=e.listeners.filter((e=>e.type===rn.BEFORE_UPDATE)),e.beforeRemoveListeners=e.listeners.filter((e=>e.type===rn.BEFORE_REMOVE)),e.beforeSoftRemoveListeners=e.listeners.filter((e=>e.type===rn.BEFORE_SOFT_REMOVE)),e.beforeRecoverListeners=e.listeners.filter((e=>e.type===rn.BEFORE_RECOVER)),e.indices=e.embeddeds.reduce(((e,t)=>e.concat(t.indicesFromTree)),e.ownIndices),e.uniques=e.embeddeds.reduce(((e,t)=>e.concat(t.uniquesFromTree)),e.ownUniques),e.primaryColumns=e.columns.filter((e=>e.isPrimary)),e.nonVirtualColumns=e.columns.filter((e=>!e.isVirtual)),e.ancestorColumns=e.columns.filter((e=>"ancestor"===e.closureType)),e.descendantColumns=e.columns.filter((e=>"descendant"===e.closureType)),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter((e=>e.isGenerated||e.isObjectId)),e.hasUUIDGeneratedColumns=e.columns.filter((e=>e.isGenerated||"uuid"===e.generationStrategy)).length>0,e.createDateColumn=e.columns.find((e=>e.isCreateDate)),e.updateDateColumn=e.columns.find((e=>e.isUpdateDate)),e.deleteDateColumn=e.columns.find((e=>e.isDeleteDate)),e.versionColumn=e.columns.find((e=>e.isVersion)),e.discriminatorColumn=e.columns.find((e=>e.isDiscriminator)),e.treeLevelColumn=e.columns.find((e=>e.isTreeLevel)),e.nestedSetLeftColumn=e.columns.find((e=>e.isNestedSetLeft)),e.nestedSetRightColumn=e.columns.find((e=>e.isNestedSetRight)),e.materializedPathColumn=e.columns.find((e=>e.isMaterializedPath)),e.objectIdColumn=e.columns.find((e=>e.isObjectId)),e.foreignKeys.forEach((e=>e.build(this.connection.namingStrategy))),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach((e=>e.build())),e.relationCounts.forEach((e=>e.build())),e.embeddeds.forEach((e=>{e.relationIdsFromTree.forEach((e=>e.build())),e.relationCountsFromTree.forEach((e=>e.build()))}))}computeInverseProperties(e,t){e.relations.forEach((n=>{const r=t.find((e=>e.target===n.type||"string"==typeof n.type&&(e.targetName===n.type||e.givenTableName===n.type)));if(!r)throw new u.K_("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find((e=>e.propertyPath===n.inverseSidePropertyPath))}))}createKeysForTableInheritance(e){e.indices.push(new Xt({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))}}class mn extends u.K_{static createEntitySchemaIsRequiredException(e){return new mn(`EntitySchema is required for ${e} embedded field`)}static createTargetIsRequired(e){return new mn(`Target field is required for ${e} embedded EntitySchema`)}constructor(e){super(e)}}class fn{transform(e){const t=new i;return e.forEach((e=>{const n=e.options,r={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,withoutRowid:!!n.withoutRowid,expression:n.expression};t.tables.push(r),this.transformColumnsRecursive(n,t)})),t}transformColumnsRecursive(e,t){Object.keys(e.columns).forEach((n=>{const r=e.columns[n];let i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.deleteDate&&(i="deleteDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");const a={target:e.target||e.name,mode:i,propertyName:n,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,enumName:r.enumName,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){const i={target:e.target||e.name,propertyName:n,strategy:"string"==typeof r.generated?r.generated:"increment"};t.generations.push(i)}r.unique&&t.uniques.push({target:e.target||e.name,columns:[n]})})),e.relations&&Object.keys(e.relations).forEach((n=>{const r=e.relations[n],i={target:e.target||e.name,propertyName:n,relationType:r.type,isLazy:r.lazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.treeParent,isTreeChildren:r.treeChildren,options:{eager:r.eager||!1,cascade:r.cascade,nullable:r.nullable,onDelete:r.onDelete,onUpdate:r.onUpdate,deferrable:r.deferrable,createForeignKeyConstraints:r.createForeignKeyConstraints,persistence:r.persistence,orphanedRowAction:r.orphanedRowAction}};if(t.relations.push(i),r.joinColumn)if("boolean"==typeof r.joinColumn){const r={target:e.target||e.name,propertyName:n};t.joinColumns.push(r)}else{const i=Array.isArray(r.joinColumn)?r.joinColumn:[r.joinColumn];for(const r of i){const i={target:e.target||e.name,propertyName:n,name:r.name,referencedColumnName:r.referencedColumnName,foreignKeyConstraintName:r.foreignKeyConstraintName};t.joinColumns.push(i)}}if(r.joinTable)if("boolean"==typeof r.joinTable){const r={target:e.target||e.name,propertyName:n};t.joinTables.push(r)}else{const i={target:e.target||e.name,propertyName:n,name:r.joinTable.name,database:r.joinTable.database,schema:r.joinTable.schema,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(i)}})),e.relationIds&&Object.keys(e.relationIds).forEach((n=>{const r=e.relationIds[n],i={propertyName:n,relation:r.relationName,target:e.target||e.name,alias:r.alias,queryBuilderFactory:r.queryBuilderFactory};t.relationIds.push(i)})),e.indices&&e.indices.forEach((n=>{const r={target:e.target||e.name,name:n.name,unique:!0===n.unique,spatial:!0===n.spatial,fulltext:!0===n.fulltext,nullFiltered:!0===n.nullFiltered,parser:n.parser,synchronize:!1!==n.synchronize,where:n.where,sparse:n.sparse,columns:n.columns};t.indices.push(r)})),e.uniques&&e.uniques.forEach((n=>{const r={target:e.target||e.name,name:n.name,columns:n.columns,deferrable:n.deferrable};t.uniques.push(r)})),e.checks&&e.checks.forEach((n=>{const r={target:e.target||e.name,name:n.name,expression:n.expression};t.checks.push(r)})),e.exclusions&&e.exclusions.forEach((n=>{const r={target:e.target||e.name,name:n.name,expression:n.expression};t.exclusions.push(r)})),e.embeddeds&&Object.keys(e.embeddeds).forEach((n=>{const r=e.embeddeds[n];if(!r.schema)throw mn.createEntitySchemaIsRequiredException(n);const i=r.schema.options;t.embeddeds.push({target:e.target||e.name,propertyName:n,isArray:!0===r.array,prefix:void 0!==r.prefix?r.prefix:void 0,type:()=>(null==i?void 0:i.target)||i.name}),this.transformColumnsRecursive(i,t)}))}}class yn{constructor(e){this.connection=e}async buildMigrations(e){const[t,n]=pe.s.splitClassesAndStrings(e);return[...t,...await(this.connection.logger,[])].map((e=>Gt(e)))}async buildSubscribers(e){const[t,n]=pe.s.splitClassesAndStrings(e||[]),r=[...t,...await(this.connection.logger,[])];return Dn().filterSubscribers(r).map((e=>Gt(e.target)))}async buildEntityMetadatas(e){const[t,n]=pe.s.splitClassesAndStrings(e||[]),r=t.filter((e=>!w.a.isEntitySchema(e))),i=t.filter((e=>w.a.isEntitySchema(e))),a=[...r,...await(this.connection.logger,[])];a.forEach((e=>{w.a.isEntitySchema(e)&&i.push(e)}));const s=new pn(this.connection,Dn()).build(a),o=(new fn).transform(i);return[...s,...new pn(this.connection,o).build()]}}var gn=n(261389);class _n{constructor(e){this.options=e}logQuery(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){const n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+n)}}logQueryError(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){const r=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+r),console.log("error:",e)}}logQuerySlow(e,t,n,r){const i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)}logSchemaBuild(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)}logMigration(e,t){console.log(e)}log(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}}stringifyParams(e){try{return JSON.stringify(e)}catch(t){return e}}}class bn{constructor(e){this.options=e}logQuery(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){const n=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");a.logInfo("query:",a.highlightSql(n))}}logQueryError(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){const r=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");a.logError("query failed:",a.highlightSql(r)),a.logError("error:",e)}}logQuerySlow(e,t,n,r){const i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");a.logWarn("query is slow:",a.highlightSql(i)),a.logWarn("execution time:",e)}logSchemaBuild(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&a.log(e)}logMigration(e,t){a.log(e)}log(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&a.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&a.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(a.warn(t))}}stringifyParams(e){try{return JSON.stringify(e)}catch(t){return e}}}class vn{logQuery(){throw new Error("This logger is not applicable in a browser context")}logQueryError(){throw new Error("This logger is not applicable in a browser context")}logQuerySlow(){throw new Error("This logger is not applicable in a browser context")}logSchemaBuild(){throw new Error("This logger is not applicable in a browser context")}logMigration(){throw new Error("This logger is not applicable in a browser context")}log(){throw new Error("This logger is not applicable in a browser context")}}class wn extends vn{}var En=n(925130),Tn=n.n(En);class Sn{constructor(){this.debugQueryLog=Tn()("typeorm:query:log"),this.debugQueryError=Tn()("typeorm:query:error"),this.debugQuerySlow=Tn()("typeorm:query:slow"),this.debugSchemaBuild=Tn()("typeorm:schema"),this.debugMigration=Tn()("typeorm:migration"),this.debugLog=Tn()("typeorm:log"),this.debugInfo=Tn()("typeorm:info"),this.debugWarn=Tn()("typeorm:warn")}logQuery(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(a.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))}logQueryError(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(a.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))}logQuerySlow(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(a.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))}logSchemaBuild(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)}logMigration(e,t){this.debugMigration.enabled&&this.debugMigration(e)}log(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}}}class Nn{create(e,t){if(V.g.isObject(e))return e;if(e)switch(e){case"simple-console":return new _n(t);case"file":return new wn(t);case"advanced-console":return new bn(t);case"debug":return new Sn}return new bn(t)}}class An{constructor(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}async connect(){const e=this.connection.options.cache;if("redis"===this.clientType)this.client=this.redis.createClient({...null==e?void 0:e.options,legacyMode:!0}),"object"==typeof this.connection.options.cache&&this.connection.options.cache.ignoreErrors&&this.client.on("error",(e=>{this.connection.logger.log("warn",e)})),"connect"in this.client&&await this.client.connect();else if("ioredis"===this.clientType)e&&e.port?e.options?this.client=new this.redis(e.port,e.options):this.client=new this.redis(e.port):e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new D.K(`options.startupNodes required for ${this.clientType}.`);this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}}async disconnect(){return new Promise(((e,t)=>{this.client.quit(((n,r)=>{if(n)return t(n);e(),this.client=void 0}))}))}async synchronize(e){}getFromCache(e,t){return new Promise(((t,n)=>{e.identifier?this.client.get(e.identifier,((e,r)=>{if(e)return n(e);t(JSON.parse(r))})):e.query?this.client.get(e.query,((e,r)=>{if(e)return n(e);t(JSON.parse(r))})):t(void 0)}))}isExpired(e){return e.time+e.duration<(new Date).getTime()}async storeInCache(e,t,n){return new Promise(((t,n)=>{e.identifier?this.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,((e,r)=>{if(e)return n(e);t()})):e.query&&this.client.set(e.query,JSON.stringify(e),"PX",e.duration,((e,r)=>{if(e)return n(e);t()}))}))}async clear(e){return new Promise(((e,t)=>{this.client.flushdb(((n,r)=>{if(n)return t(n);e()}))}))}async remove(e,t){await Promise.all(e.map((e=>this.deleteKey(e))))}deleteKey(e){return new Promise(((t,n)=>{this.client.del(e,((e,r)=>{if(e)return n(e);t()}))}))}loadRedis(){try{return"ioredis/cluster"===this.clientType?a.load("ioredis"):a.load(this.clientType)}catch(e){throw new D.K(`Cannot use cache because ${this.clientType} is not installed. Please run "npm i ${this.clientType} --save".`)}}}var Cn=n(888767);class xn{constructor(e){this.connection=e;const{schema:t}=this.connection.driver.options,n=this.connection.driver.database,r=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=n,this.queryResultCacheSchema=t,this.queryResultCacheTable=this.connection.driver.buildTableName(r,t,n)}async connect(){}async disconnect(){}async synchronize(e){e=this.getQueryRunner(e);const t=this.connection.driver;await e.hasTable(this.queryResultCacheTable)||await e.createTable(new _({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"spanner"===t.options.type?"uuid":"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))}getFromCache(e,t){t=this.getQueryRunner(t);const n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(`${n.escape("cache")}.${n.escape("identifier")} = :identifier`).setParameters({identifier:"mssql"===this.connection.driver.options.type?new v(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?"oracle"===this.connection.driver.options.type?n.where(`dbms_lob.compare(${n.escape("cache")}.${n.escape("query")}, :query) = 0`,{query:e.query}).getRawOne():n.where(`${n.escape("cache")}.${n.escape("query")} = :query`).setParameters({query:"mssql"===this.connection.driver.options.type?new v(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)}isExpired(e){const t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()}async storeInCache(e,t,n){const r=void 0===n||"slave"===(null==n?void 0:n.getReplicationMode());(void 0===n||r)&&(n=this.connection.createQueryRunner("master"));let i=e;if("mssql"===this.connection.driver.options.type&&(i={identifier:new v(e.identifier,"nvarchar"),time:new v(e.time,"bigint"),duration:new v(e.duration,"int"),query:new v(e.query,"nvarchar"),result:new v(e.result,"nvarchar")}),t&&t.identifier){const e=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i);e.where(`${e.escape("identifier")} = :condition`,{condition:i.identifier}),await e.execute()}else if(t&&t.query){const e=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i);"oracle"===this.connection.driver.options.type?e.where('dbms_lob.compare("query", :condition) = 0',{condition:i.query}):e.where(`${e.escape("query")} = :condition`,{condition:i.query}),await e.execute()}else"spanner"!==this.connection.driver.options.type||i.id||(i.id=(0,Cn.Z)()),await n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(i).execute();r&&await n.release()}async clear(e){return this.getQueryRunner(e).clearTable(this.queryResultCacheTable)}async remove(e,t){let n=t||this.getQueryRunner();await Promise.all(e.map((e=>{const t=n.manager.createQueryBuilder();return t.delete().from(this.queryResultCacheTable).where(`${t.escape("identifier")} = :identifier`,{identifier:e}).execute()}))),t||await n.release()}getQueryRunner(e){return e||this.connection.createQueryRunner()}}class Mn{constructor(e){this.connection=e}create(){if(!this.connection.options.cache)throw new D.K("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");const e=this.connection.options.cache;return e.provider&&"function"==typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new An(this.connection,e.type):new xn(this.connection)}}class Rn{constructor(e){this.connection=e}load(e,t,n,r){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n,r):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n,r):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n,r):this.loadManyToManyNotOwner(e,t,n,r)}loadManyToOneOrOneToOneOwner(e,t,n,r){const i=Array.isArray(t)?t:[t],a=e.entityMetadata.name,s=r||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),o=s.expressionMap.mainAlias.name,c=e.entityMetadata.primaryColumns,l=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map((t=>`${e.entityMetadata.name}.${t.propertyName} = ${o}.${t.referencedColumn.propertyName}`)).join(" AND ");if(s.innerJoin(e.entityMetadata.target,a,l),1===c.length)s.where(`${a}.${c[0].propertyPath} IN (:...${a+"_"+c[0].propertyName})`),s.setParameter(a+"_"+c[0].propertyName,i.map((e=>c[0].getEntityValue(e,!0))));else{const e=i.map(((e,t)=>c.map(((n,r)=>{const i=a+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e,!0)),a+"."+n.propertyPath+" = :"+i})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");s.where(e)}return q.Z.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadOneToManyOrOneToOneNotOwner(e,t,n,r){const i=Array.isArray(t)?t:[t],a=e.inverseRelation.joinColumns,s=r||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.inverseRelation.entityMetadata.target,e.propertyName),o=s.expressionMap.mainAlias.name;if(1===a.length)s.where(`${o}.${a[0].propertyPath} IN (:...${o+"_"+a[0].propertyName})`),s.setParameter(o+"_"+a[0].propertyName,i.map((e=>a[0].referencedColumn.getEntityValue(e,!0))));else{const e=i.map(((e,t)=>a.map(((n,r)=>{const i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.referencedColumn.getEntityValue(e,!0)),o+"."+n.propertyPath+" = :"+i})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");s.where(e)}return q.Z.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadManyToManyOwner(e,t,n,r){const i=Array.isArray(t)?t:[t],a=e.joinColumns.reduce(((e,t)=>(e[t.propertyName]=i.map((e=>t.referencedColumn.getEntityValue(e,!0))),e)),{}),s=r||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),o=s.expressionMap.mainAlias.name,c=e.junctionEntityMetadata.tableName,l=e.joinColumns.map((e=>`${c}.${e.propertyName} IN (:...${e.propertyName})`)),u=e.inverseJoinColumns.map((e=>`${c}.${e.propertyName}=${o}.${e.referencedColumn.propertyName}`));return s.innerJoin(c,c,[...l,...u].join(" AND ")).setParameters(a),q.Z.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),s.getMany()}loadManyToManyNotOwner(e,t,n,r){const i=Array.isArray(t)?t:[t],a=r||this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName),s=a.expressionMap.mainAlias.name,o=e.junctionEntityMetadata.tableName,c=e.inverseRelation.joinColumns.map((e=>`${o}.${e.propertyName} = ${s}.${e.referencedColumn.propertyName}`)),l=e.inverseRelation.inverseJoinColumns.map((e=>`${o}.${e.propertyName} IN (:...${e.propertyName})`)),u=e.inverseRelation.inverseJoinColumns.reduce(((e,t)=>(e[t.propertyName]=i.map((e=>t.referencedColumn.getEntityValue(e,!0))),e)),{});return a.innerJoin(o,o,[...c,...l].join(" AND ")).setParameters(u),q.Z.joinEagerRelations(a,a.alias,a.expressionMap.mainAlias.metadata),a.getMany()}enableLazyLoad(e,t,n){const r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",s="__has_"+e.propertyName+"__",o=(e,t)=>(e[i]=t,e[s]=!0,delete e[a],t),c=(e,t)=>(delete e[s],delete e[i],e[a]=t,t.then((n=>e[a]===t?o(e,n):n)),t);Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[s]||void 0!==this[i])return Promise.resolve(this[i]);if(this[a])return this[a];const t=r.load(e,this,n).then((t=>e.isOneToOne||e.isManyToOne?0===t.length?null:t[0]:t));return c(this,t)},set:function(e){e instanceof Promise?c(this,e):o(this,e)},configurable:!0})}}class On{constructor(e){this.connection=e}load(e,t,n){const r=Array.isArray(t)?t:[t],i=Array.isArray(n)?n:n?[n]:void 0;return e.isManyToMany?this.loadForManyToMany(e,r,i):e.isManyToOne||e.isOneToOneOwner?this.loadForManyToOneAndOneToOneOwner(e,r,i):this.loadForOneToManyAndOneToOneNotOwner(e,r,i)}async loadManyToManyRelationIdsAndGroup(e,t,n,r){const i=e.isManyToMany||e.isOneToMany,a=Array.isArray(t)?t:[t];if(!n&&!(n=await this.connection.relationLoader.load(e,t,void 0,r)).length)return a.map((e=>({entity:e,related:i?[]:void 0})));const s=await this.load(e,t,n),o=Array.isArray(n)?n:[n];let c=[],l=[];return e.isManyToManyOwner?(c=e.junctionEntityMetadata.inverseColumns.map((e=>e.referencedColumn)),l=e.junctionEntityMetadata.ownerColumns.map((e=>e.referencedColumn))):e.isManyToManyNotOwner?(c=e.junctionEntityMetadata.ownerColumns.map((e=>e.referencedColumn)),l=e.junctionEntityMetadata.inverseColumns.map((e=>e.referencedColumn))):e.isManyToOne||e.isOneToOneOwner?(c=e.joinColumns.map((e=>e.referencedColumn)),l=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(c=e.inverseRelation.entityMetadata.primaryColumns,l=e.inverseRelation.joinColumns.map((e=>e.referencedColumn))),a.map((t=>{const n={entity:t,related:i?[]:void 0},r=s.filter((e=>l.every((n=>n.compareEntityValue(t,e[n.entityMetadata.name+"_"+n.propertyAliasName])))));return r.length?(o.forEach((t=>{r.forEach((r=>{c.every((n=>n.compareEntityValue(t,r[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")])))&&(i?n.related.push(t):n.related=t)}))})),n):n}))}loadForManyToMany(e,t,n){const r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,s=e.isOwning?r.inverseColumns:r.ownerColumns,o=this.connection.createQueryBuilder();a.forEach((e=>{const t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");o.addSelect(i+"."+e.propertyPath,t)})),s.forEach((t=>{const n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");o.addSelect(i+"."+t.propertyPath,n)}));let c="";if(1===a.length){const e=t.map((e=>a[0].referencedColumn.getEntityValue(e)));e.every((e=>"number"==typeof e))?c=`${i}.${a[0].propertyPath} IN (${e.join(", ")})`:(o.setParameter("values1",e),c=i+"."+a[0].propertyPath+" IN (:...values1)")}else c="("+t.map(((e,t)=>a.map((n=>{const r="entity1_"+t+"_"+n.propertyName;return o.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND "))).map((e=>"("+e+")")).join(" OR ")+")";let l="";if(n)if(1===s.length){const e=n.map((e=>s[0].referencedColumn.getEntityValue(e)));e.every((e=>"number"==typeof e))?l=`${i}.${s[0].propertyPath} IN (${e.join(", ")})`:(o.setParameter("values2",e),l=i+"."+s[0].propertyPath+" IN (:...values2)")}else l="("+n.map(((e,t)=>s.map((n=>{const r="entity2_"+t+"_"+n.propertyName;return o.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND "))).map((e=>"("+e+")")).join(" OR ")+")";const u=[c,l].filter((e=>e.length>0)).join(" AND ");return o.from(r.target,i).where(u).getRawMany()}loadForManyToOneAndOneToOneOwner(e,t,n){const r=e.entityMetadata.targetName,i=e.joinColumns.every((t=>!!e.entityMetadata.nonVirtualColumns.find((e=>e===t))));if(n&&i){let r=[];if(t.forEach((t=>{let i={};e.entityMetadata.primaryColumns.forEach((e=>{const n=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");i[n]=e.getEntityValue(t)})),n.forEach((n=>{e.joinColumns.forEach((r=>{const a=r.getEntityValue(t),s=r.referencedColumn.getEntityValue(n);if(void 0!==a&&void 0!==s&&a===s){const t=r.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+r.referencedColumn.propertyPath.replace(".","_");i[t]=s}}))})),Object.keys(i).length===e.entityMetadata.primaryColumns.length+e.joinColumns.length&&r.push(i)})),r.length===t.length)return Promise.resolve(r)}const a=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((e=>{const t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");a.addSelect(r+"."+e.propertyPath,t)})),e.joinColumns.forEach((t=>{const n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");a.addSelect(r+"."+t.propertyPath,n)}));let s="";if(1===e.entityMetadata.primaryColumns.length){const n=t.map((t=>e.entityMetadata.primaryColumns[0].getEntityValue(t)));n.every((e=>"number"==typeof e))?s=`${r}.${e.entityMetadata.primaryColumns[0].propertyPath} IN (${n.join(", ")})`:(a.setParameter("values",n),s=r+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)")}else s=t.map(((t,n)=>e.entityMetadata.primaryColumns.map(((e,i)=>{const s="entity"+n+"_"+i;return a.setParameter(s,e.getEntityValue(t)),r+"."+e.propertyPath+" = :"+s})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");return a.from(e.entityMetadata.target,r).where(s).getRawMany()}loadForOneToManyAndOneToOneNotOwner(e,t,n){if((e=e.inverseRelation).entityMetadata.primaryColumns.length===e.joinColumns.length){if(e.entityMetadata.primaryColumns.every((t=>-1!==e.joinColumns.indexOf(t))))return Promise.resolve(t.map((t=>{const n={};return e.joinColumns.forEach((function(r){const i=r.referencedColumn.getEntityValue(t),a=r.referencedColumn.entityMetadata.name+"_"+r.referencedColumn.propertyPath.replace(".","_"),s=r.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+r.propertyPath.replace(".","_");n[a]=i,n[s]=i})),n})))}const r=e.entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((t=>{const n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)})),e.joinColumns.forEach((e=>{const t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)}));let a="";if(1===e.joinColumns.length){const n=t.map((t=>e.joinColumns[0].referencedColumn.getEntityValue(t)));n.every((e=>"number"==typeof e))?a=`${r}.${e.joinColumns[0].propertyPath} IN (${n.join(", ")})`:(i.setParameter("values",n),a=r+"."+e.joinColumns[0].propertyPath+" IN (:...values)")}else a=t.map(((t,n)=>e.joinColumns.map(((e,a)=>{const s="entity"+n+"_"+a;return i.setParameter(s,e.referencedColumn.getEntityValue(t)),r+"."+e.propertyPath+" = :"+s})).join(" AND "))).map((e=>"("+e+")")).join(" OR ");return i.from(e.entityMetadata.target,r).where(a).getRawMany()}}class In{constructor(e){this["@instanceof"]=Symbol.for("DataSource"),this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new Nn).create(this.options.logger,this.options.logging),this.driver=(new Wt).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new l,this.metadataTableName=e.metadataTableName||"typeorm_metadata",this.queryResultCache=e.cache?new Mn(this).create():void 0,this.relationLoader=new Rn(this),this.relationIdLoader=new On(this),this.isInitialized=!1}get isConnected(){return this.isInitialized}get mongoManager(){if(!w.a.isMongoEntityManager(this.manager))throw new u.K_("MongoEntityManager is only available for MongoDB databases.");return this.manager}get sqljsManager(){if(!w.a.isSqljsEntityManager(this.manager))throw new u.K_("SqljsEntityManager is only available for Sqljs databases.");return this.manager}setOptions(e){return Object.assign(this.options,e),(e.logger||e.logging)&&(this.logger=(new Nn).create(e.logger||this.options.logger,e.logging||this.options.logging)),e.namingStrategy&&(this.namingStrategy=e.namingStrategy),e.cache&&(this.queryResultCache=new Mn(this).create()),this}async initialize(){if(this.isInitialized)throw new u.Lo(this.name);await this.driver.connect(),this.queryResultCache&&await this.queryResultCache.connect(),V.g.assign(this,{isInitialized:!0});try{await this.buildMetadatas(),await this.driver.afterConnect(),this.options.dropSchema&&await this.dropDatabase(),this.options.migrationsRun&&await this.runMigrations({transaction:this.options.migrationsTransactionMode}),this.options.synchronize&&await this.synchronize()}catch(e){throw await this.close(),e}return this}async connect(){return this.initialize()}async destroy(){if(!this.isInitialized)throw new u.$X(this.name);await this.driver.disconnect(),this.queryResultCache&&await this.queryResultCache.disconnect(),V.g.assign(this,{isInitialized:!1})}async close(){return this.destroy()}async synchronize(e=!1){if(!this.isInitialized)throw new u.$X(this.name);e&&await this.dropDatabase();const t=this.driver.createSchemaBuilder();await t.build()}async dropDatabase(){const e=this.createQueryRunner();try{if("mssql"===this.driver.options.type||R.z.isMySQLFamily(this.driver)||"aurora-mysql"===this.driver.options.type||R.z.isSQLiteFamily(this.driver)){const t=[];if(this.entityMetadatas.forEach((e=>{e.database&&-1===t.indexOf(e.database)&&t.push(e.database)})),0===t.length&&this.driver.database&&t.push(this.driver.database),0===t.length)await e.clearDatabase();else for(const n of t)await e.clearDatabase(n)}else await e.clearDatabase()}finally{await e.release()}}async runMigrations(e){if(!this.isInitialized)throw new u.$X(this.name);const t=new E(this);t.transaction=e&&e.transaction||"all",t.fake=e&&e.fake||!1;return await t.executePendingMigrations()}async undoLastMigration(e){if(!this.isInitialized)throw new u.$X(this.name);const t=new E(this);t.transaction=e&&e.transaction||"all",t.fake=e&&e.fake||!1,await t.undoLastMigration()}async showMigrations(){if(!this.isInitialized)throw new u.$X(this.name);const e=new E(this);return await e.showMigrations()}hasMetadata(e){return!!this.findMetadata(e)}getMetadata(e){const t=this.findMetadata(e);if(!t)throw new u.tG(e);return t}getRepository(e){return this.manager.getRepository(e)}getTreeRepository(e){return this.manager.getTreeRepository(e)}getMongoRepository(e){if("mongodb"!==this.driver.options.type)throw new u.K_("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)}getCustomRepository(e){return this.manager.getCustomRepository(e)}async transaction(e,t){const n=(t||{}).entitiesToLock;return this.manager.transaction(e,t,n)}async query(e,t,n){if(w.a.isMongoEntityManager(this.manager))throw new u.K_("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new u.iU;const r=n||this.createQueryRunner();try{return await r.query(e,t)}finally{n||await r.release()}}createQueryBuilder(e,t,n){if(w.a.isMongoEntityManager(this.manager))throw new u.K_("Query Builder is not supported by MongoDB.");if(t){t=R.z.buildAlias(this.driver,t);const r=this.getMetadata(e);return new gn.Z(this,n).select(t).from(r.target,t)}return new gn.Z(this,e)}createQueryRunner(e="master"){const t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t}getManyToManyMetadata(e,t){const n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new u.K_(`Relation "${t}" was not found in ${e} entity.`);if(!n.isManyToMany)throw new u.K_(`Relation "${e}#${t}" does not have a many-to-many relationship.You can use this method only on many-to-many relations.`);return n.junctionEntityMetadata}createEntityManager(e){return(new Je).create(this,e)}findMetadata(e){return this.entityMetadatas.find((t=>t.target===e||(w.a.isEntitySchema(e)?t.name===e.options.name:"string"==typeof e?-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e:!(!V.g.isObject(e)||"string"!=typeof e.name)&&(-1!==e.name.indexOf(".")?t.tablePath===e.name:t.name===e.name||t.tableName===e.name))))}async buildMetadatas(){const e=new yn(this),t=new O,n=V.g.mixedListToArray(this.options.subscribers||[]),r=await e.buildSubscribers(n);V.g.assign(this,{subscribers:r});const i=V.g.mixedListToArray(this.options.entities||[]),a=await e.buildEntityMetadatas(i);V.g.assign(this,{entityMetadatas:a});const s=V.g.mixedListToArray(this.options.migrations||[]),o=await e.buildMigrations(s);V.g.assign(this,{migrations:o}),t.validateMany(this.entityMetadatas.filter((e=>"view"!==e.tableType)),this.driver);for(let e of a)w.a.isBaseEntityConstructor(e.target)&&e.target.useDataSource(this)}}var kn=n(642888),Pn=n(85554);class Ln{constructor(){this.connectionMap=new Map}get connections(){return Array.from(this.connectionMap.values())}has(e){return this.connectionMap.has(e)}get(e="default"){const t=this.connectionMap.get(e);if(!t)throw new kn.B(e);return t}create(e){const t=this.connectionMap.get(e.name||"default");if(t&&t.isInitialized)throw new Pn.n(e.name||"default");const n=new In(e);return this.connectionMap.set(n.name,n),n}}function Dn(){const e=a.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new i),e.typeormMetadataArgsStorage}async function qn(e="default"){return(new s).get(e)}function Bn(){return Gt(Ln)}async function jn(e){const t="string"==typeof e?e:"default",n=V.g.isObject(e)?e:await qn(t);return Bn().create(n).connect()}async function $n(e){e||(e=await(new s).all());const t=e.map((e=>Bn().create(e)));for(const e of t)await e.connect();return t}function Un(e="default"){return Bn().get(e)}function Fn(e="default"){return Bn().get(e).manager}function Kn(e="default"){return Bn().get(e).manager}function Wn(e="default"){return Bn().get(e).manager}function Vn(e,t="default"){return Bn().get(t).getRepository(e)}function Hn(e,t="default"){return Bn().get(t).getTreeRepository(e)}function Qn(e,t="default"){return Bn().get(t).getCustomRepository(e)}function zn(e,t="default"){return Bn().get(t).getMongoRepository(e)}function Gn(e,t,n="default"){return e?Vn(e,n).createQueryBuilder(t):Un(n).createQueryBuilder()}var Yn=n(893383);function Jn(e,t){return function(n,r){let i;"string"==typeof e||"function"==typeof e?i=e:e&&(t=e,i=e.type),t||(t={});const a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),"function"==typeof e)Dn().embeddeds.push({target:n.constructor,propertyName:r,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new Yn.s(n,r);!0===t.unique&&Dn().uniques.push({target:n.constructor,columns:[r]}),Dn().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&Dn().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function Xn(e){return function(t,n){Dn().columns.push({target:t.constructor,propertyName:n,mode:"createDate",options:e||{}})}}function Zn(e){return function(t,n){Dn().columns.push({target:t.constructor,propertyName:n,mode:"deleteDate",options:e||{}})}}function er(e,t){const n={};let r;return e?("string"==typeof e&&(r=e),V.g.isObject(e)&&(r="increment",Object.assign(n,e))):r="increment",V.g.isObject(t)&&Object.assign(n,t),function(e,t){n.type||("increment"===r||"identity"===r?n.type=Number:"uuid"===r?n.type="uuid":"rowid"===r&&(n.type="int")),n.primary=!0,Dn().columns.push({target:e.constructor,propertyName:t,mode:"regular",options:n}),Dn().generations.push({target:e.constructor,propertyName:t,strategy:r})}}var tr=n(901716);function nr(e,t){return function(n,r){let i;"string"==typeof e||e===String||e===Boolean||e===Number?i=e:t=Object.assign({},e),t||(t={});const a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),!t.type)throw new Yn.s(n,r);if(t.nullable)throw new tr.I(n,r);t.primary=!0,Dn().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&Dn().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}function rr(e){return function(t,n){Dn().columns.push({target:t.constructor,propertyName:n,mode:"updateDate",options:e||{}})}}function ir(e){return function(t,n){Dn().columns.push({target:t.constructor,propertyName:n,mode:"version",options:e||{}})}}function ar(e){return function(t,n){Dn().columns.push({target:t.constructor,propertyName:n,mode:"regular",options:e||{}})}}function sr(e){return function(t,n){e||(e={}),e.primary=!0,e.name||(e.name="_id"),Dn().columns.push({target:t.constructor,propertyName:n,mode:"objectId",options:e})}}function or(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_INSERT})}}function cr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_LOAD})}}function lr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_REMOVE})}}function ur(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_SOFT_REMOVE})}}function hr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_RECOVER})}}function dr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.AFTER_UPDATE})}}function pr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.BEFORE_INSERT})}}function mr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.BEFORE_REMOVE})}}function fr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.BEFORE_SOFT_REMOVE})}}function yr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.BEFORE_RECOVER})}}function gr(){return function(e,t){Dn().entityListeners.push({target:e.constructor,propertyName:t,type:rn.BEFORE_UPDATE})}}function _r(){return function(e){Dn().entitySubscribers.push({target:e})}}function br(e){return function(t,n){(Array.isArray(e)?e:[e||{}]).forEach((e=>{Dn().joinColumns.push({target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName,foreignKeyConstraintName:e.foreignKeyConstraintName})}))}}function vr(e){return function(t,n){e=e||{},Dn().joinTables.push({target:t.constructor,propertyName:n,name:e.name,joinColumns:e&&e.joinColumn?[e.joinColumn]:e.joinColumns,inverseJoinColumns:e&&e.inverseJoinColumn?[e.inverseJoinColumn]:e.inverseJoinColumns,schema:e&&e.schema?e.schema:void 0,database:e&&e.database?e.database:void 0})}}function wr(e,t,n){let r;return V.g.isObject(t)?n=t:r=t,function(t,i){n||(n={});let a=!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){const e=Reflect.getMetadata("design:type",t,i);e&&"string"==typeof e.name&&"promise"===e.name.toLowerCase()&&(a=!0)}Dn().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-many",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function Er(e,t,n){let r;return V.g.isObject(t)?n=t:r=t,function(t,i){n||(n={});let a=n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){const e=Reflect.getMetadata("design:type",t,i);e&&"string"==typeof e.name&&"promise"===e.name.toLowerCase()&&(a=!0)}Dn().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function Tr(e,t,n){return function(r,i){n||(n={});let a=n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){const e=Reflect.getMetadata("design:type",r,i);e&&"string"==typeof e.name&&"promise"===e.name.toLowerCase()&&(a=!0)}Dn().relations.push({target:r.constructor,propertyName:i,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n})}}function Sr(e,t,n){let r;return V.g.isObject(t)?n=t:r=t,function(t,i){n||(n={});let a=!(!n||!0!==n.lazy);if(!a&&Reflect&&Reflect.getMetadata){const e=Reflect.getMetadata("design:type",t,i);e&&"string"==typeof e.name&&"promise"===e.name.toLowerCase()&&(a=!0)}Dn().relations.push({target:t.constructor,propertyName:i,isLazy:a,relationType:"one-to-one",type:e,inverseSideProperty:r,options:n})}}function Nr(e,t,n){return function(r,i){Dn().relationCounts.push({target:r.constructor,propertyName:i,relation:e,alias:t,queryBuilderFactory:n})}}function Ar(e,t,n){return function(r,i){Dn().relationIds.push({target:r.constructor,propertyName:i,relation:e,alias:t,queryBuilderFactory:n})}}function Cr(e,t){const n=(V.g.isObject(e)?e:t)||{},r="string"==typeof e?e:n.name;return function(e){Dn().tables.push({target:e,name:r,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize,withoutRowid:n.withoutRowid})}}function xr(e){return function(t){Dn().tables.push({target:t,type:"entity-child"}),void 0!==e&&Dn().discriminatorValues.push({target:t,value:e})}}function Mr(e){return function(t){Dn().inheritances.push({target:t,pattern:e&&e.pattern?e.pattern:"STI",column:e&&e.column?"string"==typeof e.column?{name:e.column}:e.column:void 0})}}function Rr(e,t){const n=(V.g.isObject(e)?e:t)||{},r="string"==typeof e?e:n.name;return function(e){Dn().tables.push({target:e,name:r,expression:n.expression,dependsOn:n.dependsOn?new Set(n.dependsOn):void 0,type:"view",database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:!1!==n.synchronize,materialized:!!n.materialized})}}function Or(){return function(e,t){Dn().columns.push({target:e.constructor,propertyName:t,mode:"treeLevel",options:{}})}}function Ir(e){return function(t,n){e||(e={});const r=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",t,n):void 0,i=r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()||!1;Dn().relations.push({isTreeParent:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"many-to-one",type:()=>t.constructor,options:e})}}function kr(e){return function(t,n){e||(e={});const r=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",t,n):void 0,i=r&&"string"==typeof r.name&&"promise"===r.name.toLowerCase()||!1;Dn().relations.push({isTreeChildren:!0,target:t.constructor,propertyName:n,isLazy:i,relationType:"one-to-many",type:()=>t.constructor,options:e})}}function Pr(e,t){return function(n){Dn().trees.push({target:n,type:e,options:"closure-table"===e?t:void 0})}}function Lr(e,t,n){const r="string"==typeof e?e:void 0,i="string"==typeof e?t:e;let a=V.g.isObject(e)&&!Array.isArray(e)?e:n;return a||(a=V.g.isObject(t)&&!Array.isArray(t)?t:n),function(e,t){Dn().indices.push({target:t?e.constructor:e,name:r,columns:t?[t]:i,synchronize:!a||!1!==a.synchronize,where:a?a.where:void 0,unique:!(!a||!a.unique),spatial:!(!a||!a.spatial),fulltext:!(!a||!a.fulltext),nullFiltered:!(!a||!a.nullFiltered),parser:a?a.parser:void 0,sparse:!(!a||!a.sparse),background:!(!a||!a.background),expireAfterSeconds:a?a.expireAfterSeconds:void 0})}}function Dr(e,t,n){const r="string"==typeof e?e:void 0,i="string"==typeof e?t:e;let a=V.g.isObject(e)&&!Array.isArray(e)?e:n;return a||(a=V.g.isObject(e)&&!Array.isArray(t)?t:n),function(e,t){let n=i;if(void 0!==t)switch(typeof t){case"string":n=[t];break;case"symbol":n=[t.toString()]}const s={target:t?e.constructor:e,name:r,columns:n,deferrable:a?a.deferrable:void 0};Dn().uniques.push(s)}}function qr(e,t){const n=t?e:void 0,r=t||e;if(!r)throw new u.K_("Check expression is required");return function(e,t){Dn().checks.push({target:t?e.constructor:e,name:n,expression:r})}}function Br(e,t){const n=t?e:void 0,r=t||e;if(!r)throw new u.K_("Exclusion expression is required");return function(e,t){Dn().exclusions.push({target:t?e.constructor:e,name:n,expression:r})}}function jr(e="increment"){return function(t,n){Dn().generations.push({target:t.constructor,propertyName:n,strategy:e})}}function $r(e){return function(t){Dn().entityRepositories.push({target:t,entity:e})}}function Ur(e){return new Ue.J("any",e)}function Fr(e){return new Ue.J("arrayContainedBy",e)}function Kr(e){return new Ue.J("arrayContains",e)}function Wr(e){return new Ue.J("arrayOverlap",e)}function Vr(e,t){return new Ue.J("between",[e,t],!0,!0)}class Hr extends Ue.J{constructor(e){super("equal",e),this["@instanceof"]=Symbol.for("EqualOperator")}}function Qr(e){return new Hr(e)}var zr=n(388577);function Gr(){return new Ue.J("isNull",void 0,!1)}function Yr(e){return new Ue.J("ilike",e)}function Jr(e){return new Ue.J("like",e)}function Xr(e){return new Ue.J("not",e)}function Zr(e,t){return"function"!=typeof e?new Ue.J("raw",e,!1):new Ue.J("raw",[],!0,!0,e,t)}class ei{hasId(){return this.constructor.getRepository().hasId(this)}save(e){return this.constructor.getRepository().save(this,e)}remove(e){return this.constructor.getRepository().remove(this,e)}softRemove(e){return this.constructor.getRepository().softRemove(this,e)}recover(e){return this.constructor.getRepository().recover(this,e)}async reload(){const e=this.constructor,t=e.getRepository().metadata.getEntityIdMap(this);if(!t)throw new Error("Entity doesn't have id-s set, cannot reload entity");const n=await e.getRepository().findOneByOrFail(t);V.g.assign(this,n)}static useDataSource(e){this.dataSource=e}static getRepository(){const e=this.dataSource;if(!e)throw new Error("DataSource is not set for this entity.");return e.getRepository(this)}static get target(){return this.getRepository().target}static hasId(e){return this.getRepository().hasId(e)}static getId(e){return this.getRepository().getId(e)}static createQueryBuilder(e){return this.getRepository().createQueryBuilder(e)}static create(e){return this.getRepository().create(e)}static merge(e,...t){return this.getRepository().merge(e,...t)}static preload(e){return this.getRepository().preload(e)}static save(e,t){return this.getRepository().save(e,t)}static remove(e,t){return this.getRepository().remove(e,t)}static softRemove(e,t){return this.getRepository().softRemove(e,t)}static insert(e){return this.getRepository().insert(e)}static update(e,t){return this.getRepository().update(e,t)}static upsert(e,t){return this.getRepository().upsert(e,t)}static delete(e){return this.getRepository().delete(e)}static count(e){return this.getRepository().count(e)}static countBy(e){return this.getRepository().countBy(e)}static find(e){return this.getRepository().find(e)}static findBy(e){return this.getRepository().findBy(e)}static findAndCount(e){return this.getRepository().findAndCount(e)}static findAndCountBy(e){return this.getRepository().findAndCountBy(e)}static findByIds(e){return this.getRepository().findByIds(e)}static findOne(e){return this.getRepository().findOne(e)}static findOneBy(e){return this.getRepository().findOneBy(e)}static findOneById(e){return this.getRepository().findOneById(e)}static findOneOrFail(e){return this.getRepository().findOneOrFail(e)}static findOneByOrFail(e){return this.getRepository().findOneByOrFail(e)}static query(e,t){return this.getRepository().query(e,t)}static clear(){return this.getRepository().clear()}}class ti extends In{}var ni=n(5778),ri=n(924750),ii=n(512200),ai=n(537041),si=n(656933),oi=n(581989);class ci extends oi.D{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("NotBrackets")}}class li{constructor(e){this.options=e,this["@instanceof"]=Symbol.for("EntitySchema")}}class ui{}class hi{}},251279:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AuroraMysqlDriver:()=>c,AuroraPostgresDriver:()=>u,BetterSqlite3Driver:()=>y,CockroachDriver:()=>l,MongoDriver:()=>r,MongoEntityManager:()=>a,MongoQueryRunner:()=>i,MongoRepository:()=>s,MysqlDriver:()=>p,OracleDriver:()=>m,PostgresDriver:()=>o,SapDriver:()=>d,SqlServerDriver:()=>h,SqliteDriver:()=>f});class r{}class i{}class a{}class s{}class o{}class c{}class l{}class u{}class h{}class d{}class p{}class m{}class f{}class y{}},581989:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});class r{constructor(e){this["@instanceof"]=Symbol.for("Brackets"),this.whereFactory=e}}},924750:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(5778),i=n(100698),a=n(976588),s=n(312758);class o extends r.z{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("DeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createDeleteExpression(),e.trim()}async execute(){const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();let r=!1;try{!0===this.expressionMap.useTransaction&&!1===n.isTransactionActive&&(await n.startTransaction(),r=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await n.broadcaster.broadcast("BeforeRemove",this.expressionMap.mainAlias.metadata);const a=await n.query(e,t,!0),s=i.y.from(a);return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await n.broadcaster.broadcast("AfterRemove",this.expressionMap.mainAlias.metadata),r&&await n.commitTransaction(),s}catch(e){if(r)try{await n.rollbackTransaction()}catch(e){}throw e}finally{n!==this.queryRunner&&await n.release()}}from(e,t){e=s.a.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("delete"))throw new a.y;return this.expressionMap.returning=e,this}createDeleteExpression(){const e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression("delete");return""===n?`DELETE FROM ${e}${t}`:"mssql"===this.connection.driver.options.type?`DELETE FROM ${e} OUTPUT ${n}${t}`:`DELETE FROM ${e}${t} RETURNING ${n}`}}},512200:(e,t,n)=>{"use strict";n.d(t,{O:()=>m});var r=n(5778),i=n(787493),a=n(976588),s=n(299594),o=n(14550),c=n(172943),l=n(600706),u=n(888767),h=n(407337),d=n(503681),p=n(312758);class m extends r.z{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("InsertQueryBuilder")}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createInsertExpression(),e.trim()}async execute(){const e=this.getValueSets();if(0===e.length)return new i.t;const t=this.obtainQueryRunner();let n=!1;try{if(!0===this.expressionMap.useTransaction&&!1===t.isTransactionActive&&(await t.startTransaction(),n=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata){const n=new c.D;e.forEach((e=>{t.broadcaster.broadcastBeforeInsertEvent(n,this.expressionMap.mainAlias.metadata,e)})),await n.wait()}let r=null,a=null;const s=new o.v(t,this.expressionMap),l=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const e of this.expressionMap.returning)l.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(e));!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&"oracle"===this.connection.driver.options.type||(this.expressionMap.extraReturningColumns=this.expressionMap.mainAlias.metadata.getInsertionReturningColumns()),l.push(...this.expressionMap.extraReturningColumns.filter((e=>!l.includes(e))))),l.length>0&&"mssql"===this.connection.driver.options.type&&(r=this.connection.driver.buildTableVariableDeclaration("@OutputTable",l),a="SELECT * FROM @OutputTable");const[u,h]=this.getQueryAndParameters(),d=[r,u,a].filter((e=>null!=e)).join(";\n\n"),p=await t.query(d,h,!0),m=i.t.from(p);if(!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&await s.insert(m,e),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata){const n=new c.D;e.forEach((e=>{t.broadcaster.broadcastAfterInsertEvent(n,this.expressionMap.mainAlias.metadata,e)})),await n.wait()}return n&&await t.commitTransaction(),m}catch(e){if(n)try{await t.rollbackTransaction()}catch(e){}throw e}finally{t!==this.queryRunner&&await t.release()}}into(e,t){e=p.a.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this}values(e){return this.expressionMap.valuesSet=e,this}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("insert"))throw new a.y;return this.expressionMap.returning=e,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}onConflict(e){return this.expressionMap.onConflict=e,this}orIgnore(e=!0){return this.expressionMap.onIgnore=!!e,this}orUpdate(e,t,n){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:t,skipUpdateIfNoValuesChanged:null==n?void 0:n.skipUpdateIfNoValuesChanged},this):(this.expressionMap.onUpdate={conflict:null==e?void 0:e.conflict_target,columns:null==e?void 0:e.columns,overwrite:null==e?void 0:e.overwrite,skipUpdateIfNoValuesChanged:null==n?void 0:n.skipUpdateIfNoValuesChanged},this)}createInsertExpression(){const e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n="oracle"===this.connection.driver.options.type&&this.getValueSets().length>1?null:this.createReturningExpression("insert"),r=this.createColumnNamesExpression();let i="INSERT ";if((h.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type)&&(i+=""+(this.expressionMap.onIgnore?" IGNORE ":"")),i+=`INTO ${e}`,this.alias!==this.getMainTableName()&&h.z.isPostgresFamily(this.connection.driver)&&(i+=` AS "${this.alias}"`),r?i+=`(${r})`:t||!h.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||(i+="()"),n&&"mssql"===this.connection.driver.options.type&&(i+=` OUTPUT ${n}`),t?"oracle"===this.connection.driver.options.type&&this.getValueSets().length>1?i+=` ${t}`:i+=` VALUES ${t}`:h.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type?i+=" VALUES ()":i+=" DEFAULT VALUES","on-conflict-do-update"===this.connection.driver.supportedUpsertType){if(this.expressionMap.onIgnore)i+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)i+=` ON CONFLICT ${this.expressionMap.onConflict} `;else if(this.expressionMap.onUpdate){const{overwrite:t,columns:n,conflict:r,skipUpdateIfNoValuesChanged:a}=this.expressionMap.onUpdate;let s="ON CONFLICT";Array.isArray(r)?s+=` ( ${r.map((e=>this.escape(e))).join(", ")} )`:r&&(s+=` ON CONSTRAINT ${this.escape(r)}`),Array.isArray(t)?(i+=` ${s} DO UPDATE SET `,i+=null==t?void 0:t.map((e=>`${this.escape(e)} = EXCLUDED.${this.escape(e)}`)).join(", "),i+=" "):n&&(i+=` ${s} DO UPDATE SET `,i+=n.map((e=>`${this.escape(e)} = :${e}`)).join(", "),i+=" "),Array.isArray(t)&&a&&h.z.isPostgresFamily(this.connection.driver)&&(i+=" WHERE (",i+=t.map((t=>`${e}.${this.escape(t)} IS DISTINCT FROM EXCLUDED.${this.escape(t)}`)).join(" OR "),i+=") ")}}else if("on-duplicate-key-update"===this.connection.driver.supportedUpsertType){if(this.expressionMap.onUpdate){const{overwrite:e,columns:t}=this.expressionMap.onUpdate;Array.isArray(e)?(i+=" ON DUPLICATE KEY UPDATE ",i+=e.map((e=>`${this.escape(e)} = VALUES(${this.escape(e)})`)).join(", "),i+=" "):Array.isArray(t)&&(i+=" ON DUPLICATE KEY UPDATE ",i+=t.map((e=>`${this.escape(e)} = :${e}`)).join(", "),i+=" ")}}else if(this.expressionMap.onUpdate)throw new l.K_("onUpdate is not supported by the current database driver");return n&&(h.z.isPostgresFamily(this.connection.driver)||"oracle"===this.connection.driver.options.type||"cockroachdb"===this.connection.driver.options.type||h.z.isMySQLFamily(this.connection.driver))&&(i+=` RETURNING ${n}`),"mssql"===this.connection.driver.options.type&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter((e=>this.expressionMap.insertColumns.length>0?-1!==this.expressionMap.insertColumns.indexOf(e.propertyPath):e.isInsert)).some((e=>this.isOverridingAutoIncrementBehavior(e)))&&(i=`SET IDENTITY_INSERT ${e} ON; ${i}; SET IDENTITY_INSERT ${e} OFF`),i}getInsertedColumns(){return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter((e=>this.expressionMap.insertColumns.length?-1!==this.expressionMap.insertColumns.indexOf(e.propertyPath):!!e.isInsert&&!!(!e.isGenerated||"increment"!==e.generationStrategy||"spanner"===this.connection.driver.options.type||"oracle"===this.connection.driver.options.type||h.z.isSQLiteFamily(this.connection.driver)||h.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"mssql"===this.connection.driver.options.type&&this.isOverridingAutoIncrementBehavior(e)))):[]}createColumnNamesExpression(){const e=this.getInsertedColumns();if(e.length>0)return e.map((e=>this.escape(e.databaseName))).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){const e=this.getValueSets();if(1===e.length)return Object.keys(e[0]).map((e=>this.escape(e))).join(", ")}return this.expressionMap.insertColumns.map((e=>this.escape(e))).join(", ")}createValuesExpression(){const e=this.getValueSets(),t=this.getInsertedColumns();if(t.length>0){let n="";return e.forEach(((r,i)=>{t.forEach(((a,s)=>{0===s&&("oracle"===this.connection.driver.options.type&&e.length>1||"sap"===this.connection.driver.options.type&&e.length>1?n+=" SELECT ":n+="(");let o=a.getEntityValue(r);if("function"!=typeof o&&(o=this.connection.driver.preparePersistentValue(o,a)),a.isVersion&&void 0===o)n+="1";else if(a.isDiscriminator)n+=this.createParameter(this.expressionMap.mainAlias.metadata.discriminatorValue);else if(a.isGenerated&&"uuid"===a.generationStrategy&&!this.connection.driver.isUUIDGenerationSupported()&&void 0===o)o=(0,u.Z)(),n+=this.createParameter(o),i in this.expressionMap.locallyGenerated||(this.expressionMap.locallyGenerated[i]={}),a.setEntityValue(this.expressionMap.locallyGenerated[i],o);else if(void 0===o)"oracle"===this.connection.driver.options.type&&e.length>1||h.z.isSQLiteFamily(this.connection.driver)||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?void 0!==a.default&&null!==a.default?n+=this.connection.driver.normalizeDefault(a):n+="NULL":n+="DEFAULT";else if(null===o&&"spanner"===this.connection.driver.options.type)n+="NULL";else if("function"==typeof o)n+=o();else{"mssql"===this.connection.driver.options.type&&(o=this.connection.driver.parametrizeValue(a,o));const e=this.createParameter(o);if(!h.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||-1===this.connection.driver.spatialTypes.indexOf(a.type))h.z.isPostgresFamily(this.connection.driver)&&-1!==this.connection.driver.spatialTypes.indexOf(a.type)?null!=a.srid?n+=`ST_SetSRID(ST_GeomFromGeoJSON(${e}), ${a.srid})::${a.type}`:n+=`ST_GeomFromGeoJSON(${e})::${a.type}`:"mssql"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(a.type)?n+=a.type+"::STGeomFromText("+e+", "+(a.srid||"0")+")":n+=e;else{const t=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=a.srid?n+=`${t}(${e}, ${a.srid})`:n+=`${t}(${e})`}}s===t.length-1?i===e.length-1?"oracle"===this.connection.driver.options.type&&e.length>1?n+=" FROM DUAL ":"sap"===this.connection.driver.options.type&&e.length>1?n+=" FROM dummy ":n+=")":"oracle"===this.connection.driver.options.type&&e.length>1?n+=" FROM DUAL UNION ALL ":"sap"===this.connection.driver.options.type&&e.length>1?n+=" FROM dummy UNION ALL ":n+="), ":n+=", "}))})),"()"===n?"":n}{let t="";return e.forEach(((n,r)=>{Object.keys(n).forEach(((i,a)=>{0===a&&(t+="(");const s=n[i];"function"==typeof s?t+=s():void 0===s?"oracle"===this.connection.driver.options.type&&e.length>1||h.z.isSQLiteFamily(this.connection.driver)||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type?t+="NULL":t+="DEFAULT":null===s&&"spanner"===this.connection.driver.options.type||(t+=this.createParameter(s)),a===Object.keys(n).length-1?r===e.length-1?t+=")":t+="), ":t+=", "}))})),"()"===t?"":t}}getValueSets(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(d.g.isObject(this.expressionMap.valuesSet))return[this.expressionMap.valuesSet];throw new s.D}isOverridingAutoIncrementBehavior(e){return e.isPrimary&&e.isGenerated&&"increment"===e.generationStrategy&&this.getValueSets().some((t=>void 0!==e.getEntityValue(t)&&null!==e.getEntityValue(t)))}}},801072:(e,t,n)=>{"use strict";n.d(t,{k:()=>o});var r=n(395008),i=n(503681),a=n(600706),s=n(407337);class o{constructor(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,i.g.assign(this,n||{})}get isMany(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)}get isSelected(){if(!this.isSelectedEvaluated){let e=()=>{for(const e of this.queryExpressionMap.selects){if(e.selection===this.alias.name)return!0;if(this.metadata&&this.metadata.columns.find((t=>e.selection===this.alias.name+"."+t.propertyPath)))return!0}return!1};this.isSelectedCache=e(),this.isSelectedEvaluated=!0}return this.isSelectedCache}get tablePath(){return this.metadata?this.metadata.tablePath:this.entityOrProperty}get parentAlias(){if(r.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))}get relationPropertyPath(){if(r.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)}get relation(){if(!this.relationEvaluated){let e=()=>{if(!r.G.isAliasProperty(this.entityOrProperty))return;const e=this.queryExpressionMap.findAliasByName(this.parentAlias);let t=e.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(t)return t;if(e.metadata.parentEntityMetadata&&(t=e.metadata.parentEntityMetadata.findRelationWithPropertyPath(this.relationPropertyPath),t))return t;throw new a.K_(`Relation with property path ${this.relationPropertyPath} in entity was not found.`)};this.relationCache=e.bind(this)(),this.relationEvaluated=!0}return this.relationCache}get metadata(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0}get junctionAlias(){if(!this.relation)throw new a.K_("Cannot get junction table for join without relation.");return this.relation.isOwning?s.z.buildAlias(this.connection.driver,this.parentAlias,this.alias.name):s.z.buildAlias(this.connection.driver,this.alias.name,this.parentAlias)}get mapToPropertyParentAlias(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]}get mapToPropertyPropertyName(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]}}},5778:(e,t,n)=>{"use strict";n.d(t,{z:()=>y});var r=n(503681),i=n(600706);class a{constructor(e){r.g.assign(this,e||{})}get target(){return this.metadata.target}get hasMetadata(){return!!this._metadata}set metadata(e){this._metadata=e}get metadata(){if(!this._metadata)throw new i.K_(`Cannot get entity metadata for the given alias "${this.name}"`);return this._metadata}}var s=n(801072),o=n(331925),c=n(151835);class l{constructor(e){this.connection=e,this.relationLoadStrategy="join",this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={},this.commonTableExpressions=[],e.options.relationLoadStrategy&&(this.relationLoadStrategy=e.options.relationLoadStrategy)}get allOrderBys(){if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){const e=this.mainAlias.metadata.orderBy||{};return Object.keys(e).reduce(((t,n)=>(t[this.mainAlias.name+"."+n]=e[n],t)),{})}return this.orderBys}setMainAlias(e){return this.mainAlias=e,e}createAlias(e){let t=e.name;!t&&e.tablePath&&(t=e.tablePath),t||"function"!=typeof e.target||(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);const n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n}findAliasByName(e){const t=this.aliases.find((t=>t.name===e));if(!t)throw new i.K_(`"${e}" alias was not found. Maybe you forgot to join it?`);return t}findColumnByAliasExpression(e){const[t,n]=e.split(".");return this.findAliasByName(t).metadata.findColumnWithPropertyName(n)}get relationMetadata(){if(!this.mainAlias)throw new i.K_("Entity to work with is not specified!");const e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new i.K_(`Relation ${this.relationPropertyPath} was not found in entity ${this.mainAlias.name}`);return e}clone(){const e=new l(this.connection);return e.queryType=this.queryType,e.selects=this.selects.map((e=>e)),e.maxExecutionTime=this.maxExecutionTime,e.selectDistinct=this.selectDistinct,e.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach((t=>e.aliases.push(new a(t)))),e.relationLoadStrategy=this.relationLoadStrategy,e.mainAlias=this.mainAlias,e.valuesSet=this.valuesSet,e.returning=this.returning,e.onConflict=this.onConflict,e.onIgnore=this.onIgnore,e.onUpdate=this.onUpdate,e.joinAttributes=this.joinAttributes.map((e=>new s.k(this.connection,this,e))),e.relationIdAttributes=this.relationIdAttributes.map((e=>new o.b(this,e))),e.relationCountAttributes=this.relationCountAttributes.map((e=>new c.$(this,e))),e.wheres=this.wheres.map((e=>({...e}))),e.havings=this.havings.map((e=>({...e}))),e.orderBys=Object.assign({},this.orderBys),e.groupBys=this.groupBys.map((e=>e)),e.limit=this.limit,e.offset=this.offset,e.skip=this.skip,e.take=this.take,e.lockMode=this.lockMode,e.onLocked=this.onLocked,e.lockVersion=this.lockVersion,e.lockTables=this.lockTables,e.withDeleted=this.withDeleted,e.parameters=Object.assign({},this.parameters),e.disableEscaping=this.disableEscaping,e.enableRelationIdValues=this.enableRelationIdValues,e.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,e.subQuery=this.subQuery,e.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,e.cache=this.cache,e.cacheId=this.cacheId,e.cacheDuration=this.cacheDuration,e.relationPropertyPath=this.relationPropertyPath,e.of=this.of,e.insertColumns=this.insertColumns,e.whereEntities=this.whereEntities,e.updateEntity=this.updateEntity,e.callListeners=this.callListeners,e.useTransaction=this.useTransaction,e.nativeParameters=Object.assign({},this.nativeParameters),e.comment=this.comment,e.commonTableExpressions=this.commonTableExpressions.map((e=>({alias:e.alias,queryBuilder:"string"==typeof e.queryBuilder?e.queryBuilder:e.queryBuilder.clone(),options:e.options}))),e}}var u=n(581989),h=n(624331),d=n(388577),p=n(452257),m=n(312758);const f=/[.*+\-?^${}()|[\]\\]/g;class y{constructor(e,t){this["@instanceof"]=Symbol.for("QueryBuilder"),this.parameterIndex=0,m.a.isQueryBuilder(e)?(this.connection=e.connection,this.queryRunner=e.queryRunner,this.expressionMap=e.expressionMap.clone()):(this.connection=e,this.queryRunner=t,this.expressionMap=new l(this.connection))}get alias(){if(!this.expressionMap.mainAlias)throw new i.K_("Main alias is not set");return this.expressionMap.mainAlias.name}select(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map((e=>({selection:e}))):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);const r=n(261389).Z;return m.a.isSelectQueryBuilder(this)?this:new r(this)}insert(){this.expressionMap.queryType="insert";const e=n(512200).O;return m.a.isInsertQueryBuilder(this)?this:new e(this)}update(e,t){const r=t||e;if("function"==typeof(e=m.a.isEntitySchema(e)?e.options.name:e)||"string"==typeof e){const t=this.createFromAlias(e);this.expressionMap.setMainAlias(t)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;const i=n(537041).T;return m.a.isUpdateQueryBuilder(this)?this:new i(this)}delete(){this.expressionMap.queryType="delete";const e=n(924750).T;return m.a.isDeleteQueryBuilder(this)?this:new e(this)}softDelete(){this.expressionMap.queryType="soft-delete";const e=n(866079).B;return m.a.isSoftDeleteQueryBuilder(this)?this:new e(this)}restore(){this.expressionMap.queryType="restore";const e=n(866079).B;return m.a.isSoftDeleteQueryBuilder(this)?this:new e(this)}relation(e,t){const r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){const e=this.createFromAlias(r);this.expressionMap.setMainAlias(e)}const a=n(656933).K;return m.a.isRelationQueryBuilder(this)?this:new a(this)}hasRelation(e,t){const n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every((e=>!!n.findRelationWithPropertyPath(e)))}hasParameter(e){var t;return(null===(t=this.parentQueryBuilder)||void 0===t?void 0:t.hasParameter(e))||e in this.expressionMap.parameters}setParameter(e,t){if("function"==typeof t)throw new i.K_(`Function parameter isn't supported in the parameters. Please check "${e}" parameter.`);if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new i.K_("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,t),this.expressionMap.parameters[e]=t,this}setParameters(e){for(const[t,n]of Object.entries(e))this.setParameter(t,n);return this}createParameter(e){let t;do{t="orm_param_"+this.parameterIndex++}while(this.hasParameter(t));return this.setParameter(t,e),`:${t}`}setNativeParameters(e){return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach((t=>{this.expressionMap.nativeParameters[t]=e[t]})),this}getParameters(){const e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){const t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){const n=t.childEntityMetadatas.filter((e=>e.discriminatorColumn)).map((e=>e.discriminatorValue));n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e}printSql(){const[e,t]=this.getQueryAndParameters();return this.connection.logger.logQuery(e,t),this}getSql(){return this.getQueryAndParameters()[0]}getQueryAndParameters(){const e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)}async execute(){const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();try{return await n.query(e,t)}finally{n!==this.queryRunner&&await n.release()}}createQueryBuilder(){return new this.constructor(this.connection,this.queryRunner)}clone(){return new this.constructor(this)}comment(e){return this.expressionMap.comment=e,this}disableEscaping(){return this.expressionMap.disableEscaping=!1,this}escape(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e}setQueryRunner(e){return this.queryRunner=e,this}callListeners(e){return this.expressionMap.callListeners=e,this}useTransaction(e){return this.expressionMap.useTransaction=e,this}addCommonTableExpression(e,t,n){return this.expressionMap.commonTableExpressions.push({queryBuilder:e,alias:t,options:n||{}}),this}getTableName(e){return e.split(".").map((e=>""===e?e:this.escape(e))).join(".")}getMainTableName(){if(!this.expressionMap.mainAlias)throw new i.K_('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath}createFromAlias(e,t){if(this.connection.hasMetadata(e)){const n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}{if("string"==typeof e){const n="("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:n?void 0:e,subQuery:n?e:void 0})}const n=e(this.subQuery());this.setParameters(n.getParameters());const r=n.getQuery();return this.expressionMap.createAlias({type:"from",name:t,subQuery:r})}}replacePropertyNames(e){for(const n of this.expressionMap.aliases){if(!n.hasMetadata)continue;const r=this.expressionMap.aliasNamePrefixingEnabled?`${n.name}.`:"",i=this.expressionMap.aliasNamePrefixingEnabled?`${this.escape(n.name)}.`:"",a={};for(const e of n.metadata.relations)e.joinColumns.length>0&&(a[e.propertyPath]=e.joinColumns[0].databaseName);for(const e of n.metadata.relations)for(const t of[...e.joinColumns,...e.inverseJoinColumns]){const n=`${e.propertyPath}.${t.referencedColumn.propertyPath}`;a[n]=t.databaseName}for(const e of n.metadata.columns)a[e.databaseName]=e.databaseName;for(const e of n.metadata.columns)a[e.propertyName]=e.databaseName;for(const e of n.metadata.columns)a[e.propertyPath]=e.databaseName;e=e.replace(new RegExp(`([ =(]|^.{0})${t=r,t.replace(f,"\\$&")}([^ =(),]+)(?=[ =),]|.{0}$)`,"gm"),((e,t,n)=>a[n]?`${t}${i}${this.escape(a[n])}`:e))}var t;return e}createComment(){return this.expressionMap.comment?`/* ${this.expressionMap.comment.replace("*/","")} */ `:""}createWhereExpression(){const e=[],t=this.createWhereClausesExpression(this.expressionMap.wheres);if(t.length>0&&"1=1"!==t&&e.push(this.replacePropertyNames(t)),this.expressionMap.mainAlias.hasMetadata){const t=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){const n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,r=`${this.replacePropertyNames(n)} IS NULL`;e.push(r)}if(t.discriminatorColumn&&t.parentEntityMetadata){const n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=`${this.replacePropertyNames(n)} IN (:...discriminatorColumnValues)`;e.push(r)}}if(this.expressionMap.extraAppendedAndWhereCondition){const t=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(t)}return e.length?1===e.length?` WHERE ${e[0]}`:` WHERE ( ${e.join(" ) AND ( ")} )`:""}createReturningExpression(e){const t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported(e)&&t.push(...this.expressionMap.extraReturningColumns.filter((e=>-1===t.indexOf(e)))),t.length){let e=t.map((e=>{const t=this.escape(e.databaseName);return"mssql"===n.options.type?"insert"===this.expressionMap.queryType||"update"===this.expressionMap.queryType||"soft-delete"===this.expressionMap.queryType||"restore"===this.expressionMap.queryType?"INSERTED."+t:this.escape(this.getMainTableName())+"."+t:t})).join(", ");return"oracle"===n.options.type&&(e+=" INTO "+t.map((e=>this.createParameter({type:n.columnTypeToNativeParameter(e.type),dir:n.oracle.BIND_OUT}))).join(", ")),"mssql"===n.options.type&&("insert"!==this.expressionMap.queryType&&"update"!==this.expressionMap.queryType||(e+=" INTO @OutputTable")),e}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""}getReturningColumns(){const e=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach((t=>{this.expressionMap.mainAlias.hasMetadata&&e.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(t))})),e}createWhereClausesExpression(e){return e.map(((e,t)=>{const n=this.createWhereConditionExpression(e.condition);switch(e.type){case"and":return(t>0?"AND ":"")+n;case"or":return(t>0?"OR ":"")+n}return n})).join(" ").trim()}createWhereConditionExpression(e,t=!1){if("string"==typeof e)return e;if(Array.isArray(e))return 0===e.length?"1=1":1!==e.length||t?"("+this.createWhereClausesExpression(e)+")":this.createWhereClausesExpression(e);const{driver:n}=this.connection;switch(e.operator){case"lessThan":return`${e.parameters[0]} < ${e.parameters[1]}`;case"lessThanOrEqual":return`${e.parameters[0]} <= ${e.parameters[1]}`;case"arrayContains":return`${e.parameters[0]} @> ${e.parameters[1]}`;case"arrayContainedBy":return`${e.parameters[0]} <@ ${e.parameters[1]}`;case"arrayOverlap":return`${e.parameters[0]} && ${e.parameters[1]}`;case"moreThan":return`${e.parameters[0]} > ${e.parameters[1]}`;case"moreThanOrEqual":return`${e.parameters[0]} >= ${e.parameters[1]}`;case"notEqual":return`${e.parameters[0]} != ${e.parameters[1]}`;case"equal":return`${e.parameters[0]} = ${e.parameters[1]}`;case"ilike":return"postgres"===n.options.type||"cockroachdb"===n.options.type?`${e.parameters[0]} ILIKE ${e.parameters[1]}`:`UPPER(${e.parameters[0]}) LIKE UPPER(${e.parameters[1]})`;case"like":return`${e.parameters[0]} LIKE ${e.parameters[1]}`;case"between":return`${e.parameters[0]} BETWEEN ${e.parameters[1]} AND ${e.parameters[2]}`;case"in":return e.parameters.length<=1?"0=1":`${e.parameters[0]} IN (${e.parameters.slice(1).join(", ")})`;case"any":return`${e.parameters[0]} = ANY(${e.parameters[1]})`;case"isNull":return`${e.parameters[0]} IS NULL`;case"not":return`NOT(${this.createWhereConditionExpression(e.condition)})`;case"brackets":return`${this.createWhereConditionExpression(e.condition,!0)}`}throw new TypeError(`Unsupported FindOperator ${h.J.constructor.name}`)}createCteExpression(){if(!this.hasCommonTableExpressions())return"";const e=this.connection.driver.cteCapabilities.requiresRecursiveHint;return"WITH "+this.expressionMap.commonTableExpressions.map((t=>{const n="string"==typeof t.queryBuilder?t.queryBuilder:t.queryBuilder.getQuery();if("string"!=typeof t.queryBuilder){if(t.queryBuilder.hasCommonTableExpressions())throw new i.K_(`Nested CTEs aren't supported (CTE: ${t.alias})`);if(!this.connection.driver.cteCapabilities.writable&&!m.a.isSelectQueryBuilder(t.queryBuilder))throw new i.K_(`Only select queries are supported in CTEs in ${this.connection.options.type} (CTE: ${t.alias})`);this.setParameters(t.queryBuilder.getParameters())}let r=this.escape(t.alias);if(t.options.columnNames){const e=t.options.columnNames.map((e=>this.escape(e)));if(m.a.isSelectQueryBuilder(t.queryBuilder)&&t.queryBuilder.expressionMap.selects.length&&t.options.columnNames.length!==t.queryBuilder.expressionMap.selects.length)throw new i.K_(`cte.options.columnNames length (${t.options.columnNames.length}) doesn't match subquery select list length ${t.queryBuilder.expressionMap.selects.length} (CTE: ${t.alias})`);r+=`(${e.join(", ")})`}return[t.options.recursive&&e?"RECURSIVE":"",r,t.options.materialized&&this.connection.driver.cteCapabilities.materializedHint?"MATERIALIZED":"","AS",`(${n})`].filter(Boolean).join(" ")})).join(", ")+" "}getWhereInIdsCondition(e){const t=this.expressionMap.mainAlias.metadata,n=(Array.isArray(e)?e:[e]).map((e=>t.ensureEntityIdMap(e)));if(!t.hasMultiplePrimaryKeys){const e=t.primaryColumns[0];if(!e.transformer&&!e.relationMetadata&&!e.embeddedMetadata)return{[e.propertyName]:(0,d.In)(n.map((t=>e.getEntityValue(t,!1))))}}return new u.D((e=>{for(const t of n)e.orWhere(new u.D((e=>e.where(t))))}))}findColumnsForPropertyPath(e){let t=this.expressionMap.mainAlias;const n=[],r=e.split(".");for(;r.length>1;){const e=r[0];if(!(null==t?void 0:t.hasMetadata))break;if(t.metadata.hasEmbeddedWithPropertyPath(e))r.unshift(`${r.shift()}.${r.shift()}`);else{if(!t.metadata.hasRelationWithPropertyPath(e))break;{const i=this.expressionMap.joinAttributes.find((t=>t.relationPropertyPath===e));if(!(null==i?void 0:i.alias)){const t=n.length>0?`${n.join(".")}.${e}`:e;throw new Error(`Cannot find alias for relation at ${t}`)}t=i.alias,n.push(...e.split(".")),r.shift()}}}if(!t)throw new Error(`Cannot find alias for property ${e}`);const i=r.join("."),a=t.metadata.findColumnsWithPropertyPath(i);if(!a.length)throw new p.B(e,t.metadata);return[t,n,a]}createPropertyPath(e,t,n=""){const r=[];for(const i of Object.keys(t)){const a=n?`${n}.${i}`:i;if(null===t[i]||"object"!=typeof t[i]||m.a.isFindOperator(t[i]))r.push(a);else if(e.hasEmbeddedWithPropertyPath(a)){const n=this.createPropertyPath(e,t[i],a);r.push(...n)}else if(e.hasRelationWithPropertyPath(a)){const n=e.findRelationWithPropertyPath(a);if("one-to-one"===n.relationType||"many-to-one"===n.relationType){const e=n.joinColumns.map((e=>e.referencedColumn)).filter((e=>!!e));if(e.length>0&&e.every((e=>e.getEntityValue(t[i],!1)))){r.push(a);continue}}if("one-to-many"===n.relationType||"many-to-many"===n.relationType)throw new Error(`Cannot query across ${n.relationType} for property ${a}`);const s=n.inverseEntityMetadata.primaryColumns;if(s.length>0&&s.every((e=>e.getEntityValue(t[i],!1)))){const e=s.map((e=>`${a}.${e.propertyPath}`));r.push(...e);continue}const o=this.createPropertyPath(n.inverseEntityMetadata,t[i]).map((e=>`${a}.${e}`));r.push(...o)}else r.push(a)}return r}*getPredicates(e){if(this.expressionMap.mainAlias.hasMetadata){const t=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e);for(const n of t){const[t,r,i]=this.findColumnsForPropertyPath(n);for(const n of i){let i=e;for(const e of r){if(!i||!(e in i)){i={};break}i=i[e]}const a=this.expressionMap.aliasNamePrefixingEnabled?`${t.name}.${n.propertyPath}`:n.propertyPath,s=n.getEntityValue(i,!0);yield[a,s]}}}else for(const t of Object.keys(e)){const n=e[t],r=this.expressionMap.aliasNamePrefixingEnabled?`${this.alias}.${t}`:t;yield[r,n]}}getWherePredicateCondition(e,t){if(m.a.isFindOperator(t)){let n=[];if(t.useParameter)if(t.objectLiteralParameters)this.setParameters(t.objectLiteralParameters);else if(t.multipleParameters)for(const e of t.value)n.push(this.createParameter(e));else n.push(this.createParameter(t.value));return"raw"===t.type?t.getSql?t.getSql(e):{operator:"equal",parameters:[e,t.value]}:"not"===t.type?t.child?{operator:t.type,condition:this.getWherePredicateCondition(e,t.child)}:{operator:"notEqual",parameters:[e,...n]}:{operator:t.type,parameters:[e,...n]}}return{operator:"equal",parameters:[e,this.createParameter(t)]}}getWhereCondition(e){if("string"==typeof e)return e;if(m.a.isBrackets(e)){const t=this.createQueryBuilder();return t.parentQueryBuilder=this,t.expressionMap.mainAlias=this.expressionMap.mainAlias,t.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,t.expressionMap.parameters=this.expressionMap.parameters,t.expressionMap.nativeParameters=this.expressionMap.nativeParameters,t.expressionMap.wheres=[],e.whereFactory(t),{operator:m.a.isNotBrackets(e)?"not":"brackets",condition:t.expressionMap.wheres}}if("function"==typeof e)return e(this);const t=Array.isArray(e)?e:[e],n=[];for(const e of t){const t=[];for(const[n,r]of this.getPredicates(e))t.push({type:"and",condition:this.getWherePredicateCondition(n,r)});n.push({type:"or",condition:t})}return 1===n.length?n[0].condition:n}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner()}hasCommonTableExpressions(){return this.expressionMap.commonTableExpressions.length>0}}},395008:(e,t,n)=>{"use strict";n.d(t,{G:()=>r});class r{static isAliasProperty(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;const[t,n]=e.split(".");return!(!t||!n)&&(-1===e.indexOf("(")&&-1===e.indexOf(")"))}}},656933:(e,t,n)=>{"use strict";n.d(t,{K:()=>c});var r=n(5778),i=n(600706),a=n(503681);class s{constructor(e,t){this.queryBuilder=e,this.expressionMap=t}async update(e){const t=this.expressionMap.relationMetadata;if(t.isManyToOne||t.isOneToOneOwner){const n=t.joinColumns.reduce(((t,n)=>{const r=a.g.isObject(e)?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t}),{});if(!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length)return;await this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(n).whereInIds(this.expressionMap.of).execute()}else if((t.isOneToOneNotOwner||t.isOneToMany)&&null===e){const e={};t.inverseRelation.joinColumns.forEach((t=>{e[t.propertyName]=null}));const n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],r={},i=[];n.forEach(((e,n)=>{t.inverseRelation.joinColumns.map(((t,s)=>{const o="joinColumn_"+n+"_"+s;r[o]=a.g.isObject(e)?t.referencedColumn.getEntityValue(e):e,i.push(`${t.propertyPath} = :${o}`)}))}));const s=i.map((e=>"("+e+")")).join(" OR ");if(!s)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(e).where(s).setParameters(r).execute()}else if(t.isOneToOneNotOwner||t.isOneToMany){if(Array.isArray(this.expressionMap.of))throw new i.K_("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");const n=this.expressionMap.of,r=t.inverseRelation.joinColumns.reduce(((e,t)=>{const r=a.g.isObject(n)?t.referencedColumn.getEntityValue(n):n;return t.setEntityValue(e,r),e}),{});if(!e||Array.isArray(e)&&!e.length)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(r).whereInIds(e).execute()}else{const n=t.junctionEntityMetadata,r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],s=t.isManyToManyOwner?r:i,o=t.isManyToManyOwner?i:r,c=[];if(s.forEach((e=>{o.forEach((t=>{const r={};n.ownerColumns.forEach((t=>{r[t.databaseName]=a.g.isObject(e)?t.referencedColumn.getEntityValue(e):e})),n.inverseColumns.forEach((e=>{r[e.databaseName]=a.g.isObject(t)?e.referencedColumn.getEntityValue(t):t})),c.push(r)}))})),!c.length)return;"oracle"===this.queryBuilder.connection.driver.options.type||"sap"===this.queryBuilder.connection.driver.options.type?await Promise.all(c.map((e=>this.queryBuilder.createQueryBuilder().insert().into(n.tableName).values(e).execute()))):await this.queryBuilder.createQueryBuilder().insert().into(n.tableName).values(c).execute()}}}class o{constructor(e,t){this.queryBuilder=e,this.expressionMap=t}async remove(e){const t=this.expressionMap.relationMetadata;if(t.isOneToMany){const n=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],r=Array.isArray(e)?e:[e],i={};t.inverseRelation.joinColumns.forEach((e=>{i[e.propertyName]=null}));const s={},o=[];n.forEach(((e,n)=>{o.push(...r.map(((r,i)=>[...t.inverseRelation.joinColumns.map(((t,r)=>{const o="joinColumn_"+n+"_"+i+"_"+r;return s[o]=a.g.isObject(e)?t.referencedColumn.getEntityValue(e):e,`${t.propertyPath} = :${o}`})),...t.inverseRelation.entityMetadata.primaryColumns.map(((e,t)=>{const n="primaryColumn_"+i+"_"+i+"_"+t;return s[n]=a.g.isObject(r)?e.getEntityValue(r):r,`${e.propertyPath} = :${n}`}))].join(" AND "))))}));const c=o.map((e=>"("+e+")")).join(" OR ");if(!c)return;await this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(c).setParameters(s).execute()}else{const n=t.junctionEntityMetadata,r=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i=Array.isArray(e)?e:[e],s=t.isManyToManyOwner?r:i,o=t.isManyToManyOwner?i:r,c={},l=[];s.forEach(((e,t)=>{l.push(...o.map(((r,i)=>[...n.ownerColumns.map(((n,r)=>{const s="firstValue_"+t+"_"+i+"_"+r;return c[s]=a.g.isObject(e)?n.referencedColumn.getEntityValue(e):e,`${n.databaseName} = :${s}`})),...n.inverseColumns.map(((e,n)=>{const s="secondValue_"+t+"_"+i+"_"+n;return c[s]=a.g.isObject(r)?e.referencedColumn.getEntityValue(r):r,`${e.databaseName} = :${s}`}))].join(" AND "))))}));const u=l.map((e=>"("+e+")")).join(" OR ");await this.queryBuilder.createQueryBuilder().delete().from(n.tableName).where(u).setParameters(c).execute()}}}class c extends r.z{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("RelationQueryBuilder")}getQuery(){return""}of(e){return this.expressionMap.of=e,this}async set(e){const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new i.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new i.K_(`Set operation is only supported for many-to-one and one-to-one relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .add() method instead.`);if(t.joinColumns&&t.joinColumns.length>1&&(!a.g.isObject(e)||Object.keys(e).length<t.joinColumns.length))throw new i.K_('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new s(this,this.expressionMap).update(e)}async add(e){if(Array.isArray(e)&&0===e.length)return;const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new i.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new i.K_(`Add operation is only supported for many-to-many and one-to-many relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .set() method instead.`);if(t.joinColumns&&t.joinColumns.length>1&&(!a.g.isObject(e)||Object.keys(e).length<t.joinColumns.length))throw new i.K_('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return new s(this,this.expressionMap).update(e)}async remove(e){if(Array.isArray(e)&&0===e.length)return;const t=this.expressionMap.relationMetadata;if(!this.expressionMap.of)throw new i.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new i.K_(`Add operation is only supported for many-to-many and one-to-many relations. However given "${t.propertyPath}" has ${t.relationType} relation. Use .set(null) method instead.`);return new o(this,this.expressionMap).remove(e)}async addAndRemove(e,t){await this.remove(t),await this.add(e)}async loadOne(){return this.loadMany().then((e=>e[0]))}async loadMany(){let e=this.expressionMap.of;if(!a.g.isObject(e)){const t=this.expressionMap.mainAlias.metadata;if(t.hasMultiplePrimaryKeys)throw new i.K_("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)}}},14550:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var r=n(600706);class i{constructor(e,t){this.queryRunner=e,this.expressionMap=t}async update(e,t){const n=this.expressionMap.mainAlias.metadata;await Promise.all(t.map((async(t,i)=>{if(this.queryRunner.connection.driver.isReturningSqlSupported("update")){"oracle"===this.queryRunner.connection.driver.options.type&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(((e,t,n)=>(e[this.expressionMap.extraReturningColumns[n].databaseName]=t[0],e)),{}));const r=Array.isArray(e.raw)?e.raw[i]:e.raw,a=this.queryRunner.connection.driver.createGeneratedMap(n,r);a&&(this.queryRunner.manager.merge(n.target,t,a),e.generatedMaps.push(a))}else{const i=this.expressionMap.extraReturningColumns;if(i.length>0){const a=this.expressionMap.mainAlias.metadata.getEntityIdMap(t);if(!a)throw new r.K_("Cannot update entity because entity id is not set in the entity.");const s=await this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((e=>n.targetName+"."+e.propertyPath))).addSelect(i.map((e=>n.targetName+"."+e.propertyPath))).from(n.target,n.targetName).where(a).withDeleted().setOption("create-pojo").getOne();s&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s))}}})))}async insert(e,t){const n=this.expressionMap.mainAlias.metadata;let i=n.getInsertionReturningColumns();const a=this.queryRunner.connection.driver.isReturningSqlSupported("insert");i=i.filter((e=>!e.isGenerated||!0===a));const s=t.map(((r,i)=>{"oracle"===this.queryRunner.connection.driver.options.type&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce(((e,t,n)=>(e[this.expressionMap.extraReturningColumns[n].databaseName]=t[0],e)),{}));const a=Array.isArray(e.raw)?e.raw[i]:e.raw,s=this.queryRunner.connection.driver.createGeneratedMap(n,a,i,t.length)||{};return i in this.expressionMap.locallyGenerated&&this.queryRunner.manager.merge(n.target,s,this.expressionMap.locallyGenerated[i]),this.queryRunner.manager.merge(n.target,r,s),s}));if(i.length>0&&!this.queryRunner.connection.driver.isReturningSqlSupported("insert")){const e=t.map((e=>{const t=n.getEntityIdMap(e);if(!t)throw new r.K_("Cannot update entity because entity id is not set in the entity.");return t})),a=await this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((e=>n.targetName+"."+e.propertyPath))).addSelect(i.map((e=>n.targetName+"."+e.propertyPath))).from(n.target,n.targetName).where(e).setOption("create-pojo").getMany();t.forEach(((e,t)=>{this.queryRunner.manager.merge(n.target,s[t],a[t]),this.queryRunner.manager.merge(n.target,e,a[t])}))}t.forEach(((t,r)=>{const i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r])}))}getUpdationReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter((e=>e.isUpdateDate||e.isVersion))}getSoftDeletionReturningColumns(){return this.expressionMap.mainAlias.metadata.columns.filter((e=>e.isUpdateDate||e.isVersion||e.isDeleteDate))}}},261389:(e,t,n)=>{"use strict";n.d(t,{Z:()=>M});var r=n(234769),i=n(407337),a=n(503681),s=n(348834).Buffer;class o{constructor(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}transform(e,t){const n=this.group(e,t),r=[];if(e.length>0&&null!=e[0]?.TransactionDMO_fromAddress){let n=t.metadata;if(n.discriminatorColumn){const r=e.map((e=>e[i.z.buildAlias(this.driver,t.name,t.metadata.discriminatorColumn.databaseName)])),a=n.childEntityMetadatas.find((e=>void 0!==r.find((t=>t===e.discriminatorValue))));a&&(n=a)}const a=[];n.columns.forEach((e=>{e.name__=`TransactionDMO_${e.databaseName}`,a.push(e)}));for(let t=0;t<e.length;++t){const n=e[t];let i={},s=!1;for(let e=0;e<a.length;++e){const t=a[e],r=n[t.name__];if(void 0===r||t.isVirtual)return;i[t.databaseName]=this.driver.prepareHydratedValue(r,t),null!==r&&(s=!0)}s&&r.push(i)}return r}return n.forEach((e=>{const n=this.transformRawResultsGroup(e,t);void 0===n||Object.values(n).every((e=>null===e))||r.push(n)})),r}group(e,t){const n=new Map,r=[];return"view"===t.metadata.tableType?r.push(...t.metadata.columns.map((e=>i.z.buildAlias(this.driver,t.name,e.databaseName)))):r.push(...t.metadata.primaryColumns.map((e=>i.z.buildAlias(this.driver,t.name,e.databaseName)))),e.forEach((e=>{const t=r.map((t=>{const n=e[t];return s.isBuffer(n)?n.toString("hex"):a.g.isObject(n)?JSON.stringify(n):n})).join("_"),i=n.get(t);i?i.push(e):n.set(t,[e])})),n}transformRawResultsGroup(e,t){let n=t.metadata;if(n.discriminatorColumn){const r=e.map((e=>e[i.z.buildAlias(this.driver,t.name,t.metadata.discriminatorColumn.databaseName)])),a=n.childEntityMetadatas.find((e=>void 0!==r.find((t=>t===e.discriminatorValue))));a&&(n=a)}let r=n.create(this.queryRunner,{fromDeserializer:!0,pojo:-1!==this.expressionMap.options.indexOf("create-pojo")});const a=this.transformColumns(e,t,r,n),s=this.transformJoins(e,r,t,n),o=this.transformRelationIds(e,t,r,n),c=this.transformRelationCounts(e,t,r);if(a)return r;return 0===n.primaryColumns.filter((e=>!1===e.isVirtual)).length&&(s||o||c)?r:void 0}transformColumns(e,t,n,r){let a=!1;return r.columns.forEach((s=>{if(r.childEntityMetadatas.length>0&&-1!==r.childEntityMetadatas.findIndex((e=>e.target===s.target)))return;const o=e[0][i.z.buildAlias(this.driver,t.name,s.databaseName)];void 0===o||s.isVirtual||this.expressionMap.selects.find((e=>e.selection===t.name||e.selection===t.name+"."+s.propertyPath))&&(s.setEntityValue(n,this.driver.prepareHydratedValue(o,s)),null!==o&&(a=!0))})),a}transformJoins(e,t,n,r){let i=!1;return this.expressionMap.joinAttributes.forEach((a=>{if(!a.metadata)return;if(!a.isSelected)return;if(a.relation&&!r.relations.find((e=>e===a.relation)))return;if(a.mapToProperty){if(a.mapToPropertyParentAlias!==n.name)return}else if(!a.relation||a.parentAlias!==n.name||a.relationPropertyPath!==a.relation.propertyPath)return;let s=this.transform(e,a.alias);s=a.isMany?s:s[0],s=a.isMany||void 0!==s?s:null,void 0!==s&&(a.mapToPropertyPropertyName?t[a.mapToPropertyPropertyName]=s:a.relation.setEntityValue(t,s),i=!0)})),i}transformRelationIds(e,t,n,r){let i=!1;return this.rawRelationIdResults.forEach(((r,a)=>{if(r.relationIdAttribute.parentAlias!==t.name)return;const s=r.relationIdAttribute.relation,o=this.createValueMapFromJoinColumns(s,r.relationIdAttribute.parentAlias,e);if(null==o)return;this.prepareDataForTransformRelationIds();const c=this.hashEntityIds(s,o),l=this.relationIdMaps[a][c]||[],u=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),h=(e,t,n)=>{const r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void h(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==l[0]&&(h(u,n,l[0]),i=!0):(h(u,n,l),i=i||l.length>0)})),i}transformRelationCounts(e,t,n){let r=!1;return this.rawRelationCountResults.filter((e=>e.relationCountAttribute.parentAlias===t.name)).forEach((a=>{const s=a.relationCountAttribute.relation;let o;o=s.isOneToMany?s.inverseRelation.joinColumns[0].referencedColumn.databaseName:s.isOwning?s.joinColumns[0].referencedColumn.databaseName:s.inverseRelation.joinColumns[0].referencedColumn.databaseName;const c=e[0][i.z.buildAlias(this.driver,t.name,o)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter((e=>e.parentId===c)).forEach((e=>{n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),r=!0})))})),r}createValueMapFromJoinColumns(e,t,n){let r;return r=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((e=>e)):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((e=>e)):e.isOwning?e.joinColumns.map((e=>e)):e.inverseRelation.inverseJoinColumns.map((e=>e)),r.reduce(((r,a)=>(n.forEach((n=>{e.isManyToOne||e.isOneToOneOwner?r[a.databaseName]=this.driver.prepareHydratedValue(n[i.z.buildAlias(this.driver,t,a.databaseName)],a):r[a.databaseName]=this.driver.prepareHydratedValue(n[i.z.buildAlias(this.driver,t,a.referencedColumn.databaseName)],a)})),r)),{})}extractEntityPrimaryIds(e,t){let n;return n=e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((e=>e)):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((e=>e)):e.isOwning?e.joinColumns.map((e=>e)):e.inverseRelation.inverseJoinColumns.map((e=>e)),n.reduce(((e,n)=>(e[n.databaseName]=t[n.databaseName],e)),{})}prepareDataForTransformRelationIds(){this.relationIdMaps||(this.relationIdMaps=this.rawRelationIdResults.map((e=>{const t=e.relationIdAttribute.relation;let n;return n=t.isManyToOne||t.isOneToOneOwner?t.joinColumns:t.isOneToMany||t.isOneToOneNotOwner?t.inverseEntityMetadata.primaryColumns:t.isOwning?t.inverseJoinColumns:t.inverseRelation.joinColumns,e.results.reduce(((i,a)=>{let s=n.reduce(((e,n)=>{let i=a[n.databaseName];return t.isOneToMany||t.isOneToOneNotOwner?(n.isVirtual&&n.referencedColumn&&n.referencedColumn.propertyName!==n.propertyName&&(i=n.referencedColumn.createValueMap(i)),r.s.mergeDeep(e,n.createValueMap(i))):(!n.isPrimary&&n.referencedColumn.referencedColumn&&(i=n.referencedColumn.referencedColumn.createValueMap(i)),r.s.mergeDeep(e,n.referencedColumn.createValueMap(i)))}),{});if(1!==n.length||e.relationIdAttribute.disableMixedMap||(s=t.isOneToMany||t.isOneToOneNotOwner?n[0].getEntityValue(s):n[0].referencedColumn.getEntityValue(s)),void 0!==s){const e=this.hashEntityIds(t,a);i[e]?i[e].push(s):i[e]=[s]}return i}),{})})))}hashEntityIds(e,t){const n=this.extractEntityPrimaryIds(e,t);return JSON.stringify(n)}}var c=n(124758),l=n(428761),u=n(969919),h=n(336668),d=n(801072),p=n(331925),m=n(151835),f=n(584639);class y{constructor(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}async load(e){const t=this.relationIdAttributes.map((async t=>{if(t.relation.isManyToOne||t.relation.isOneToOneOwner){if(t.queryBuilderFactory)throw new f.K("Additional condition can not be used with ManyToOne or OneToOne owner relations.");const n={},r=e.map((e=>{const r={},a=[];t.relation.joinColumns.forEach((n=>{r[n.databaseName]=this.connection.driver.prepareHydratedValue(e[i.z.buildAlias(this.connection.driver,t.parentAlias,n.databaseName)],n.referencedColumn);const s=`${n.databaseName}:${r[n.databaseName]}`;-1===a.indexOf(s)&&a.push(s)})),t.relation.entityMetadata.primaryColumns.forEach((n=>{r[n.databaseName]=this.connection.driver.prepareHydratedValue(e[i.z.buildAlias(this.connection.driver,t.parentAlias,n.databaseName)],n);const s=`${n.databaseName}:${r[n.databaseName]}`;-1===a.indexOf(s)&&a.push(s)})),a.sort();const s=a.join("::");return n[s]?null:(n[s]=!0,r)})).filter((e=>e));return{relationIdAttribute:t,results:r}}if(t.relation.isOneToMany||t.relation.isOneToOneNotOwner){const n=t.relation,a=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,s=n.inverseEntityMetadata.target,o=n.inverseEntityMetadata.tableName,c=t.alias||o,l={},u={},h=e.map(((e,n)=>{const r=[],s={},o=a.map((a=>{const o=a.databaseName+n,l=e[i.z.buildAlias(this.connection.driver,t.parentAlias,a.referencedColumn.databaseName)],u=`${c}:${a.propertyPath}:${l}`;return-1!==r.indexOf(u)?"":(r.push(u),s[o]=l,c+"."+a.propertyPath+" = :"+o)})).filter((e=>e)).join(" AND ");r.sort();const h=r.join("::");return l[h]?"":(l[h]=!0,Object.assign(u,s),o)})).filter((e=>e)).map((e=>"("+e+")")).join(" OR ");if(!h)return{relationIdAttribute:t,results:[]};const d=this.connection.createQueryBuilder(this.queryRunner);r.s.uniq([...a,...n.inverseRelation.entityMetadata.primaryColumns],(e=>e.propertyPath)).forEach((e=>{d.addSelect(c+"."+e.propertyPath,e.databaseName)})),d.from(s,c).where("("+h+")").setParameters(u),t.queryBuilderFactory&&t.queryBuilderFactory(d);const p=await d.getRawMany();return p.forEach((e=>{a.forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t)}))})),{relationIdAttribute:t,results:p}}{const n=t.relation,r=n.isOwning?n.joinColumns:n.inverseRelation.inverseJoinColumns,a=n.isOwning?n.inverseJoinColumns:n.inverseRelation.joinColumns,s=t.junctionAlias,o=t.joinInverseSideMetadata.tableName,c=t.alias||o,l=n.isOwning?n.junctionEntityMetadata.tableName:n.inverseRelation.junctionEntityMetadata.tableName,u=e.map((e=>r.reduce(((n,r)=>(n[r.propertyPath]=e[i.z.buildAlias(this.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n)),{})));if(0===u.length)return{relationIdAttribute:t,results:[]};const h={},d={},p=u.map(((e,t)=>{const n=[],r={},i=Object.keys(e).map((i=>{const a=i+t,o=e[i],c=`${s}:${i}:${o}`;return-1!==n.indexOf(c)?"":(n.push(c),r[a]=o,s+"."+i+" = :"+a)})).filter((e=>e)).join(" AND ");n.sort();const a=n.join("::");return d[a]?"":(d[a]=!0,Object.assign(h,r),i)})).filter((e=>e)),m=a.map((e=>s+"."+e.propertyPath+" = "+c+"."+e.referencedColumn.propertyPath)).join(" AND "),f=p.map((e=>"("+e+" AND "+m+")")).join(" OR "),y=this.connection.createQueryBuilder(this.queryRunner);a.forEach((e=>{y.addSelect(s+"."+e.propertyPath,e.databaseName).addOrderBy(s+"."+e.propertyPath)})),r.forEach((e=>{y.addSelect(s+"."+e.propertyPath,e.databaseName).addOrderBy(s+"."+e.propertyPath)})),y.from(o,c).innerJoin(l,s,f).setParameters(h),t.queryBuilderFactory&&t.queryBuilderFactory(y);const g=await y.getRawMany();return g.forEach((e=>{[...r,...a].forEach((t=>{e[t.databaseName]=this.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}))})),{relationIdAttribute:t,results:g}}}));return Promise.all(t)}}class g{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach((e=>{const t=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationIdAttributes.push(t)})),this.expressionMap.joinAttributes.forEach((e=>{e.metadata&&!e.metadata.isJunction&&e.metadata.relationIds.forEach((t=>{const n=this.metadataToAttribute(e.alias.name,t);this.expressionMap.relationIdAttributes.push(n)}))}))}metadataToAttribute(e,t){return new p.b(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})}}class _{constructor(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}async load(e){const t=(e,t,n)=>n.indexOf(e)===t,n=this.relationCountAttributes.map((async n=>{if(n.relation.isOneToMany){const r=n.relation,i=r.inverseRelation,a=i.joinColumns[0].referencedColumn.propertyName,s=r.inverseEntityMetadata.target,o=r.inverseEntityMetadata.tableName,c=n.alias||o,l=i.propertyName;let u=e.map((e=>e[n.parentAlias+"_"+a])).filter((e=>!!e));if(u=u.filter(t),0===u.length)return{relationCountAttribute:n,results:[]};const h=this.connection.createQueryBuilder(this.queryRunner);return h.select(c+"."+l,"parentId").addSelect("COUNT(*)","cnt").from(s,c).where(c+"."+l+" IN (:...ids)").addGroupBy(c+"."+l).setParameter("ids",u),n.queryBuilderFactory&&n.queryBuilderFactory(h),{relationCountAttribute:n,results:await h.getRawMany()}}{let r,i,a,s;n.relation.isOwning?(r=n.relation.joinColumns[0].referencedColumn.databaseName,i=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,a=n.relation.junctionEntityMetadata.columns[0],s=n.relation.junctionEntityMetadata.columns[1]):(r=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,i=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,a=n.relation.junctionEntityMetadata.columns[1],s=n.relation.junctionEntityMetadata.columns[0]);let o=e.map((e=>e[n.parentAlias+"_"+r])).filter((e=>!!e));if(o=o.filter(t),0===o.length)return{relationCountAttribute:n,results:[]};const c=n.junctionAlias,l=n.joinInverseSideMetadata.tableName,u=n.alias||l,h=n.relation.junctionEntityMetadata.tableName,d=c+"."+a.propertyName+" IN ("+o.map((e=>isNaN(e)?"'"+e+"'":e))+") AND "+c+"."+s.propertyName+" = "+u+"."+i,p=this.connection.createQueryBuilder(this.queryRunner);return p.select(c+"."+a.propertyName,"parentId").addSelect("COUNT("+p.escape(u)+"."+p.escape(i)+")","cnt").from(l,u).innerJoin(h,c,d).addGroupBy(c+"."+a.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(p),{relationCountAttribute:n,results:await p.getRawMany()}}}));return Promise.all(n)}}class b{constructor(e){this.expressionMap=e}transform(){this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach((e=>{const t=this.metadataToAttribute(this.expressionMap.mainAlias.name,e);this.expressionMap.relationCountAttributes.push(t)})),this.expressionMap.joinAttributes.forEach((e=>{e.metadata&&!e.metadata.isJunction&&e.metadata.relationCounts.forEach((t=>{const n=this.metadataToAttribute(e.alias.name,t);this.expressionMap.relationCountAttributes.push(n)}))}))}metadataToAttribute(e,t){return new m.$(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})}}var v=n(5778),w=n(685741),E=n(375e3),T=n(517830),S=n(600706),N=n(653140),A=n(900924),C=n(452257),x=n(312758);class M extends v.z{constructor(){super(...arguments),this["@instanceof"]=Symbol.for("SelectQueryBuilder"),this.findOptions={},this.selects=[],this.joins=[],this.conditions="",this.orderBys=[],this.relationMetadatas=[]}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e+=this.createLockExpression(),e=e.trim(),this.expressionMap.subQuery&&(e="("+e+")"),e}setFindOptions(e){return this.findOptions=e,this.applyFindOptions(),this}subQuery(){const e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e}select(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map((e=>({selection:e})));else if("function"==typeof e){const n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this}addSelect(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map((e=>({selection:e}))));else if("function"==typeof e){const n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this}maxExecutionTime(e){return this.expressionMap.maxExecutionTime=e,this}distinct(e=!0){return this.expressionMap.selectDistinct=e,this}distinctOn(e){return this.expressionMap.selectDistinctOn=e,this}from(e,t){const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}addFrom(e,t){const n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this}innerJoin(e,t,n,r){return this.join("INNER",e,t,n,r),this}leftJoin(e,t,n,r){return this.join("LEFT",e,t,n,r),this}innerJoinAndSelect(e,t,n,r){return this.addSelect(t),this.innerJoin(e,t,n,r),this}leftJoinAndSelect(e,t,n,r){return this.addSelect(t),this.leftJoin(e,t,n,r),this}innerJoinAndMapMany(e,t,n,r,i){return this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this}innerJoinAndMapOne(e,t,n,r,i){return this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this}leftJoinAndMapMany(e,t,n,r,i){return this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this}leftJoinAndMapOne(e,t,n,r,i){return this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this}loadRelationIdAndMap(e,t,n,r){const i=new p.b(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),"object"==typeof n&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this}loadRelationCountAndMap(e,t,n,r){const i=new m.$(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this}loadAllRelationIds(e){return this.expressionMap.mainAlias.metadata.relations.forEach((t=>{void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(t.propertyPath)||this.loadRelationIdAndMap(this.expressionMap.mainAlias.name+"."+t.propertyPath,this.expressionMap.mainAlias.name+"."+t.propertyPath,e)})),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}having(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this}andHaving(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this}orHaving(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this}groupBy(e){return this.expressionMap.groupBys=e?[e]:[],this}addGroupBy(e){return this.expressionMap.groupBys.push(e),this}orderBy(e,t="ASC",n){if(void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new S.K_('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new S.K_('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){if(void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new S.K_('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new S.K_('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new S.K_('Provided "limit" value is not a number. Please provide a numeric value.');return this}offset(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new S.K_('Provided "offset" value is not a number. Please provide a numeric value.');return this}take(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new S.K_('Provided "take" value is not a number. Please provide a numeric value.');return this}skip(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new S.K_('Provided "skip" value is not a number. Please provide a numeric value.');return this}useIndex(e){return this.expressionMap.useIndex=e,this}setLock(e,t,n){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this.expressionMap.lockTables=n,this}setOnLocked(e){return this.expressionMap.onLocked=e,this}withDeleted(){return this.expressionMap.withDeleted=!0,this}async getRawOne(){return(await this.getRawMany())[0]}async getRawMany(){if("optimistic"===this.expressionMap.lockMode)throw new h.Y;this.expressionMap.queryEntity=!1;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0);const n=await this.loadRawResults(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getRawAndEntities(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!0;const n=await this.executeEntitiesAndRawResults(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getOne(){const e=(await this.getRawAndEntities()).entities[0];if(e&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion){const t=this.expressionMap.mainAlias.metadata;if(this.expressionMap.lockVersion instanceof Date){const n=t.updateDateColumn.getEntityValue(e);if(n.getTime()!==this.expressionMap.lockVersion.getTime())throw new u.Z(t.name,this.expressionMap.lockVersion,n)}else{const n=t.versionColumn.getEntityValue(e);if(n!==this.expressionMap.lockVersion)throw new u.Z(t.name,this.expressionMap.lockVersion,n)}}return void 0===e?null:e}async getOneOrFail(){const e=await this.getOne();if(!e)throw new T.E(this.expressionMap.mainAlias.target,this);return e}async getMany(){if("optimistic"===this.expressionMap.lockMode)throw new h.Y;return(await this.getRawAndEntities()).entities}async getCount(){if("optimistic"===this.expressionMap.lockMode)throw new h.Y;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!1;const n=await this.executeCountQuery(e);return t&&await e.commitTransaction(),n}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async getManyAndCount(){if("optimistic"===this.expressionMap.lockMode)throw new h.Y;const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),this.expressionMap.queryEntity=!0;const n=await this.executeEntitiesAndRawResults(e);this.expressionMap.queryEntity=!1;const r=this.expressionMap.cacheId;this.expressionMap.cacheId=r?`${r}-count`:r;const i=await this.executeCountQuery(e),a=[n.entities,i];return t&&await e.commitTransaction(),a}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}async stream(){this.expressionMap.queryEntity=!1;const[e,t]=this.getQueryAndParameters(),n=this.obtainQueryRunner();let r=!1;try{!0===this.expressionMap.useTransaction&&!1===n.isTransactionActive&&(await n.startTransaction(),r=!0);const i=()=>{if(n!==this.queryRunner)return n.release()},a=n.stream(e,t,i,i);return r&&await n.commitTransaction(),a}catch(e){if(r)try{await n.rollbackTransaction()}catch(e){}throw e}}cache(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this}setOption(e){return this.expressionMap.options.push(e),this}join(e,t,n,r,i,a,s){this.setParameters(i||{});const o=new d.k(this.connection,this.expressionMap);if(o.direction=e,o.mapToProperty=a,o.isMappingMany=s,o.entityOrProperty=t,o.condition=r||void 0,this.expressionMap.joinAttributes.push(o),o.metadata){if(o.metadata.deleteDateColumn&&!this.expressionMap.withDeleted){const e=`${n}.${o.metadata.deleteDateColumn.propertyName} IS NULL`;o.condition=o.condition?` ${o.condition} AND ${e}`:`${e}`}o.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:o.metadata}),o.relation&&o.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:o.junctionAlias,metadata:o.relation.junctionEntityMetadata})}else{let e="";if("function"==typeof t){const n=t(this.subQuery());this.setParameters(n.getParameters()),e=n.getQuery()}else e=t;const r="function"==typeof t||"("===t.substr(0,1)&&")"===t.substr(-1);o.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===r?t:void 0,subQuery:!0===r?e:void 0})}}createSelectExpression(){if(!this.expressionMap.mainAlias)throw new S.K_("Cannot build query because main alias is not set (call qb#from method)");const e=[],t=[];if(this.expressionMap.mainAlias.hasMetadata){const n=this.expressionMap.mainAlias.metadata;e.push(...this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,n)),t.push(...this.findEntityColumnSelects(this.expressionMap.mainAlias.name,n))}this.expressionMap.joinAttributes.forEach((n=>{if(n.metadata)e.push(...this.buildEscapedEntityColumnSelects(n.alias.name,n.metadata)),t.push(...this.findEntityColumnSelects(n.alias.name,n.metadata));else{const r=this.expressionMap.selects.some((e=>e.selection===n.alias.name));if(r){e.push({selection:this.escape(n.alias.name)+".*"});const r=this.expressionMap.selects.find((e=>e.selection===n.alias.name));t.push(r)}}})),this.expressionMap.selects.filter((e=>-1===t.indexOf(e))).forEach((t=>e.push({selection:this.replacePropertyNames(t.selection),aliasName:t.aliasName}))),0===e.length&&e.push({selection:"*"});let n="";this.expressionMap.useIndex&&i.z.isMySQLFamily(this.connection.driver)&&(n=` USE INDEX (${this.expressionMap.useIndex})`);const r=this.expressionMap.aliases.filter((e=>"from"===e.type&&(e.tablePath||e.subQuery))).map((e=>e.subQuery?e.subQuery+" "+this.escape(e.name):this.getTableName(e.tablePath)+" "+this.escape(e.name))),a=this.createSelectDistinctExpression(),s=e.map((e=>e.selection+(e.aliasName?" AS "+this.escape(e.aliasName):""))).join(", ");return a+s+" FROM "+r.join(", ")+this.createTableLockExpression()+n}createSelectDistinctExpression(){const{selectDistinct:e,selectDistinctOn:t,maxExecutionTime:n}=this.expressionMap,{driver:r}=this.connection;let a="SELECT ";if(n>0&&i.z.isMySQLFamily(r)&&(a+=`/*+ MAX_EXECUTION_TIME(${this.expressionMap.maxExecutionTime}) */ `),i.z.isPostgresFamily(r)&&t.length>0){a=`SELECT DISTINCT ON (${t.map((e=>this.replacePropertyNames(e))).join(", ")}) `}else e&&(a="SELECT DISTINCT ");return a}createJoinExpression(){return this.expressionMap.joinAttributes.map((e=>{const t=e.relation,n=e.tablePath,r=e.alias.name;let i=e.condition?" AND ("+e.condition+")":"";const a=e.parentAlias;if(!a||!t){const t=e.alias.subQuery?e.alias.subQuery:this.getTableName(n);return" "+e.direction+" JOIN "+t+" "+this.escape(r)+this.createTableLockExpression()+(e.condition?" ON "+this.replacePropertyNames(e.condition):"")}if(t.isManyToOne||t.isOneToOneOwner){const s=t.joinColumns.map((e=>r+"."+e.referencedColumn.propertyPath+"="+a+"."+t.propertyPath+"."+e.referencedColumn.propertyPath)).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(r)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+i)}if(t.isOneToMany||t.isOneToOneNotOwner){const s=t.inverseRelation.joinColumns.map((e=>("entity-child"===t.inverseEntityMetadata.tableType&&t.inverseEntityMetadata.discriminatorColumn&&(i+=" AND "+r+"."+t.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+t.inverseEntityMetadata.discriminatorValue+"'"),r+"."+t.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+a+"."+e.referencedColumn.propertyPath))).join(" AND ");return" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(r)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(s+i)}{const s=t.junctionEntityMetadata.tablePath,o=e.junctionAlias;let c="",l="";return t.isOwning?(c=t.joinColumns.map((e=>o+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath)).join(" AND "),l=t.inverseJoinColumns.map((e=>r+"."+e.referencedColumn.propertyPath+"="+o+"."+e.propertyPath)).join(" AND ")):(c=t.inverseRelation.inverseJoinColumns.map((e=>o+"."+e.propertyPath+"="+a+"."+e.referencedColumn.propertyPath)).join(" AND "),l=t.inverseRelation.joinColumns.map((e=>r+"."+e.referencedColumn.propertyPath+"="+o+"."+e.propertyPath)).join(" AND "))," "+e.direction+" JOIN "+this.getTableName(s)+" "+this.escape(o)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(c)+" "+e.direction+" JOIN "+this.getTableName(n)+" "+this.escape(r)+this.createTableLockExpression()+" ON "+this.replacePropertyNames(l+i)}})).join(" ")}createGroupByExpression(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""}createOrderByExpression(){const e=this.expressionMap.allOrderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitOffsetExpression(){let e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),"mssql"===this.connection.driver.options.type){let n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(i.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type||"sap"===this.connection.driver.options.type||"spanner"===this.connection.driver.options.type){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new E.G}else if(i.z.isSQLiteFamily(this.connection.driver)){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if("oracle"===this.connection.driver.options.type){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""}createTableLockExpression(){if("mssql"===this.connection.driver.options.type)switch(this.expressionMap.lockMode){case"pessimistic_read":return" WITH (HOLDLOCK, ROWLOCK)";case"pessimistic_write":return" WITH (UPDLOCK, ROWLOCK)";case"dirty_read":return" WITH (NOLOCK)"}return""}createLockExpression(){const e=this.connection.driver;let t="";if(this.expressionMap.lockTables){if(!i.z.isPostgresFamily(e)&&"cockroachdb"!==e.options.type)throw new S.K_("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new S.K_("lockTables cannot be an empty array");t=" OF "+this.expressionMap.lockTables.join(", ")}let n="";switch("nowait"===this.expressionMap.onLocked?n=" NOWAIT":"skip_locked"===this.expressionMap.onLocked&&(n=" SKIP LOCKED"),this.expressionMap.lockMode){case"pessimistic_read":if("mysql"===e.options.type||"aurora-mysql"===e.options.type)return i.z.isReleaseVersionOrGreater(e,"8.0.0")?" FOR SHARE"+t+n:" LOCK IN SHARE MODE";if("mariadb"===e.options.type)return" LOCK IN SHARE MODE";if(i.z.isPostgresFamily(e))return" FOR SHARE"+t+n;if("oracle"===e.options.type)return" FOR UPDATE";if("mssql"===e.options.type)return"";throw new w.A;case"pessimistic_write":if(i.z.isMySQLFamily(e)||"aurora-mysql"===e.options.type||"oracle"===e.options.type)return" FOR UPDATE"+n;if(i.z.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR UPDATE"+t+n;if("mssql"===e.options.type)return"";throw new w.A;case"pessimistic_partial_write":if(i.z.isPostgresFamily(e))return" FOR UPDATE"+t+" SKIP LOCKED";if(i.z.isMySQLFamily(e))return" FOR UPDATE SKIP LOCKED";throw new w.A;case"pessimistic_write_or_fail":if(i.z.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR UPDATE"+t+" NOWAIT";if(i.z.isMySQLFamily(e))return" FOR UPDATE NOWAIT";throw new w.A;case"for_no_key_update":if(i.z.isPostgresFamily(e)||"cockroachdb"===e.options.type)return" FOR NO KEY UPDATE"+t+n;throw new w.A;case"for_key_share":if(i.z.isPostgresFamily(e))return" FOR KEY SHARE"+t+n;throw new w.A;default:return""}}createHavingExpression(){if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";const e=this.expressionMap.havings.map(((e,t)=>{switch(e.type){case"and":return(t>0?"AND ":"")+this.replacePropertyNames(e.condition);case"or":return(t>0?"OR ":"")+this.replacePropertyNames(e.condition);default:return this.replacePropertyNames(e.condition)}})).join(" ");return e.length?" HAVING "+e:""}buildEscapedEntityColumnSelects(e,t){const n=this.expressionMap.selects.some((t=>t.selection===e)),r=[];if(n&&r.push(...t.columns.filter((e=>!0===e.isSelect))),r.push(...t.columns.filter((t=>this.expressionMap.selects.some((n=>n.selection===e+"."+t.propertyPath))))),0===r.length)return[];const a=this.expressionMap.queryEntity?t.primaryColumns.filter((e=>-1===r.indexOf(e))):[],s=[...r,...a],o=[];return s.forEach((t=>{let r=this.escape(e)+"."+this.escape(t.databaseName);if(-1!==this.connection.driver.spatialTypes.indexOf(t.type)){if(i.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type){const e=this.connection.driver.options.legacySpatialSupport;r=`${e?"AsText":"ST_AsText"}(${r})`}i.z.isPostgresFamily(this.connection.driver)&&(r=t.precision?`ST_AsGeoJSON(${r}, ${t.precision})::json`:`ST_AsGeoJSON(${r})::json`),"mssql"===this.connection.driver.options.type&&(r=`${r}.ToString()`)}const a=this.expressionMap.selects.filter((n=>n.selection===e+"."+t.propertyPath));a.length?a.forEach((n=>{o.push({selection:r,aliasName:n.aliasName?n.aliasName:i.z.buildAlias(this.connection.driver,e,t.databaseName),virtual:n.virtual})})):o.push({selection:r,aliasName:i.z.buildAlias(this.connection.driver,e,t.databaseName),virtual:n})})),o}findEntityColumnSelects(e,t){const n=this.expressionMap.selects.find((t=>t.selection===e));return n?[n]:this.expressionMap.selects.filter((n=>t.columns.some((t=>n.selection===e+"."+t.propertyPath))))}computeCountExpression(){const e=this.expressionMap.mainAlias.name,t=this.expressionMap.mainAlias.metadata.primaryColumns,n=this.escape(e);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if("cockroachdb"===this.connection.driver.options.type||i.z.isPostgresFamily(this.connection.driver))return"COUNT(DISTINCT("+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", ")+"))";if(i.z.isMySQLFamily(this.connection.driver))return"COUNT(DISTINCT "+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", ")+")";if("mssql"===this.connection.driver.options.type){const e=t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(", '|;|', ");return 1===t.length?`COUNT(DISTINCT(${e}))`:`COUNT(DISTINCT(CONCAT(${e})))`}if("spanner"===this.connection.driver.options.type){if(1===t.length)return`COUNT(DISTINCT(${n}.${this.escape(t[0].databaseName)}))`;return`COUNT(DISTINCT(CONCAT(${t.map((e=>`CAST(${n}.${this.escape(e.databaseName)} AS STRING)`)).join(", '|;|', ")})))`}return"COUNT(DISTINCT("+t.map((e=>`${n}.${this.escape(e.databaseName)}`)).join(" || '|;|' || ")+"))"}async executeCountQuery(e){const t=this.computeCountExpression(),n=await this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(t,"cnt").setOption("disable-global-order").loadRawResults(e);return n&&n[0]&&n[0].cnt?parseInt(n[0].cnt):0}applyFindOptions(){if(this.expressionMap.mainAlias.metadata){if(this.findOptions.relationLoadStrategy&&(this.expressionMap.relationLoadStrategy=this.findOptions.relationLoadStrategy),this.findOptions.comment&&this.comment(this.findOptions.comment),this.findOptions.withDeleted&&this.withDeleted(),this.findOptions.select){const e=Array.isArray(this.findOptions.select)?r.s.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select;this.buildSelect(e,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.select(this.selects),this.selects=[],this.findOptions.relations){const e=Array.isArray(this.findOptions.relations)?r.s.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations;this.buildRelations(e,"object"==typeof this.findOptions.select?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),!1!==this.findOptions.loadEagerRelations&&"join"===this.expressionMap.relationLoadStrategy&&this.buildEagerRelations(e,"object"==typeof this.findOptions.select?this.findOptions.select:void 0,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name)}if(this.selects.length&&this.addSelect(this.selects),this.findOptions.where&&(this.conditions=this.buildWhere(this.findOptions.where,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.conditions.length&&this.andWhere("("!==this.conditions.substr(0,1)?"("+this.conditions+")":this.conditions)),this.findOptions.order&&this.buildOrder(this.findOptions.order,this.expressionMap.mainAlias.metadata,this.expressionMap.mainAlias.name),this.joins.length&&this.joins.forEach((e=>{e.select&&!e.selection?"inner"===e.type?this.innerJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoinAndSelect(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):"inner"===e.type?this.innerJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias):this.leftJoin(`${e.parentAlias}.${e.relationMetadata.propertyPath}`,e.alias)})),void 0!==this.findOptions.skip&&this.skip(this.findOptions.skip),void 0!==this.findOptions.take&&this.take(this.findOptions.take),"number"==typeof this.findOptions.cache||"boolean"==typeof this.findOptions.cache?this.cache(this.findOptions.cache):"object"==typeof this.findOptions.cache&&this.cache(this.findOptions.cache.id,this.findOptions.cache.milliseconds),this.findOptions.join&&(this.findOptions.join.leftJoin&&Object.keys(this.findOptions.join.leftJoin).forEach((e=>{this.leftJoin(this.findOptions.join.leftJoin[e],e)})),this.findOptions.join.innerJoin&&Object.keys(this.findOptions.join.innerJoin).forEach((e=>{this.innerJoin(this.findOptions.join.innerJoin[e],e)})),this.findOptions.join.leftJoinAndSelect&&Object.keys(this.findOptions.join.leftJoinAndSelect).forEach((e=>{this.leftJoinAndSelect(this.findOptions.join.leftJoinAndSelect[e],e)})),this.findOptions.join.innerJoinAndSelect&&Object.keys(this.findOptions.join.innerJoinAndSelect).forEach((e=>{this.innerJoinAndSelect(this.findOptions.join.innerJoinAndSelect[e],e)}))),this.findOptions.lock)if("optimistic"===this.findOptions.lock.mode)this.setLock(this.findOptions.lock.mode,this.findOptions.lock.version);else if("pessimistic_read"===this.findOptions.lock.mode||"pessimistic_write"===this.findOptions.lock.mode||"dirty_read"===this.findOptions.lock.mode||"pessimistic_partial_write"===this.findOptions.lock.mode||"pessimistic_write_or_fail"===this.findOptions.lock.mode||"for_no_key_update"===this.findOptions.lock.mode||"for_key_share"===this.findOptions.lock.mode){const e=this.findOptions.lock.tables?this.findOptions.lock.tables.map((e=>{const t=this.expressionMap.aliases.find((t=>t.metadata.tableNameWithoutPrefix===e));if(!t)throw new S.K_(`"${e}" is not part of this query`);return this.escape(t.name)})):void 0;this.setLock(this.findOptions.lock.mode,void 0,e),this.findOptions.lock.onLocked&&this.setOnLocked(this.findOptions.lock.onLocked)}!0===this.findOptions.loadRelationIds?this.loadAllRelationIds():"object"==typeof this.findOptions.loadRelationIds&&this.loadAllRelationIds(this.findOptions.loadRelationIds),!1!==this.findOptions.loadEagerRelations&&N.Z.joinEagerRelations(this,this.expressionMap.mainAlias.name,this.expressionMap.mainAlias.metadata),!0===this.findOptions.transaction&&(this.expressionMap.useTransaction=!0)}}async executeEntitiesAndRawResults(e){if(!this.expressionMap.mainAlias)throw new S.K_('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode||"for_key_share"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new c.G;if("optimistic"===this.expressionMap.lockMode){const e=this.expressionMap.mainAlias.metadata;if(!e.versionColumn&&!e.updateDateColumn)throw new l.f(e.name)}const t=new y(this.connection,e,this.expressionMap.relationIdAttributes),n=new _(this.connection,e,this.expressionMap.relationCountAttributes);new g(this.expressionMap).transform();new b(this.expressionMap).transform();let a=[],s=[];if((this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0){const[t,n]=this.createOrderByCombinedWithSelectExpression("distinctAlias"),r=this.expressionMap.mainAlias.metadata,s=this.expressionMap.mainAlias.name,o=r.primaryColumns.map((e=>{const t=this.escape("distinctAlias"),r=this.escape(i.z.buildAlias(this.connection.driver,s,e.databaseName));n[r]||(n[r]="ASC");const a=i.z.buildAlias(this.connection.driver,"ids_"+s,e.databaseName);return`${t}.${r} AS ${this.escape(a)}`}));if(a=await new M(this.connection,e).select(`DISTINCT ${o.join(", ")}`).addSelect(t).from(`(${this.clone().orderBy().getQuery()})`,"distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(n).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany(),a.length>0){let t="";const n={};if(r.hasMultiplePrimaryKeys)t=a.map(((e,t)=>r.primaryColumns.map((r=>{const i=`orm_distinct_ids_${t}_${r.databaseName}`;return n[i]=e[`ids_${s}_${r.databaseName}`],`${s}.${r.propertyPath}=:${i}`})).join(" AND "))).join(" OR ");else{const e=i.z.buildAlias(this.connection.driver,"ids_"+s,r.primaryColumns[0].databaseName),o=a.map((t=>t[e]));o.every((e=>"number"==typeof e))?t=`${s}.${r.primaryColumns[0].propertyPath} IN (${o.join(", ")})`:(n.orm_distinct_ids=o,t=s+"."+r.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")}a=await this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:t}).setParameters(n).loadRawResults(e)}}else a=await this.loadRawResults(e);if(a.length>0){const r=await t.load(a),i=await n.load(a),c=new o(this.expressionMap,this.connection.driver,r,i,this.queryRunner);s=c.transform(a,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("Load",this.expressionMap.mainAlias.metadata,s)}return"query"===this.expressionMap.relationLoadStrategy&&await Promise.all(this.relationMetadatas.map((async e=>{const t=e.inverseEntityMetadata.target,n=e.inverseEntityMetadata.targetName,i=Array.isArray(this.findOptions.select)?r.s.propertyPathsToTruthyObject(this.findOptions.select):this.findOptions.select,a=Array.isArray(this.findOptions.relations)?r.s.propertyPathsToTruthyObject(this.findOptions.relations):this.findOptions.relations,o=this.createQueryBuilder().select(n).from(t,n).setFindOptions({select:i?r.s.deepValue(i,e.propertyPath):void 0,order:this.findOptions.order?r.s.deepValue(this.findOptions.order,e.propertyPath):void 0,relations:a?r.s.deepValue(a,e.propertyPath):void 0,withDeleted:this.findOptions.withDeleted,relationLoadStrategy:this.findOptions.relationLoadStrategy});if(s.length>0){const t=await this.connection.relationIdLoader.loadManyToManyRelationIdsAndGroup(e,s,void 0,o);s.forEach((n=>{const r=t.find((e=>e.entity===n));if(r){const t=void 0===r.related?null:r.related;e.setEntityValue(n,t)}}))}}))),{raw:a,entities:s}}createOrderByCombinedWithSelectExpression(e){const t=this.expressionMap.allOrderBys,n=Object.keys(t).map((t=>{if(-1!==t.indexOf(".")){const n=t.split("."),r=n[0],a=n.slice(1).join("."),s=this.expressionMap.findAliasByName(r).metadata.findColumnWithPropertyPath(a);return this.escape(e)+"."+this.escape(i.z.buildAlias(this.connection.driver,r,s.databaseName))}return this.expressionMap.selects.find((e=>e.selection===t||e.aliasName===t))?this.escape(e)+"."+t:""})).join(", "),r={};return Object.keys(t).forEach((n=>{if(-1!==n.indexOf(".")){const a=n.split("."),s=a[0],o=a.slice(1).join("."),c=this.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(o);r[this.escape(e)+"."+this.escape(i.z.buildAlias(this.connection.driver,s,c.databaseName))]=t[n]}else this.expressionMap.selects.find((e=>e.selection===n||e.aliasName===n))?r[this.escape(e)+"."+n]=t[n]:r[n]=t[n]})),[n,r]}async loadRawResults(e){const[t,n]=this.getQueryAndParameters(),r=t+" -- PARAMETERS: "+JSON.stringify(n),i="object"==typeof this.connection.options.cache?this.connection.options.cache:{};let a,s=!1;if(this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled))try{if(a=await this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:r,duration:this.expressionMap.cacheDuration||i.duration||1e3},e),a&&!this.connection.queryResultCache.isExpired(a))return JSON.parse(a.result)}catch(e){if(!i.ignoreErrors)throw e;s=!0}const o=await e.query(t,n,!0);if(!s&&this.connection.queryResultCache&&(this.expressionMap.cache||i.alwaysEnabled))try{await this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:r,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||i.duration||1e3,result:JSON.stringify(o.records)},a,e)}catch(e){if(!i.ignoreErrors)throw e}return o.records}mergeExpressionMap(e){return a.g.assign(this.expressionMap,e),this}normalizeNumber(e){return"number"==typeof e||null==e?e:Number(e)}obtainQueryRunner(){return this.queryRunner||this.connection.createQueryRunner("slave")}buildSelect(e,t,n,r){for(let i in e){if(void 0===e[i]||!1===e[i])continue;const a=r?r+"."+i:i,s=t.findColumnWithPropertyPathStrict(a),o=t.findEmbeddedWithPropertyPath(a),c=t.findRelationWithPropertyPath(a);if(!o&&!s&&!c)throw new C.B(a,t);s?this.selects.push(n+"."+a):o&&this.buildSelect(e[i],t,n,i)}}buildRelations(e,t,n,a,s){e&&Object.keys(e).forEach((o=>{const c=e[o],l=s?s+"."+o:o,u=n.findEmbeddedWithPropertyPath(l),h=n.findRelationWithPropertyPath(l);if(!u&&!h)throw new C.B(l,n);if(u)this.buildRelations(c,"object"==typeof t?r.s.deepValue(t,u.propertyPath):void 0,n,a,l);else if(h){let e=a+"_"+l.replace(".","_");e=i.z.buildAlias(this.connection.driver,{joiner:"__"},a,e),!0!==c&&"object"!=typeof c||("query"===this.expressionMap.relationLoadStrategy?this.relationMetadatas.push(h):(this.joins.push({type:"left",select:!0,selection:t&&"object"==typeof t[o]?t[o]:void 0,alias:e,parentAlias:a,relationMetadata:h}),t&&"object"==typeof t[o]&&this.buildSelect(t[o],h.inverseEntityMetadata,e))),"object"==typeof c&&"join"===this.expressionMap.relationLoadStrategy&&this.buildRelations(c,"object"==typeof t?r.s.deepValue(t,h.propertyPath):void 0,h.inverseEntityMetadata,e,void 0)}}))}buildEagerRelations(e,t,n,a,s){e&&Object.keys(e).forEach((o=>{const c=e[o],l=s?s+"."+o:o,u=n.findEmbeddedWithPropertyPath(l),h=n.findRelationWithPropertyPath(l);if(!u&&!h)throw new C.B(l,n);if(u)this.buildEagerRelations(c,"object"==typeof t?r.s.deepValue(t,u.propertyPath):void 0,n,a,l);else if(h){let e=a+"_"+l.replace(".","_");e=i.z.buildAlias(this.connection.driver,{joiner:"__"},a,e),!0!==c&&"object"!=typeof c||h.inverseEntityMetadata.eagerRelations.forEach((n=>{let r=e+"_"+n.propertyPath.replace(".","_");r=i.z.buildAlias(this.connection.driver,{joiner:"__"},e,r);this.joins.find((e=>e.alias===r))||this.joins.push({type:"left",select:!0,alias:r,parentAlias:e,selection:void 0,relationMetadata:n}),t&&"object"==typeof t[o]&&this.buildSelect(t[o],h.inverseEntityMetadata,e)})),"object"==typeof c&&this.buildEagerRelations(c,"object"==typeof t?r.s.deepValue(t,h.propertyPath):void 0,h.inverseEntityMetadata,e,void 0)}}))}buildOrder(e,t,n,r){for(let a in e){if(void 0===e[a])continue;const s=r?r+"."+a:a,o=t.findColumnWithPropertyPathStrict(s),c=t.findEmbeddedWithPropertyPath(s),l=t.findRelationWithPropertyPath(s);if(!c&&!o&&!l)throw new C.B(s,t);if(o){let t="object"==typeof e[a]?e[a].direction:e[a];t="DESC"===t||"desc"===t||-1===t?"DESC":"ASC";let r="object"==typeof e[a]?e[a].nulls:void 0;r="first"===(null==r?void 0:r.toLowerCase())?"NULLS FIRST":"last"===(null==r?void 0:r.toLowerCase())?"NULLS LAST":void 0,this.addOrderBy(`${n}.${s}`,t,r)}else if(c)this.buildOrder(e[a],t,n,s);else if(l){let t=n+"_"+s.replace(".","_");t=i.z.buildAlias(this.connection.driver,{joiner:"__"},n,t);this.joins.find((e=>e.alias===t))||this.joins.push({type:"left",select:!1,alias:t,parentAlias:n,selection:void 0,relationMetadata:l}),this.buildOrder(e[a],l.inverseEntityMetadata,t)}}}buildWhere(e,t,n,r){let a="";if(Array.isArray(e))a="("+e.map((e=>this.buildWhere(e,t,n,r))).filter((e=>!!e)).map((e=>"("+e+")")).join(" OR ")+")";else{let s=[];for(let a in e){if(void 0===e[a]||null===e[a])continue;const o=r?r+"."+a:a,c=t.findColumnWithPropertyPathStrict(o),l=t.findEmbeddedWithPropertyPath(o),u=t.findRelationWithPropertyPath(o);if(!l&&!c&&!u)throw new C.B(o,t);if(c){const t=`${n}.${o}`;let r=e[a];x.a.isEqualOperator(e[a])&&(r=e[a].value),c.transformer&&(r=A.A.transformTo(c.transformer,r)),s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(t,r)))}else if(l){const r=this.buildWhere(e[a],t,n,o);r&&s.push(r)}else if(u){if("object"==typeof e[a]){if(Object.keys(e[a]).every((t=>void 0===e[a][t])))continue}if(x.a.isFindOperator(e[a]))if("moreThan"===e[a].type||"lessThan"===e[a].type){const t="moreThan"===e[a].type?">":"<",r=this.subQuery();if(u.isManyToManyOwner)r.select("COUNT(*)").from(u.joinTableName,u.joinTableName).where(u.joinColumns.map((e=>`${u.joinTableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "));else if(u.isManyToManyNotOwner)r.select("COUNT(*)").from(u.inverseRelation.joinTableName,u.inverseRelation.joinTableName).where(u.inverseRelation.inverseJoinColumns.map((e=>`${u.inverseRelation.joinTableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "));else{if(!u.isOneToMany)throw new Error("This relation isn't supported by given find operator");r.select("COUNT(*)").from(u.inverseEntityMetadata.target,u.inverseEntityMetadata.tableName).where(u.inverseRelation.joinColumns.map((e=>`${u.inverseEntityMetadata.tableName}.${e.propertyName} = ${n}.${e.referencedColumn.propertyName}`)).join(" AND "))}this.andWhere(r.getSql()+" "+t+" "+parseInt(e[a].value))}else{if(!(u.isManyToOne||u.isOneToOne&&u.isOneToOneOwner))throw new Error("This relation isn't supported by given find operator");{const t=`${n}.${o}`;s.push(this.createWhereConditionExpression(this.getWherePredicateCondition(t,e[a])))}}else{let t=n+"_"+u.propertyPath.replace(".","_");t=i.z.buildAlias(this.connection.driver,{joiner:"__"},n,t);const r=this.joins.find((e=>e.alias===t));r?"left"===r.type&&(r.type="inner"):this.joins.push({type:"inner",select:!1,selection:void 0,alias:t,parentAlias:n,relationMetadata:u});const o=this.buildWhere(e[a],u.inverseEntityMetadata,t);o&&s.push(o)}}}a=s.join(" AND ")}return a}}},866079:(e,t,n)=>{"use strict";n.d(t,{B:()=>p});var r=n(5778),i=n(231134),a=n(976588),s=n(14550),o=n(883474),c=n(704480),l=n(138946),u=n(600706),h=n(407337),d=n(312758);class p extends r.z{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("SoftDeleteQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createUpdateExpression();return e+=this.createCteExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e.trim()}async execute(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&("soft-delete"===this.expressionMap.queryType?await e.broadcaster.broadcast("BeforeSoftRemove",this.expressionMap.mainAlias.metadata):"restore"===this.expressionMap.queryType&&await e.broadcaster.broadcast("BeforeRecover",this.expressionMap.mainAlias.metadata));const n=new s.v(e,this.expressionMap);!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getSoftDeletionReturningColumns());const[r,a]=this.getQueryAndParameters(),o=await e.query(r,a,!0),c=i.s.from(o);return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await n.update(c,this.expressionMap.whereEntities),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&("soft-delete"===this.expressionMap.queryType?await e.broadcaster.broadcast("AfterSoftRemove",this.expressionMap.mainAlias.metadata):"restore"===this.expressionMap.queryType&&await e.broadcaster.broadcast("AfterRecover",this.expressionMap.mainAlias.metadata)),t&&await e.commitTransaction(),c}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}from(e,t){e=d.a.isEntitySchema(e)?e.options.name:e;const n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new a.y;return this.expressionMap.returning=e,this}orderBy(e,t="ASC",n){return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new u.K_(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const t=Array.isArray(e)?e:[e];return t.forEach((e=>{const t=this.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!t)throw new u.K_("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(t)})),this.expressionMap.whereEntities=t,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new u.K_(`Cannot get entity metadata for the given alias "${this.expressionMap.mainAlias}"`);if(!e.deleteDateColumn)throw new c.d(e);const t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new u.K_('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new l.y;const n=this.createWhereExpression(),r=this.createReturningExpression("update");return""===r?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")}${n}`:"mssql"===this.connection.driver.options.type?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")} OUTPUT ${r}${n}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${t.join(", ")}${n} RETURNING ${r}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(h.z.isMySQLFamily(this.connection.driver))return" LIMIT "+e;throw new o.T}return""}}},537041:(e,t,n)=>{"use strict";n.d(t,{T:()=>p});var r=n(5778),i=n(231134),a=n(976588),s=n(14550),o=n(883474),c=n(138946),l=n(600706),u=n(452257),h=n(407337),d=n(348834).Buffer;class p extends r.z{constructor(e,t){super(e,t),this["@instanceof"]=Symbol.for("UpdateQueryBuilder"),this.expressionMap.aliasNamePrefixingEnabled=!1}getQuery(){let e=this.createComment();return e+=this.createCteExpression(),e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),e+=this.createLimitExpression(),e.trim()}async execute(){const e=this.obtainQueryRunner();let t=!1;try{!0===this.expressionMap.useTransaction&&!1===e.isTransactionActive&&(await e.startTransaction(),t=!0),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("BeforeUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet);let n=null,r=null;const a=new s.v(e,this.expressionMap),o=[];if(Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)for(const e of this.expressionMap.returning)o.push(...this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(e));!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=a.getUpdationReturningColumns(),o.push(...this.expressionMap.extraReturningColumns.filter((e=>!o.includes(e))))),o.length>0&&"mssql"===this.connection.driver.options.type&&(n=this.connection.driver.buildTableVariableDeclaration("@OutputTable",o),r="SELECT * FROM @OutputTable");const[c,l]=this.getQueryAndParameters(),u=[n,c,r],h=await e.query(u.filter((e=>null!=e)).join(";\n\n"),l,!0),d=i.s.from(h);return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&await a.update(d,this.expressionMap.whereEntities),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata&&await e.broadcaster.broadcast("AfterUpdate",this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),t&&await e.commitTransaction(),d}catch(n){if(t)try{await e.rollbackTransaction()}catch(e){}throw n}finally{e!==this.queryRunner&&await e.release()}}set(e){return this.expressionMap.valuesSet=e,this}where(e,t){this.expressionMap.wheres=[];const n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this}andWhere(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}orWhere(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this}whereInIds(e){return this.where(this.getWhereInIdsCondition(e))}andWhereInIds(e){return this.andWhere(this.getWhereInIdsCondition(e))}orWhereInIds(e){return this.orWhere(this.getWhereInIdsCondition(e))}output(e){return this.returning(e)}returning(e){if(!this.connection.driver.isReturningSqlSupported("update"))throw new a.y;return this.expressionMap.returning=e,this}orderBy(e,t="ASC",n){return this.expressionMap.orderBys=e?"object"==typeof e?e:n?{[e]:{order:t,nulls:n}}:{[e]:t}:{},this}addOrderBy(e,t="ASC",n){return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this}limit(e){return this.expressionMap.limit=e,this}whereEntity(e){if(!this.expressionMap.mainAlias.hasMetadata)throw new l.K_(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];const t=Array.isArray(e)?e:[e];return t.forEach((e=>{const t=this.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!t)throw new l.K_("Provided entity does not have ids set, cannot perform operation.");this.orWhereInIds(t)})),this.expressionMap.whereEntities=t,this}updateEntity(e){return this.expressionMap.updateEntity=e,this}createUpdateExpression(){const e=this.getValueSet(),t=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,n={};for(let t in e)void 0!==e[t]&&(n[t]=e[t]);const r=[],i=[];if(t?(this.createPropertyPath(t,n).forEach((e=>{const a=t.findColumnsWithPropertyPath(e);if(a.length<=0)throw new u.B(e,t);a.forEach((e=>{if(!e.isUpdate||i.includes(e))return;i.push(e);let t=e.getEntityValue(n);if(!e.referencedColumn||"object"!=typeof t||t instanceof Date||null===t||d.isBuffer(t)?"function"!=typeof t&&(t=this.connection.driver.preparePersistentValue(t,e)):t=e.referencedColumn.getEntityValue(t),"function"==typeof t)r.push(this.escape(e.databaseName)+" = "+t());else if("sap"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type||null!==t){"mssql"===this.connection.driver.options.type&&(t=this.connection.driver.parametrizeValue(e,t));const n=this.createParameter(t);let i=null;if(!h.z.isMySQLFamily(this.connection.driver)&&"aurora-mysql"!==this.connection.driver.options.type||-1===this.connection.driver.spatialTypes.indexOf(e.type))i="postgres"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(e.type)?null!=e.srid?`ST_SetSRID(ST_GeomFromGeoJSON(${n}), ${e.srid})::${e.type}`:`ST_GeomFromGeoJSON(${n})::${e.type}`:"mssql"===this.connection.driver.options.type&&-1!==this.connection.driver.spatialTypes.indexOf(e.type)?e.type+"::STGeomFromText("+n+", "+(e.srid||"0")+")":n;else{const t=this.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";i=null!=e.srid?`${t}(${n}, ${e.srid})`:`${t}(${n})`}r.push(this.escape(e.databaseName)+" = "+i)}else r.push(this.escape(e.databaseName)+" = NULL")}))})),(r.length>0||0===Object.keys(n).length)&&(t.versionColumn&&-1===i.indexOf(t.versionColumn)&&r.push(this.escape(t.versionColumn.databaseName)+" = "+this.escape(t.versionColumn.databaseName)+" + 1"),t.updateDateColumn&&-1===i.indexOf(t.updateDateColumn)&&r.push(this.escape(t.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"))):Object.keys(n).map((e=>{let t=n[e];if("function"==typeof t)r.push(this.escape(e)+" = "+t());else if("sap"!==this.connection.driver.options.type&&"spanner"!==this.connection.driver.options.type||null!==t){const n=this.createParameter(t);r.push(this.escape(e)+" = "+n)}else r.push(this.escape(e)+" = NULL")})),r.length<=0)throw new c.y;const a=this.createWhereExpression(),s=this.createReturningExpression("update");return""===s?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${r.join(", ")}${a}`:"mssql"===this.connection.driver.options.type?`UPDATE ${this.getTableName(this.getMainTableName())} SET ${r.join(", ")} OUTPUT ${s}${a}`:`UPDATE ${this.getTableName(this.getMainTableName())} SET ${r.join(", ")}${a} RETURNING ${s}`}createOrderByExpression(){const e=this.expressionMap.orderBys;return Object.keys(e).length>0?" ORDER BY "+Object.keys(e).map((t=>"string"==typeof e[t]?this.replacePropertyNames(t)+" "+e[t]:this.replacePropertyNames(t)+" "+e[t].order+" "+e[t].nulls)).join(", "):""}createLimitExpression(){let e=this.expressionMap.limit;if(e){if(h.z.isMySQLFamily(this.connection.driver)||"aurora-mysql"===this.connection.driver.options.type)return" LIMIT "+e;throw new o.T}return""}getValueSet(){if("object"==typeof this.expressionMap.valuesSet)return this.expressionMap.valuesSet;throw new c.y}}},151835:(e,t,n)=>{"use strict";n.d(t,{$:()=>s});var r=n(395008),i=n(503681),a=n(584639);class s{constructor(e,t){this.expressionMap=e,i.g.assign(this,t||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value must be a string representation of alias property");return this.relationName.split(".")[0]}get relationProperty(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value is a string representation of alias property");return this.relationName.split(".")[1]}get junctionAlias(){const[e,t]=this.relationName.split(".");return e+"_"+t+"_rc"}get relation(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value is a string representation of alias property");const[e,t]=this.relationName.split("."),n=this.expressionMap.findAliasByName(e).metadata.findRelationWithPropertyPath(t);if(!n)throw new a.K(`Relation with property path ${t} in entity was not found.`);return n}get metadata(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value is a string representation of alias property");const e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata}get mapToPropertyPropertyName(){return this.mapToProperty.split(".")[1]}}},331925:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var r=n(395008),i=n(503681),a=n(584639);class s{constructor(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,i.g.assign(this,t||{})}get joinInverseSideMetadata(){return this.relation.inverseEntityMetadata}get parentAlias(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))}get relationPropertyPath(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)}get relation(){if(!r.G.isAliasProperty(this.relationName))throw new a.K("Given value must be a string representation of alias property");const e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new a.K(`Relation with property path ${this.relationPropertyPath} in entity was not found.`);return e}get junctionAlias(){const[e,t]=this.relationName.split(".");return e+"_"+t+"_rid"}get junctionMetadata(){return this.relation.junctionEntityMetadata}get mapToPropertyParentAlias(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))}get mapToPropertyPropertyPath(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)}}},100698:(e,t,n)=>{"use strict";n.d(t,{y:()=>r});class r{static from(e){const t=new this;return t.raw=e.records,t.affected=e.affected,t}}},787493:(e,t,n)=>{"use strict";n.d(t,{t:()=>r});class r{constructor(){this.identifiers=[],this.generatedMaps=[]}static from(e){const t=new this;return t.raw=e.raw,t}}},231134:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});class r{constructor(){this.generatedMaps=[]}static from(e){const t=new this;return t.raw=e.records,t.affected=e.affected,t}}},172943:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});class r{constructor(){this.count=0,this.promises=[]}async wait(){return this.promises.length>0&&await Promise.all(this.promises),this}}},900924:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});class r{static transformFrom(e,t){if(Array.isArray(e)){return e.slice().reverse().reduce(((e,t)=>t.from(e)),t)}return e.from(t)}static transformTo(e,t){return Array.isArray(e)?e.reduce(((e,t)=>t.to(e)),t):e.to(t)}}},312758:(e,t,n)=>{"use strict";n.d(t,{a:()=>r});class r{static isMssqlParameter(e){return this.check(e,"MssqlParameter")}static isEntityMetadata(e){return this.check(e,"EntityMetadata")}static isColumnMetadata(e){return this.check(e,"ColumnMetadata")}static isQueryBuilder(e){return this.check(e,"QueryBuilder")||this.check(e,"SelectQueryBuilder")||this.check(e,"InsertQueryBuilder")||this.check(e,"DeleteQueryBuilder")||this.check(e,"UpdateQueryBuilder")||this.check(e,"SoftDeleteQueryBuilder")||this.check(e,"RelationQueryBuilder")}static isSelectQueryBuilder(e){return this.check(e,"SelectQueryBuilder")}static isInsertQueryBuilder(e){return this.check(e,"InsertQueryBuilder")}static isDeleteQueryBuilder(e){return this.check(e,"DeleteQueryBuilder")}static isUpdateQueryBuilder(e){return this.check(e,"UpdateQueryBuilder")}static isSoftDeleteQueryBuilder(e){return this.check(e,"SoftDeleteQueryBuilder")}static isRelationQueryBuilder(e){return this.check(e,"RelationQueryBuilder")}static isBrackets(e){return this.check(e,"Brackets")||this.check(e,"NotBrackets")}static isNotBrackets(e){return this.check(e,"NotBrackets")}static isSubject(e){return this.check(e,"Subject")}static isRdbmsSchemaBuilder(e){return this.check(e,"RdbmsSchemaBuilder")}static isMongoEntityManager(e){return this.check(e,"MongoEntityManager")}static isSqljsEntityManager(e){return this.check(e,"SqljsEntityManager")}static isEntitySchema(e){return this.check(e,"EntitySchema")}static isBaseEntityConstructor(e){return"function"==typeof e&&"function"==typeof e.hasId&&"function"==typeof e.save&&"function"==typeof e.useDataSource}static isFindOperator(e){return this.check(e,"FindOperator")||this.check(e,"EqualOperator")}static isEqualOperator(e){return this.check(e,"EqualOperator")}static isQuery(e){return this.check(e,"Query")}static isTable(e){return this.check(e,"Table")}static isTableCheck(e){return this.check(e,"TableCheck")}static isTableColumn(e){return this.check(e,"TableColumn")}static isTableExclusion(e){return this.check(e,"TableExclusion")}static isTableForeignKey(e){return this.check(e,"TableForeignKey")}static isTableIndex(e){return this.check(e,"TableIndex")}static isTableUnique(e){return this.check(e,"TableUnique")}static isView(e){return this.check(e,"View")}static isDataSource(e){return this.check(e,"DataSource")}static check(e,t){return"object"==typeof e&&null!==e&&e["@instanceof"]===Symbol.for(t)}}},503681:(e,t,n)=>{"use strict";n.d(t,{g:()=>r});class r{static isObject(e){return null!==e&&"object"==typeof e}static assign(e,...t){for(const n of t)for(const t of Object.getOwnPropertyNames(n))e[t]=n[t]}static mixedListToArray(e){return null!==e&&"object"==typeof e?Object.keys(e).map((t=>e[t])):e}}},234769:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});class r{static chunk(e,t){return Array.from(Array(Math.ceil(e.length/t)),((n,r)=>e.slice(r*t,r*t+t)))}static splitClassesAndStrings(e){return[e.filter((e=>"string"!=typeof e)),e.filter((e=>"string"==typeof e))]}static groupBy(e,t){return e.reduce(((e,n)=>{const r=t(n);let i=e.find((e=>e.id===r));return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e}),[])}static uniq(e,t){return e.reduce(((e,n)=>{let r=!1;if("function"==typeof t){const i=t(n);r=!!e.find((e=>t(e)===i))}else r="string"==typeof t?!!e.find((e=>e[t]===n[t])):-1!==e.indexOf(n);return r||e.push(n),e}),[])}static isPlainObject(e){return null!=e&&(!e.constructor||e.constructor===Object)}static mergeArrayKey(e,t,n,r){r.has(n)?e[t]=r.get(n):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||(e[t]=Array.isArray(n)?[]:{}),r.set(n,e[t]),this.merge(e[t],n,r),r.delete(n)):e[t]=n)}static mergeObjectKey(e,t,n,r){r.has(n)?Object.assign(e,{[t]:r.get(n)}):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||Object.assign(e,{[t]:Array.isArray(n)?[]:{}}),r.set(n,e[t]),this.merge(e[t],n,r),r.delete(n)):Object.assign(e,{[t]:n}))}static merge(e,t,n=new Map){if(this.isPlainObject(e)&&this.isPlainObject(t))for(const r of Object.keys(t))"__proto__"!==r&&this.mergeObjectKey(e,r,t[r],n);if(Array.isArray(e)&&Array.isArray(t))for(let r=0;r<t.length;r++)this.mergeArrayKey(e,r,t[r],n)}static mergeDeep(e,...t){if(!t.length)return e;for(const n of t)r.merge(e,n);return e}static deepCompare(...e){let t,n,r,i;if(arguments.length<1)return!0;for(t=1,n=arguments.length;t<n;t++)if(r=[],i=[],!this.compare2Objects(r,i,arguments[0],arguments[t]))return!1;return!0}static deepValue(e,t){const n=t.split(".");for(let t=0,r=n.length;t<r;t++)e=e[n[t]];return e}static replaceEmptyObjectsWithBooleans(e){for(let t in e)e[t]&&"object"==typeof e[t]&&(0===Object.keys(e[t]).length?e[t]=!0:this.replaceEmptyObjectsWithBooleans(e[t]))}static propertyPathsToTruthyObject(e){let t={};for(let n of e){const e=n.split(".");if(!e.length)continue;t[e[0]]&&!0!==t[e[0]]||(t[e[0]]={});let r=t[e[0]];for(let[t,n]of e.entries())0!==t&&(r[n]?r=r[n]:t===e.length-1?(r[n]={},r=null):(r[n]={},r=r[n]))}return this.replaceEmptyObjectsWithBooleans(t),t}static compareIds(e,t){return null!=e&&null!=t&&(("string"==typeof e.id&&"string"==typeof t.id||"number"==typeof e.id&&"number"==typeof t.id)&&1===Object.keys(e).length&&1===Object.keys(t).length?e.id===t.id:r.deepCompare(e,t))}static toBoolean(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0}static zipObject(e,t){return e.reduce(((e,n,r)=>(e[n]=t[r],e)),{})}static isArraysEqual(e,t){return e.length===t.length&&e.every((e=>-1!==t.indexOf(e)))}static areMutuallyExclusive(...e){return!e.some((t=>{const n=e.filter((e=>e!==t));return t.some((e=>n.some((t=>t.includes(e)))))}))}static compare2Objects(e,t,n,r){let i;if(Number.isNaN(n)&&Number.isNaN(r))return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"==typeof n.equals||"function"==typeof n.equals)&&n.equals(r))return!0;if("function"==typeof n&&"function"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||"string"==typeof n&&"string"==typeof r||"number"==typeof n&&"number"==typeof r)return n.toString()===r.toString();if("object"!=typeof n||"object"!=typeof r)return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(i in r){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1}for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0}}},116188:(e,t,n)=>{"use strict";n.d(t,{OV:()=>c,Qs:()=>o,eV:()=>a,fu:()=>s,vp:()=>l});var r=n(609065),i=n.n(r);function a(e,t=!1){return e.replace(/^([A-Z])|[\s-_](\w)/g,(function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()}))}function s(e){return e.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase()}function o(e){return e.replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()))}function c(e,t={}){const{segmentLength:n=4,separator:r="__",termLength:i=2}=t;return e.split(r).reduce(((e,t)=>{const r=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),a=r.length>1?i:n,s=r.map((e=>e.substr(0,a))).join("");return e.push(s),e}),[]).join(r)}function l(e,t={}){const n=i()("sha256");n.update(e,"utf8");const r=n.digest("hex");return t.length?r.slice(0,t.length):r}},754881:(e,t,n)=>{"use strict";n.d(t,{m:()=>r});class r{static isGreaterOrEqual(e,t){const n=i(e),r=i(t);return n[0]>r[0]||n[0]===r[0]&&n[1]>r[1]||n[0]===r[0]&&n[1]===r[1]&&n[2]>=r[2]}}function i(e=""){const t=[0,0,0];return e.split(".").forEach(((e,n)=>t[n]=parseInt(e,10))),t}},677748:(e,t,n)=>{var r=n(665539).Symbol;e.exports=r},692299:(e,t,n)=>{var r=n(677748),i=n(795999),a=n(608572),s=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?i(e):a(e)}},286515:e=>{e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a}},383830:(e,t,n)=>{var r=n(252138),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},783522:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},795999:(e,t,n)=>{var r=n(677748),i=Object.prototype,a=i.hasOwnProperty,s=i.toString,o=r?r.toStringTag:void 0;e.exports=function(e){var t=a.call(e,o),n=e[o];try{e[o]=void 0;var r=!0}catch(e){}var i=s.call(e);return r&&(t?e[o]=n:delete e[o]),i}},792207:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n}},83009:(e,t,n)=>{var r=n(712597),i=n(918228),a=n(792207),s=n(216109);e.exports=function(e,t,n){if(!s(n))return!1;var o=typeof t;return!!("number"==o?i(n)&&a(t,n.length):"string"==o&&t in n)&&r(n[t],e)}},608572:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},665539:(e,t,n)=>{var r=n(783522),i="object"==typeof self&&self&&self.Object===Object&&self,a=r||i||Function("return this")();e.exports=a},252138:e=>{var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},173964:(e,t,n)=>{var r=n(286515),i=n(83009),a=n(5467),s=Math.ceil,o=Math.max;e.exports=function(e,t,n){t=(n?i(e,t,n):void 0===t)?1:o(a(t),0);var c=null==e?0:e.length;if(!c||t<1)return[];for(var l=0,u=0,h=Array(s(c/t));l<c;)h[u++]=r(e,l,l+=t);return h}},712597:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},918228:(e,t,n)=>{var r=n(726028),i=n(600172);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},726028:(e,t,n)=>{var r=n(692299),i=n(216109);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},600172:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},216109:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},127056:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},274583:(e,t,n)=>{var r=n(692299),i=n(127056);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==r(e)}},766813:(e,t,n)=>{var r=n(217115),i=1/0;e.exports=function(e){return e?(e=r(e))===i||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},5467:(e,t,n)=>{var r=n(766813);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},217115:(e,t,n)=>{var r=n(383830),i=n(216109),a=n(274583),s=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=o.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):s.test(e)?NaN:+e}},287886:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorValues=t.standardErrorCodes=void 0,t.standardErrorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901,unsupportedChain:4902}},t.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}}},750566:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardErrors=void 0;const r=n(287886),i=n(531781);function a(e,t){const[n,r]=o(t);return new c(e,n||(0,i.getMessageFromCode)(e),r)}function s(e,t){const[n,r]=o(t);return new l(e,n||(0,i.getMessageFromCode)(e),r)}function o(e){if(e){if("string"==typeof e)return[e];if("object"==typeof e&&!Array.isArray(e)){const{message:t,data:n}=e;if(t&&"string"!=typeof t)throw new Error("Must specify string message.");return[t||void 0,n]}}return[]}t.standardErrors={rpc:{parse:e=>a(r.standardErrorCodes.rpc.parse,e),invalidRequest:e=>a(r.standardErrorCodes.rpc.invalidRequest,e),invalidParams:e=>a(r.standardErrorCodes.rpc.invalidParams,e),methodNotFound:e=>a(r.standardErrorCodes.rpc.methodNotFound,e),internal:e=>a(r.standardErrorCodes.rpc.internal,e),server:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return a(t,e)},invalidInput:e=>a(r.standardErrorCodes.rpc.invalidInput,e),resourceNotFound:e=>a(r.standardErrorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>a(r.standardErrorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>a(r.standardErrorCodes.rpc.transactionRejected,e),methodNotSupported:e=>a(r.standardErrorCodes.rpc.methodNotSupported,e),limitExceeded:e=>a(r.standardErrorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>s(r.standardErrorCodes.provider.userRejectedRequest,e),unauthorized:e=>s(r.standardErrorCodes.provider.unauthorized,e),unsupportedMethod:e=>s(r.standardErrorCodes.provider.unsupportedMethod,e),disconnected:e=>s(r.standardErrorCodes.provider.disconnected,e),chainDisconnected:e=>s(r.standardErrorCodes.provider.chainDisconnected,e),unsupportedChain:e=>s(r.standardErrorCodes.provider.unsupportedChain,e),custom:e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:t,message:n,data:r}=e;if(!n||"string"!=typeof n)throw new Error('"message" must be a nonempty string');return new l(t,n,r)}}};class c extends Error{constructor(e,t,n){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw new Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==n&&(this.data=n)}}class l extends c{constructor(e,t,n){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,n)}}},60397:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.standardErrors=t.standardErrorCodes=t.serializeError=t.getMessageFromCode=t.getErrorCode=void 0;const r=n(287886);Object.defineProperty(t,"standardErrorCodes",{enumerable:!0,get:function(){return r.standardErrorCodes}});const i=n(750566);Object.defineProperty(t,"standardErrors",{enumerable:!0,get:function(){return i.standardErrors}});const a=n(265560);Object.defineProperty(t,"serializeError",{enumerable:!0,get:function(){return a.serializeError}});const s=n(531781);Object.defineProperty(t,"getErrorCode",{enumerable:!0,get:function(){return s.getErrorCode}}),Object.defineProperty(t,"getMessageFromCode",{enumerable:!0,get:function(){return s.getMessageFromCode}})},265560:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serializeError=void 0;const r=n(449525),i=n(553329),a=n(287886),s=n(531781);t.serializeError=function(e,t){const n=(0,s.serialize)(function(e){if("string"==typeof e)return{message:e,code:a.standardErrorCodes.rpc.internal};if((0,r.isErrorResponse)(e))return Object.assign(Object.assign({},e),{message:e.errorMessage,code:e.errorCode,data:{method:e.method}});return e}(e),{shouldIncludeStack:!0}),o=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors");o.searchParams.set("version",i.LIB_VERSION),o.searchParams.set("code",n.code.toString());const c=function(e,t){const n=null==e?void 0:e.method;if(n)return n;if(void 0===t)return;if("string"==typeof t)return t;if(!Array.isArray(t))return t.method;if(t.length>0)return t[0].method;return}(n.data,t);return c&&o.searchParams.set("method",c),o.searchParams.set("message",n.message),Object.assign(Object.assign({},n),{docUrl:o.href})}},531781:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.getErrorCode=t.isValidCode=t.getMessageFromCode=t.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const r=n(287886),i="Unspecified error message.";function a(e,n=i){if(e&&Number.isInteger(e)){const n=e.toString();if(l(r.errorValues,n))return r.errorValues[n].message;if(o(e))return t.JSON_RPC_SERVER_ERROR_MESSAGE}return n}function s(e){if(!Number.isInteger(e))return!1;const t=e.toString();return!!r.errorValues[t]||!!o(e)}function o(e){return e>=-32099&&e<=-32e3}function c(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){return"object"==typeof e&&null!==e&&t in e&&"string"==typeof e[t]}t.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.",t.getMessageFromCode=a,t.isValidCode=s,t.getErrorCode=function(e){var t;return"number"==typeof e?e:function(e){return"object"==typeof e&&null!==e&&("number"==typeof e.code||"number"==typeof e.errorCode)}(e)?null!==(t=e.code)&&void 0!==t?t:e.errorCode:void 0},t.serialize=function(e,{shouldIncludeStack:t=!1}={}){const n={};if(e&&"object"==typeof e&&!Array.isArray(e)&&l(e,"code")&&s(e.code)){const t=e;n.code=t.code,t.message&&"string"==typeof t.message?(n.message=t.message,l(t,"data")&&(n.data=t.data)):(n.message=a(n.code),n.data={originalError:c(e)})}else n.code=r.standardErrorCodes.rpc.internal,n.message=u(e,"message")?e.message:i,n.data={originalError:c(e)};return t&&(n.stack=u(e,"stack")?e.stack:void 0),n}},212065:(e,t)=>{"use strict";function n(){return e=>e}var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderType=t.RegExpString=t.IntNumber=t.BigIntString=t.AddressString=t.HexString=t.OpaqueType=void 0,t.OpaqueType=n,t.HexString=e=>e,t.AddressString=e=>e,t.BigIntString=e=>e,t.IntNumber=function(e){return Math.floor(e)},t.RegExpString=e=>e,function(e){e.CoinbaseWallet="CoinbaseWallet",e.MetaMask="MetaMask",e.Unselected=""}(r||(t.ProviderType=r={}))},263678:function(e,t,n){"use strict";var r=n(348834).Buffer,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isMobileWeb=t.getLocation=t.isInIFrame=t.createQrUrl=t.getFavicon=t.range=t.isBigNumber=t.ensureParsedJSONObject=t.ensureBN=t.ensureRegExpString=t.ensureIntNumber=t.ensureBuffer=t.ensureAddressString=t.ensureEvenLengthHexString=t.ensureHexString=t.isHexString=t.prepend0x=t.strip0x=t.has0xPrefix=t.hexStringFromIntNumber=t.intNumberFromHexString=t.bigIntStringFromBN=t.hexStringFromBuffer=t.hexStringToUint8Array=t.uint8ArrayToHex=t.randomBytesHex=void 0;const a=i(n(162197)),s=n(60397),o=n(212065),c=/^[0-9]*$/,l=/^[a-f0-9]*$/;function u(e){return[...e].map((e=>e.toString(16).padStart(2,"0"))).join("")}function h(e){return e.startsWith("0x")||e.startsWith("0X")}function d(e){return h(e)?e.slice(2):e}function p(e){return h(e)?`0x${e.slice(2)}`:`0x${e}`}function m(e){if("string"!=typeof e)return!1;const t=d(e).toLowerCase();return l.test(t)}function f(e,t=!1){if("string"==typeof e){const n=d(e).toLowerCase();if(l.test(n))return(0,o.HexString)(t?`0x${n}`:n)}throw s.standardErrors.rpc.invalidParams(`"${String(e)}" is not a hexadecimal string`)}function y(e,t=!1){let n=f(e,!1);return n.length%2==1&&(n=(0,o.HexString)(`0${n}`)),t?(0,o.HexString)(`0x${n}`):n}function g(e){if("number"==typeof e&&Number.isInteger(e))return(0,o.IntNumber)(e);if("string"==typeof e){if(c.test(e))return(0,o.IntNumber)(Number(e));if(m(e))return(0,o.IntNumber)(new a.default(y(e,!1),16).toNumber())}throw s.standardErrors.rpc.invalidParams(`Not an integer: ${String(e)}`)}function _(e){if(null==e||"function"!=typeof e.constructor)return!1;const{constructor:t}=e;return"function"==typeof t.config&&"number"==typeof t.EUCLID}function b(){try{return null!==window.frameElement}catch(e){return!1}}t.randomBytesHex=function(e){return u(crypto.getRandomValues(new Uint8Array(e)))},t.uint8ArrayToHex=u,t.hexStringToUint8Array=function(e){return new Uint8Array(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))},t.hexStringFromBuffer=function(e,t=!1){const n=e.toString("hex");return(0,o.HexString)(t?`0x${n}`:n)},t.bigIntStringFromBN=function(e){return(0,o.BigIntString)(e.toString(10))},t.intNumberFromHexString=function(e){return(0,o.IntNumber)(new a.default(y(e,!1),16).toNumber())},t.hexStringFromIntNumber=function(e){return(0,o.HexString)(`0x${new a.default(e).toString(16)}`)},t.has0xPrefix=h,t.strip0x=d,t.prepend0x=p,t.isHexString=m,t.ensureHexString=f,t.ensureEvenLengthHexString=y,t.ensureAddressString=function(e){if("string"==typeof e){const t=d(e).toLowerCase();if(m(t)&&40===t.length)return(0,o.AddressString)(p(t))}throw s.standardErrors.rpc.invalidParams(`Invalid Ethereum address: ${String(e)}`)},t.ensureBuffer=function(e){if(r.isBuffer(e))return e;if("string"==typeof e){if(m(e)){const t=y(e,!1);return r.from(t,"hex")}return r.from(e,"utf8")}throw s.standardErrors.rpc.invalidParams(`Not binary data: ${String(e)}`)},t.ensureIntNumber=g,t.ensureRegExpString=function(e){if(e instanceof RegExp)return(0,o.RegExpString)(e.toString());throw s.standardErrors.rpc.invalidParams(`Not a RegExp: ${String(e)}`)},t.ensureBN=function(e){if(null!==e&&(a.default.isBN(e)||_(e)))return new a.default(e.toString(10),10);if("number"==typeof e)return new a.default(g(e));if("string"==typeof e){if(c.test(e))return new a.default(e,10);if(m(e))return new a.default(y(e,!1),16)}throw s.standardErrors.rpc.invalidParams(`Not an integer: ${String(e)}`)},t.ensureParsedJSONObject=function(e){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw s.standardErrors.rpc.invalidParams(`Not a JSON string or an object: ${String(e)}`)},t.isBigNumber=_,t.range=function(e,t){return Array.from({length:t-e},((t,n)=>e+n))},t.getFavicon=function(){const e=document.querySelector('link[sizes="192x192"]')||document.querySelector('link[sizes="180x180"]')||document.querySelector('link[rel="icon"]')||document.querySelector('link[rel="shortcut icon"]'),{protocol:t,host:n}=document.location,r=e?e.getAttribute("href"):null;return!r||r.startsWith("javascript:")||r.startsWith("vbscript:")?null:r.startsWith("http://")||r.startsWith("https://")||r.startsWith("data:")?r:r.startsWith("//")?t+r:`${t}//${n}${r}`},t.createQrUrl=function(e,t,n,r,i,a){return`${n}/#/link?${new URLSearchParams({[r?"parent-id":"id"]:e,secret:t,server:n,v:i,chainId:a.toString()}).toString()}`},t.isInIFrame=b,t.getLocation=function(){try{return b()&&window.top?window.top.location:window.location}catch(e){return window.location}},t.isMobileWeb=function(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.userAgent)}},449525:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isErrorResponse=void 0,t.isErrorResponse=function(e){return void 0!==e.errorMessage}},553329:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LIB_VERSION=void 0,t.LIB_VERSION="3.9.0"},105994:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(122970),i=n(994772),a=function(){function e(e){this._semaphore=new i.default(1,e)}return e.prototype.acquire=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._semaphore.acquire()];case 1:return e=t.sent(),[2,e[1]]}}))}))},e.prototype.runExclusive=function(e){return this._semaphore.runExclusive((function(){return e()}))},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()},e.prototype.release=function(){this._semaphore.release()},e.prototype.cancel=function(){return this._semaphore.cancel()},e}();t.default=a},994772:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(122970),i=n(781571),a=function(){function e(e,t){if(void 0===t&&(t=i.E_CANCELED),this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}return e.prototype.acquire=function(){var e=this,t=this.isLocked(),n=new Promise((function(t,n){return e._queue.push({resolve:t,reject:n})}));return t||this._dispatch(),n},e.prototype.runExclusive=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.acquire()];case 1:t=r.sent(),n=t[0],i=t[1],r.label=2;case 2:return r.trys.push([2,,4,5]),[4,e(n)];case 3:return[2,r.sent()];case 4:return i(),[7];case 5:return[2]}}))}))},e.prototype.waitForUnlock=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return this.isLocked()?[2,new Promise((function(t){return e._waiters.push({resolve:t})}))]:[2,Promise.resolve()]}))}))},e.prototype.isLocked=function(){return this._value<=0},e.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var e=this._currentReleaser;this._currentReleaser=void 0,e()}},e.prototype.cancel=function(){var e=this;this._queue.forEach((function(t){return t.reject(e._cancelError)})),this._queue=[]},e.prototype._dispatch=function(){var e=this,t=this._queue.shift();if(t){var n=!1;this._currentReleaser=function(){n||(n=!0,e._value++,e._resolveWaiters(),e._dispatch())},t.resolve([this._value--,this._currentReleaser])}},e.prototype._resolveWaiters=function(){this._waiters.forEach((function(e){return e.resolve()})),this._waiters=[]},e}();t.default=a},781571:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CANCELED=t.E_ALREADY_LOCKED=t.E_TIMEOUT=void 0,t.E_TIMEOUT=new Error("timeout while waiting for mutex to become available"),t.E_ALREADY_LOCKED=new Error("mutex already locked"),t.E_CANCELED=new Error("request for lock canceled")},478858:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryAcquire=t.withTimeout=t.Semaphore=t.Mutex=void 0;var r=n(122970),i=n(105994);Object.defineProperty(t,"Mutex",{enumerable:!0,get:function(){return i.default}});var a=n(994772);Object.defineProperty(t,"Semaphore",{enumerable:!0,get:function(){return a.default}});var s=n(824562);Object.defineProperty(t,"withTimeout",{enumerable:!0,get:function(){return s.withTimeout}});var o=n(792325);Object.defineProperty(t,"tryAcquire",{enumerable:!0,get:function(){return o.tryAcquire}}),(0,r.__exportStar)(n(781571),t)},792325:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tryAcquire=void 0;var r=n(781571),i=n(824562);t.tryAcquire=function(e,t){return void 0===t&&(t=r.E_ALREADY_LOCKED),(0,i.withTimeout)(e,0,t)}},824562:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withTimeout=void 0;var r=n(122970),i=n(781571);t.withTimeout=function(e,t,n){var a=this;return void 0===n&&(n=i.E_TIMEOUT),{acquire:function(){return new Promise((function(i,s){return(0,r.__awaiter)(a,void 0,void 0,(function(){var a,o,c,l;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:a=!1,o=setTimeout((function(){a=!0,s(n)}),t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.acquire()];case 2:return c=r.sent(),a?(Array.isArray(c)?c[1]:c)():(clearTimeout(o),i(c)),[3,4];case 3:return l=r.sent(),a||(clearTimeout(o),s(l)),[3,4];case 4:return[2]}}))}))}))},runExclusive:function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:t=function(){},r.label=1;case 1:return r.trys.push([1,,7,8]),[4,this.acquire()];case 2:return n=r.sent(),Array.isArray(n)?(t=n[1],[4,e(n[0])]):[3,4];case 3:return[2,r.sent()];case 4:return t=n,[4,e()];case 5:return[2,r.sent()];case 6:return[3,8];case 7:return t(),[7];case 8:return[2]}}))}))},release:function(){e.release()},cancel:function(){return e.cancel()},waitForUnlock:function(){return e.waitForUnlock()},isLocked:function(){return e.isLocked()}}}},921166:function(e,t,n){var r;e=n.nmd(e),function(i){var a=t,s=(e&&e.exports,"object"==typeof n.g&&n.g);s.global!==s&&s.window;var o=function(e){this.message=e};(o.prototype=new Error).name="InvalidCharacterError";var c=function(e){throw new o(e)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=/[\t\n\f\r ]/g,h={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,n,r,i,a=e.length%3,s="",o=-1,u=e.length-a;++o<u;)t=e.charCodeAt(o)<<16,n=e.charCodeAt(++o)<<8,r=e.charCodeAt(++o),s+=l.charAt((i=t+n+r)>>18&63)+l.charAt(i>>12&63)+l.charAt(i>>6&63)+l.charAt(63&i);return 2==a?(t=e.charCodeAt(o)<<8,n=e.charCodeAt(++o),s+=l.charAt((i=t+n)>>10)+l.charAt(i>>4&63)+l.charAt(i<<2&63)+"="):1==a&&(i=e.charCodeAt(o),s+=l.charAt(i>>2)+l.charAt(i<<4&63)+"=="),s},decode:function(e){var t=(e=String(e).replace(u,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var n,r,i=0,a="",s=-1;++s<t;)r=l.indexOf(e.charAt(s)),n=i%4?64*n+r:r,i++%4&&(a+=String.fromCharCode(255&n>>(-2*i&6)));return a},version:"1.0.0"};void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}()},595766:(e,t)=>{"use strict";t.byteLength=function(e){var t=o(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=o(e),s=a[0],c=a[1],l=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,c)),u=0,h=c>0?s-4:s;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===c&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,l[u++]=255&t);1===c&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],s=16383,o=0,l=r-i;o<l;o+=s)a.push(c(e,o,o+s>l?l:o+s));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function o(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,a,s=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},162197:function(e,t,n){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}function a(e,t,n){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(n=t,t=10),this._init(e||0,t||10,n||"be"))}var s;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:n(833196).Buffer}catch(e){}function o(e,t){var n=e.charCodeAt(t);return n>=48&&n<=57?n-48:n>=65&&n<=70?n-55:n>=97&&n<=102?n-87:void r(!1,"Invalid character in "+e)}function c(e,t,n){var r=o(e,n);return n-1>=t&&(r|=o(e,n-1)<<4),r}function l(e,t,n,i){for(var a=0,s=0,o=Math.min(e.length,n),c=t;c<o;c++){var l=e.charCodeAt(c)-48;a*=i,s=l>=49?l-49+10:l>=17?l-17+10:l,r(l>=0&&s<i,"Invalid character"),a+=s}return a}function u(e,t){e.words=t.words,e.length=t.length,e.negative=t.negative,e.red=t.red}if(a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},a.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},a.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var a,s,o=0;if("be"===n)for(i=e.length-1,a=0;i>=0;i-=3)s=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[a]|=s<<o&67108863,this.words[a+1]=s>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===n)for(i=0,a=0;i<e.length;i+=3)s=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[a]|=s<<o&67108863,this.words[a+1]=s>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this._strip()},a.prototype._parseHex=function(e,t,n){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var i,a=0,s=0;if("be"===n)for(r=e.length-1;r>=t;r-=2)i=c(e,t,r)<<a,this.words[s]|=67108863&i,a>=18?(a-=18,s+=1,this.words[s]|=i>>>26):a+=8;else for(r=(e.length-t)%2==0?t+1:t;r<e.length;r+=2)i=c(e,t,r)<<a,this.words[s]|=67108863&i,a>=18?(a-=18,s+=1,this.words[s]|=i>>>26):a+=8;this._strip()},a.prototype._parseBase=function(e,t,n){this.words=[0],this.length=1;for(var r=0,i=1;i<=67108863;i*=t)r++;r--,i=i/t|0;for(var a=e.length-n,s=a%r,o=Math.min(a,a-s)+n,c=0,u=n;u<o;u+=r)c=l(e,u,u+r,t),this.imuln(i),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==s){var h=1;for(c=l(e,u,e.length,t),u=0;u<s;u++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this._strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype._move=function(e){u(e,this)},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{a.prototype[Symbol.for("nodejs.util.inspect.custom")]=h}catch(e){a.prototype.inspect=h}else a.prototype.inspect=h;function h(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var d=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],p=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],m=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];a.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,a=0,s=0;s<this.length;s++){var o=this.words[s],c=(16777215&(o<<i|a)).toString(16);a=o>>>24-i&16777215,(i+=2)>=26&&(i-=26,s--),n=0!==a||s!==this.length-1?d[6-c.length]+c+n:c+n}for(0!==a&&(n=a.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var l=p[e],u=m[e];n="";var h=this.clone();for(h.negative=0;!h.isZero();){var f=h.modrn(u).toString(e);n=(h=h.idivn(u)).isZero()?f+n:d[l-f.length]+f+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16,2)},s&&(a.prototype.toBuffer=function(e,t){return this.toArrayLike(s,e,t)}),a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};function f(e,t,n){n.negative=t.negative^e.negative;var r=e.length+t.length|0;n.length=r,r=r-1|0;var i=0|e.words[0],a=0|t.words[0],s=i*a,o=67108863&s,c=s/67108864|0;n.words[0]=o;for(var l=1;l<r;l++){for(var u=c>>>26,h=67108863&c,d=Math.min(l,t.length-1),p=Math.max(0,l-e.length+1);p<=d;p++){var m=l-p|0;u+=(s=(i=0|e.words[m])*(a=0|t.words[p])+h)/67108864|0,h=67108863&s}n.words[l]=0|h,c=0|u}return 0!==c?n.words[l]=0|c:n.length--,n._strip()}a.prototype.toArrayLike=function(e,t,n){this._strip();var i=this.byteLength(),a=n||Math.max(1,i);r(i<=a,"byte array longer than desired length"),r(a>0,"Requested array length <= 0");var s=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,a);return this["_toArrayLike"+("le"===t?"LE":"BE")](s,i),s},a.prototype._toArrayLikeLE=function(e,t){for(var n=0,r=0,i=0,a=0;i<this.length;i++){var s=this.words[i]<<a|r;e[n++]=255&s,n<e.length&&(e[n++]=s>>8&255),n<e.length&&(e[n++]=s>>16&255),6===a?(n<e.length&&(e[n++]=s>>24&255),r=0,a=0):(r=s>>>24,a+=2)}if(n<e.length)for(e[n++]=r;n<e.length;)e[n++]=0},a.prototype._toArrayLikeBE=function(e,t){for(var n=e.length-1,r=0,i=0,a=0;i<this.length;i++){var s=this.words[i]<<a|r;e[n--]=255&s,n>=0&&(e[n--]=s>>8&255),n>=0&&(e[n--]=s>>16&255),6===a?(n>=0&&(e[n--]=s>>24&255),r=0,a=0):(r=s>>>24,a+=2)}if(n>=0)for(e[n--]=r;n>=0;)e[n--]=0},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,n=0;return t>=4096&&(n+=13,t>>>=13),t>=64&&(n+=7,t>>>=7),t>=8&&(n+=4,t>>>=4),t>=2&&(n+=2,t>>>=2),n+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,n=0;return 0==(8191&t)&&(n+=13,t>>>=13),0==(127&t)&&(n+=7,t>>>=7),0==(15&t)&&(n+=4,t>>>=4),0==(3&t)&&(n+=2,t>>>=2),0==(1&t)&&n++,n},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var n=this._zeroBits(this.words[t]);if(e+=n,26!==n)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},a.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var n=0;n<t.length;n++)this.words[n]=this.words[n]&e.words[n];return this.length=t.length,this._strip()},a.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,n;this.length>e.length?(t=this,n=e):(t=e,n=this);for(var r=0;r<n.length;r++)this.words[r]=t.words[r]^n.words[r];if(this!==t)for(;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this._strip()},a.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this._strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this._strip()},a.prototype.iadd=function(e){var t,n,r;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(n=this,r=e):(n=e,r=this);for(var i=0,a=0;a<r.length;a++)t=(0|n.words[a])+(0|r.words[a])+i,this.words[a]=67108863&t,i=t>>>26;for(;0!==i&&a<n.length;a++)t=(0|n.words[a])+i,this.words[a]=67108863&t,i=t>>>26;if(this.length=n.length,0!==i)this.words[this.length]=i,this.length++;else if(n!==this)for(;a<n.length;a++)this.words[a]=n.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var n,r,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(n=this,r=e):(n=e,r=this);for(var a=0,s=0;s<r.length;s++)a=(t=(0|n.words[s])-(0|r.words[s])+a)>>26,this.words[s]=67108863&t;for(;0!==a&&s<n.length;s++)a=(t=(0|n.words[s])+a)>>26,this.words[s]=67108863&t;if(0===a&&s<n.length&&n!==this)for(;s<n.length;s++)this.words[s]=n.words[s];return this.length=Math.max(this.length,s),n!==this&&(this.negative=1),this._strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var y=function(e,t,n){var r,i,a,s=e.words,o=t.words,c=n.words,l=0,u=0|s[0],h=8191&u,d=u>>>13,p=0|s[1],m=8191&p,f=p>>>13,y=0|s[2],g=8191&y,_=y>>>13,b=0|s[3],v=8191&b,w=b>>>13,E=0|s[4],T=8191&E,S=E>>>13,N=0|s[5],A=8191&N,C=N>>>13,x=0|s[6],M=8191&x,R=x>>>13,O=0|s[7],I=8191&O,k=O>>>13,P=0|s[8],L=8191&P,D=P>>>13,q=0|s[9],B=8191&q,j=q>>>13,$=0|o[0],U=8191&$,F=$>>>13,K=0|o[1],W=8191&K,V=K>>>13,H=0|o[2],Q=8191&H,z=H>>>13,G=0|o[3],Y=8191&G,J=G>>>13,X=0|o[4],Z=8191&X,ee=X>>>13,te=0|o[5],ne=8191&te,re=te>>>13,ie=0|o[6],ae=8191&ie,se=ie>>>13,oe=0|o[7],ce=8191&oe,le=oe>>>13,ue=0|o[8],he=8191&ue,de=ue>>>13,pe=0|o[9],me=8191&pe,fe=pe>>>13;n.negative=e.negative^t.negative,n.length=19;var ye=(l+(r=Math.imul(h,U))|0)+((8191&(i=(i=Math.imul(h,F))+Math.imul(d,U)|0))<<13)|0;l=((a=Math.imul(d,F))+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,r=Math.imul(m,U),i=(i=Math.imul(m,F))+Math.imul(f,U)|0,a=Math.imul(f,F);var ge=(l+(r=r+Math.imul(h,W)|0)|0)+((8191&(i=(i=i+Math.imul(h,V)|0)+Math.imul(d,W)|0))<<13)|0;l=((a=a+Math.imul(d,V)|0)+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,r=Math.imul(g,U),i=(i=Math.imul(g,F))+Math.imul(_,U)|0,a=Math.imul(_,F),r=r+Math.imul(m,W)|0,i=(i=i+Math.imul(m,V)|0)+Math.imul(f,W)|0,a=a+Math.imul(f,V)|0;var _e=(l+(r=r+Math.imul(h,Q)|0)|0)+((8191&(i=(i=i+Math.imul(h,z)|0)+Math.imul(d,Q)|0))<<13)|0;l=((a=a+Math.imul(d,z)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,r=Math.imul(v,U),i=(i=Math.imul(v,F))+Math.imul(w,U)|0,a=Math.imul(w,F),r=r+Math.imul(g,W)|0,i=(i=i+Math.imul(g,V)|0)+Math.imul(_,W)|0,a=a+Math.imul(_,V)|0,r=r+Math.imul(m,Q)|0,i=(i=i+Math.imul(m,z)|0)+Math.imul(f,Q)|0,a=a+Math.imul(f,z)|0;var be=(l+(r=r+Math.imul(h,Y)|0)|0)+((8191&(i=(i=i+Math.imul(h,J)|0)+Math.imul(d,Y)|0))<<13)|0;l=((a=a+Math.imul(d,J)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,r=Math.imul(T,U),i=(i=Math.imul(T,F))+Math.imul(S,U)|0,a=Math.imul(S,F),r=r+Math.imul(v,W)|0,i=(i=i+Math.imul(v,V)|0)+Math.imul(w,W)|0,a=a+Math.imul(w,V)|0,r=r+Math.imul(g,Q)|0,i=(i=i+Math.imul(g,z)|0)+Math.imul(_,Q)|0,a=a+Math.imul(_,z)|0,r=r+Math.imul(m,Y)|0,i=(i=i+Math.imul(m,J)|0)+Math.imul(f,Y)|0,a=a+Math.imul(f,J)|0;var ve=(l+(r=r+Math.imul(h,Z)|0)|0)+((8191&(i=(i=i+Math.imul(h,ee)|0)+Math.imul(d,Z)|0))<<13)|0;l=((a=a+Math.imul(d,ee)|0)+(i>>>13)|0)+(ve>>>26)|0,ve&=67108863,r=Math.imul(A,U),i=(i=Math.imul(A,F))+Math.imul(C,U)|0,a=Math.imul(C,F),r=r+Math.imul(T,W)|0,i=(i=i+Math.imul(T,V)|0)+Math.imul(S,W)|0,a=a+Math.imul(S,V)|0,r=r+Math.imul(v,Q)|0,i=(i=i+Math.imul(v,z)|0)+Math.imul(w,Q)|0,a=a+Math.imul(w,z)|0,r=r+Math.imul(g,Y)|0,i=(i=i+Math.imul(g,J)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,J)|0,r=r+Math.imul(m,Z)|0,i=(i=i+Math.imul(m,ee)|0)+Math.imul(f,Z)|0,a=a+Math.imul(f,ee)|0;var we=(l+(r=r+Math.imul(h,ne)|0)|0)+((8191&(i=(i=i+Math.imul(h,re)|0)+Math.imul(d,ne)|0))<<13)|0;l=((a=a+Math.imul(d,re)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,r=Math.imul(M,U),i=(i=Math.imul(M,F))+Math.imul(R,U)|0,a=Math.imul(R,F),r=r+Math.imul(A,W)|0,i=(i=i+Math.imul(A,V)|0)+Math.imul(C,W)|0,a=a+Math.imul(C,V)|0,r=r+Math.imul(T,Q)|0,i=(i=i+Math.imul(T,z)|0)+Math.imul(S,Q)|0,a=a+Math.imul(S,z)|0,r=r+Math.imul(v,Y)|0,i=(i=i+Math.imul(v,J)|0)+Math.imul(w,Y)|0,a=a+Math.imul(w,J)|0,r=r+Math.imul(g,Z)|0,i=(i=i+Math.imul(g,ee)|0)+Math.imul(_,Z)|0,a=a+Math.imul(_,ee)|0,r=r+Math.imul(m,ne)|0,i=(i=i+Math.imul(m,re)|0)+Math.imul(f,ne)|0,a=a+Math.imul(f,re)|0;var Ee=(l+(r=r+Math.imul(h,ae)|0)|0)+((8191&(i=(i=i+Math.imul(h,se)|0)+Math.imul(d,ae)|0))<<13)|0;l=((a=a+Math.imul(d,se)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,r=Math.imul(I,U),i=(i=Math.imul(I,F))+Math.imul(k,U)|0,a=Math.imul(k,F),r=r+Math.imul(M,W)|0,i=(i=i+Math.imul(M,V)|0)+Math.imul(R,W)|0,a=a+Math.imul(R,V)|0,r=r+Math.imul(A,Q)|0,i=(i=i+Math.imul(A,z)|0)+Math.imul(C,Q)|0,a=a+Math.imul(C,z)|0,r=r+Math.imul(T,Y)|0,i=(i=i+Math.imul(T,J)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,J)|0,r=r+Math.imul(v,Z)|0,i=(i=i+Math.imul(v,ee)|0)+Math.imul(w,Z)|0,a=a+Math.imul(w,ee)|0,r=r+Math.imul(g,ne)|0,i=(i=i+Math.imul(g,re)|0)+Math.imul(_,ne)|0,a=a+Math.imul(_,re)|0,r=r+Math.imul(m,ae)|0,i=(i=i+Math.imul(m,se)|0)+Math.imul(f,ae)|0,a=a+Math.imul(f,se)|0;var Te=(l+(r=r+Math.imul(h,ce)|0)|0)+((8191&(i=(i=i+Math.imul(h,le)|0)+Math.imul(d,ce)|0))<<13)|0;l=((a=a+Math.imul(d,le)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,r=Math.imul(L,U),i=(i=Math.imul(L,F))+Math.imul(D,U)|0,a=Math.imul(D,F),r=r+Math.imul(I,W)|0,i=(i=i+Math.imul(I,V)|0)+Math.imul(k,W)|0,a=a+Math.imul(k,V)|0,r=r+Math.imul(M,Q)|0,i=(i=i+Math.imul(M,z)|0)+Math.imul(R,Q)|0,a=a+Math.imul(R,z)|0,r=r+Math.imul(A,Y)|0,i=(i=i+Math.imul(A,J)|0)+Math.imul(C,Y)|0,a=a+Math.imul(C,J)|0,r=r+Math.imul(T,Z)|0,i=(i=i+Math.imul(T,ee)|0)+Math.imul(S,Z)|0,a=a+Math.imul(S,ee)|0,r=r+Math.imul(v,ne)|0,i=(i=i+Math.imul(v,re)|0)+Math.imul(w,ne)|0,a=a+Math.imul(w,re)|0,r=r+Math.imul(g,ae)|0,i=(i=i+Math.imul(g,se)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,se)|0,r=r+Math.imul(m,ce)|0,i=(i=i+Math.imul(m,le)|0)+Math.imul(f,ce)|0,a=a+Math.imul(f,le)|0;var Se=(l+(r=r+Math.imul(h,he)|0)|0)+((8191&(i=(i=i+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;l=((a=a+Math.imul(d,de)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,r=Math.imul(B,U),i=(i=Math.imul(B,F))+Math.imul(j,U)|0,a=Math.imul(j,F),r=r+Math.imul(L,W)|0,i=(i=i+Math.imul(L,V)|0)+Math.imul(D,W)|0,a=a+Math.imul(D,V)|0,r=r+Math.imul(I,Q)|0,i=(i=i+Math.imul(I,z)|0)+Math.imul(k,Q)|0,a=a+Math.imul(k,z)|0,r=r+Math.imul(M,Y)|0,i=(i=i+Math.imul(M,J)|0)+Math.imul(R,Y)|0,a=a+Math.imul(R,J)|0,r=r+Math.imul(A,Z)|0,i=(i=i+Math.imul(A,ee)|0)+Math.imul(C,Z)|0,a=a+Math.imul(C,ee)|0,r=r+Math.imul(T,ne)|0,i=(i=i+Math.imul(T,re)|0)+Math.imul(S,ne)|0,a=a+Math.imul(S,re)|0,r=r+Math.imul(v,ae)|0,i=(i=i+Math.imul(v,se)|0)+Math.imul(w,ae)|0,a=a+Math.imul(w,se)|0,r=r+Math.imul(g,ce)|0,i=(i=i+Math.imul(g,le)|0)+Math.imul(_,ce)|0,a=a+Math.imul(_,le)|0,r=r+Math.imul(m,he)|0,i=(i=i+Math.imul(m,de)|0)+Math.imul(f,he)|0,a=a+Math.imul(f,de)|0;var Ne=(l+(r=r+Math.imul(h,me)|0)|0)+((8191&(i=(i=i+Math.imul(h,fe)|0)+Math.imul(d,me)|0))<<13)|0;l=((a=a+Math.imul(d,fe)|0)+(i>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,r=Math.imul(B,W),i=(i=Math.imul(B,V))+Math.imul(j,W)|0,a=Math.imul(j,V),r=r+Math.imul(L,Q)|0,i=(i=i+Math.imul(L,z)|0)+Math.imul(D,Q)|0,a=a+Math.imul(D,z)|0,r=r+Math.imul(I,Y)|0,i=(i=i+Math.imul(I,J)|0)+Math.imul(k,Y)|0,a=a+Math.imul(k,J)|0,r=r+Math.imul(M,Z)|0,i=(i=i+Math.imul(M,ee)|0)+Math.imul(R,Z)|0,a=a+Math.imul(R,ee)|0,r=r+Math.imul(A,ne)|0,i=(i=i+Math.imul(A,re)|0)+Math.imul(C,ne)|0,a=a+Math.imul(C,re)|0,r=r+Math.imul(T,ae)|0,i=(i=i+Math.imul(T,se)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,se)|0,r=r+Math.imul(v,ce)|0,i=(i=i+Math.imul(v,le)|0)+Math.imul(w,ce)|0,a=a+Math.imul(w,le)|0,r=r+Math.imul(g,he)|0,i=(i=i+Math.imul(g,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0;var Ae=(l+(r=r+Math.imul(m,me)|0)|0)+((8191&(i=(i=i+Math.imul(m,fe)|0)+Math.imul(f,me)|0))<<13)|0;l=((a=a+Math.imul(f,fe)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,r=Math.imul(B,Q),i=(i=Math.imul(B,z))+Math.imul(j,Q)|0,a=Math.imul(j,z),r=r+Math.imul(L,Y)|0,i=(i=i+Math.imul(L,J)|0)+Math.imul(D,Y)|0,a=a+Math.imul(D,J)|0,r=r+Math.imul(I,Z)|0,i=(i=i+Math.imul(I,ee)|0)+Math.imul(k,Z)|0,a=a+Math.imul(k,ee)|0,r=r+Math.imul(M,ne)|0,i=(i=i+Math.imul(M,re)|0)+Math.imul(R,ne)|0,a=a+Math.imul(R,re)|0,r=r+Math.imul(A,ae)|0,i=(i=i+Math.imul(A,se)|0)+Math.imul(C,ae)|0,a=a+Math.imul(C,se)|0,r=r+Math.imul(T,ce)|0,i=(i=i+Math.imul(T,le)|0)+Math.imul(S,ce)|0,a=a+Math.imul(S,le)|0,r=r+Math.imul(v,he)|0,i=(i=i+Math.imul(v,de)|0)+Math.imul(w,he)|0,a=a+Math.imul(w,de)|0;var Ce=(l+(r=r+Math.imul(g,me)|0)|0)+((8191&(i=(i=i+Math.imul(g,fe)|0)+Math.imul(_,me)|0))<<13)|0;l=((a=a+Math.imul(_,fe)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,r=Math.imul(B,Y),i=(i=Math.imul(B,J))+Math.imul(j,Y)|0,a=Math.imul(j,J),r=r+Math.imul(L,Z)|0,i=(i=i+Math.imul(L,ee)|0)+Math.imul(D,Z)|0,a=a+Math.imul(D,ee)|0,r=r+Math.imul(I,ne)|0,i=(i=i+Math.imul(I,re)|0)+Math.imul(k,ne)|0,a=a+Math.imul(k,re)|0,r=r+Math.imul(M,ae)|0,i=(i=i+Math.imul(M,se)|0)+Math.imul(R,ae)|0,a=a+Math.imul(R,se)|0,r=r+Math.imul(A,ce)|0,i=(i=i+Math.imul(A,le)|0)+Math.imul(C,ce)|0,a=a+Math.imul(C,le)|0,r=r+Math.imul(T,he)|0,i=(i=i+Math.imul(T,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0;var xe=(l+(r=r+Math.imul(v,me)|0)|0)+((8191&(i=(i=i+Math.imul(v,fe)|0)+Math.imul(w,me)|0))<<13)|0;l=((a=a+Math.imul(w,fe)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,r=Math.imul(B,Z),i=(i=Math.imul(B,ee))+Math.imul(j,Z)|0,a=Math.imul(j,ee),r=r+Math.imul(L,ne)|0,i=(i=i+Math.imul(L,re)|0)+Math.imul(D,ne)|0,a=a+Math.imul(D,re)|0,r=r+Math.imul(I,ae)|0,i=(i=i+Math.imul(I,se)|0)+Math.imul(k,ae)|0,a=a+Math.imul(k,se)|0,r=r+Math.imul(M,ce)|0,i=(i=i+Math.imul(M,le)|0)+Math.imul(R,ce)|0,a=a+Math.imul(R,le)|0,r=r+Math.imul(A,he)|0,i=(i=i+Math.imul(A,de)|0)+Math.imul(C,he)|0,a=a+Math.imul(C,de)|0;var Me=(l+(r=r+Math.imul(T,me)|0)|0)+((8191&(i=(i=i+Math.imul(T,fe)|0)+Math.imul(S,me)|0))<<13)|0;l=((a=a+Math.imul(S,fe)|0)+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,r=Math.imul(B,ne),i=(i=Math.imul(B,re))+Math.imul(j,ne)|0,a=Math.imul(j,re),r=r+Math.imul(L,ae)|0,i=(i=i+Math.imul(L,se)|0)+Math.imul(D,ae)|0,a=a+Math.imul(D,se)|0,r=r+Math.imul(I,ce)|0,i=(i=i+Math.imul(I,le)|0)+Math.imul(k,ce)|0,a=a+Math.imul(k,le)|0,r=r+Math.imul(M,he)|0,i=(i=i+Math.imul(M,de)|0)+Math.imul(R,he)|0,a=a+Math.imul(R,de)|0;var Re=(l+(r=r+Math.imul(A,me)|0)|0)+((8191&(i=(i=i+Math.imul(A,fe)|0)+Math.imul(C,me)|0))<<13)|0;l=((a=a+Math.imul(C,fe)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,r=Math.imul(B,ae),i=(i=Math.imul(B,se))+Math.imul(j,ae)|0,a=Math.imul(j,se),r=r+Math.imul(L,ce)|0,i=(i=i+Math.imul(L,le)|0)+Math.imul(D,ce)|0,a=a+Math.imul(D,le)|0,r=r+Math.imul(I,he)|0,i=(i=i+Math.imul(I,de)|0)+Math.imul(k,he)|0,a=a+Math.imul(k,de)|0;var Oe=(l+(r=r+Math.imul(M,me)|0)|0)+((8191&(i=(i=i+Math.imul(M,fe)|0)+Math.imul(R,me)|0))<<13)|0;l=((a=a+Math.imul(R,fe)|0)+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,r=Math.imul(B,ce),i=(i=Math.imul(B,le))+Math.imul(j,ce)|0,a=Math.imul(j,le),r=r+Math.imul(L,he)|0,i=(i=i+Math.imul(L,de)|0)+Math.imul(D,he)|0,a=a+Math.imul(D,de)|0;var Ie=(l+(r=r+Math.imul(I,me)|0)|0)+((8191&(i=(i=i+Math.imul(I,fe)|0)+Math.imul(k,me)|0))<<13)|0;l=((a=a+Math.imul(k,fe)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,r=Math.imul(B,he),i=(i=Math.imul(B,de))+Math.imul(j,he)|0,a=Math.imul(j,de);var ke=(l+(r=r+Math.imul(L,me)|0)|0)+((8191&(i=(i=i+Math.imul(L,fe)|0)+Math.imul(D,me)|0))<<13)|0;l=((a=a+Math.imul(D,fe)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863;var Pe=(l+(r=Math.imul(B,me))|0)+((8191&(i=(i=Math.imul(B,fe))+Math.imul(j,me)|0))<<13)|0;return l=((a=Math.imul(j,fe))+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,c[0]=ye,c[1]=ge,c[2]=_e,c[3]=be,c[4]=ve,c[5]=we,c[6]=Ee,c[7]=Te,c[8]=Se,c[9]=Ne,c[10]=Ae,c[11]=Ce,c[12]=xe,c[13]=Me,c[14]=Re,c[15]=Oe,c[16]=Ie,c[17]=ke,c[18]=Pe,0!==l&&(c[19]=l,n.length++),n};function g(e,t,n){n.negative=t.negative^e.negative,n.length=e.length+t.length;for(var r=0,i=0,a=0;a<n.length-1;a++){var s=i;i=0;for(var o=67108863&r,c=Math.min(a,t.length-1),l=Math.max(0,a-e.length+1);l<=c;l++){var u=a-l,h=(0|e.words[u])*(0|t.words[l]),d=67108863&h;o=67108863&(d=d+o|0),i+=(s=(s=s+(h/67108864|0)|0)+(d>>>26)|0)>>>26,s&=67108863}n.words[a]=o,r=s,s=i}return 0!==r?n.words[a]=r:n.length--,n._strip()}function _(e,t,n){return g(e,t,n)}function b(e,t){this.x=e,this.y=t}Math.imul||(y=f),a.prototype.mulTo=function(e,t){var n=this.length+e.length;return 10===this.length&&10===e.length?y(this,e,t):n<63?f(this,e,t):n<1024?g(this,e,t):_(this,e,t)},b.prototype.makeRBT=function(e){for(var t=new Array(e),n=a.prototype._countBits(e)-1,r=0;r<e;r++)t[r]=this.revBin(r,n,e);return t},b.prototype.revBin=function(e,t,n){if(0===e||e===n-1)return e;for(var r=0,i=0;i<t;i++)r|=(1&e)<<t-i-1,e>>=1;return r},b.prototype.permute=function(e,t,n,r,i,a){for(var s=0;s<a;s++)r[s]=t[e[s]],i[s]=n[e[s]]},b.prototype.transform=function(e,t,n,r,i,a){this.permute(a,e,t,n,r,i);for(var s=1;s<i;s<<=1)for(var o=s<<1,c=Math.cos(2*Math.PI/o),l=Math.sin(2*Math.PI/o),u=0;u<i;u+=o)for(var h=c,d=l,p=0;p<s;p++){var m=n[u+p],f=r[u+p],y=n[u+p+s],g=r[u+p+s],_=h*y-d*g;g=h*g+d*y,y=_,n[u+p]=m+y,r[u+p]=f+g,n[u+p+s]=m-y,r[u+p+s]=f-g,p!==o&&(_=c*h-l*d,d=c*d+l*h,h=_)}},b.prototype.guessLen13b=function(e,t){var n=1|Math.max(t,e),r=1&n,i=0;for(n=n/2|0;n;n>>>=1)i++;return 1<<i+1+r},b.prototype.conjugate=function(e,t,n){if(!(n<=1))for(var r=0;r<n/2;r++){var i=e[r];e[r]=e[n-r-1],e[n-r-1]=i,i=t[r],t[r]=-t[n-r-1],t[n-r-1]=-i}},b.prototype.normalize13b=function(e,t){for(var n=0,r=0;r<t/2;r++){var i=8192*Math.round(e[2*r+1]/t)+Math.round(e[2*r]/t)+n;e[r]=67108863&i,n=i<67108864?0:i/67108864|0}return e},b.prototype.convert13b=function(e,t,n,i){for(var a=0,s=0;s<t;s++)a+=0|e[s],n[2*s]=8191&a,a>>>=13,n[2*s+1]=8191&a,a>>>=13;for(s=2*t;s<i;++s)n[s]=0;r(0===a),r(0==(-8192&a))},b.prototype.stub=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t},b.prototype.mulp=function(e,t,n){var r=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(r),a=this.stub(r),s=new Array(r),o=new Array(r),c=new Array(r),l=new Array(r),u=new Array(r),h=new Array(r),d=n.words;d.length=r,this.convert13b(e.words,e.length,s,r),this.convert13b(t.words,t.length,l,r),this.transform(s,a,o,c,r,i),this.transform(l,a,u,h,r,i);for(var p=0;p<r;p++){var m=o[p]*u[p]-c[p]*h[p];c[p]=o[p]*h[p]+c[p]*u[p],o[p]=m}return this.conjugate(o,c,r),this.transform(o,c,d,a,r,i),this.conjugate(d,a,r),this.normalize13b(d,r),n.negative=e.negative^t.negative,n.length=e.length+t.length,n._strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),_(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){var t=e<0;t&&(e=-e),r("number"==typeof e),r(e<67108864);for(var n=0,i=0;i<this.length;i++){var a=(0|this.words[i])*e,s=(67108863&a)+(67108863&n);n>>=26,n+=a/67108864|0,n+=s>>>26,this.words[i]=67108863&s}return 0!==n&&(this.words[i]=n,this.length++),t?this.ineg():this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),n=0;n<t.length;n++){var r=n/26|0,i=n%26;t[n]=e.words[r]>>>i&1}return t}(e);if(0===t.length)return new a(1);for(var n=this,r=0;r<t.length&&0===t[r];r++,n=n.sqr());if(++r<t.length)for(var i=n.sqr();r<t.length;r++,i=i.sqr())0!==t[r]&&(n=n.mul(i));return n},a.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,a=67108863>>>26-n<<26-n;if(0!==n){var s=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,c=(0|this.words[t])-o<<n;this.words[t]=c|s,s=o>>>26-n}s&&(this.words[t]=s,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this._strip()},a.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var a=e%26,s=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,c=n;if(i-=s,i=Math.max(0,i),c){for(var l=0;l<s;l++)c.words[l]=this.words[l];c.length=s}if(0===s);else if(this.length>s)for(this.length-=s,l=0;l<this.length;l++)this.words[l]=this.words[l+s];else this.words[0]=0,this.length=1;var u=0;for(l=this.length-1;l>=0&&(0!==u||l>=i);l--){var h=0|this.words[l];this.words[l]=u<<26-a|h>>>a,u=h&o}return c&&0!==u&&(c.words[c.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},a.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n)&&!!(this.words[n]&i)},a.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this._strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,n){var i,a,s=e.length+n;this._expand(s);var o=0;for(i=0;i<e.length;i++){a=(0|this.words[i+n])+o;var c=(0|e.words[i])*t;o=((a-=67108863&c)>>26)-(c/67108864|0),this.words[i+n]=67108863&a}for(;i<this.length-n;i++)o=(a=(0|this.words[i+n])+o)>>26,this.words[i+n]=67108863&a;if(0===o)return this._strip();for(r(-1===o),o=0,i=0;i<this.length;i++)o=(a=-(0|this.words[i])+o)>>26,this.words[i]=67108863&a;return this.negative=1,this._strip()},a.prototype._wordDiv=function(e,t){var n=(this.length,e.length),r=this.clone(),i=e,s=0|i.words[i.length-1];0!==(n=26-this._countBits(s))&&(i=i.ushln(n),r.iushln(n),s=0|i.words[i.length-1]);var o,c=r.length-i.length;if("mod"!==t){(o=new a(null)).length=c+1,o.words=new Array(o.length);for(var l=0;l<o.length;l++)o.words[l]=0}var u=r.clone()._ishlnsubmul(i,1,c);0===u.negative&&(r=u,o&&(o.words[c]=1));for(var h=c-1;h>=0;h--){var d=67108864*(0|r.words[i.length+h])+(0|r.words[i.length+h-1]);for(d=Math.min(d/s|0,67108863),r._ishlnsubmul(i,d,h);0!==r.negative;)d--,r.negative=0,r._ishlnsubmul(i,1,h),r.isZero()||(r.negative^=1);o&&(o.words[h]=d)}return o&&o._strip(),r._strip(),"div"!==t&&0!==n&&r.iushrn(n),{div:o||null,mod:r}},a.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(i=o.div.neg()),"div"!==t&&(s=o.mod.neg(),n&&0!==s.negative&&s.iadd(e)),{div:i,mod:s}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(i=o.div.neg()),{div:i,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(s=o.mod.neg(),n&&0!==s.negative&&s.isub(e)),{div:o.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modrn(e.words[0]))}:this._wordDiv(e,t);var i,s,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var n=0!==t.div.negative?t.mod.isub(e):t.mod,r=e.ushrn(1),i=e.andln(1),a=n.cmp(r);return a<0||1===i&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modrn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var n=(1<<26)%e,i=0,a=this.length-1;a>=0;a--)i=(n*i+(0|this.words[a]))%e;return t?-i:i},a.prototype.modn=function(e){return this.modrn(e)},a.prototype.idivn=function(e){var t=e<0;t&&(e=-e),r(e<=67108863);for(var n=0,i=this.length-1;i>=0;i--){var a=(0|this.words[i])+67108864*n;this.words[i]=a/e|0,n=a%e}return this._strip(),t?this.ineg():this},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i=new a(1),s=new a(0),o=new a(0),c=new a(1),l=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++l;for(var u=n.clone(),h=t.clone();!t.isZero();){for(var d=0,p=1;0==(t.words[0]&p)&&d<26;++d,p<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(i.isOdd()||s.isOdd())&&(i.iadd(u),s.isub(h)),i.iushrn(1),s.iushrn(1);for(var m=0,f=1;0==(n.words[0]&f)&&m<26;++m,f<<=1);if(m>0)for(n.iushrn(m);m-- >0;)(o.isOdd()||c.isOdd())&&(o.iadd(u),c.isub(h)),o.iushrn(1),c.iushrn(1);t.cmp(n)>=0?(t.isub(n),i.isub(o),s.isub(c)):(n.isub(t),o.isub(i),c.isub(s))}return{a:o,b:c,gcd:n.iushln(l)}},a.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var i,s=new a(1),o=new a(0),c=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var l=0,u=1;0==(t.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(t.iushrn(l);l-- >0;)s.isOdd()&&s.iadd(c),s.iushrn(1);for(var h=0,d=1;0==(n.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(n.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(c),o.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(o)):(n.isub(t),o.isub(s))}return(i=0===t.cmpn(1)?s:o).cmpn(0)<0&&i.iadd(e),i},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),n=e.clone();t.negative=0,n.negative=0;for(var r=0;t.isEven()&&n.isEven();r++)t.iushrn(1),n.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;n.isEven();)n.iushrn(1);var i=t.cmp(n);if(i<0){var a=t;t=n,n=a}else if(0===i||0===n.cmpn(1))break;t.isub(n)}return n.iushln(r)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var a=i,s=n;0!==a&&s<this.length;s++){var o=0|this.words[s];a=(o+=a)>>>26,o&=67108863,this.words[s]=o}return 0!==a&&(this.words[s]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this._strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,n=this.length-1;n>=0;n--){var r=0|this.words[n],i=0|e.words[n];if(r!==i){r<i?t=-1:r>i&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new A(e)},a.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var v={k256:null,p224:null,p192:null,p25519:null};function w(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function E(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function T(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function N(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function A(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function C(e){A.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}w.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},w.prototype.ireduce=function(e){var t,n=e;do{this.split(n,this.tmp),t=(n=(n=this.imulK(n)).iadd(this.tmp)).bitLength()}while(t>this.n);var r=t<this.n?-1:n.ucmp(this.p);return 0===r?(n.words[0]=0,n.length=1):r>0?n.isub(this.p):void 0!==n.strip?n.strip():n._strip(),n},w.prototype.split=function(e,t){e.iushrn(this.n,0,t)},w.prototype.imulK=function(e){return e.imul(this.k)},i(E,w),E.prototype.split=function(e,t){for(var n=4194303,r=Math.min(e.length,9),i=0;i<r;i++)t.words[i]=e.words[i];if(t.length=r,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&n,i=10;i<e.length;i++){var s=0|e.words[i];e.words[i-10]=(s&n)<<4|a>>>22,a=s}a>>>=22,e.words[i-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},E.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,n=0;n<e.length;n++){var r=0|e.words[n];t+=977*r,e.words[n]=67108863&t,t=64*r+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},i(T,w),i(S,w),i(N,w),N.prototype.imulK=function(e){for(var t=0,n=0;n<e.length;n++){var r=19*(0|e.words[n])+t,i=67108863&r;r>>>=26,e.words[n]=i,t=r}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(v[e])return v[e];var t;if("k256"===e)t=new E;else if("p224"===e)t=new T;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new N}return v[e]=t,t},A.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},A.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},A.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(u(e,e.umod(this.m)._forceRed(this)),e)},A.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},A.prototype.add=function(e,t){this._verify2(e,t);var n=e.add(t);return n.cmp(this.m)>=0&&n.isub(this.m),n._forceRed(this)},A.prototype.iadd=function(e,t){this._verify2(e,t);var n=e.iadd(t);return n.cmp(this.m)>=0&&n.isub(this.m),n},A.prototype.sub=function(e,t){this._verify2(e,t);var n=e.sub(t);return n.cmpn(0)<0&&n.iadd(this.m),n._forceRed(this)},A.prototype.isub=function(e,t){this._verify2(e,t);var n=e.isub(t);return n.cmpn(0)<0&&n.iadd(this.m),n},A.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},A.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},A.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},A.prototype.isqr=function(e){return this.imul(e,e.clone())},A.prototype.sqr=function(e){return this.mul(e,e)},A.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new a(1)).iushrn(2);return this.pow(e,n)}for(var i=this.m.subn(1),s=0;!i.isZero()&&0===i.andln(1);)s++,i.iushrn(1);r(!i.isZero());var o=new a(1).toRed(this),c=o.redNeg(),l=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new a(2*u*u).toRed(this);0!==this.pow(u,l).cmp(c);)u.redIAdd(c);for(var h=this.pow(u,i),d=this.pow(e,i.addn(1).iushrn(1)),p=this.pow(e,i),m=s;0!==p.cmp(o);){for(var f=p,y=0;0!==f.cmp(o);y++)f=f.redSqr();r(y<m);var g=this.pow(h,new a(1).iushln(m-y-1));d=d.redMul(g),h=g.redSqr(),p=p.redMul(h),m=y}return d},A.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},A.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var n=new Array(16);n[0]=new a(1).toRed(this),n[1]=e;for(var r=2;r<n.length;r++)n[r]=this.mul(n[r-1],e);var i=n[0],s=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),r=t.length-1;r>=0;r--){for(var l=t.words[r],u=c-1;u>=0;u--){var h=l>>u&1;i!==n[0]&&(i=this.sqr(i)),0!==h||0!==s?(s<<=1,s|=h,(4===++o||0===r&&0===u)&&(i=this.mul(i,n[s]),o=0,s=0)):o=0}c=26}return i},A.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},A.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new C(e)},i(C,A),C.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},C.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},C.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var n=e.imul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),a=i;return i.cmp(this.m)>=0?a=i.isub(this.m):i.cmpn(0)<0&&(a=i.iadd(this.m)),a._forceRed(this)},C.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var n=e.mul(t),r=n.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=n.isub(r).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},C.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=n.nmd(e),this)},348834:(e,t,n)=>{"use strict";const r=n(595766),i=n(462333),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,c.prototype),t}function c(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|f(e,t);let r=o(n);const i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){const t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return p(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return p(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return c.from(r,t,n);const i=function(e){if(c.isBuffer(e)){const t=0|m(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||Y(e.length)?o(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),o(e<0?0:0|m(e))}function d(e){const t=e.length<0?0:0|m(e.length),n=o(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,c.prototype),r}function m(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Q(e).length;default:if(i)return r?-1:H(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return x(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function _(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){let a,s=1,o=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,o/=2,c/=2,n/=2}function l(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let r=-1;for(a=n;a<o;a++)if(l(e,a)===l(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===c)return r*s}else-1!==r&&(a-=a-r),r=-1}else for(n+c>o&&(n=o-c),a=n;a>=0;a--){let n=!0;for(let r=0;r<c;r++)if(l(e,a+r)!==l(t,r)){n=!1;break}if(n)return a}return-1}function v(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let s;for(r>a/2&&(r=a/2),s=0;s<r;++s){const r=parseInt(t.substr(2*s,2),16);if(Y(r))return s;e[n+s]=r}return s}function w(e,t,n,r){return z(H(t,e.length-n),e,n,r)}function E(e,t,n,r){return z(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function T(e,t,n,r){return z(Q(t),e,n,r)}function S(e,t,n,r){return z(function(e,t){let n,r,i;const a=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=n){let n,r,o,c;switch(s){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(c=(31&t)<<6|63&n,c>127&&(a=c));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(c=(15&t)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(a=c));break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&o)&&(c=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o,c>65535&&c<1114112&&(a=c))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return function(e){const t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}t.kMaxLength=s,c.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},c.allocUnsafe=function(e){return h(e)},c.allocUnsafeSlow=function(e){return h(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(G(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=c.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(G(t,Uint8Array))i+t.length>r.length?(c.isBuffer(t)||(t=c.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!c.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):y.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(c.prototype[a]=c.prototype.inspect),c.prototype.compare=function(e,t,n,r,i){if(G(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const o=Math.min(a,s),l=this.slice(r,i),u=e.slice(t,n);for(let e=0;e<o;++e)if(l[e]!==u[e]){a=l[e],s=u[e];break}return a<s?-1:s<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function x(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function M(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=J[e[r]];return i}function O(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function I(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,r,i,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r,i){F(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function L(e,t,n,r,i){F(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function D(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,r,a){return t=+t,n>>>=0,a||D(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function B(e,t,n,r,a){return t=+t,n>>>=0,a||D(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=X((function(e){K(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),c.prototype.readBigUInt64BE=X((function(e){K(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),c.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||I(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=X((function(e){K(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),c.prototype.readBigInt64BE=X((function(e){K(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){k(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){k(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=X((function(e,t=0){return P(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=X((function(e,t=0){return L(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}let i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);k(this,e,t,n,r-1,-r)}let i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=X((function(e,t=0){return P(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=X((function(e,t=0){return L(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=c.isBuffer(e)?e:c.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};const j={};function $(e,t,n){j[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function U(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function F(e,t,n,r,i,a){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=a>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(a+1)}${r}`:`>= -(2${r} ** ${8*(a+1)-1}${r}) and < 2 ** ${8*(a+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new j.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){K(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||W(t,e.length-(n+1))}(r,i,a)}function K(e,t){if("number"!=typeof e)throw new j.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,n){if(Math.floor(e)!==e)throw K(e,n),new j.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new j.ERR_BUFFER_OUT_OF_BOUNDS;throw new j.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}$("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),$("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),$("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=U(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=U(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function H(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function Q(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},105792:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=t},19562:e=>{var t,n;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],a=0;a<4;a++)8*r+6*a<=8*e.length?n.push(t.charAt(i>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,i=0;r<e.length;i=++r%4)0!=i&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|t.indexOf(e.charAt(r))>>>6-2*i);return n}},e.exports=n},465881:e=>{var t=1e3,n=60*t,r=60*n,i=24*r,a=7*i,s=365.25*i;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,c){c=c||{};var l=typeof e;if("string"===l&&e.length>0)return function(e){if((e=String(e)).length>100)return;var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!o)return;var c=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*a;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===l&&isFinite(e))return c.long?function(e){var a=Math.abs(e);if(a>=i)return o(e,a,i,"day");if(a>=r)return o(e,a,r,"hour");if(a>=n)return o(e,a,n,"minute");if(a>=t)return o(e,a,t,"second");return e+" ms"}(e):function(e){var a=Math.abs(e);if(a>=i)return Math.round(e/i)+"d";if(a>=r)return Math.round(e/r)+"h";if(a>=n)return Math.round(e/n)+"m";if(a>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},925130:(e,t,n)=>{var r=n(834406);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e="MISSING_ENV_VAR".DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(987123)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},987123:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,a,s=null;function o(...e){if(!o.enabled)return;const r=o,i=Number(new Date),a=i-(n||i);r.diff=a,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const a=t.formatters[i];if("function"==typeof a){const t=e[s];n=a.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=r,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(465881),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},462333:(e,t)=>{t.read=function(e,t,n,r,i){var a,s,o=8*i-r-1,c=(1<<o)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=e[t+h];for(h+=d,a=p&(1<<-u)-1,p>>=-u,u+=o;u>0;a=256*a+e[t+h],h+=d,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===a)a=1-l;else{if(a===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),a-=l}return(p?-1:1)*s*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var s,o,c,l=8*a-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,m=r?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=u?(o=0,s=u):s+h>=1?(o=(t*c-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&o,p+=m,o/=256,i-=8);for(s=s<<i|o,l+=i;l>0;e[n+p]=255&s,p+=m,s/=256,l-=8);e[n+p-m]|=128*f}},991285:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},313335:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},839515:(e,t,n)=>{var r=n(638761)(n(137772),"DataView");e.exports=r},989612:(e,t,n)=>{var r=n(752118),i=n(196909),a=n(198138),s=n(704174),o=n(507942);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},180235:(e,t,n)=>{var r=n(103945),i=n(221846),a=n(988028),s=n(572344),o=n(594769);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},510326:(e,t,n)=>{var r=n(638761)(n(137772),"Map");e.exports=r},896738:(e,t,n)=>{var r=n(792411),i=n(436417),a=n(586928),s=n(479493),o=n(724150);function c(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=a,c.prototype.has=s,c.prototype.set=o,e.exports=c},452760:(e,t,n)=>{var r=n(638761)(n(137772),"Promise");e.exports=r},302143:(e,t,n)=>{var r=n(638761)(n(137772),"Set");e.exports=r},750857:(e,t,n)=>{var r=n(137772).Symbol;e.exports=r},493215:(e,t,n)=>{var r=n(638761)(n(137772),"WeakMap");e.exports=r},722218:(e,t,n)=>{var r=n(641225);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},853366:(e,t,n)=>{var r=n(750857),i=n(662107),a=n(237157),s=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?i(e):a(e)}},115183:(e,t,n)=>{var r=n(853366),i=n(315125);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},906840:(e,t,n)=>{var r=n(161049),i=n(247394),a=n(429259),s=n(187035),o=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,h=l.hasOwnProperty,d=RegExp("^"+u.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||i(e))&&(r(e)?d:o).test(s(e))}},435522:(e,t,n)=>{var r=n(853366),i=n(761158),a=n(315125),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&i(e.length)&&!!s[r(e)]}},286411:(e,t,n)=>{var r=n(616001),i=n(254248),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},947826:e=>{e.exports=function(e){return function(t){return e(t)}}},724019:(e,t,n)=>{var r=n(137772)["__core-js_shared__"];e.exports=r},51242:(e,t,n)=>{var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},527937:(e,t,n)=>{var r=n(198304);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},638761:(e,t,n)=>{var r=n(906840),i=n(98109);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},662107:(e,t,n)=>{var r=n(750857),i=Object.prototype,a=i.hasOwnProperty,s=i.toString,o=r?r.toStringTag:void 0;e.exports=function(e){var t=a.call(e,o),n=e[o];try{e[o]=void 0;var r=!0}catch(e){}var i=s.call(e);return r&&(t?e[o]=n:delete e[o]),i}},970940:(e,t,n)=>{var r=n(839515),i=n(510326),a=n(452760),s=n(302143),o=n(493215),c=n(853366),l=n(187035),u="[object Map]",h="[object Promise]",d="[object Set]",p="[object WeakMap]",m="[object DataView]",f=l(r),y=l(i),g=l(a),_=l(s),b=l(o),v=c;(r&&v(new r(new ArrayBuffer(1)))!=m||i&&v(new i)!=u||a&&v(a.resolve())!=h||s&&v(new s)!=d||o&&v(new o)!=p)&&(v=function(e){var t=c(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case f:return m;case y:return u;case g:return h;case _:return d;case b:return p}return t}),e.exports=v},98109:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},752118:(e,t,n)=>{var r=n(399191);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},196909:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},198138:(e,t,n)=>{var r=n(399191),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},704174:(e,t,n)=>{var r=n(399191),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},507942:(e,t,n)=>{var r=n(399191);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},198304:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},247394:(e,t,n)=>{var r,i=n(724019),a=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!a&&a in e}},616001:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},103945:e=>{e.exports=function(){this.__data__=[],this.size=0}},221846:(e,t,n)=>{var r=n(722218),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},988028:(e,t,n)=>{var r=n(722218);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},572344:(e,t,n)=>{var r=n(722218);e.exports=function(e){return r(this.__data__,e)>-1}},594769:(e,t,n)=>{var r=n(722218);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},792411:(e,t,n)=>{var r=n(989612),i=n(180235),a=n(510326);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(a||i),string:new r}}},436417:(e,t,n)=>{var r=n(527937);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},586928:(e,t,n)=>{var r=n(527937);e.exports=function(e){return r(this,e).get(e)}},479493:(e,t,n)=>{var r=n(527937);e.exports=function(e){return r(this,e).has(e)}},724150:(e,t,n)=>{var r=n(527937);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},399191:(e,t,n)=>{var r=n(638761)(Object,"create");e.exports=r},254248:(e,t,n)=>{var r=n(860241)(Object.keys,Object);e.exports=r},704146:(e,t,n)=>{e=n.nmd(e);var r=n(51242),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,s=a&&a.exports===i&&r.process,o=function(){try{var e=a&&a.require&&a.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=o},237157:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},860241:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},137772:(e,t,n)=>{var r=n(51242),i="object"==typeof self&&self&&self.Object===Object&&self,a=r||i||Function("return this")();e.exports=a},187035:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},641225:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},379631:(e,t,n)=>{var r=n(115183),i=n(315125),a=Object.prototype,s=a.hasOwnProperty,o=a.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return i(e)&&s.call(e,"callee")&&!o.call(e,"callee")};e.exports=c},986152:e=>{var t=Array.isArray;e.exports=t},867878:(e,t,n)=>{var r=n(161049),i=n(761158);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},273226:(e,t,n)=>{e=n.nmd(e);var r=n(137772),i=n(836330),a=t&&!t.nodeType&&t,s=a&&e&&!e.nodeType&&e,o=s&&s.exports===a?r.Buffer:void 0,c=(o?o.isBuffer:void 0)||i;e.exports=c},545455:(e,t,n)=>{var r=n(286411),i=n(970940),a=n(379631),s=n(986152),o=n(867878),c=n(273226),l=n(616001),u=n(777598),h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(o(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||a(e)))return!e.length;var t=i(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(l(e))return!r(e).length;for(var n in e)if(h.call(e,n))return!1;return!0}},161049:(e,t,n)=>{var r=n(853366),i=n(429259);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},761158:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},429259:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},315125:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},777598:(e,t,n)=>{var r=n(435522),i=n(947826),a=n(704146),s=a&&a.isTypedArray,o=s?i(s):r;e.exports=o},830733:(e,t,n)=>{var r=n(896738);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var s=e.apply(this,r);return n.cache=a.set(i,s)||a,s};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},836330:e=>{e.exports=function(){return!1}},768762:(e,t,n)=>{var r,i,a,s,o;r=n(19562),i=n(105792).utf8,a=n(313335),s=n(105792).bin,(o=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?s.stringToBytes(e):i.stringToBytes(e):a(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=r.bytesToWords(e),c=8*e.length,l=1732584193,u=-271733879,h=-1732584194,d=271733878,p=0;p<n.length;p++)n[p]=16711935&(n[p]<<8|n[p]>>>24)|4278255360&(n[p]<<24|n[p]>>>8);n[c>>>5]|=128<<c%32,n[14+(c+64>>>9<<4)]=c;var m=o._ff,f=o._gg,y=o._hh,g=o._ii;for(p=0;p<n.length;p+=16){var _=l,b=u,v=h,w=d;l=m(l,u,h,d,n[p+0],7,-680876936),d=m(d,l,u,h,n[p+1],12,-389564586),h=m(h,d,l,u,n[p+2],17,606105819),u=m(u,h,d,l,n[p+3],22,-1044525330),l=m(l,u,h,d,n[p+4],7,-176418897),d=m(d,l,u,h,n[p+5],12,1200080426),h=m(h,d,l,u,n[p+6],17,-1473231341),u=m(u,h,d,l,n[p+7],22,-45705983),l=m(l,u,h,d,n[p+8],7,1770035416),d=m(d,l,u,h,n[p+9],12,-1958414417),h=m(h,d,l,u,n[p+10],17,-42063),u=m(u,h,d,l,n[p+11],22,-1990404162),l=m(l,u,h,d,n[p+12],7,1804603682),d=m(d,l,u,h,n[p+13],12,-40341101),h=m(h,d,l,u,n[p+14],17,-1502002290),l=f(l,u=m(u,h,d,l,n[p+15],22,1236535329),h,d,n[p+1],5,-165796510),d=f(d,l,u,h,n[p+6],9,-1069501632),h=f(h,d,l,u,n[p+11],14,643717713),u=f(u,h,d,l,n[p+0],20,-373897302),l=f(l,u,h,d,n[p+5],5,-701558691),d=f(d,l,u,h,n[p+10],9,38016083),h=f(h,d,l,u,n[p+15],14,-660478335),u=f(u,h,d,l,n[p+4],20,-405537848),l=f(l,u,h,d,n[p+9],5,568446438),d=f(d,l,u,h,n[p+14],9,-1019803690),h=f(h,d,l,u,n[p+3],14,-187363961),u=f(u,h,d,l,n[p+8],20,1163531501),l=f(l,u,h,d,n[p+13],5,-1444681467),d=f(d,l,u,h,n[p+2],9,-51403784),h=f(h,d,l,u,n[p+7],14,1735328473),l=y(l,u=f(u,h,d,l,n[p+12],20,-1926607734),h,d,n[p+5],4,-378558),d=y(d,l,u,h,n[p+8],11,-2022574463),h=y(h,d,l,u,n[p+11],16,1839030562),u=y(u,h,d,l,n[p+14],23,-35309556),l=y(l,u,h,d,n[p+1],4,-1530992060),d=y(d,l,u,h,n[p+4],11,1272893353),h=y(h,d,l,u,n[p+7],16,-155497632),u=y(u,h,d,l,n[p+10],23,-1094730640),l=y(l,u,h,d,n[p+13],4,681279174),d=y(d,l,u,h,n[p+0],11,-358537222),h=y(h,d,l,u,n[p+3],16,-722521979),u=y(u,h,d,l,n[p+6],23,76029189),l=y(l,u,h,d,n[p+9],4,-640364487),d=y(d,l,u,h,n[p+12],11,-421815835),h=y(h,d,l,u,n[p+15],16,530742520),l=g(l,u=y(u,h,d,l,n[p+2],23,-995338651),h,d,n[p+0],6,-198630844),d=g(d,l,u,h,n[p+7],10,1126891415),h=g(h,d,l,u,n[p+14],15,-1416354905),u=g(u,h,d,l,n[p+5],21,-57434055),l=g(l,u,h,d,n[p+12],6,1700485571),d=g(d,l,u,h,n[p+3],10,-1894986606),h=g(h,d,l,u,n[p+10],15,-1051523),u=g(u,h,d,l,n[p+1],21,-2054922799),l=g(l,u,h,d,n[p+8],6,1873313359),d=g(d,l,u,h,n[p+15],10,-30611744),h=g(h,d,l,u,n[p+6],15,-1560198380),u=g(u,h,d,l,n[p+13],21,1309151649),l=g(l,u,h,d,n[p+4],6,-145523070),d=g(d,l,u,h,n[p+11],10,-1120210379),h=g(h,d,l,u,n[p+2],15,718787259),u=g(u,h,d,l,n[p+9],21,-343485551),l=l+_>>>0,u=u+b>>>0,h=h+v>>>0,d=d+w>>>0}return r.endian([l,u,h,d])})._ff=function(e,t,n,r,i,a,s){var o=e+(t&n|~t&r)+(i>>>0)+s;return(o<<a|o>>>32-a)+t},o._gg=function(e,t,n,r,i,a,s){var o=e+(t&r|n&~r)+(i>>>0)+s;return(o<<a|o>>>32-a)+t},o._hh=function(e,t,n,r,i,a,s){var o=e+(t^n^r)+(i>>>0)+s;return(o<<a|o>>>32-a)+t},o._ii=function(e,t,n,r,i,a,s){var o=e+(n^(t|~r))+(i>>>0)+s;return(o<<a|o>>>32-a)+t},o._blocksize=16,o._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=r.wordsToBytes(o(e,t));return t&&t.asBytes?n:t&&t.asString?s.bytesToString(n):r.bytesToHex(n)}},826002:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Perfume:()=>Ke,incrementUjNavigation:()=>Be,markStep:()=>$e,markStepOnce:()=>Ue});var r,i,a={isResourceTiming:!1,isElementTiming:!1,maxTime:3e4,reportOptions:{},enableNavigationTracking:!0},s=window,o=s.console,c=s.navigator,l=s.performance,u=function(){return c.deviceMemory},h=function(){return c.hardwareConcurrency},d="mark.",p=function(){return l&&!!l.getEntriesByType&&!!l.now&&!!l.mark},m="4g",f=!1,y={},g={value:0},_={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},b={value:0},v={value:0},w={},E={isHidden:!1,didChange:!1},T=function(){E.isHidden=!1,document.hidden&&(E.isHidden=document.hidden,E.didChange=!0)},S=function(e,t){try{var n=new PerformanceObserver((function(e){t(e.getEntries())}));return n.observe({type:e,buffered:!0}),n}catch(e){o.warn("Perfume.js:",e)}return null},N=function(){return!!(h()&&h()<=4)||!!(u()&&u()<=4)},A=function(e,t){switch(e){case"slow-2g":case"2g":case"3g":return!0;default:return N()||t}},C=function(e){return parseFloat(e.toFixed(4))},x=function(e){return"number"!=typeof e?null:C(e/Math.pow(1024,2))},M=function(e,t,n,r,i){var o,l=function(){a.analyticsTracker&&(E.isHidden&&!["CLS","INP"].includes(e)||a.analyticsTracker({attribution:r,metricName:e,data:t,navigatorInformation:c?{deviceMemory:u()||0,hardwareConcurrency:h()||0,serviceWorkerStatus:"serviceWorker"in c?c.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:N(),isLowEndExperience:A(m,f)}:{},rating:n,navigationType:i}))};["CLS","INP"].includes(e)?l():(o=l,"requestIdleCallback"in s?s.requestIdleCallback(o,{timeout:3e3}):o())},R=function(e){e.forEach((function(e){if(!("self"!==e.name||e.startTime<g.value)){var t=e.duration-50;t>0&&(b.value+=t,v.value+=t)}}))};!function(e){e.instant="instant",e.quick="quick",e.moderate="moderate",e.slow="slow",e.unavoidable="unavoidable"}(r||(r={}));var O,I,k,P,L,D=((i={})[r.instant]={vitalsThresholds:[100,200],maxOutlierThreshold:1e4},i[r.quick]={vitalsThresholds:[200,500],maxOutlierThreshold:1e4},i[r.moderate]={vitalsThresholds:[500,1e3],maxOutlierThreshold:1e4},i[r.slow]={vitalsThresholds:[1e3,2e3],maxOutlierThreshold:1e4},i[r.unavoidable]={vitalsThresholds:[2e3,5e3],maxOutlierThreshold:2e4},i),q={RT:[100,200],TBT:[200,600],NTBT:[200,600]},B=function(e,t){return q[e]?t<=q[e][0]?"good":t<=q[e][1]?"needsImprovement":"poor":null},j=function(e,t,n){Object.keys(t).forEach((function(e){"number"==typeof t[e]&&(t[e]=C(t[e]))})),M(e,t,null,n||{})},$=function(e){var t=e.attribution,n=e.name,r=e.rating,i=e.value,s=e.navigationType;"FCP"===n&&(g.value=i),["FCP","LCP"].includes(n)&&!w[0]&&(w[0]=S("longtask",R)),"FID"===n&&setTimeout((function(){E.didChange||($({attribution:t,name:"TBT",rating:B("TBT",b.value),value:b.value,navigationType:s}),j("dataConsumption",_.value))}),1e4);var o=C(i);o<=a.maxTime&&o>=0&&M(n,o,r,t,s)},U=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},F=function(e){if("loading"===document.readyState)return"loading";var t=U();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},K=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},W=function(e,t){var n="";try{for(;e&&9!==e.nodeType;){var r=e,i=r.id?"#"+r.id:K(r)+(r.className&&r.className.length?"."+r.className.replace(/\s+/g,"."):"");if(n.length+i.length>(t||100)-1)return n||i;if(n=n?i+">"+n:i,r.id)break;e=r.parentNode}}catch(e){}return n},V=-1,H=function(){return V},Q=function(e){addEventListener("pageshow",(function(t){t.persisted&&(V=t.timeStamp,e(t))}),!0)},z=function(){var e=U();return e&&e.activationStart||0},G=function(e,t){var n=U(),r="navigate";return H()>=0?r="back-forward-cache":n&&(r=document.prerendering||z()>0?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},Y=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},J=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},X=function(e,t,n,r){var i,a;return function(s){t.value>=0&&(s||r)&&((a=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=a,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},Z=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},ee=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},te=-1,ne=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},re=function(e){"hidden"===document.visibilityState&&te>-1&&(te="visibilitychange"===e.type?e.timeStamp:0,ae())},ie=function(){addEventListener("visibilitychange",re,!0),addEventListener("prerenderingchange",re,!0)},ae=function(){removeEventListener("visibilitychange",re,!0),removeEventListener("prerenderingchange",re,!0)},se=function(){return te<0&&(te=ne(),ie(),Q((function(){setTimeout((function(){te=ne(),ie()}),0)}))),{get firstHiddenTime(){return te}}},oe=function(e,t){t=t||{},ee((function(){var n,r=[1800,3e3],i=se(),a=G("FCP"),s=Y("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(s.disconnect(),e.startTime<i.firstHiddenTime&&(a.value=Math.max(e.startTime-z(),0),a.entries.push(e),n(!0)))}))}));s&&(n=X(e,a,r,t.reportAllChanges),Q((function(i){a=G("FCP"),n=X(e,a,r,t.reportAllChanges),Z((function(){a.value=performance.now()-i.timeStamp,n(!0)}))})))}))},ce={passive:!0,capture:!0},le=new Date,ue=function(e,t){O||(O=t,I=e,k=new Date,pe(removeEventListener),he())},he=function(){if(I>=0&&I<k-le){var e={entryType:"first-input",name:O.type,target:O.target,cancelable:O.cancelable,startTime:O.timeStamp,processingStart:O.timeStamp+I};P.forEach((function(t){t(e)})),P=[]}},de=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){ue(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,ce),removeEventListener("pointercancel",r,ce)};addEventListener("pointerup",n,ce),addEventListener("pointercancel",r,ce)}(t,e):ue(t,e)}},pe=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,de,ce)}))},me=0,fe=1/0,ye=0,ge=function(e){e.forEach((function(e){e.interactionId&&(fe=Math.min(fe,e.interactionId),ye=Math.max(ye,e.interactionId),me=ye?(ye-fe)/7+1:0)}))},_e=function(){return L?me:performance.interactionCount||0},be=0,ve=function(){return _e()-be},we=[],Ee={},Te=function(e){var t=we[we.length-1],n=Ee[e.interactionId];if(n||we.length<10||e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};Ee[r.id]=r,we.push(r)}we.sort((function(e,t){return t.latency-e.latency})),we.splice(10).forEach((function(e){delete Ee[e.id]}))}},Se=function(e,t){!function(e,t){t=t||{},ee((function(){var n=[200,500];"interactionCount"in performance||L||(L=Y("event",ge,{type:"event",buffered:!0,durationThreshold:0}));var r,i=G("INP"),a=function(e){e.forEach((function(e){e.interactionId&&Te(e),"first-input"===e.entryType&&!we.some((function(t){return t.entries.some((function(t){return e.duration===t.duration&&e.startTime===t.startTime}))}))&&Te(e)}));var t,n=(t=Math.min(we.length-1,Math.floor(ve()/50)),we[t]);n&&n.latency!==i.value&&(i.value=n.latency,i.entries=n.entries,r())},s=Y("event",a,{durationThreshold:t.durationThreshold||40});r=X(e,i,n,t.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),J((function(){a(s.takeRecords()),i.value<0&&ve()>0&&(i.value=0,i.entries=[]),r(!0)})),Q((function(){we=[],be=_e(),i=G("INP"),r=X(e,i,n,t.reportAllChanges)})))}))}((function(t){!function(e){if(e.entries.length){var t=e.entries.sort((function(e,t){return t.duration-e.duration||t.processingEnd-t.processingStart-(e.processingEnd-e.processingStart)}))[0];e.attribution={eventTarget:W(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:F(t.startTime)}}else e.attribution={}}(t),e(t)}),t)},Ne={},Ae=function e(t){document.prerendering?ee((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},Ce=function(e,t){t=t||{};var n=[800,1800],r=G("TTFB"),i=X(e,r,n,t.reportAllChanges);Ae((function(){var a=U();if(a){var s=a.responseStart;if(s<=0||s>performance.now())return;r.value=Math.max(s-z(),0),r.entries=[a],i(!0),Q((function(){r=G("TTFB",0),(i=X(e,r,n,t.reportAllChanges))(!0)}))}}))},xe=function(e){e.forEach((function(e){e.identifier&&$({attribution:{identifier:e.identifier},name:"ET",rating:null,value:e.startTime})}))},Me=function(e){e.forEach((function(e){if(a.isResourceTiming&&j("resourceTiming",e),e.decodedBodySize&&e.initiatorType){var t=e.decodedBodySize/1e3;_.value[e.initiatorType]+=t,_.value.total+=t}}))},Re=function(){!function(e,t){Ce((function(e){!function(e){if(e.entries.length){var t=e.entries[0],n=t.activationStart||0,r=Math.max(t.domainLookupStart-n,0),i=Math.max(t.connectStart-n,0),a=Math.max(t.requestStart-n,0);e.attribution={waitingTime:r,dnsTime:i-r,connectionTime:a-i,requestTime:e.value-a,navigationEntry:t}}else e.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}}(e),function(e){e.value>0&&$(e)}(e)}),t)}(0,a.reportOptions.ttfb),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[.1,.25],i=G("CLS"),a=-1,s=0,o=[],c=function(t){a>-1&&e(t)},l=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],r=o[o.length-1];s&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(s+=e.value,o.push(e)):(s=e.value,o=[e]),s>i.value&&(i.value=s,i.entries=o,n())}}))},u=Y("layout-shift",l);u&&(n=X(c,i,r,t.reportAllChanges),oe((function(e){a=e.value,i.value<0&&(i.value=0,n())})),J((function(){l(u.takeRecords()),n(!0)})),Q((function(){s=0,a=-1,i=G("CLS",0),n=X(c,i,r,t.reportAllChanges),Z((function(){return n()}))})))}))}((function(e){!function(e){if(e.entries.length){var t=e.entries.reduce((function(e,t){return e&&e.value>t.value?e:t}));if(t&&t.sources&&t.sources.length){var n=(r=t.sources).find((function(e){return e.node&&1===e.node.nodeType}))||r[0];if(n)return void(e.attribution={largestShiftTarget:W(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:F(t.startTime)})}}var r;e.attribution={}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.cls),function(e,t){oe((function(e){!function(e){if(e.entries.length){var t=U(),n=e.entries[e.entries.length-1];if(t){var r=t.activationStart||0,i=Math.max(0,t.responseStart-r);return void(e.attribution={timeToFirstByte:i,firstByteToFCP:e.value-i,loadState:F(e.entries[0].startTime),navigationEntry:t,fcpEntry:n})}}e.attribution={timeToFirstByte:0,firstByteToFCP:e.value,loadState:F(H())}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.fcp),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[100,300],i=se(),a=G("FID"),s=function(e){e.startTime<i.firstHiddenTime&&(a.value=e.processingStart-e.startTime,a.entries.push(e),n(!0))},o=function(e){e.forEach(s)},c=Y("first-input",o);n=X(e,a,r,t.reportAllChanges),c&&J((function(){o(c.takeRecords()),c.disconnect()}),!0),c&&Q((function(){var i;a=G("FID"),n=X(e,a,r,t.reportAllChanges),P=[],I=-1,O=null,pe(addEventListener),i=s,P.push(i),he()}))}))}((function(e){!function(e){var t=e.entries[0];e.attribution={eventTarget:W(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:F(t.startTime)}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.fid),function(e,t){!function(e,t){t=t||{},ee((function(){var n,r=[2500,4e3],i=se(),a=G("LCP"),s=function(e){var t=e[e.length-1];if(t){var r=Math.max(t.startTime-z(),0);r<i.firstHiddenTime&&(a.value=r,a.entries=[t],n())}},o=Y("largest-contentful-paint",s);if(o){n=X(e,a,r,t.reportAllChanges);var c=function(){Ne[a.id]||(s(o.takeRecords()),o.disconnect(),Ne[a.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),J(c,!0),Q((function(i){a=G("LCP"),n=X(e,a,r,t.reportAllChanges),Z((function(){a.value=performance.now()-i.timeStamp,Ne[a.id]=!0,n(!0)}))}))}}))}((function(e){!function(e){if(e.entries.length){var t=U();if(t){var n=t.activationStart||0,r=e.entries[e.entries.length-1],i=r.url&&performance.getEntriesByType("resource").filter((function(e){return e.name===r.url}))[0],a=Math.max(0,t.responseStart-n),s=Math.max(a,i?(i.requestStart||i.startTime)-n:0),o=Math.max(s,i?i.responseEnd-n:0),c=Math.max(o,r?r.startTime-n:0),l={element:W(r.element),timeToFirstByte:a,resourceLoadDelay:s-a,resourceLoadTime:o-s,elementRenderDelay:c-o,navigationEntry:t,lcpEntry:r};return r.url&&(l.url=r.url),i&&(l.lcpResourceEntry=i),void(e.attribution=l)}}e.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:e.value}}(e),function(e){$(e)}(e)}),t)}(0,a.reportOptions.lcp),Se((function(e){return $(e)}),a.reportOptions.inp),a.isResourceTiming&&S("resource",Me),a.isElementTiming&&S("element",xe)},Oe=function(e){var t="usageDetails"in e?e.usageDetails:{};j("storageEstimate",{quota:x(e.quota),usage:x(e.usage),caches:x(t.caches),indexedDB:x(t.indexedDB),serviceWorker:x(t.serviceWorkerRegistrations)})},Ie={finalMarkToStepsMap:{},startMarkToStepsMap:{},active:{},navigationSteps:{}},ke=function(e){delete Ie.active[e]},Pe=function(){return Ie.navigationSteps},Le=function(e){var t;return null!==(t=Pe()[e])&&void 0!==t?t:{}},De=function(e,t,n){var r="step."+e,i=l.getEntriesByName(d+t).length>0;if(l.getEntriesByName(d+n).length>0&&a.steps){var s=D[a.steps[e].threshold],o=s.maxOutlierThreshold,c=s.vitalsThresholds;if(i){var u=l.measure(r,d+t,d+n),h=u.duration;if(h<=o){var p=function(e,t){return e<=t[0]?"good":e<=t[1]?"needsImprovement":"poor"}(h,c);h>=0&&(M("userJourneyStep",h,p,{stepName:e},void 0),l.measure("step.".concat(e,"_vitals_").concat(p),{start:u.startTime+u.duration,end:u.startTime+u.duration,detail:{type:"stepVital",duration:h}}))}}}},qe=function(){var e=Pe(),t=Ie.startMarkToStepsMap,n=Object.keys(e).length;if(0===n)return{};var r={},i=n-1,a=Le(i);if(Object.keys(a).forEach((function(e){var n,i=null!==(n=t[e])&&void 0!==n?n:[];Object.keys(i).forEach((function(e){r[e]=!0}))})),n>1){var s=Le(i-1);Object.keys(s).forEach((function(e){var n,i=null!==(n=t[e])&&void 0!==n?n:[];Object.keys(i).forEach((function(e){r[e]=!0}))}))}return r},Be=function(){var e,t=Object.keys(Ie.navigationSteps).length;Ie.navigationSteps[t]={};var n=qe();null===(e=a.onMarkStep)||void 0===e||e.call(a,"",Object.keys(n))},je=function(e){var t,n,r,i,s,o,c;if(Ie.finalMarkToStepsMap[e]){!function(e){var t=Ie.navigationSteps,n=Ie.finalMarkToStepsMap,r=Object.keys(t).length;if(0!==r){var i=r-1,a=Le(i);if(a&&n[e]){var s=n[e];s&&Object.keys(s).forEach((function(e){if(a[e]){var n=Le(i)||{};n[e]=!1,t[i]=n}if(r>1){var s=i-1,o=Le(s);o[e]&&(o[e]=!1,t[s]=o)}}))}}}(e);var l=Ie.finalMarkToStepsMap[e];Object.keys(l).forEach((function(t){var n=l[t];n.forEach(ke),Promise.all(n.map((function(n){return function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function o(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((r=r.apply(e,t||[])).next())}))}(void 0,void 0,void 0,(function(){return function(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}(this,(function(r){switch(r.label){case 0:return[4,De(n,t,e)];case 1:return r.sent(),[2]}}))}))}))).catch((function(){}))}))}else r=e,i=Ie.navigationSteps,s=Object.keys(i).length,(c=Le(o=(s>0?s:1)-1)||[])[r]=!0,i[o]=c,function(e){var t,n=null!==(t=Ie.startMarkToStepsMap[e])&&void 0!==t?t:[];Object.keys(n).forEach((function(e){Ie.active[e]||(Ie.active[e]=!0)}))}(e);if(a.enableNavigationTracking){var u=qe();null===(t=a.onMarkStep)||void 0===t||t.call(a,e,Object.keys(u))}else null===(n=a.onMarkStep)||void 0===n||n.call(a,e,Object.keys(Ie.active))},$e=function(e){l.mark(d+e),je(e)},Ue=function(e){0===l.getEntriesByName(d+e).length&&(l.mark(d+e),je(e))},Fe=0,Ke=function(){function e(e){if(void 0===e&&(e={}),this.v="9.0.0-rc.3",a.analyticsTracker=e.analyticsTracker,a.isResourceTiming=!!e.resourceTiming,a.isElementTiming=!!e.elementTiming,a.maxTime=e.maxMeasureTime||a.maxTime,a.reportOptions=e.reportOptions||a.reportOptions,a.steps=e.steps,a.onMarkStep=e.onMarkStep,a.enableNavigationTracking=e.enableNavigationTracking,p()){"PerformanceObserver"in s&&Re(),void 0!==document.hidden&&document.addEventListener("visibilitychange",T);var t=function(){if(!p())return{};var e=l.getEntriesByType("navigation")[0];if(!e)return{};var t=e.responseStart,n=e.responseEnd;return{fetchTime:n-e.fetchStart,workerTime:e.workerStart>0?n-e.workerStart:0,totalTime:n-e.requestStart,downloadTime:n-t,timeToFirstByte:t-e.requestStart,headerSize:e.transferSize-e.encodedBodySize||0,dnsLookupTime:e.domainLookupEnd-e.domainLookupStart,redirectTime:e.redirectEnd-e.redirectStart}}();j("navigationTiming",t),t.redirectTime&&$({attribution:{},name:"RT",rating:B("RT",t.redirectTime),value:t.redirectTime}),j("networkInformation",function(){if("connection"in c){var e=c.connection;return"object"!=typeof e?{}:(m=e.effectiveType,f=!!e.saveData,{downlink:e.downlink,effectiveType:e.effectiveType,rtt:e.rtt,saveData:!!e.saveData})}return{}}()),c&&c.storage&&"function"==typeof c.storage.estimate&&c.storage.estimate().then(Oe),a.steps&&a.steps&&(Ie.startMarkToStepsMap={},Ie.finalMarkToStepsMap={},Ie.active={},Ie.navigationSteps={},Object.entries(a.steps).forEach((function(e){var t,n,r=e[0],i=e[1].marks,a=i[0],s=i[1],o=null!==(n=Ie.startMarkToStepsMap[a])&&void 0!==n?n:{};if(o[r]=!0,Ie.startMarkToStepsMap[a]=o,Ie.finalMarkToStepsMap[s]){var c=Ie.finalMarkToStepsMap[s][a]||[];c.push(r),Ie.finalMarkToStepsMap[s][a]=c}else Ie.finalMarkToStepsMap[s]=((t={})[a]=[r],t)})))}}return e.prototype.start=function(e){p()&&!y[e]&&(y[e]=!0,l.mark("mark_".concat(e,"_start")))},e.prototype.end=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!0),p()&&y[e]){l.mark("mark_".concat(e,"_end")),delete y[e];var r=function(e){l.measure(e,"mark_".concat(e,"_start"),"mark_".concat(e,"_end"));var t=l.getEntriesByName(e).pop();return t&&"measure"===t.entryType?t.duration:-1}(e);n&&j(e,C(r),t)}},e.prototype.endPaint=function(e,t){var n=this;setTimeout((function(){n.end(e,t)}))},e.prototype.clear=function(e){delete y[e],l.clearMarks&&(l.clearMarks("mark_".concat(e,"_start")),l.clearMarks("mark_".concat(e,"_end")))},e.prototype.markNTBT=function(){var e=this;this.start("ntbt"),v.value=0,clearTimeout(Fe),Fe=setTimeout((function(){e.end("ntbt",{},!1),$({attribution:{},name:"NTBT",rating:B("NTBT",v.value),value:v.value}),v.value=0}),2e3)},e}()},834406:e=>{var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o,c=[],l=!1,u=-1;function h(){l&&o&&(l=!1,o.length?c=o.concat(c):u=-1,c.length&&d())}function d(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(o=c,c=[];++u<t;)o&&o[u].run();u=-1,t=c.length}o=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},897375:(e,t)=>{"use strict";var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function i(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var r,a,s=[];for(a in"string"!=typeof t&&(t="?"),e)if(n.call(e,a)){if((r=e[a])||null!=r&&!isNaN(r)||(r=""),a=i(a),r=i(r),null===a||null===r)continue;s.push(a+"="+r)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var a=r(t[1]),s=r(t[2]);null===a||null===s||a in i||(i[a]=s)}return i}},811837:(e,t,n)=>{"use strict";var r=n(202784),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,u=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:u,props:a,_owner:o.current}}t.jsx=l},283426:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,y={};function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}function _(){}function b(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=g.prototype;var v=b.prototype=new _;v.constructor=b,f(v,g.prototype),v.isPureReactComponent=!0;var w=Array.isArray,E=Object.prototype.hasOwnProperty,T={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,r){var i,a={},s=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)E.call(t,i)&&!S.hasOwnProperty(i)&&(a[i]=t[i]);var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){for(var l=Array(c),u=0;u<c;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===a[i]&&(a[i]=c[i]);return{$$typeof:n,type:e,key:s,ref:o,props:a,_owner:T.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function x(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,i,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var c=!1;if(null===e)c=!0;else switch(o){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return s=s(c=e),e=""===a?"."+x(c,0):a,w(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),M(s,t,i,"",(function(e){return e}))):null!=s&&(A(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(c=0,a=""===a?".":a+":",w(e))for(var l=0;l<e.length;l++){var u=a+x(o=e[l],l);c+=M(o,t,i,u,s)}else if(u=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"==typeof u)for(e=u.call(e),l=0;!(o=e.next()).done;)c+=M(o=o.value,t,i,u=a+x(o,l++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function R(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function O(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null},k={transition:null},P={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:k,ReactCurrentOwner:T};t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=s,t.PureComponent=b,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=f({},e.props),a=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=T.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)E.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}return{$$typeof:n,type:e.type,key:a,ref:s,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=k.transition;k.transition={};try{e()}finally{k.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return I.current.useCallback(e,t)},t.useContext=function(e){return I.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return I.current.useDeferredValue(e)},t.useEffect=function(e,t){return I.current.useEffect(e,t)},t.useId=function(){return I.current.useId()},t.useImperativeHandle=function(e,t,n){return I.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return I.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return I.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return I.current.useMemo(e,t)},t.useReducer=function(e,t,n){return I.current.useReducer(e,t,n)},t.useRef=function(e){return I.current.useRef(e)},t.useState=function(e){return I.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return I.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return I.current.useTransition()},t.version="18.2.0"},202784:(e,t,n)=>{"use strict";e.exports=n(283426)},552322:(e,t,n)=>{"use strict";e.exports=n(811837)},201738:(e,t,n)=>{var r,i=n(834406);!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),a=s(e);function s(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:a=s(r.Reflect,a),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,o={__proto__:[]}instanceof Array,c=!s&&!o,l={create:s?function(){return ie(Object.create(null))}:o?function(){return ie({__proto__:null})}:function(){return ie({})},has:c?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:c?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},u=Object.getPrototypeOf(Function),h="object"==typeof i&&"true"==="MISSING_ENV_VAR".REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,p=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?ne():Set,m=new(h||"function"!=typeof WeakMap?re():WeakMap);function f(e,t,n,r){if(D(n)){if(!V(e))throw new TypeError;if(!Q(t))throw new TypeError;return N(e,t)}if(!V(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(r)&&!D(r)&&!q(r))throw new TypeError;return q(r)&&(r=void 0),A(e,t,n=W(n),r)}function y(e,t){function n(n,r){if(!j(n))throw new TypeError;if(!D(r)&&!z(r))throw new TypeError;I(e,t,n,r)}return n}function g(e,t,n,r){if(!j(n))throw new TypeError;return D(r)||(r=W(r)),I(e,t,n,r)}function _(e,t,n){if(!j(t))throw new TypeError;return D(n)||(n=W(n)),x(e,t,n)}function b(e,t,n){if(!j(t))throw new TypeError;return D(n)||(n=W(n)),M(e,t,n)}function v(e,t,n){if(!j(t))throw new TypeError;return D(n)||(n=W(n)),R(e,t,n)}function w(e,t,n){if(!j(t))throw new TypeError;return D(n)||(n=W(n)),O(e,t,n)}function E(e,t){if(!j(e))throw new TypeError;return D(t)||(t=W(t)),k(e,t)}function T(e,t){if(!j(e))throw new TypeError;return D(t)||(t=W(t)),P(e,t)}function S(e,t,n){if(!j(t))throw new TypeError;D(n)||(n=W(n));var r=C(t,n,!1);if(D(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=m.get(t);return i.delete(n),i.size>0||m.delete(t),!0}function N(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!D(r)&&!q(r)){if(!Q(r))throw new TypeError;t=r}}return t}function A(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!D(a)&&!q(a)){if(!j(a))throw new TypeError;r=a}}return r}function C(e,t,n){var r=m.get(e);if(D(r)){if(!n)return;r=new d,m.set(e,r)}var i=r.get(t);if(D(i)){if(!n)return;i=new d,r.set(t,i)}return i}function x(e,t,n){if(M(e,t,n))return!0;var r=ee(t);return!q(r)&&x(e,r,n)}function M(e,t,n){var r=C(t,n,!1);return!D(r)&&F(r.has(e))}function R(e,t,n){if(M(e,t,n))return O(e,t,n);var r=ee(t);return q(r)?void 0:R(e,r,n)}function O(e,t,n){var r=C(t,n,!1);if(!D(r))return r.get(e)}function I(e,t,n,r){C(n,r,!0).set(e,t)}function k(e,t){var n=P(e,t),r=ee(e);if(null===r)return n;var i=k(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var a=new p,s=[],o=0,c=n;o<c.length;o++){var l=c[o];a.has(l)||(a.add(l),s.push(l))}for(var u=0,h=i;u<h.length;u++){l=h[u];a.has(l)||(a.add(l),s.push(l))}return s}function P(e,t){var n=[],r=C(e,t,!1);if(D(r))return n;for(var i=Y(r.keys()),a=0;;){var s=X(i);if(!s)return n.length=a,n;var o=J(s);try{n[a]=o}catch(e){try{Z(i)}finally{throw e}}a++}}function L(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function D(e){return void 0===e}function q(e){return null===e}function B(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function $(e,t){switch(L(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=G(e,r);if(void 0!==i){var a=i.call(e,n);if(j(a))throw new TypeError;return a}return U(e,"default"===n?"number":n)}function U(e,t){if("string"===t){var n=e.toString;if(H(n))if(!j(i=n.call(e)))return i;if(H(r=e.valueOf))if(!j(i=r.call(e)))return i}else{var r;if(H(r=e.valueOf))if(!j(i=r.call(e)))return i;var i,a=e.toString;if(H(a))if(!j(i=a.call(e)))return i}throw new TypeError}function F(e){return!!e}function K(e){return""+e}function W(e){var t=$(e,3);return B(t)?t:K(t)}function V(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function H(e){return"function"==typeof e}function Q(e){return"function"==typeof e}function z(e){switch(L(e)){case 3:case 4:return!0;default:return!1}}function G(e,t){var n=e[t];if(null!=n){if(!H(n))throw new TypeError;return n}}function Y(e){var t=G(e,a);if(!H(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function J(e){return e.value}function X(e){var t=e.next();return!t.done&&t}function Z(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===u)return t;if(t!==u)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function te(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function s(e,t){return[e,t]}}function ne(){return function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}()}function re(){var e=16,n=l.create(),r=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=a(e,!1);return void 0!==t&&l.has(t,this._key)},e.prototype.get=function(e){var t=a(e,!1);return void 0!==t?l.get(t,this._key):void 0},e.prototype.set=function(e,t){return a(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=a(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+c()}while(l.has(n,e));return n[e]=!0,e}function a(e,n){if(!t.call(e,r)){if(!n)return;Object.defineProperty(e,r,{value:l.create()})}return e[r]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function c(){var t=o(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<e;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function ie(e){return e.__=void 0,delete e.__,e}e("decorate",f),e("metadata",y),e("defineMetadata",g),e("hasMetadata",_),e("hasOwnMetadata",b),e("getMetadata",v),e("getOwnMetadata",w),e("getMetadataKeys",E),e("getOwnMetadataKeys",T),e("deleteMetadata",S)}(a)}()}(r||(r={}))},957245:e=>{"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},517190:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ArgumentOutOfRangeError:()=>R.W,AsyncSubject:()=>u.c,BehaviorSubject:()=>c.X,ConnectableObservable:()=>i.c,EMPTY:()=>G.E,EmptyError:()=>O.K,GroupedObservable:()=>a.T,NEVER:()=>he,Notification:()=>N.P,NotificationKind:()=>N.W,ObjectUnsubscribedError:()=>I.N,Observable:()=>r.y,ReplaySubject:()=>l.t,Scheduler:()=>E.b,Subject:()=>o.xQ,Subscriber:()=>S.L,Subscription:()=>T.w,TimeoutError:()=>P.W,UnsubscriptionError:()=>k.B,VirtualAction:()=>w,VirtualTimeScheduler:()=>v,animationFrame:()=>b,animationFrameScheduler:()=>_,asap:()=>h.e,asapScheduler:()=>h.E,async:()=>d.P,asyncScheduler:()=>d.z,bindCallback:()=>j,bindNodeCallback:()=>F,combineLatest:()=>H.aj,concat:()=>Q.z,config:()=>Me.v,defer:()=>z.P,empty:()=>G.c,forkJoin:()=>X,from:()=>J.D,fromEvent:()=>te,fromEventPattern:()=>re,generate:()=>ie,identity:()=>x.y,iif:()=>se,interval:()=>ce,isObservable:()=>M.b,merge:()=>ue.T,never:()=>de,noop:()=>C.Z,observable:()=>s.L,of:()=>pe.of,onErrorResumeNext:()=>me,pairs:()=>fe,partition:()=>ve,pipe:()=>A.z,queue:()=>p.c,queueScheduler:()=>p.N,race:()=>we.S3,range:()=>Ee,scheduled:()=>xe.x,throwError:()=>Se._,timer:()=>Ne.H,using:()=>Ae,zip:()=>Ce.$R});var r=n(919939),i=n(189386),a=n(860453),s=n(68859),o=n(661194),c=n(664580),l=n(961048),u=n(293866),h=n(74858),d=n(220646),p=n(787410),m=n(702995),f=n(809795),y=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return m.ZT(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(f.o),g=n(952966),_=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return m.ZT(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(g.v))(y),b=_,v=function(e){function t(t,n){void 0===t&&(t=w),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return m.ZT(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(g.v),w=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return m.ZT(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(f.o),E=n(877035),T=n(451586),S=n(691881),N=n(738781),A=n(801199),C=n(354582),x=n(236930),M=n(586621),R=n(309120),O=n(744397),I=n(590906),k=n(222674),P=n(835915),L=n(92188),D=n(84658),q=n(693073),B=n(114070);function j(e,t,n){if(t){if(!(0,B.K)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return j(e,n).apply(void 0,r).pipe((0,L.U)((function(e){return(0,q.k)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a,s=this,o={context:s,subject:a,callbackFunc:e,scheduler:n};return new r.y((function(r){if(n){var i={args:t,subscriber:r,params:o};return n.schedule($,0,i)}if(!a){a=new u.c;try{e.apply(s,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.next(e.length<=1?e[0]:e),a.complete()}]))}catch(e){(0,D._)(a)?a.error(e):console.warn(e)}}return a.subscribe(r)}))}}function $(e){var t=this,n=e.args,r=e.subscriber,i=e.params,a=i.callbackFunc,s=i.context,o=i.scheduler,c=i.subject;if(!c){c=i.subject=new u.c;try{a.apply(s,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(o.schedule(U,0,{value:r,subject:c}))}]))}catch(e){c.error(e)}}this.add(c.subscribe(r))}function U(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function F(e,t,n){if(t){if(!(0,B.K)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return F(e,n).apply(void 0,r).pipe((0,L.U)((function(e){return(0,q.k)(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new r.y((function(r){var i=a.context,s=a.subject;if(n)return n.schedule(K,0,{params:a,subscriber:r,context:i});if(!s){s=a.subject=new u.c;try{e.apply(i,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?s.error(n):(s.next(e.length<=1?e[0]:e),s.complete())}]))}catch(e){(0,D._)(s)?s.error(e):console.warn(e)}}return s.subscribe(r)}))}}function K(e){var t=this,n=e.params,r=e.subscriber,i=e.context,a=n.callbackFunc,s=n.args,o=n.scheduler,c=n.subject;if(!c){c=n.subject=new u.c;try{a.apply(i,s.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(o.schedule(V,0,{err:r,subject:c}));else{var i=e.length<=1?e[0]:e;t.add(o.schedule(W,0,{value:i,subject:c}))}}]))}catch(e){this.add(o.schedule(V,0,{err:e,subject:c}))}}this.add(c.subscribe(r))}function W(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function V(e){var t=e.err;e.subject.error(t)}var H=n(820097),Q=n(524245),z=n(386542),G=n(984773),Y=n(150757),J=n(297238);function X(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if((0,q.k)(n))return Z(n,null);if((0,Y.K)(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return Z(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var i=e.pop();return Z(e=1===e.length&&(0,q.k)(e[0])?e[0]:e,null).pipe((0,L.U)((function(e){return i.apply(void 0,e)})))}return Z(e,null)}function Z(e,t){return new r.y((function(n){var r=e.length;if(0!==r)for(var i=new Array(r),a=0,s=0,o=function(o){var c=(0,J.D)(e[o]),l=!1;n.add(c.subscribe({next:function(e){l||(l=!0,s++),i[o]=e},error:function(e){return n.error(e)},complete:function(){++a!==r&&l||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)o(c);else n.complete()}))}var ee=n(477371);function te(e,t,n,i){return(0,ee.m)(n)&&(i=n,n=void 0),i?te(e,t,n).pipe((0,L.U)((function(e){return(0,q.k)(e)?i.apply(void 0,e):i(e)}))):new r.y((function(r){ne(e,t,(function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function ne(e,t,n,r,i){var a;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var s=e;e.addEventListener(t,n,i),a=function(){return s.removeEventListener(t,n,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var o=e;e.on(t,n),a=function(){return o.off(t,n)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){var c=e;e.addListener(t,n),a=function(){return c.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var l=0,u=e.length;l<u;l++)ne(e[l],t,n,r,i)}r.add(a)}function re(e,t,n){return n?re(e,t).pipe((0,L.U)((function(e){return(0,q.k)(e)?n.apply(void 0,e):n(e)}))):new r.y((function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(e){return void n.error(e)}if((0,ee.m)(t))return function(){return t(i,r)}}))}function ie(e,t,n,i,a){var s,o;if(1==arguments.length){var c=e;o=c.initialState,t=c.condition,n=c.iterate,s=c.resultSelector||x.y,a=c.scheduler}else void 0===i||(0,B.K)(i)?(o=e,s=x.y,a=i):(o=e,s=i);return new r.y((function(e){var r=o;if(a)return a.schedule(ae,0,{subscriber:e,iterate:n,condition:t,resultSelector:s,state:r});for(;;){if(t){var i=void 0;try{i=t(r)}catch(t){return void e.error(t)}if(!i){e.complete();break}}var c=void 0;try{c=s(r)}catch(t){return void e.error(t)}if(e.next(c),e.closed)break;try{r=n(r)}catch(t){return void e.error(t)}}}))}function ae(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function se(e,t,n){return void 0===t&&(t=G.E),void 0===n&&(n=G.E),(0,z.P)((function(){return e()?t:n}))}var oe=n(576712);function ce(e,t){return void 0===e&&(e=0),void 0===t&&(t=d.P),(!(0,oe.k)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=d.P),new r.y((function(n){return n.add(t.schedule(le,e,{subscriber:n,counter:0,period:e})),n}))}function le(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var ue=n(997686),he=new r.y(C.Z);function de(){return he}var pe=n(116612);function me(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return G.E;var n=e[0],i=e.slice(1);return 1===e.length&&(0,q.k)(n)?me.apply(void 0,n):new r.y((function(e){var t=function(){return e.add(me.apply(void 0,i).subscribe(e))};return(0,J.D)(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function fe(e,t){return t?new r.y((function(n){var r=Object.keys(e),i=new T.w;return i.add(t.schedule(ye,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i})):new r.y((function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()}))}function ye(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,a=e.obj;if(!r.closed)if(n<t.length){var s=t[n];r.next([s,a[s]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:a}))}else r.complete()}var ge=n(265683),_e=n(21400),be=n(572730);function ve(e,t,n){return[(0,be.h)(t,n)(new r.y((0,_e.s)(e))),(0,be.h)((0,ge.f)(t,n))(new r.y((0,_e.s)(e)))]}var we=n(32219);function Ee(e,t,n){return void 0===e&&(e=0),new r.y((function(r){void 0===t&&(t=e,e=0);var i=0,a=e;if(n)return n.schedule(Te,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(a++),r.closed)break}}))}function Te(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}var Se=n(434236),Ne=n(613254);function Ae(e,t){return new r.y((function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var a=(i?(0,J.D)(i):G.E).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}}))}var Ce=n(271131),xe=n(612540),Me=n(520604)},293866:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(702995),i=n(661194),a=n(451586),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return r.ZT(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),a.w.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),a.w.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(i.xQ)},664580:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var r=n(702995),i=n(661194),a=n(590906),s=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.ZT(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new a.N;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.xQ)},738781:(e,t,n)=>{"use strict";n.d(t,{P:()=>o,W:()=>r});var r,i=n(984773),a=n(116612),s=n(434236);r||(r={});var o=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return(0,a.of)(this.value);case"E":return(0,s._)(this.error);case"C":return(0,i.c)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},919939:(e,t,n)=>{"use strict";n.d(t,{y:()=>u});var r=n(84658),i=n(691881),a=n(392532),s=n(335629);var o=n(68859),c=n(801199),l=n(520604),u=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,o=function(e,t,n){if(e){if(e instanceof i.L)return e;if(e[a.b])return e[a.b]()}return e||t||n?new i.L(e,t,n):new i.L(s.c)}(e,t,n);if(r?o.add(r.call(o,this.source)):o.add(this.source||l.v.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),l.v.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){l.v.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),(0,r._)(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=h(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[o.L]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:(0,c.U)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=h(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function h(e){if(e||(e=l.v.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},335629:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});var r=n(520604),i=n(847804),a={closed:!0,next:function(e){},error:function(e){if(r.v.useDeprecatedSynchronousErrorHandling)throw e;(0,i.z)(e)},complete:function(){}}},696807:(e,t,n)=>{"use strict";n.d(t,{L:()=>i});var r=n(702995),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(691881).L)},961048:(e,t,n)=>{"use strict";n.d(t,{t:()=>u});var r=n(702995),i=n(661194),a=n(787410),s=n(451586),o=n(649433),c=n(590906),l=n(327566),u=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.ZT(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new h(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,a=r.length;if(this.closed)throw new c.N;if(this.isStopped||this.hasError?t=s.w.EMPTY:(this.observers.push(e),t=new l.W(this,e)),i&&e.add(e=new o.ht(e,i)),n)for(var u=0;u<a&&!e.closed;u++)e.next(r[u]);else for(u=0;u<a&&!e.closed;u++)e.next(r[u].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||a.c).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,a=0;a<i&&!(e-r[a].time<n);)a++;return i>t&&(a=Math.max(a,i-t)),a>0&&r.splice(0,a),r},t}(i.xQ),h=function(){return function(e,t){this.time=e,this.value=t}}()},877035:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}()},661194:(e,t,n)=>{"use strict";n.d(t,{Yc:()=>u,xQ:()=>h});var r=n(702995),i=n(919939),a=n(691881),s=n(451586),o=n(590906),c=n(327566),l=n(392532),u=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.ZT(t,e),t}(a.L),h=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.ZT(t,e),t.prototype[l.b]=function(){return new u(this)},t.prototype.lift=function(e){var t=new d(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new o.N;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new o.N;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new o.N;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new o.N;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new o.N;return this.hasError?(e.error(this.thrownError),s.w.EMPTY):this.isStopped?(e.complete(),s.w.EMPTY):(this.observers.push(e),new c.W(this,e))},t.prototype.asObservable=function(){var e=new i.y;return e.source=this,e},t.create=function(e,t){return new d(e,t)},t}(i.y),d=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.ZT(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.w.EMPTY},t}(h)},327566:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(702995),i=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.ZT(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(451586).w)},691881:(e,t,n)=>{"use strict";n.d(t,{L:()=>u});var r=n(702995),i=n(477371),a=n(335629),s=n(451586),o=n(392532),c=n(520604),l=n(847804),u=function(e){function t(n,r,i){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=a.c;break;case 1:if(!n){s.destination=a.c;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new h(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new h(s,n,r,i)}return s}return r.ZT(t,e),t.prototype[o.b]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(s.w),h=function(e){function t(t,n,r,s){var o,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return(0,i.m)(n)?o=n:n&&(o=n.next,r=n.error,s=n.complete,n!==a.c&&(l=Object.create(n),(0,i.m)(l.unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=o,c._error=r,c._complete=s,c}return r.ZT(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;c.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=c.v.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):(0,l.z)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;(0,l.z)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};c.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),c.v.useDeprecatedSynchronousErrorHandling)throw e;(0,l.z)(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!c.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return c.v.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):((0,l.z)(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(u)},451586:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var r=n(693073),i=n(150757),a=n(477371),s=n(222674),o=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,o=n._parentOrParents,l=n._ctorUnsubscribe,u=n._unsubscribe,h=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var d=0;d<o.length;++d){o[d].remove(this)}if((0,a.m)(u)){l&&(this._unsubscribe=void 0);try{u.call(this)}catch(e){t=e instanceof s.B?c(e.errors):[e]}}if((0,r.k)(h)){d=-1;for(var p=h.length;++d<p;){var m=h[d];if((0,i.K)(m))try{m.unsubscribe()}catch(e){t=t||[],e instanceof s.B?t=t.concat(c(e.errors)):t.push(e)}}}if(t)throw new s.B(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var a=this._subscriptions;return null===a?this._subscriptions=[n]:a.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function c(e){return e.reduce((function(e,t){return e.concat(t instanceof s.B?t.errors:t)}),[])}},520604:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},393694:(e,t,n)=>{"use strict";n.d(t,{Ds:()=>c,IY:()=>o,ft:()=>l});var r=n(702995),i=n(691881),a=n(919939),s=n(21400),o=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return r.ZT(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(i.L),c=(i.L,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(i.L));i.L;function l(e,t){if(!t.closed){if(e instanceof a.y)return e.subscribe(t);var n;try{n=(0,s.s)(e)(t)}catch(e){t.error(e)}return n}}},189386:(e,t,n)=>{"use strict";n.d(t,{N:()=>u,c:()=>l});var r=n(702995),i=n(661194),a=n(919939),s=n(691881),o=n(451586),c=n(246840),l=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.ZT(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new o.w).add(this.source.subscribe(new h(this.getSubject(),this))),e.closed&&(this._connection=null,e=o.w.EMPTY)),e},t.prototype.refCount=function(){return(0,c.x)()(this)},t}(a.y),u=function(){var e=l.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),h=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.ZT(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(i.Yc);s.L},820097:(e,t,n)=>{"use strict";n.d(t,{Ms:()=>h,aj:()=>u});var r=n(702995),i=n(114070),a=n(693073),s=n(696807),o=n(510505),c=n(560007),l={};function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return(0,i.K)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&(0,a.k)(e[0])&&(e=e[0]),(0,c.n)(e,r).lift(new h(n))}var h=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.resultSelector))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.ZT(t,e),t.prototype._next=function(e){this.values.push(l),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add((0,o.D)(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],a=this.toRespond?i===l?--this.toRespond:this.toRespond:0;r[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(s.L)},524245:(e,t,n)=>{"use strict";n.d(t,{z:()=>a});var r=n(116612),i=n(90430);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,i.u)()(r.of.apply(void 0,e))}},386542:(e,t,n)=>{"use strict";n.d(t,{P:()=>s});var r=n(919939),i=n(297238),a=n(984773);function s(e){return new r.y((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?(0,i.D)(n):(0,a.c)()).subscribe(t)}))}},984773:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,c:()=>a});var r=n(919939),i=new r.y((function(e){return e.complete()}));function a(e){return e?function(e){return new r.y((function(t){return e.schedule((function(){return t.complete()}))}))}(e):i}},297238:(e,t,n)=>{"use strict";n.d(t,{D:()=>s});var r=n(919939),i=n(21400),a=n(612540);function s(e,t){return t?(0,a.x)(e,t):e instanceof r.y?e:new r.y((0,i.s)(e))}},560007:(e,t,n)=>{"use strict";n.d(t,{n:()=>s});var r=n(919939),i=n(517651),a=n(436405);function s(e,t){return t?(0,a.r)(e,t):new r.y((0,i.V)(e))}},997686:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var r=n(919939),i=n(114070),a=n(997258),s=n(560007);function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,o=null,c=e[e.length-1];return(0,i.K)(c)?(o=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof c&&(n=e.pop()),null===o&&1===e.length&&e[0]instanceof r.y?e[0]:(0,a.J)(n)((0,s.n)(e,o))}},116612:(e,t,n)=>{"use strict";n.d(t,{of:()=>s});var r=n(114070),i=n(560007),a=n(436405);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return(0,r.K)(n)?(e.pop(),(0,a.r)(e,n)):(0,i.n)(e)}},32219:(e,t,n)=>{"use strict";n.d(t,{S3:()=>c});var r=n(702995),i=n(693073),a=n(560007),s=n(696807),o=n(510505);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!(0,i.k)(e[0]))return e[0];e=e[0]}return(0,a.n)(e,void 0).lift(new l)}var l=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new u(e))},e}(),u=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.ZT(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=(0,o.D)(this,r,void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(t)},t}(s.L)},434236:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(919939);function i(e,t){return t?new r.y((function(n){return t.schedule(a,0,{error:e,subscriber:n})})):new r.y((function(t){return t.error(e)}))}function a(e){var t=e.error;e.subscriber.error(t)}},613254:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(919939),i=n(220646),a=n(576712),s=n(114070);function o(e,t,n){void 0===e&&(e=0);var o=-1;return(0,a.k)(t)?o=Number(t)<1?1:Number(t):(0,s.K)(t)&&(n=t),(0,s.K)(n)||(n=i.P),new r.y((function(t){var r=(0,a.k)(e)?e:+e-n.now();return n.schedule(c,r,{index:0,period:o,subscriber:t})}))}function c(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}},271131:(e,t,n)=>{"use strict";n.d(t,{$R:()=>l,mx:()=>u});var r=n(702995),i=n(560007),a=n(693073),s=n(691881),o=n(100002),c=n(393694);function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),(0,i.n)(e,void 0).lift(new u(n))}var u=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.resultSelector))},e}(),h=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return r.ZT(t,e),t.prototype._next=function(e){var t=this.iterators;(0,a.k)(e)?t.push(new p(e)):"function"==typeof e[o.hZ]?t.push(new d(e[o.hZ]())):t.push(new m(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe());else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(s=e[r]).hasValue&&!s.hasValue())return}var i=!1,a=[];for(r=0;r<t;r++){var s,o=(s=e[r]).next();if(s.hasCompleted()&&(i=!0),o.done)return void n.complete();a.push(o.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(s.L),d=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),p=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[o.hZ]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),m=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.ZT(t,e),t.prototype[o.hZ]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return(0,c.ft)(this.observable,new c.IY(this))},t}(c.Ds)},90430:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var r=n(997258);function i(){return(0,r.J)(1)}},791008:(e,t,n)=>{"use strict";n.d(t,{x:()=>a});var r=n(702995),i=n(691881);function a(e,t){return function(n){return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.compare,this.keySelector))},e}(),o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.ZT(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(i.L)},572730:(e,t,n)=>{"use strict";n.d(t,{h:()=>a});var r=n(702995),i=n(691881);function a(e,t){return function(n){return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.thisArg))},e}(),o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(i.L)},860453:(e,t,n)=>{"use strict";n.d(t,{T:()=>d,v:()=>c});var r=n(702995),i=n(691881),a=n(451586),s=n(919939),o=n(661194);function c(e,t,n,r){return function(i){return i.lift(new l(e,t,n,r))}}var l=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),u=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=a,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new o.xQ,n.set(t,i);var a=new d(t,i,this);if(this.destination.next(a),this.durationSelector){var s=void 0;try{s=this.durationSelector(new d(t,i))}catch(e){return void this.error(e)}this.add(s.subscribe(new h(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(i.L),h=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return r.ZT(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(i.L),d=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return r.ZT(t,e),t.prototype._subscribe=function(e){var t=new a.w,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new p(n)),t.add(r.subscribe(e)),t},t}(s.y),p=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return r.ZT(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(a.w)},92188:(e,t,n)=>{"use strict";n.d(t,{U:()=>a});var r=n(702995),i=n(691881);function a(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.project,this.thisArg))},e}(),o=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.ZT(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(i.L)},997258:(e,t,n)=>{"use strict";n.d(t,{J:()=>a});var r=n(771710),i=n(236930);function a(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),(0,r.zg)(i.y,e)}},771710:(e,t,n)=>{"use strict";n.d(t,{VS:()=>u,zg:()=>o});var r=n(702995),i=n(92188),a=n(297238),s=n(393694);function o(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(o((function(n,r){return(0,a.D)(e(n,r)).pipe((0,i.U)((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new c(e,n))})}var c=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project,this.concurrent))},e}(),l=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new s.IY(this),n=this.destination;n.add(t);var r=(0,s.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(s.Ds),u=o},649433:(e,t,n)=>{"use strict";n.d(t,{QV:()=>s,ht:()=>c});var r=n(702995),i=n(691881),a=n(738781);function s(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}}var o=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}(),c=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return r.ZT(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new l(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(a.P.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(a.P.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(a.P.createComplete()),this.unsubscribe()},t}(i.L),l=function(){return function(e,t){this.notification=e,this.destination=t}}()},321520:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(92188);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return(0,r.U)(function(e,t){var n=function(n){for(var r=n,i=0;i<t;i++){var a=null!=r?r[e[i]]:void 0;if(void 0===a)return;r=a}return r};return n}(e,n))(t)}}},246840:(e,t,n)=>{"use strict";n.d(t,{x:()=>a});var r=n(702995),i=n(691881);function a(){return function(e){return e.lift(new s(e))}}var s=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new o(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),o=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.ZT(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(i.L)},436405:(e,t,n)=>{"use strict";n.d(t,{r:()=>a});var r=n(919939),i=n(451586);function a(e,t){return new r.y((function(n){var r=new i.w,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}},612540:(e,t,n)=>{"use strict";n.d(t,{x:()=>u});var r=n(919939),i=n(451586),a=n(68859);var s=n(436405),o=n(100002);var c=n(839633),l=n(72318);function u(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[a.L]}(e))return function(e,t){return new r.y((function(n){var r=new i.w;return r.add(t.schedule((function(){var i=e[a.L]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if((0,c.t)(e))return function(e,t){return new r.y((function(n){var r=new i.w;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if((0,l.z)(e))return(0,s.r)(e,t);if(function(e){return e&&"function"==typeof e[o.hZ]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.y((function(n){var r,a=new i.w;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[o.hZ](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}},809795:(e,t,n)=>{"use strict";n.d(t,{o:()=>i});var r=n(702995),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return r.ZT(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return r.ZT(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(451586).w))},952966:(e,t,n)=>{"use strict";n.d(t,{v:()=>a});var r=n(702995),i=n(877035),a=function(e){function t(n,r){void 0===r&&(r=i.b.now);var a=e.call(this,n,(function(){return t.delegate&&t.delegate!==a?t.delegate.now():r()}))||this;return a.actions=[],a.active=!1,a.scheduled=void 0,a}return r.ZT(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(i.b)},74858:(e,t,n)=>{"use strict";n.d(t,{e:()=>d,E:()=>h});var r=n(702995),i=1,a=function(){return Promise.resolve()}(),s={};function o(e){return e in s&&(delete s[e],!0)}var c=function(e){var t=i++;return s[t]=!0,a.then((function(){return o(t)&&e()})),t},l=function(e){o(e)},u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.ZT(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=c(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(l(n),t.scheduled=void 0)},t}(n(809795).o),h=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(952966).v))(u),d=h},220646:(e,t,n)=>{"use strict";n.d(t,{P:()=>a,z:()=>i});var r=n(809795),i=new(n(952966).v)(r.o),a=i},787410:(e,t,n)=>{"use strict";n.d(t,{c:()=>s,N:()=>a});var r=n(702995),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.ZT(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(n(809795).o),a=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t}(n(952966).v))(i),s=a},100002:(e,t,n)=>{"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(t,{hZ:()=>i});var i=r()},68859:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},392532:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},309120:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var r=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}()},744397:(e,t,n)=>{"use strict";n.d(t,{K:()=>r});var r=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}()},590906:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}()},835915:(e,t,n)=>{"use strict";n.d(t,{W:()=>r});var r=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}()},222674:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},84658:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(691881);function i(e){for(;e;){var t=e,n=t.closed,i=t.destination,a=t.isStopped;if(n||a)return!1;e=i&&i instanceof r.L?i:null}return!0}},847804:(e,t,n)=>{"use strict";function r(e){setTimeout((function(){throw e}),0)}n.d(t,{z:()=>r})},236930:(e,t,n)=>{"use strict";function r(e){return e}n.d(t,{y:()=>r})},693073:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});var r=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},72318:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},477371:(e,t,n)=>{"use strict";function r(e){return"function"==typeof e}n.d(t,{m:()=>r})},576712:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});var r=n(693073);function i(e){return!(0,r.k)(e)&&e-parseFloat(e)+1>=0}},150757:(e,t,n)=>{"use strict";function r(e){return null!==e&&"object"==typeof e}n.d(t,{K:()=>r})},586621:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});var r=n(919939);function i(e){return!!e&&(e instanceof r.y||"function"==typeof e.lift&&"function"==typeof e.subscribe)}},839633:(e,t,n)=>{"use strict";function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.d(t,{t:()=>r})},114070:(e,t,n)=>{"use strict";function r(e){return e&&"function"==typeof e.schedule}n.d(t,{K:()=>r})},354582:(e,t,n)=>{"use strict";function r(){}n.d(t,{Z:()=>r})},265683:(e,t,n)=>{"use strict";function r(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}n.d(t,{f:()=>r})},801199:(e,t,n)=>{"use strict";n.d(t,{U:()=>a,z:()=>i});var r=n(236930);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(e)}function a(e){return 0===e.length?r.y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}},21400:(e,t,n)=>{"use strict";n.d(t,{s:()=>u});var r=n(517651),i=n(847804),a=n(100002),s=n(68859),o=n(72318),c=n(839633),l=n(150757),u=function(e){if(e&&"function"==typeof e[s.L])return u=e,function(e){var t=u[s.L]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if((0,o.z)(e))return(0,r.V)(e);if((0,c.t)(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,i.z),e};if(e&&"function"==typeof e[a.hZ])return t=e,function(e){for(var n=t[a.hZ]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,u,h=(0,l.K)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},517651:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var r=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}}},510505:(e,t,n)=>{"use strict";n.d(t,{D:()=>o});var r=n(702995),i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(691881).L),a=n(21400),s=n(919939);function o(e,t,n,r,o){if(void 0===o&&(o=new i(e,n,r)),!o.closed)return t instanceof s.y?t.subscribe(o):(0,a.s)(t)(o)}},49906:(e,t,n)=>{"use strict";n.r(t),n.d(t,{audit:()=>a,auditTime:()=>u,buffer:()=>h,bufferCount:()=>f,bufferTime:()=>v,bufferToggle:()=>R,bufferWhen:()=>k,catchError:()=>D,combineAll:()=>$,combineLatest:()=>K,concat:()=>V,concatAll:()=>H.u,concatMap:()=>z,concatMapTo:()=>G,count:()=>Y,debounce:()=>Z,debounceTime:()=>ne,defaultIfEmpty:()=>se,delay:()=>he,delayWhen:()=>ye,dematerialize:()=>we,distinct:()=>Se,distinctUntilChanged:()=>Ce.x,distinctUntilKeyChanged:()=>xe,elementAt:()=>$e,endWith:()=>Fe,every:()=>Ke,exhaust:()=>He,exhaustMap:()=>Ye,expand:()=>Ze,filter:()=>Re.h,finalize:()=>nt,find:()=>at,findIndex:()=>ct,first:()=>ut,flatMap:()=>Q.VS,groupBy:()=>ht.v,ignoreElements:()=>dt,isEmpty:()=>ft,last:()=>wt,map:()=>Ge.U,mapTo:()=>Et,materialize:()=>Nt,max:()=>kt,merge:()=>Lt,mergeAll:()=>Dt.J,mergeMap:()=>Q.zg,mergeMapTo:()=>qt,mergeScan:()=>Bt,min:()=>Ut,multicast:()=>Kt,observeOn:()=>Vt.QV,onErrorResumeNext:()=>Ht,pairwise:()=>Gt,partition:()=>Zt,pluck:()=>en.j,publish:()=>nn,publishBehavior:()=>an,publishLast:()=>on,publishReplay:()=>ln,race:()=>hn,reduce:()=>It,refCount:()=>Sn.x,repeat:()=>dn,repeatWhen:()=>fn,retry:()=>_n,retryWhen:()=>wn,sample:()=>Nn,sampleTime:()=>xn,scan:()=>xt,sequenceEqual:()=>In,share:()=>qn,shareReplay:()=>Bn,single:()=>jn,skip:()=>Fn,skipLast:()=>Vn,skipUntil:()=>zn,skipWhile:()=>Jn,startWith:()=>er,subscribeOn:()=>ir,switchAll:()=>lr,switchMap:()=>sr,switchMapTo:()=>ur,take:()=>qe,takeLast:()=>_t,takeUntil:()=>hr,takeWhile:()=>mr,tap:()=>br,throttle:()=>Tr,throttleTime:()=>Ar,throwIfEmpty:()=>Ie,timeInterval:()=>Or,timeout:()=>Br,timeoutWith:()=>Pr,timestamp:()=>jr,toArray:()=>Fr,window:()=>Kr,windowCount:()=>Hr,windowTime:()=>Gr,windowToggle:()=>ni,windowWhen:()=>ai,withLatestFrom:()=>ci,zip:()=>di,zipAll:()=>pi});var r=n(702995),i=n(393694);function a(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.durationSelector))},e}(),o=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(e){return this.destination.error(e)}var n=(0,i.ft)(t,new i.IY(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},t.prototype.clearThrottle=function(){var e=this,t=e.value,n=e.hasValue,r=e.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))},t.prototype.notifyNext=function(){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(i.Ds),c=n(220646),l=n(613254);function u(e,t){return void 0===t&&(t=c.P),a((function(){return(0,l.H)(e,t)}))}function h(e){return function(t){return t.lift(new d(e))}}var d=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new p(e,this.closingNotifier))},e}(),p=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add((0,i.ft)(n,new i.IY(r))),r}return r.ZT(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(){var e=this.buffer;this.buffer=[],this.destination.next(e)},t}(i.Ds),m=n(691881);function f(e,t){return void 0===t&&(t=null),function(n){return n.lift(new y(e,t))}}var y=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?_:g}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),g=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(m.L),_=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t=this,n=t.bufferSize,r=t.startBufferEvery,i=t.buffers,a=t.count;this.count++,a%r==0&&i.push([]);for(var s=i.length;s--;){var o=i[s];o.push(e),o.length===n&&(i.splice(s,1),this.destination.next(o))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(m.L),b=n(114070);function v(e){var t=arguments.length,n=c.P;(0,b.K)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new w(e,r,i,n))}}var w=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new T(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),E=function(){return function(){this.buffer=[]}}(),T=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=a,s.contexts=[];var o=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var c={subscriber:s,context:o,bufferTimeSpan:n};s.add(o.closeAction=a.schedule(S,n,c))}else{var l={subscriber:s,context:o},u={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:a};s.add(o.closeAction=a.schedule(A,n,l)),s.add(a.schedule(N,r,u))}return s}return r.ZT(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var a=n[i],s=a.buffer;s.push(e),s.length==this.maxBufferSize&&(t=a)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(S,n,r))}},t.prototype.openContext=function(){var e=new E;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(m.L);function S(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function N(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,a=r.openContext();r.closed||(r.add(a.closeAction=i.schedule(A,n,{subscriber:r,context:a})),this.schedule(e,t))}function A(e){var t=e.subscriber,n=e.context;t.closeContext(n)}var C=n(451586),x=n(510505),M=n(696807);function R(e,t){return function(n){return n.lift(new O(e,t))}}var O=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new I(e,this.openings,this.closingSelector))},e}(),I=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.closingSelector=r,i.contexts=[],i.add((0,x.D)(i,n)),i}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new C.w,r={buffer:[],subscription:n};t.push(r);var i=(0,x.D)(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},t}(M.L);function k(e){return function(t){return t.lift(new P(e))}}var P=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new L(e,this.closingSelector))},e}(),L=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.ZT(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},t.prototype.notifyNext=function(){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{t=(0,this.closingSelector)()}catch(e){return this.error(e)}e=new C.w,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add((0,i.ft)(t,new i.IY(this))),this.subscribing=!1},t}(i.Ds);function D(e){return function(t){var n=new q(e),r=t.lift(n);return n.caught=r}}var q=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new B(e,this.selector,this.caught))},e}(),B=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new i.IY(this);this.add(r);var a=(0,i.ft)(n,r);a!==r&&this.add(a)}},t}(i.Ds),j=n(820097);function $(e){return function(t){return t.lift(new j.Ms(e))}}var U=n(693073),F=n(297238);function K(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&(0,U.k)(e[0])&&(e=e[0].slice()),function(t){return t.lift.call((0,F.D)([t].concat(e)),new j.Ms(n))}}var W=n(524245);function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(W.z.apply(void 0,[t].concat(e)))}}var H=n(90430),Q=n(771710);function z(e,t){return(0,Q.zg)(e,t,1)}function G(e,t){return z((function(){return e}),t)}function Y(e){return function(t){return t.lift(new J(e,t))}}var J=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new X(e,this.predicate,this.source))},e}(),X=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(m.L);function Z(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.durationSelector))},e}(),te=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=(0,i.ft)(t,new i.IY(this)))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(i.Ds);function ne(e,t){return void 0===t&&(t=c.P),function(n){return n.lift(new re(e,t))}}var re=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ie(e,this.dueTime,this.scheduler))},e}(),ie=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.ZT(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(ae,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(m.L);function ae(e){e.debouncedNext()}function se(e){return void 0===e&&(e=null),function(t){return t.lift(new oe(e))}}var oe=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.defaultValue))},e}(),ce=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.ZT(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(m.L);function le(e){return e instanceof Date&&!isNaN(+e)}var ue=n(738781);function he(e,t){void 0===t&&(t=c.P);var n=le(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new de(n,t))}}var de=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new pe(e,this.delay,this.scheduler))},e}(),pe=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.ZT(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var a=Math.max(0,n[0].time-r.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new me(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(ue.P.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(ue.P.createComplete()),this.unsubscribe()},t}(m.L),me=function(){return function(e,t){this.time=e,this.notification=t}}(),fe=n(919939);function ye(e,t){return t?function(n){return new be(n,t).lift(new ge(e))}:function(t){return t.lift(new ge(e))}}var ge=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new _e(e,this.delayDurationSelector))},e}(),_e=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=(0,x.D)(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(M.L),be=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return r.ZT(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new ve(e,this.source))},t}(fe.y),ve=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return r.ZT(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(m.L);function we(){return function(e){return e.lift(new Ee)}}var Ee=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Te(e))},e}(),Te=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(m.L);function Se(e,t){return function(n){return n.lift(new Ne(e,t))}}var Ne=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Ae(e,this.keySelector,this.flushes))},e}(),Ae=function(e){function t(t,n,r){var a=e.call(this,t)||this;return a.keySelector=n,a.values=new Set,r&&a.add((0,i.ft)(r,new i.IY(a))),a}return r.ZT(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(i.Ds),Ce=n(791008);function xe(e,t){return(0,Ce.x)((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))}var Me=n(309120),Re=n(572730),Oe=n(744397);function Ie(e){return void 0===e&&(e=Le),function(t){return t.lift(new ke(e))}}var ke=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Pe(e,this.errorFactory))},e}(),Pe=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return r.ZT(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(m.L);function Le(){return new Oe.K}var De=n(984773);function qe(e){return function(t){return 0===e?(0,De.c)():t.lift(new Be(e))}}var Be=function(){function e(e){if(this.total=e,this.total<0)throw new Me.W}return e.prototype.call=function(e,t){return t.subscribe(new je(e,this.total))},e}(),je=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(m.L);function $e(e,t){if(e<0)throw new Me.W;var n=arguments.length>=2;return function(r){return r.pipe((0,Re.h)((function(t,n){return n===e})),qe(1),n?se(t):Ie((function(){return new Me.W})))}}var Ue=n(116612);function Fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return(0,W.z)(t,Ue.of.apply(void 0,e))}}function Ke(e,t){return function(n){return n.lift(new We(e,t,n))}}var We=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new Ve(e,this.predicate,this.thisArg,this.source))},e}(),Ve=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.predicate=n,a.thisArg=r,a.source=i,a.index=0,a.thisArg=r||a,a}return r.ZT(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m.L);function He(){return function(e){return e.lift(new Qe)}}var Qe=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new ze(e))},e}(),ze=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.ZT(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add((0,i.ft)(e,new i.IY(this))))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.Ds),Ge=n(92188);function Ye(e,t){return t?function(n){return n.pipe(Ye((function(n,r){return(0,F.D)(e(n,r)).pipe((0,Ge.U)((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Je(e))}}var Je=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Xe(e,this.project))},e}(),Xe=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.Ds);function Ze(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new et(e,t,n))}}var et=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new tt(e,this.project,this.concurrent,this.scheduler))},e}(),tt=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.project=n,a.concurrent=r,a.scheduler=i,a.index=0,a.active=0,a.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(a.buffer=[]),a}return r.ZT(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=(0,this.project)(e,r);if(this.scheduler){var a={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,a))}else this.subscribeToProjection(i,e,r)}catch(e){n.error(e)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add((0,i.ft)(e,new i.IY(this)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this._next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(i.Ds);function nt(e){return function(t){return t.lift(new rt(e))}}var rt=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new it(e,this.callback))},e}(),it=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new C.w(n)),r}return r.ZT(t,e),t}(m.L);function at(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new st(e,n,!1,t))}}var st=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new ot(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),ot=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=a,s.index=0,s}return r.ZT(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(m.L);function ct(e,t){return function(n){return n.lift(new st(e,n,!0,t))}}var lt=n(236930);function ut(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,Re.h)((function(t,n){return e(t,n,r)})):lt.y,qe(1),n?se(t):Ie((function(){return new Oe.K})))}}var ht=n(860453);function dt(){return function(e){return e.lift(new pt)}}var pt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new mt(e))},e}(),mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.ZT(t,e),t.prototype._next=function(e){},t}(m.L);function ft(){return function(e){return e.lift(new yt)}}var yt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new gt(e))},e}(),gt=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(m.L);function _t(e){return function(t){return 0===e?(0,De.c)():t.lift(new bt(e))}}var bt=function(){function e(e){if(this.total=e,this.total<0)throw new Me.W}return e.prototype.call=function(e,t){return t.subscribe(new vt(e,this.total))},e}(),vt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var a=t++%n;e.next(r[a])}e.complete()},t}(m.L);function wt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?(0,Re.h)((function(t,n){return e(t,n,r)})):lt.y,_t(1),n?se(t):Ie((function(){return new Oe.K})))}}function Et(e){return function(t){return t.lift(new Tt(e))}}var Tt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new St(e,this.value))},e}(),St=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return r.ZT(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(m.L);function Nt(){return function(e){return e.lift(new At)}}var At=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ct(e))},e}(),Ct=function(e){function t(t){return e.call(this,t)||this}return r.ZT(t,e),t.prototype._next=function(e){this.destination.next(ue.P.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(ue.P.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(ue.P.createComplete()),e.complete()},t}(m.L);function xt(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Mt(e,t,n))}}var Mt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Rt(e,this.accumulator,this.seed,this.hasSeed))},e}(),Rt=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.accumulator=n,a._seed=r,a.hasSeed=i,a.index=0,a}return r.ZT(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(m.L),Ot=n(801199);function It(e,t){return arguments.length>=2?function(n){return(0,Ot.z)(xt(e,t),_t(1),se(t))(n)}:function(t){return(0,Ot.z)(xt((function(t,n,r){return e(t,n,r+1)})),_t(1))(t)}}function kt(e){return It("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})}var Pt=n(997686);function Lt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(Pt.T.apply(void 0,[t].concat(e)))}}var Dt=n(997258);function qt(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?(0,Q.zg)((function(){return e}),t,n):("number"==typeof t&&(n=t),(0,Q.zg)((function(){return e}),n))}function Bt(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new jt(e,t,n))}}var jt=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new $t(e,this.accumulator,this.seed,this.concurrent))},e}(),$t=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.accumulator=n,a.acc=r,a.concurrent=i,a.hasValue=!1,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return r.ZT(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(e){return n.error(e)}this.active++,this._innerSub(r)}else this.buffer.push(e)},t.prototype._innerSub=function(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e){var t=this.destination;this.acc=e,this.hasValue=!0,t.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(i.Ds);function Ut(e){return It("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})}var Ft=n(189386);function Kt(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new Wt(r,t));var i=Object.create(n,Ft.N);return i.source=n,i.subjectFactory=r,i}}var Wt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}(),Vt=n(649433);function Ht(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&(0,U.k)(e[0])&&(e=e[0]),function(t){return t.lift(new Qt(e))}}var Qt=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new zt(e,this.nextSources))},e}(),zt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return r.ZT(t,e),t.prototype.notifyError=function(){this.subscribeToNextSource()},t.prototype.notifyComplete=function(){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new i.IY(this),n=this.destination;n.add(t);var r=(0,i.ft)(e,t);r!==t&&n.add(r)}else this.destination.complete()},t}(i.Ds);function Gt(){return function(e){return e.lift(new Yt)}}var Yt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Jt(e))},e}(),Jt=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return r.ZT(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)},t}(m.L),Xt=n(265683);function Zt(e,t){return function(n){return[(0,Re.h)(e,t)(n),(0,Re.h)((0,Xt.f)(e,t))(n)]}}var en=n(321520),tn=n(661194);function nn(e){return e?Kt((function(){return new tn.xQ}),e):Kt(new tn.xQ)}var rn=n(664580);function an(e){return function(t){return Kt(new rn.X(e))(t)}}var sn=n(293866);function on(){return function(e){return Kt(new sn.c)(e)}}var cn=n(961048);function ln(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,a=new cn.t(e,t,r);return function(e){return Kt((function(){return a}),i)(e)}}var un=n(32219);function hn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&(0,U.k)(e[0])&&(e=e[0]),t.lift.call(un.S3.apply(void 0,[t].concat(e)))}}function dn(e){return void 0===e&&(e=-1),function(t){return 0===e?(0,De.c)():e<0?t.lift(new pn(-1,t)):t.lift(new pn(e-1,t))}}var pn=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new mn(e,this.count,this.source))},e}(),mn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.ZT(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(m.L);function fn(e){return function(t){return t.lift(new yn(e))}}var yn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new gn(e,this.notifier,t))},e}(),gn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.ZT(t,e),t.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new tn.xQ;try{t=(0,this.notifier)(this.notifications)}catch(t){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=(0,i.ft)(t,new i.IY(this))},t}(i.Ds);function _n(e){return void 0===e&&(e=-1),function(t){return t.lift(new bn(e,t))}}var bn=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new vn(e,this.count,this.source))},e}(),vn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(m.L);function wn(e){return function(t){return t.lift(new En(e,t))}}var En=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Tn(e,this.notifier,this.source))},e}(),Tn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return r.ZT(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,a=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new tn.xQ;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}a=(0,i.ft)(r,new i.IY(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=a,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(i.Ds),Sn=n(246840);function Nn(e){return function(t){return t.lift(new An(e))}}var An=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Cn(e),r=t.subscribe(n);return r.add((0,i.ft)(this.notifier,new i.IY(n))),r},e}(),Cn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return r.ZT(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(i.Ds);function xn(e,t){return void 0===t&&(t=c.P),function(n){return n.lift(new Mn(e,t))}}var Mn=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Rn(e,this.period,this.scheduler))},e}(),Rn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(On,n,{subscriber:i,period:n})),i}return r.ZT(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(m.L);function On(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}function In(e,t){return function(n){return n.lift(new kn(e,t))}}var kn=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new Pn(e,this.compareTo,this.comparator))},e}(),Pn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Ln(t,i))),i}return r.ZT(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this,t=e._a,n=e._b,r=e.comparator;t.length>0&&n.length>0;){var i=t.shift(),a=n.shift(),s=!1;try{s=r?r(i,a):i===a}catch(e){this.destination.error(e)}s||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(m.L),Ln=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return r.ZT(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(m.L);function Dn(){return new tn.xQ}function qn(){return function(e){return(0,Sn.x)()(Kt(Dn)(e))}}function Bn(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift(function(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,a=e.windowTime,s=void 0===a?Number.POSITIVE_INFINITY:a,o=e.refCount,c=e.scheduler,l=0,u=!1,h=!1;return function(e){var r;l++,!t||u?(u=!1,t=new cn.t(i,s,c),r=t.subscribe(this),n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){h=!0,n=void 0,t.complete()}}),h&&(n=void 0)):r=t.subscribe(this),this.add((function(){l--,r.unsubscribe(),r=void 0,n&&!h&&o&&0===l&&(n.unsubscribe(),n=void 0,t=void 0)}))}}(r))}}function jn(e){return function(t){return t.lift(new $n(e,t))}}var $n=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Un(e,this.predicate,this.source))},e}(),Un=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.ZT(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Oe.K)},t}(m.L);function Fn(e){return function(t){return t.lift(new Kn(e))}}var Kn=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Wn(e,this.total))},e}(),Wn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.ZT(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(m.L);function Vn(e){return function(t){return t.lift(new Hn(e))}}var Hn=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new Me.W}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new m.L(e)):t.subscribe(new Qn(e,this._skipCount))},e}(),Qn=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.ZT(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,a=i[r];i[r]=e,this.destination.next(a)}},t}(m.L);function zn(e){return function(t){return t.lift(new Gn(e))}}var Gn=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Yn(e,this.notifier))},e}(),Yn=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var a=new i.IY(r);r.add(a),r.innerSubscription=a;var s=(0,i.ft)(n,a);return s!==a&&(r.add(s),r.innerSubscription=s),r}return r.ZT(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(i.Ds);function Jn(e){return function(t){return t.lift(new Xn(e))}}var Xn=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new Zn(e,this.predicate))},e}(),Zn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(m.L);function er(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return(0,b.K)(n)?(e.pop(),function(t){return(0,W.z)(e,t,n)}):function(t){return(0,W.z)(e,t)}}var tr=n(74858),nr=n(576712),rr=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=tr.e);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!(0,nr.k)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=tr.e),i}return r.ZT(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=tr.e),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(fe.y);function ir(e,t){return void 0===t&&(t=0),function(n){return n.lift(new ar(e,t))}}var ar=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new rr(t,this.delay,this.scheduler).subscribe(e)},e}();function sr(e,t){return"function"==typeof t?function(n){return n.pipe(sr((function(n,r){return(0,F.D)(e(n,r)).pipe((0,Ge.U)((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new or(e))}}var or=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new cr(e,this.project))},e}(),cr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return r.ZT(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new i.IY(this),r=this.destination;r.add(n),this.innerSubscription=(0,i.ft)(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(i.Ds);function lr(){return sr(lt.y)}function ur(e,t){return t?sr((function(){return e}),t):sr((function(){return e}))}function hr(e){return function(t){return t.lift(new dr(e))}}var dr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new pr(e),r=(0,i.ft)(this.notifier,new i.IY(n));return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),pr=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return r.ZT(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(i.Ds);function mr(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new fr(e,t))}}var fr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new yr(e,this.predicate,this.inclusive))},e}(),yr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r.ZT(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(m.L),gr=n(354582),_r=n(477371);function br(e,t,n){return function(r){return r.lift(new vr(e,t,n))}}var vr=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new wr(e,this.nextOrObserver,this.error,this.complete))},e}(),wr=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a._tapNext=gr.Z,a._tapError=gr.Z,a._tapComplete=gr.Z,a._tapError=r||gr.Z,a._tapComplete=i||gr.Z,(0,_r.m)(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||gr.Z,a._tapError=n.error||gr.Z,a._tapComplete=n.complete||gr.Z),a}return r.ZT(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(m.L),Er={leading:!0,trailing:!1};function Tr(e,t){return void 0===t&&(t=Er),function(n){return n.lift(new Sr(e,!!t.leading,!!t.trailing))}}var Sr=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new Nr(e,this.durationSelector,this.leading,this.trailing))},e}(),Nr=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a.destination=t,a.durationSelector=n,a._leading=r,a._trailing=i,a._hasValue=!1,a}return r.ZT(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=(0,i.ft)(t,new i.IY(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(i.Ds);function Ar(e,t,n){return void 0===t&&(t=c.P),void 0===n&&(n=Er),function(r){return r.lift(new Cr(e,t,n.leading,n.trailing))}}var Cr=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new xr(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),xr=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=a,s._hasTrailingValue=!1,s._trailingValue=null,s}return r.ZT(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mr,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(m.L);function Mr(e){e.subscriber.clearThrottle()}var Rr=n(386542);function Or(e){return void 0===e&&(e=c.P),function(t){return(0,Rr.P)((function(){return t.pipe(xt((function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}}),{current:e.now(),value:void 0,last:void 0}),(0,Ge.U)((function(e){var t=e.current,n=e.last,r=e.value;return new Ir(r,t-n)})))}))}}var Ir=function(){return function(e,t){this.value=e,this.interval=t}}(),kr=n(835915);function Pr(e,t,n){return void 0===n&&(n=c.P),function(r){var i=le(e),a=i?+e-n.now():Math.abs(e);return r.lift(new Lr(a,i,t,n))}}var Lr=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Dr(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Dr=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=a,s.scheduleTimeout(),s}return r.ZT(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add((0,i.ft)(t,new i.IY(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(i.Ds),qr=n(434236);function Br(e,t){return void 0===t&&(t=c.P),Pr(e,(0,qr._)(new kr.W),t)}function jr(e){return void 0===e&&(e=c.P),(0,Ge.U)((function(t){return new $r(t,e.now())}))}var $r=function(){return function(e,t){this.value=e,this.timestamp=t}}();function Ur(e,t,n){return 0===n?[t]:(e.push(t),e)}function Fr(){return It(Ur,[])}function Kr(e){return function(t){return t.lift(new Wr(e))}}var Wr=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new Vr(e),r=t.subscribe(n);return r.closed||n.add((0,i.ft)(this.windowBoundaries,new i.IY(n))),r},e}(),Vr=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new tn.xQ,t.next(n.window),n}return r.ZT(t,e),t.prototype.notifyNext=function(){this.openWindow()},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new tn.xQ;t.next(n)},t}(i.Ds);function Hr(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Qr(e,t))}}var Qr=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new zr(e,this.windowSize,this.startWindowEvery))},e}(),zr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new tn.xQ],i.count=0,t.next(i.windows[0]),i}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,a=i.length,s=0;s<a&&!this.closed;s++)i[s].next(e);var o=this.count-r+1;if(o>=0&&o%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var c=new tn.xQ;i.push(c),n.next(c)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(m.L);function Gr(e){var t=c.P,n=null,r=Number.POSITIVE_INFINITY;return(0,b.K)(arguments[3])&&(t=arguments[3]),(0,b.K)(arguments[2])?t=arguments[2]:(0,nr.k)(arguments[2])&&(r=Number(arguments[2])),(0,b.K)(arguments[1])?t=arguments[1]:(0,nr.k)(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new Yr(e,n,r,t))}}var Yr=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Xr(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),Jr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return r.ZT(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(tn.xQ),Xr=function(e){function t(t,n,r,i,a){var s=e.call(this,t)||this;s.destination=t,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=a,s.windows=[];var o=s.openWindow();if(null!==r&&r>=0){var c={subscriber:s,window:o,context:null},l={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:a};s.add(a.schedule(ti,n,c)),s.add(a.schedule(ei,r,l))}else{var u={subscriber:s,window:o,windowTimeSpan:n};s.add(a.schedule(Zr,n,u))}return s}return r.ZT(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new Jr;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(m.L);function Zr(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function ei(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,a=n.openWindow(),s=this,o={action:s,subscription:null},c={subscriber:n,window:a,context:o};o.subscription=r.schedule(ti,t,c),s.add(o.subscription),s.schedule(e,i)}function ti(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}function ni(e,t){return function(n){return n.lift(new ri(e,t))}}var ri=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new ii(e,this.openings,this.closingSelector))},e}(),ii=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=(0,x.D)(i,n,n)),i}return r.ZT(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var a=n[i];a.window.error(t),a.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var a=void 0;try{a=(0,this.closingSelector)(t)}catch(e){return this.error(e)}var s=new tn.xQ,o=new C.w,c={window:s,subscription:o};this.contexts.push(c);var l=(0,x.D)(this,a,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,o.add(l)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(M.L);function ai(e){return function(t){return t.lift(new si(e))}}var si=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new oi(e,this.closingSelector))},e}(),oi=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n,r=this.window=new tn.xQ;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(e){return this.destination.error(e),void this.window.error(e)}this.add(this.closingNotification=(0,x.D)(this,n))},t}(M.L);function ci(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new li(r,n))}}var li=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new ui(e,this.observables,this.project))},e}(),ui=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var a=n.length;i.values=new Array(a);for(var s=0;s<a;s++)i.toRespond.push(s);for(s=0;s<a;s++){var o=n[s];i.add((0,x.D)(i,o,void 0,s))}return i}return r.ZT(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(M.L),hi=n(271131);function di(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(hi.$R.apply(void 0,[t].concat(e)))}}function pi(e){return function(t){return t.lift(new hi.mx(e))}}},702995:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>i});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}},577834:(e,t,n)=>{var r=n(348834),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),a(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},973327:(e,t,n)=>{var r=n(577834).Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,a=e.length,s=this._len,o=0;o<a;){for(var c=s%i,l=Math.min(a-o,i-c),u=0;u<l;u++)n[c+u]=e[o+u];o+=l,(s+=l)%i==0&&this._update(n)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i},609065:(e,t,n)=>{var r=e.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};r.sha=n(508820),r.sha1=n(217885),r.sha224=n(958321),r.sha256=n(974424),r.sha384=n(490213),r.sha512=n(155596)},508820:(e,t,n)=>{var r=n(991285),i=n(973327),a=n(577834).Buffer,s=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,i.call(this,64,56)}function l(e){return e<<30|e>>>2}function u(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=n[h-3]^n[h-8]^n[h-14]^n[h-16];for(var d=0;d<80;++d){var p=~~(d/20),m=0|((t=r)<<5|t>>>27)+u(p,i,a,o)+c+n[d]+s[p];c=o,o=a,a=l(i),i=r,r=m}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},217885:(e,t,n)=>{var r=n(991285),i=n(973327),a=n(577834).Buffer,s=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,i.call(this,64,56)}function l(e){return e<<5|e>>>27}function u(e){return e<<30|e>>>2}function h(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(c,i),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,d=0;d<16;++d)n[d]=e.readInt32BE(4*d);for(;d<80;++d)n[d]=(t=n[d-3]^n[d-8]^n[d-14]^n[d-16])<<1|t>>>31;for(var p=0;p<80;++p){var m=~~(p/20),f=l(r)+h(m,i,a,o)+c+n[p]+s[m]|0;c=o,o=a,a=u(i),i=r,r=f}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0},c.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},958321:(e,t,n)=>{var r=n(991285),i=n(974424),a=n(973327),s=n(577834).Buffer,o=new Array(64);function c(){this.init(),this._w=o,a.call(this,64,56)}r(c,i),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},974424:(e,t,n)=>{var r=n(991285),i=n(973327),a=n(577834).Buffer,s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function c(){this.init(),this._w=o,i.call(this,64,56)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function d(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function p(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(c,i),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,o=0|this._d,c=0|this._e,m=0|this._f,f=0|this._g,y=0|this._h,g=0;g<16;++g)n[g]=e.readInt32BE(4*g);for(;g<64;++g)n[g]=0|(((t=n[g-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[g-7]+p(n[g-15])+n[g-16];for(var _=0;_<64;++_){var b=y+d(c)+l(c,m,f)+s[_]+n[_]|0,v=h(r)+u(r,i,a)|0;y=f,f=m,m=c,c=o+b|0,o=a,a=i,i=r,r=b+v|0}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=c+this._e|0,this._f=m+this._f|0,this._g=f+this._g|0,this._h=y+this._h|0},c.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},490213:(e,t,n)=>{var r=n(991285),i=n(155596),a=n(973327),s=n(577834).Buffer,o=new Array(160);function c(){this.init(),this._w=o,a.call(this,128,112)}r(c,i),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=s.allocUnsafe(48);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},155596:(e,t,n)=>{var r=n(991285),i=n(973327),a=n(577834).Buffer,s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function c(){this.init(),this._w=o,i.call(this,128,112)}function l(e,t,n){return n^e&(t^n)}function u(e,t,n){return e&t|n&(e|t)}function h(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function d(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function m(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function f(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function g(e,t){return e>>>0<t>>>0?1:0}r(c,i),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,i=0|this._ch,a=0|this._dh,o=0|this._eh,c=0|this._fh,_=0|this._gh,b=0|this._hh,v=0|this._al,w=0|this._bl,E=0|this._cl,T=0|this._dl,S=0|this._el,N=0|this._fl,A=0|this._gl,C=0|this._hl,x=0;x<32;x+=2)t[x]=e.readInt32BE(4*x),t[x+1]=e.readInt32BE(4*x+4);for(;x<160;x+=2){var M=t[x-30],R=t[x-30+1],O=p(M,R),I=m(R,M),k=f(M=t[x-4],R=t[x-4+1]),P=y(R,M),L=t[x-14],D=t[x-14+1],q=t[x-32],B=t[x-32+1],j=I+D|0,$=O+L+g(j,I)|0;$=($=$+k+g(j=j+P|0,P)|0)+q+g(j=j+B|0,B)|0,t[x]=$,t[x+1]=j}for(var U=0;U<160;U+=2){$=t[U],j=t[U+1];var F=u(n,r,i),K=u(v,w,E),W=h(n,v),V=h(v,n),H=d(o,S),Q=d(S,o),z=s[U],G=s[U+1],Y=l(o,c,_),J=l(S,N,A),X=C+Q|0,Z=b+H+g(X,C)|0;Z=(Z=(Z=Z+Y+g(X=X+J|0,J)|0)+z+g(X=X+G|0,G)|0)+$+g(X=X+j|0,j)|0;var ee=V+K|0,te=W+F+g(ee,V)|0;b=_,C=A,_=c,A=N,c=o,N=S,o=a+Z+g(S=T+X|0,T)|0,a=i,T=E,i=r,E=w,r=n,w=v,n=Z+te+g(v=X+ee|0,X)|0}this._al=this._al+v|0,this._bl=this._bl+w|0,this._cl=this._cl+E|0,this._dl=this._dl+T|0,this._el=this._el+S|0,this._fl=this._fl+N|0,this._gl=this._gl+A|0,this._hl=this._hl+C|0,this._ah=this._ah+n+g(this._al,v)|0,this._bh=this._bh+r+g(this._bl,w)|0,this._ch=this._ch+i+g(this._cl,E)|0,this._dh=this._dh+a+g(this._dl,T)|0,this._eh=this._eh+o+g(this._el,S)|0,this._fh=this._fh+c+g(this._fl,N)|0,this._gh=this._gh+_+g(this._gl,A)|0,this._hh=this._hh+b+g(this._hl,C)|0},c.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},288619:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletLinkExtensionConnectionRequest=void 0,function(e){e.troubleshootConnection="troubleshootConnection"}(t.WalletLinkExtensionConnectionRequest||(t.WalletLinkExtensionConnectionRequest={}))},437168:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletLinkExtensionConnectionResponse=void 0,function(e){e.web3RequestCanceled="web3RequestCanceled",e.parentDisconnected="parentDisconnect"}(t.WalletLinkExtensionConnectionResponse||(t.WalletLinkExtensionConnectionResponse={}))},151771:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionConnectionRequest=void 0,function(e){e.getAllAddresses="getAllAddresses"}(t.ExtensionConnectionRequest||(t.ExtensionConnectionRequest={}))},731648:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionConnectionRequest=void 0,function(e){e.requestEthereumAccounts="requestEthereumAccounts",e.hideRequestEthereumAccounts="hideRequestEthereumAccounts",e.switchEthereumChain="switchEthereumChain",e.addEthereumChain="addEthereumChain",e.watchAsset="watchAsset",e.selectProvider="selectProvider"}(t.ExtensionConnectionRequest||(t.ExtensionConnectionRequest={}))},441090:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionConnectionResponse=void 0,function(e){e.requestEthereumAccountsResponse="requestEthereumAccountsResponse",e.addEthereumChainDeny="addEthereumChainDeny",e.addEthereumChainApprove="addEthereumChainApprove",e.switchEthereumChainDeny="switchEthereumChainDeny",e.switchEthereumChainApprove="switchEthereumChainApprove",e.signEthereumMessageSuccess="signEthereumMessageSuccess",e.signEthereumTransactionSuccess="signEthereumTransactionSuccess",e.submitEthereumTransactionSuccess="submitEthereumTransactionSuccess",e.watchAssetApprove="watchAssetApprove",e.watchAssetDeny="watchAssetDeny",e.selectProviderApprove="selectProviderApprove",e.selectProviderDeny="selectProviderDeny",e.dappChainSwitched="dappChainSwitched"}(t.ExtensionConnectionResponse||(t.ExtensionConnectionResponse={}))},394125:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoreKeys_legacyPasswordIv=t.StoreKeys_legacyPasswordSalt=t.StoreKeys_legacyEncryptedMnemonic=t.StoreKeys_signingDevice=t.StoreKeys_logoutIncomplete=t.StoreKeys_autoLockByUnixTimestamp=t.StoreKeys_autoLockTimeout=t.StoreKeys_lastPasswordAttempt=t.StoreKeys_passwordAttempts=t.StoreKeys_serviceWorkerStorageSecret=t.StoreKeys_hashIterations=t.StoreKeys_multiAccountEncryptedSecrets=t.StoreKeys_isAppAccessAuthRequired=t.StoreKeys_requireTransactionsAuth=t.StoreKeys_isAuthenticating=t.StoreKeys_isAppUnlocked=void 0;const r=n(298801),i=n(191501);t.StoreKeys_isAppUnlocked=new i.MemoryStorageKey("isAppUnlocked"),t.StoreKeys_isAuthenticating=new i.MemoryStorageKey("isAuthenticating"),t.StoreKeys_requireTransactionsAuth=new r.LocalStorageStoreKey("requireTransactionsAuth"),t.StoreKeys_isAppAccessAuthRequired=new r.LocalStorageStoreKey("isAppAccessAuthRequired"),t.StoreKeys_multiAccountEncryptedSecrets=new r.LocalStorageStoreKey("multiAccountEncryptedMnemonic"),t.StoreKeys_hashIterations=new r.LocalStorageStoreKey("hashIterations"),t.StoreKeys_serviceWorkerStorageSecret=new r.LocalStorageStoreKey("serviceWorkerStorageSecret"),t.StoreKeys_passwordAttempts=new r.LocalStorageStoreKey("passwordAttempts"),t.StoreKeys_lastPasswordAttempt=new r.LocalStorageStoreKey("lastPasswordAttempt"),t.StoreKeys_autoLockTimeout=new r.LocalStorageStoreKey("autoLockTimeout"),t.StoreKeys_autoLockByUnixTimestamp=new r.LocalStorageStoreKey("autoLockByUnixTimestamp"),t.StoreKeys_logoutIncomplete=new r.LocalStorageStoreKey("logoutIncomplete"),t.StoreKeys_signingDevice=new r.LocalStorageStoreKey("signingDevice"),t.StoreKeys_legacyEncryptedMnemonic=new r.LocalStorageStoreKey("encryptedMnemonic"),t.StoreKeys_legacyPasswordSalt=new r.LocalStorageStoreKey("passwordSalt"),t.StoreKeys_legacyPasswordIv=new r.LocalStorageStoreKey("passwordIv")},790802:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DappConnectionRepository=void 0;const r=n(327242),i=n(517190),a=n(49906),s=n(773841),o=n(577168),c=n(220652);t.DappConnectionRepository=class{constructor(){this.dappsSubject=new i.ReplaySubject(1),this.getDapps().subscribe((e=>{this.dappsSubject.next(e)}))}get allConnections(){return this.dappsSubject.pipe((0,a.map)((e=>e.filter((e=>e.connected)))))}updateChainIdForHost(e){const t=e.overriddenChainId,n=t?r.EthereumNetworkMap.fromChainId(BigInt(t))?.rpcUrl:void 0,i=this.getHostName(e.dappURL);return this.getDapps().pipe((0,a.map)((e=>e.map((e=>this.getHostName(e.dappURL)===i?{...e,overriddenChainId:t,overriddenJsonUrl:n}:e)))),(0,a.mergeMap)((e=>this.setDapps(e))),(0,s.asVoid)())}addConnection(e){const t=e.overriddenChainId,n=e.overriddenJsonUrl,r={dappName:e.dappName,dappLogoURL:e.dappLogoURL,dappLogoURLAlt:e.dappLogoURLAlt,dappURL:e.dappURL,connected:!0,connectedAddress:e.connectedAddress,providerType:e.providerType,overriddenChainId:t,overriddenJsonUrl:n};return this.updateConnection([r],!1)}addConnections(e){const t=e.map((e=>{const t=e.overriddenChainId,n=e.overriddenJsonUrl;return{dappName:e.dappName,dappLogoURL:e.dappLogoURL,dappLogoURLAlt:e.dappLogoURLAlt,dappURL:e.dappURL,connected:!0,connectedAddress:e.connectedAddress,providerType:e.providerType,overriddenChainId:t,overriddenJsonUrl:n}}));return this.setDapps(t)}removeConnection(e){return this.updateConnection([e],!0)}removeAllConnections(e){return this.getDapps().pipe((0,a.mergeMap)((t=>{if(e){const n=t.filter((t=>{const n=e.map((e=>e.toLocaleLowerCase()));return!!t.connectedAddress&&n.includes(t.connectedAddress.toLowerCase())}));return this.updateConnection(n,!0)}return this.updateConnection(t,!0)})),(0,s.asVoid)())}setDapps(e){return o.Single.deferPromise((async()=>new Promise((t=>{chrome.storage?.local.set({[c.ServiceWorkerStorageKey.connectedDapps]:JSON.stringify(e)},(()=>{this.dappsSubject.next(e),t()}))}))))}getDapps(){return o.Single.deferPromise((async()=>new Promise((e=>{chrome.storage?.local.get([c.ServiceWorkerStorageKey.connectedDapps],(t=>{if(!t[c.ServiceWorkerStorageKey.connectedDapps])return void e([]);const n=t[c.ServiceWorkerStorageKey.connectedDapps];e(n?JSON.parse(n):[])}))}))))}getHostName(e){return new URL(e).hostname.toLocaleUpperCase()}updateConnection(e,t){return this.getDapps().pipe((0,a.map)((n=>{let r=n;r.length||(r=[]);let i=!1;const a=new Set(e.map((e=>this.getHostName(e.dappURL)))),s=r.map((n=>{const r=this.getHostName(n.dappURL);if(a.has(r)){const a=e.find((e=>this.getHostName(e.dappURL)===r&&e.connectedAddress?.toLowerCase()===n.connectedAddress?.toLowerCase()));if(a)return i=!0,{dappName:a.dappName,dappLogoURL:a.dappLogoURL,dappLogoURLAlt:a.dappLogoURLAlt,dappURL:a.dappURL,overriddenChainId:a.overriddenChainId,overriddenJsonUrl:a.overriddenJsonUrl,connected:!t,connectedAddress:a.connectedAddress,providerType:a.providerType}}return n}));if(!i&&!t){const t={dappName:e[0].dappName,dappLogoURL:e[0].dappLogoURL,dappLogoURLAlt:e[0].dappLogoURLAlt,dappURL:e[0].dappURL,connected:!0,connectedAddress:e[0].connectedAddress,providerType:e[0].providerType,overriddenChainId:e[0].overriddenChainId,overriddenJsonUrl:e[0].overriddenJsonUrl};return[...s,t]}return s})),(0,a.mergeMap)((e=>this.setDapps(e))),(0,s.asVoid)())}}},773841:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asVoid=t.unwrap=void 0;const r=n(517190),i=n(49906);t.unwrap=function(){return(0,r.pipe)((0,i.filter)((e=>void 0!==e)),(0,i.map)((e=>e)))},t.asVoid=function(){return(0,i.map)((()=>{}))}},577168:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Single=void 0;const r=n(517190);class i extends r.Subscriber{constructor(){super(...arguments),this.completed=!1}_next(e){super._next(e),this._complete()}_complete(){this.completed=!0,super._complete()}_error(e){this.completed=!0,super._error(e)}unsubscribe(){super.unsubscribe(),!this.completed&&this.onUnsubscribe&&(this.onUnsubscribe(),this.onUnsubscribe=void 0)}}class a extends r.Observable{constructor(e){super((t=>{const n=new i(t);return this.onUnsubscribe&&(n.onUnsubscribe=this.onUnsubscribe),e(n),n}))}static just(e){return new a((t=>{t.next(e)}))}static error(e){return new a((t=>{t.error(e)}))}static fromCallable(e){return new a((t=>{e(),t.next()}))}static deferPromise(e){return new a((t=>{e().then((e=>t.next(e))).catch((e=>t.error(e)))}))}}t.Single=a},989289:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteLegacyMnemonic=t.decryptLegacyMnemonic=t.saveLegacyMnemonicToStorage=t.getSecretCounts=t.parseSecretsFromStorage=t.stringifySecretsIntoStorage=t.getSecretsFromServiceWorker=t.saveSecretsToServiceWorker=t.saveEncryptedSecretForAccount=t.saveEncryptedSecrets=t.deleteSecretForAccount=t.deleteSecrets=t.getHasStoredSecrets=t.decryptSecretForAccount=t.decryptSecrets=t.getEncryptedSecrets=t.CANNOT_DELETE_LAST_ACCOUNT_ERROR=t.ENCRYPTED_SECRET_FOR_ACCOUNT_UNDEFINED_ERROR=t.ENCRYPTED_SECRET_UNDEFINED_ERROR=t.SecretAccessContext=void 0;const i=n(385394),a=n(854195),s=n(86296),o=n(996016),c=n(46290),l=n(485599),u=r(n(545455)),h=n(394125),d=n(392079);function p(){(0,i.logGetEncryptedSecretsStart)();const e=l.Store.get(h.StoreKeys_multiAccountEncryptedSecrets);if(!e)return void(0,i.logGetEncryptedSecretsResult)({encryptedSecretsLength:0,isEncryptedSecretsUndefined:void 0===e,isLocalStorageUndefined:!localStorage,localStorageLength:localStorage?.length??0});const t=g(e);return(0,i.logGetEncryptedSecretsResult)({encryptedSecretsLength:Object.keys(t).length,isEncryptedSecretsUndefined:!1,isLocalStorageUndefined:!localStorage,localStorageLength:localStorage?.length??0}),t}function m(e){l.Store.set(h.StoreKeys_multiAccountEncryptedSecrets,y(e))}function f(){return l.Store.has(h.StoreKeys_legacyEncryptedMnemonic)||l.Store.has(h.StoreKeys_multiAccountEncryptedSecrets)}function y(e){return JSON.stringify(e,(function(e,t){switch(e){case"salt":case"passwordIv":return Array.from(t);default:return t}})).replaceAll('"secret"','"mnemonic"')}function g(e){const t=e.replaceAll('"mnemonic"','"secret"');return JSON.parse(t,(function(e,t){switch(e){case"salt":case"passwordIv":return new Uint8Array(t);default:return t}}))}!function(e){e.Unlock="Unlock",e.PasswordOnboardingFlow="PasswordOnboardingFlow",e.ShowRecoveryPhrase="ShowRecoveryPhrase",e.ShowPrivateKey="ShowPrivateKey",e.ChangePassword="ChangePassword",e.VerifyPasswordCreateFlow="VerifyPasswordCreateFlow",e.VerifyPasswordImportFlow="VerifyPasswordImportFlow",e.DebugMenu="DebugMenu",e.BackfillPrimaryAddress="BackfillPrimaryAddress",e.CreateAccount="CreateNewMnemonic",e.ImportAccount="ImportAccount"}(t.SecretAccessContext||(t.SecretAccessContext={})),t.ENCRYPTED_SECRET_UNDEFINED_ERROR=new Error("Illegal State - encrypted secret is undefined"),t.ENCRYPTED_SECRET_FOR_ACCOUNT_UNDEFINED_ERROR=new Error("Illegal State - encrypted secret for account is undefined"),t.CANNOT_DELETE_LAST_ACCOUNT_ERROR=new Error("Illegal State - cannot delete last remaining account"),t.getEncryptedSecrets=p,t.decryptSecrets=async function(e,n){const r=p();if(!r)throw(0,s.cbReportError)({error:t.ENCRYPTED_SECRET_UNDEFINED_ERROR,context:"secret",metadata:{secretAccessContext:n},severity:"error",isHandled:!1}),t.ENCRYPTED_SECRET_UNDEFINED_ERROR;const i=await Promise.all(Object.entries(r).map((async([t,n])=>[t,await e(n)])));return(0,a.triggerDecryptedAllSecrets)(i.length,n),i.reduce(((e,[t,n])=>(e[t]=n,e)),{})},t.decryptSecretForAccount=async function({accountId:e,decryptRequest:n,secretAccessContext:r}){const i=p(),c=o.Account.parseAccountTypeFromId(e);if(!i)throw(0,s.cbReportError)({error:t.ENCRYPTED_SECRET_UNDEFINED_ERROR,context:"secret",metadata:{secretAccessContext:r,accountType:c},severity:"error",isHandled:!1}),t.ENCRYPTED_SECRET_UNDEFINED_ERROR;const l=i[e];if(!l)throw(0,s.cbReportError)({error:t.ENCRYPTED_SECRET_FOR_ACCOUNT_UNDEFINED_ERROR,context:"secret",metadata:{secretAccessContext:r,accountType:c},severity:"error",isHandled:!1}),t.ENCRYPTED_SECRET_FOR_ACCOUNT_UNDEFINED_ERROR;return(0,a.triggerDecryptedSecretForAccount)(r,c),{[e]:await n(l)}},t.getHasStoredSecrets=f,t.deleteSecrets=function(){l.Store.set(h.StoreKeys_multiAccountEncryptedSecrets,void 0)},t.deleteSecretForAccount=function(e){const n=p(),r=o.Account.parseAccountTypeFromId(e);if(!n)throw(0,s.cbReportError)({error:t.ENCRYPTED_SECRET_UNDEFINED_ERROR,context:"secret",metadata:{accountType:r},severity:"error",isHandled:!1}),t.ENCRYPTED_SECRET_UNDEFINED_ERROR;const{[e]:i,...a}=n;if((0,u.default)(a))throw(0,s.cbReportError)({error:t.CANNOT_DELETE_LAST_ACCOUNT_ERROR,context:"secret",metadata:{accountType:r},severity:"error",isHandled:!1}),t.CANNOT_DELETE_LAST_ACCOUNT_ERROR;m(a)},t.saveEncryptedSecrets=async function({decryptedSecrets:e,encryptRequest:t}){const n=await Promise.all(Object.entries(e).map((async([e,n])=>[e,await t(n)]))),r=n.reduce(((e,[t,n])=>(e[t]=n,e)),{});return(0,a.triggerEncryptedAllSecrets)(n.length),m(r),r},t.saveEncryptedSecretForAccount=async function({accountId:e,decryptedSecret:t,encryptRequest:n}){const r=p(),i=o.Account.parseAccountTypeFromId(e),s={...r,[e]:await n(t)};return(0,a.triggerEncryptedSecretForAccount)(i),m(s),s},t.saveSecretsToServiceWorker=function(e){d.serviceWorkerMemoryStore.set("mnemonics",e?JSON.stringify(e):void 0)},t.getSecretsFromServiceWorker=async function(){return d.serviceWorkerMemoryStore.get("mnemonics").then((e=>{if(e){return JSON.parse(e)}}))},t.stringifySecretsIntoStorage=y,t.parseSecretsFromStorage=g,t.getSecretCounts=function(){const e={[c.AccountType.MNEMONIC]:0,[c.AccountType.PRIVATE_KEY]:0};if(!f())return e;const t=p()??{};return Object.keys(t).reduce(((e,t)=>{const n=o.Account.parseAccountTypeFromId(t);return n!==c.AccountType.MNEMONIC&&n!==c.AccountType.PRIVATE_KEY?((0,s.cbReportError)({error:new Error(`Unexpected account type ${n} found with secrets.`),context:"escape-hatch-error",severity:"error",isHandled:!1}),e):{...e,[n]:e[n]+1}}),e)},t.saveLegacyMnemonicToStorage=async function(e,t){(0,a.triggerEncryptLegacyMnemonic)();const n=await t(e);return l.Store.set(h.StoreKeys_legacyEncryptedMnemonic,n),n},t.decryptLegacyMnemonic=async function(e){const n=l.Store.get(h.StoreKeys_legacyEncryptedMnemonic);if(!n)throw(0,s.cbReportError)({error:t.ENCRYPTED_SECRET_UNDEFINED_ERROR,context:"mnemonic_error",severity:"error",isHandled:!1}),t.ENCRYPTED_SECRET_UNDEFINED_ERROR;return(0,a.triggerDecryptLegacyMnemonic)(),await e(n)},t.deleteLegacyMnemonic=function(){l.Store.set(h.StoreKeys_legacyEncryptedMnemonic,void 0),l.Store.set(h.StoreKeys_legacyPasswordSalt,void 0),l.Store.set(h.StoreKeys_legacyPasswordIv,void 0)}},97501:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVENTS=void 0,t.EVENTS={AUTHORIZED:"extension.dapp_authorized",AUTHORIZE_DENY:"extension.dapp_authorize_deny",AUTHORIZE_REQUEST:"extension.dapp_authorize_request",CHROME_UPDATE:"extension.chrome_update",CONNECTED:"extension.connected",CONNECTION_ERROR:"extension.connection_error",CONNECTION_LOST:"extension.connection_lost",CONNECTION_REQUEST:"extension.connection_request",CONNECTION_RESPONSE:"extension.connection_in_flight",DAPP_ORIGIN_MISMATCH:"extension.dapp_origin_mismatch",DISCONNECTION_COMPLETED:"extension.disconnection_completed",DISCONNECTION_INITIATED:"extension.disconnection_initiated",DISCONNECTION_NOOP_COMPLETED:"extension.disconnection_noop_completed",DISCONNECT_COMPLETE_RECEIVED:"extension.disconnect_complete_event.received",DISCONNECT_RELOAD_RECEIVED:"extension.disconnect_reload_event.received",DISCONNECT_RESET_START:"extension.disconnect_reset.start",DISCONNECT_RESET_SUCCESS:"extension.disconnect_reset.success",DISCONNECT_CLEAR_STATE_START:"extension.disconnect_clear_state.start",DISCONNECT_CLEAR_STATE_SUCCESS:"extension.disconnect_clear_state.success",ERROR:"extension.error",FORCE_UPDATE:"extension.force_update",FORCE_UPDATE_CLEARED:"extension.force_update_cleared",INSTALLED:"extension.installed",LOCALSTORAGE_MIGRATION_FAILED:"extension.localstorage_migration.failed",LOCALSTORAGE_MIGRATION_SUCCESS:"extension.localstorage_migration.success",NO_ORIGINAL_TAB:"extension.no_original_tab",REDIRECT:"extension_redirect",RE_LINK_WALLET:"extension.connection_lost.reLinkWallet",SERVICE_WORKER_STARTED:"extension.service_worker_started",CPU_INFO_SERVICE_WORKER_STARTED:"extension.cpu_info.service_worker_started",CPU_INFO_SERVICE_WORKER_IDLE:"extension.cpu_info.service_worker_idle",CPU_INFO_SERVICE_WORKER_INTERVAL:"extension.cpu_info.service_worker_interval",SESSION_CHANGED:"extension.session_changed",STORAGE_MIGRATION_FAILED:"extension.storage_migration.failed",STORAGE_MIGRATION_SUCCESS:"extension.storage_migration.success",SUSPEND:"extension.suspend",TIME:"extension.time_spent",UNDEFINED_POPUP_EVENT_RESPONSE:"extension.undefined_popup_event_response",UNKNOWN_MESSAGE_TYPE:"extension.unknown_message_type",UNSPECIFIED_SENDER_TAB:"extension.unspecified_sender_tab",UPDATED:"extension.updated",WALLETLINK_EXTENSION_SNACKBAR_SHOWN:"walletlink_sdk.snackbar_shown",WALLETLINK_EXTENSION_CANCEL_CLICKED:"walletlink_sdk.snackbar_cancel_connection_clicked",WALLETLINK_EXTENSION_NEED_HELP_CLICKED:"walletlink_sdk.snackbar_need_help_clicked",WALLETLINK_EXTENSION_RESET_CLICKED:"walletlink_sdk.snackbar_reset_connection_clicked"}},50953:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allKillSwitches=t.KILLSWITCHES_CONFIG=t.KILLSWITCHES_SCOPE=void 0;const r=n(86296),i=n(552421),a=n(223967),s=n(395545),o=n(193479),c=n(524264),l=n(875651),u=`${c.KILL_SWITCH_ENDPOINT}/v3/coinbase.killswitch.KillSwitchService/KillSwitches`,h="kill-switches";t.KILLSWITCHES_SCOPE="wallet",t.KILLSWITCHES_CONFIG={serviceUrl:u,disabled:!1,platform:s.PlatformName.extension,scope:t.KILLSWITCHES_SCOPE,version:(0,l.getAppVersion)()||"",contextErrorHandler:function(){(0,r.cbReportError)({error:new Error("ClientKillSwitch: context not provided"),context:h,severity:"error",isHandled:!1})},fetchErrorHandler:function(e){(0,r.cbReportError)({error:e,context:h,severity:"error",metadata:{MetaData:e.message||"fetchError"},isHandled:!1})},hookErrorHandler:function(){(0,r.cbReportError)({error:new Error("ClientKillSwitch: useHook error"),context:h,severity:"error",isHandled:!1})},logger:{logMetric:function(){(0,s.logMetric)({metricName:"client_kill_switch.listen_latest",metricType:s.MetricType.count,value:1})},platform:"extension",enableLogging:!1}},t.allKillSwitches=Object.freeze({...i.extensionClientKillSwitchConfig,...a.rnClientKillSwitchConfig}),(0,o.initClientKillSwitch)(t.allKillSwitches,t.KILLSWITCHES_CONFIG)},448978:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.triggerMetaMaskSelected=t.triggerCoinbaseWalletSelected=t.useSelectProviderRequestScreenViewed=t.triggerWeb3RequestSendingCancelledResponse=t.triggerWeb3RequestConfirmButtonEnabled=t.triggerWeb3RequestSendingSuccessResponse=t.triggerWeb3RequestPermissionError=t.triggerWeb3RequestTxGenerationError=t.triggerWeb3RequestTxGenerationStart=t.triggerWeb3RequestShown=t.triggerWeb3RequestQueued=t.triggerWeb3RequestStartHandling=t.triggerWeb3Signout=t.triggerExtensionDappConnectionNetworkSwitched=t.triggerAuthorizationRequestDenyClicked=t.triggerAuthorizationRequestConnectClicked=t.useAuthorizationRequestScreenViewed=t.useTriggerTxApprovalLoaded=t.useWeb3InstructionTypeDataViewed=t.EVENTS=void 0;const r=n(160593),i=n(628656),a=n(395545);t.EVENTS={WEB3_REQUEST_START:"extension.web3_request.started",WEB3_REQUEST_QUEUED:"extension.web3_request.queued",WEB3_REQUEST_START_HANDLING:"extension.web3_request.start_handling",WEB3_REQUEST_PERMISSION_ERROR:"extension.web3_request.permission_error",WEB3_REQUEST_TX_GENERATION_START:"extension.web3_request.tx_generation_start",WEB3_REQUEST_TX_GENERATION_ERROR:"extension.web3_request.tx_generation_error",WEB3_REQUEST_SHOWN:"extension.web3_request.shown",WEB3_REQUEST_CONFIRM_BUTTON_ENABLED:"extension.web3_request.confirm_button_enabled",WEB3_REQUEST_SENDING_SUCCESS_RESPONSE:"extension.web3_request.sending_sucess",WEB3_REQUEST_SENDING_CANCELED_RESPONSE:"extension.web3_request.sending_canceled",WEB3_REQUEST_RESPONSE_HANDLED:"extension.web3_request.response_handled",WEB3_REQUEST_RESPONSE_NO_ID_ERROR:"extension.web3_request.no_id_error"},t.useWeb3InstructionTypeDataViewed=function(e){(0,r.useLogEventOnMount)("extension.web3_request.txn_instruction_info",{loggingId:"f95f5c40-8fbe-4e17-927d-f5f418ddf873",action:a.ActionType.view,componentType:a.ComponentType.page,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,instructionType:e.instructionType??""})},t.useTriggerTxApprovalLoaded=function(e){(0,r.useLogEventOnMount)("tx_approval_component_loaded",{loggingId:"2a43d290-d396-454d-b96d-aac2e7bba67a",action:a.ActionType.render,componentType:a.ComponentType.unknown,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,blockchain:e.blockchain??"",operationType:e.approveOperation?.operationType??""})},t.useAuthorizationRequestScreenViewed=function(e){(0,r.useLogEventOnMount)("extension.web3_request.authorization_request.viewed",{loggingId:"0f910c60-9be9-4c91-ab19-33779341d29c",action:a.ActionType.view,componentType:a.ComponentType.page,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,blockchain:e.blockchain??""})},t.triggerAuthorizationRequestConnectClicked=function(e){(0,r.logEvent)("extension.web3_request.authorization_request_connect.clicked",{loggingId:"9628669d-92de-4781-871a-e3637fe84175",action:a.ActionType.click,componentType:a.ComponentType.button,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,blockchain:e.blockchain??""},a.AnalyticsEventImportance.high)},t.triggerAuthorizationRequestDenyClicked=function(e){(0,r.logEvent)("extension.web3_request.authorization_request_deny.clicked",{loggingId:"11b3d956-eb05-4503-bd4b-cc554d4d9024",action:a.ActionType.click,componentType:a.ComponentType.button,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,blockchain:e.blockchain??""},a.AnalyticsEventImportance.high)},t.triggerExtensionDappConnectionNetworkSwitched=function(e){(0,r.logEvent)("extension.web3.dapp_connection.network_switched",{loggingId:"423cee41-7865-44a8-bb5c-f05dbf7cb3c7",action:a.ActionType.measurement,componentType:a.ComponentType.unknown,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,chainId:e.chainId??""})},t.triggerWeb3Signout=function(e){(0,r.logEvent)("extension.web3_request.signout",{loggingId:"8bf18b58-d913-415b-b574-ea4f9c3b5713",action:a.ActionType.click,componentType:a.ComponentType.button,dappURL:(0,i.getHostNameForDapp)(e.dappURL),request:e.request,blockchain:e.blockchain??"",walletType:e.walletType??""})},t.triggerWeb3RequestStartHandling=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_START_HANDLING,{loggingId:"2ced6103-4f12-4552-9b90-939e8431307f",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??""})},t.triggerWeb3RequestQueued=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_QUEUED,{loggingId:"0a42346e-ccf1-4abc-a9aa-ca2be2ede653",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL)})},t.triggerWeb3RequestShown=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_SHOWN,{loggingId:"536345ae-162d-4eeb-8c28-f60070666e8d",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??""})},t.triggerWeb3RequestTxGenerationStart=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_TX_GENERATION_START,{loggingId:"bbb96f58-aaf5-4b07-9def-f0fec9ed1502",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??"",...e.eventData})},t.triggerWeb3RequestTxGenerationError=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_TX_GENERATION_ERROR,{loggingId:"cc8ca40c-a6a9-4bf4-9ce5-d33e719768b4",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??"",...e.eventData})},t.triggerWeb3RequestPermissionError=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_PERMISSION_ERROR,{loggingId:"368d08c5-9000-4811-ac53-f54271eb2d81",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??""})},t.triggerWeb3RequestSendingSuccessResponse=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_SENDING_SUCCESS_RESPONSE,{loggingId:"3900edb6-2b06-4a42-b83d-d2fe73657518",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??"",...e.eventData},a.AnalyticsEventImportance.high)},t.triggerWeb3RequestConfirmButtonEnabled=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_CONFIRM_BUTTON_ENABLED,{loggingId:"42ad1cd5-fd18-4596-9cd0-e0355c8195d8",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),blockchain:e.blockchain??"",...e.eventData})},t.triggerWeb3RequestSendingCancelledResponse=function(e){(0,r.logDataEvent)(t.EVENTS.WEB3_REQUEST_SENDING_CANCELED_RESPONSE,{loggingId:"a191038d-225c-4234-b677-d14af4375035",request:e.request,dappURL:(0,i.getHostNameForDapp)(e.dappURL),errorMessage:e.errorMessage??"",errorName:e.errorName??"",blockchain:e.blockchain??""},a.AnalyticsEventImportance.high)},t.useSelectProviderRequestScreenViewed=function(e){(0,r.useLogEventOnMount)("extension.select_provider_request.viewed",{loggingId:"7d3f02cb-8391-4083-aa60-869111111456",action:a.ActionType.view,componentType:a.ComponentType.page,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request})},t.triggerCoinbaseWalletSelected=function(e){(0,r.logEvent)("extension.select_provider_request.coinbase_wallet_selected",{loggingId:"628758b5-654c-45ee-8898-ca2163119d05",action:a.ActionType.click,componentType:a.ComponentType.button,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request})},t.triggerMetaMaskSelected=function(e){(0,r.logEvent)("extension.select_provider_request.metamaskr_selected",{loggingId:"4c337ee6-8d98-48ff-a90b-b75bb2603cb2",action:a.ActionType.click,componentType:a.ComponentType.button,dapp:(0,i.getHostNameForDapp)(e.dappURL),request:e.request})}},688977:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ForceUpdateService=void 0;const r=n(97501),i=n(524264),a=n(713403),s=n(310666);t.ForceUpdateService=class{constructor(e,t){this.sendOrQueueEvent=e,this.serviceWorkerMemory=t}start(){this.checkForceUpdate().catch((e=>{(0,s.log)("Failed checking forced update ",e)})),chrome.alarms.create("checkForceUpdate",{periodInMinutes:(0,a.isProd)()?5:30}),chrome.alarms.onAlarm.addListener((e=>{"checkForceUpdate"===e.name&&(this.checkForceUpdate().catch((e=>{(0,s.log)("Failed checking forced update ",e)})),chrome.storage.local.get(["autoLockByUnixTimestamp"],(e=>{const t=e.autoLockByUnixTimestamp;void 0!==t&&t<Date.now()&&this.serviceWorkerMemory.clear()})))}))}async checkForceUpdate(){return new Promise(((e,t)=>{chrome.storage.local.get(["minimumVersion","hasForcedUpdate"],(async n=>{let i=n.minimumVersion;const a=n.hasForcedUpdate;try{if(i=await this.fetchMinimumVersion(),chrome.storage.local.set({minimumVersion:i}),!i)return this.setPopup("index.html?inPageRequest=false"),chrome.storage.local.set({hasForcedUpdated:!1}),a&&this.sendOrQueueEvent(r.EVENTS.FORCE_UPDATE_CLEARED,{loggingId:"7e5b0380-0d1b-4523-bc19-ebee4a987414"}),void e(!1)}catch(e){(0,s.log)(e)}const o=chrome.runtime.getManifest().version;if(!i||!o)return void t(new Error("Couldn't check minimum version"));if(!(this.compareVersion(i,o)>0))return this.setPopup("index.html?inPageRequest=false"),chrome.storage.local.set({hasForcedUpdated:!1}),a&&this.sendOrQueueEvent(r.EVENTS.FORCE_UPDATE_CLEARED,{loggingId:"7e5b0380-0d1b-4523-bc19-ebee4a987414",currentVersion:o,minimumVersion:i}),void e(!1);this.sendOrQueueEvent(r.EVENTS.FORCE_UPDATE,{loggingId:"0868c1f5-118d-405d-85cf-b2f201a87a48",currentVersion:o,minimumVersion:i}),this.setPopup("forceUpdate.html"),this.serviceWorkerMemory.clear(),chrome.storage.local.set({hasForcedUpdated:!0}),e(!0)}))}))}compareVersion(e,t){const n=e.split("."),r=t.split("."),i=e=>/^\d+$/.test(e);if(!n.every(i)||!r.every(i))return NaN;for(;n.length<r.length;)n.push("0");for(;r.length<n.length;)r.push("0");const a=n.map(Number),s=r.map(Number);for(let e=0;e<a.length;++e){if(a[e]>s[e])return 1;if(a[e]<s[e])return-1}return 0}async fetchMinimumVersion(){return fetch(`${i.CB_WALLET_API_URL}/rpc/v2/getMinimumSupportedBuilds`).then((async e=>{if(e.status<200||e.status>=400)throw new Error("Invalid response");const t=await e.json();return t?.result?.extension}))}setPopup(e){chrome.action.setPopup({popup:e})}}},791971:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerEventManager=void 0;const r=n(160593),i=n(410189),a=n(395545),s=n(524264),o=n(875651),c=n(713403),l=n(310666),u=n(519077),h=n(220652);t.ServiceWorkerEventManager=class{constructor(){this.hasInitializedAnalytics=!1,this.eventQueue=[],this.sendOrQueueEvent=this.sendOrQueueEvent.bind(this)}initializeAnalytics(e){(0,a.init)({amplitudeApiKey:s.CB_WALLET_AMPLITUDE_KEY,isProd:(0,c.isProd)(),platform:a.PlatformName.server,onError:e=>{(0,l.log)("Got error in analytics",e?.message)},projectName:"wallet_extension_service_worker",showDebugLogging:s.SHOW_CCA_LOGGING,version:(0,o.getAppVersion)()}),chrome.storage.local.get([h.ServiceWorkerStorageKey.amplitudeDeviceId],(t=>{let n=t[h.ServiceWorkerStorageKey.amplitudeDeviceId];if(!n&&e)n=(0,i.v4)(),chrome.storage.local.set({[h.ServiceWorkerStorageKey.amplitudeDeviceId]:n});else if(!n)return void chrome.storage.onChanged.addListener((e=>{const t=e[h.ServiceWorkerStorageKey.amplitudeDeviceId]?.newValue;t&&!this.hasInitializedAnalytics&&((0,a.identify)({deviceId:t}),this.hasInitializedAnalytics=!0,this.flushEventQueue())}));(0,a.identify)({deviceId:n}),this.hasInitializedAnalytics=!0,this.flushEventQueue()}))}flushEventQueue(){0!==this.eventQueue.length&&((0,l.log)(`Flushing ${this.eventQueue.length} events from the queue`),this.eventQueue.forEach((({eventName:e,eventProperties:t})=>{(0,r.logDataEvent)(e,{...t,...this.eventMetadata})})),this.eventQueue=[])}get eventMetadata(){const{vendor:e,version:t,major:n,userAgent:r}=(0,u.resolveNavigatorVersion)();return{appVersion:chrome.runtime.getManifest().version,browserVendor:e,browserVersionMajor:n,chromeVersion:t,userAgent:r}}sendOrQueueEvent(e,t){this.hasInitializedAnalytics?(0,r.logDataEvent)(e,{...t,...this.eventMetadata}):((0,l.log)(`Queueing event: ${e}`),this.eventQueue.push({eventName:e,eventProperties:t}))}}},392079:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serviceWorkerMemoryStore=void 0;const r=n(263678),i=n(86296),a=n(485599),s=n(394125),o=n(55446),c=n(414369);t.serviceWorkerMemoryStore=new class{constructor(){this.secret=a.Store.get(s.StoreKeys_serviceWorkerStorageSecret)??(0,r.randomBytesHex)(32),a.Store.set(s.StoreKeys_serviceWorkerStorageSecret,this.secret)}async timedPromise(e,t,n){return new Promise(((r,a)=>{let s=!1;setTimeout((()=>{s||(s=!0,(0,i.cbReportError)({error:new Error(`Timed out while reading/writing ${e} from Service Worker Storage.`),context:"service_worker",severity:"error",isHandled:!1}),a(void 0))}),t);n((t=>{s?(0,i.cbReportError)({error:new Error(`Tried to resolve result for ${e} in Service Worker Storage after timeout.`),context:"service_worker",severity:"warning",isHandled:!1}):(s=!0,r(t))}))}))}async get(e){return this.timedPromise(e,2e3,(t=>{chrome.runtime.sendMessage({type:c.SERVICE_WORKER_MEMORY_REQUEST,data:{key:e,action:"get"}},(e=>{if("string"!=typeof e)return t(void 0);(0,o.decrypt)(e,this.secret).then(t).catch((e=>t(void 0)))}))})).catch((()=>{}))}async set(e,t){const n=t?await(0,o.encrypt)(t,this.secret):void 0;return this.timedPromise(e,2e3,(t=>{chrome.runtime.sendMessage({type:c.SERVICE_WORKER_MEMORY_REQUEST,data:{key:e,action:"set",value:n}},(()=>t(!0)))})).catch((()=>!1))}async clear(){return new Promise((e=>{chrome.runtime.sendMessage({type:c.SERVICE_WORKER_MEMORY_REQUEST,data:{action:"clear"}},(t=>e(t)))}))}}},414369:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceWorkerMemoryStorageHandler=t.SERVICE_WORKER_MEMORY_REQUEST=void 0;const r=n(856790),i=n(503771);t.SERVICE_WORKER_MEMORY_REQUEST="serviceWorkerMemoryRequest";t.ServiceWorkerMemoryStorageHandler=class{constructor(){this.storage=new i.SessionStorage}handleRequest(e,t){switch(e.action){case"get":this.get(e.key).then((e=>t(e)));break;case"set":this.set(e.key,e.value).then((()=>t(!0)));break;case"clear":this.storage.clear().then((()=>t(!0)))}}clear(){this.storage.clear()}async set(e,t){const n=await this.getId(e);return void 0===t?this.storage.delete(n):this.storage.set(n,t)}async get(e){const t=await this.getId(e);return this.storage.get(t)}async getId(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return(0,r.uint8ArrayToHex)(new Uint8Array(n))}}},220652:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeprecatedServiceWorkerStorageKey=t.ServiceWorkerStorageKey=void 0,function(e){e.parentConnected="parentConnected",e.connectedDapps="connectedDapps",e.amplitudeDeviceId="amplitudeDeviceId",e.cachedExperiments="cachedExperiments",e.cachedDeviceExperiments="cachedDeviceExperiments",e.blockedDappWhitelist="blockedDappWhitelist",e.evmPhishingConfig="evmPhishingConfig",e.solanaPhishingConfig="solanaPhishingConfig",e.extensionWasUpdated="extensionWasUpdated",e.activeEthAddress="activeEthAddress",e.chainSwitchedDapp="chainSwitchedDapp",e.canSignViaExtension="canSignViaExtension",e.supportsSolana="supportsSolana",e.migrationIndex="migrationIndex",e.signoutIncomplete="signoutIncomplete"}(t.ServiceWorkerStorageKey||(t.ServiceWorkerStorageKey={})),function(e){e.isStandaloneSigning="isStandaloneSigning",e.signingDevice="signingDevice"}(t.DeprecatedServiceWorkerStorageKey||(t.DeprecatedServiceWorkerStorageKey={}))},503771:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=void 0;t.SessionStorage=class{constructor(){this.memoryStorage=new Map,this.delete=async e=>this.sessionApi?this.sessionApi.remove(e):(this.memoryStorage.delete(e),Promise.resolve()),"object"==typeof chrome.storage.session&&(this.sessionApi=chrome.storage.session)}async clear(){return this.sessionApi?chrome.storage.session.clear():(this.memoryStorage.clear(),Promise.resolve())}async get(e){if(this.sessionApi){return(await this.sessionApi.get(e))[e]}return Promise.resolve(this.memoryStorage.get(e))}async set(e,t){return this.sessionApi?this.sessionApi.set({[e]:t}):(this.memoryStorage.set(e,t),Promise.resolve())}}},325566:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletServiceWorker=t.dappConnectionRepository=void 0;const r=n(60397),i=n(478858),a=n(108389),s=n(552421),o=n(408027),c=n(305944),l=n(151886),u=n(822754),h=n(990656),d=n(628656),p=n(395545),m=n(193479),f=n(46668),y=n(151771),g=n(731648),_=n(441090),b=n(437168),v=n(790802),w=n(50953),E=n(448978),T=n(278163),S=n(639761),N=n(875651),A=n(713403),C=n(97501),x=n(310666),M=n(516755),R=n(163392),O=n(333770),I=n(640284),k=n(654484),P=n(486586),L=n(688977),D=n(791971),q=n(414369),B=n(220652),j=n(503771);t.dappConnectionRepository=new v.DappConnectionRepository;t.WalletServiceWorker=class{constructor(){this.initialState={callbackMap:{},currPopupTab:null,currPopupWin:null,originsMap:{},popupUIResponseMap:{},web3OriginTabId:null,injectedTabs:{}},this.cachedState=this.initialState,this.sessionState=new j.SessionStorage,this.stateMutex=new i.Mutex,this.stateKey="Coinbase/Wallet/WalletLinkService/State",this.checkingWindowLock=new i.Mutex,this.serviceWorkerMemory=new q.ServiceWorkerMemoryStorageHandler,this.hasStartedWindowOrTabOpen=!1,this.serviceWorkerEventManager=new D.ServiceWorkerEventManager}async initializeState(){try{const e=await this.sessionState.get(this.stateKey);e&&Object.assign(this.cachedState,e)}catch(e){(0,x.log)("Failed to initialize service worker state.",e)}}async initializeKillSwitches(){await(0,m.initClientKillSwitch)(s.extensionClientKillSwitchConfig,w.KILLSWITCHES_CONFIG)}get state(){return this.cachedState}setState(e){e(this.cachedState),this.stateMutex.runExclusive((async()=>{await this.sessionState.set(this.stateKey,this.cachedState)}))}async setupKeepAlive(){const e=chrome.runtime.getURL("index.html"),t=new RegExp(`^(https?:|${e})`),n=new Map;function r(e){const t=()=>{chrome.runtime.connect({name:"keepAlive"}).onDisconnect.addListener((()=>{"Could not establish connection. Receiving end does not exist."!==chrome.runtime.lastError?.message?t():((...t)=>{e||console.log(...t)})("Had last error indicating a connection error happened, stopping keep alive")}))};t()}async function i(...e){await Promise.all(e.map((async({id:e,url:t})=>{if(void 0!==e)try{(0,x.log)(`Registering keepAlive for tab ${e}`),await chrome.scripting.executeScript({target:{tabId:e},func:r,args:[(0,A.isProd)()]}),t&&n.set(e,t)}catch(t){(0,x.log)(`Could not reconnect keepalive port for tab with tabId ${e}`,t)}else(0,x.log)("Could not reconnect keepalive port for tab with undefined id")})))}const a=await chrome.tabs.query({url:[e,"http://*/*","https://*/*"]});await i(...a),chrome.tabs.onUpdated.addListener((function(e,r,a){(t.test(r.url??"")||"loading"===r.status&&n.get(e)===a.url)&&async function(e){if(chrome.runtime.lastError)return void(0,x.log)(`Could not reconnect tab with tabId ${e.id} \u2014 it has likely been closed.`,chrome.runtime.lastError);await i(e)}(a)})),chrome.runtime.onConnect.addListener((e=>{"keepAlive"===e.name&&setTimeout((()=>e.disconnect()),25e4)}))}async onTabActivated(e){await this.injectProviderContentScriptsIntoTab(e.tabId)}async logCpuUsage(e){if(!(0,P.systemCpuPermissionEnabled)())return;const t=await(0,P.collectCpuUsage)();"number"==typeof t&&this.serviceWorkerEventManager.sendOrQueueEvent(e,{usedCpuInfo:t})}async start(){if(await this.logCpuUsage(C.EVENTS.CPU_INFO_SERVICE_WORKER_STARTED),await Promise.allSettled([this.initializeState(),this.initializeKillSwitches(),(0,O.migrateStorage)({eventMessenger:this.serviceWorkerEventManager.sendOrQueueEvent})]),this.onTabActivated=this.onTabActivated.bind(this),chrome.tabs.onActivated.addListener(this.onTabActivated),chrome.tabs.onRemoved.addListener((e=>{this.setState((t=>{t.injectedTabs[e]=[]}))})),this.setupKeepAlive().catch((e=>(0,x.log)("FAILED while setting up keepAlive",e))),(0,h.setApplicationMetadata)({version:(0,N.getAppVersion)(),platform:p.PlatformName.extension}),!T.isSingletonServiceWorker)return;new L.ForceUpdateService(this.serviceWorkerEventManager.sendOrQueueEvent,this.serviceWorkerMemory).start(),chrome.runtime.onMessage.addListener(((e,t,n)=>{let r,i;switch(e.type){case"extensionUIRequest":return n(),void 0===t.tab?.id||void 0===t.tab.url||void 0===t.tab.title?((0,x.log)("Skipping message, sender tab not specified"),void this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.UNSPECIFIED_SENDER_TAB,{loggingId:"53b228aa-c93f-4c21-8648-7e4fa55acd61"})):new URL(t.tab.url).origin!==e.data.origin?(this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.DAPP_ORIGIN_MISMATCH,{loggingId:"53b228aa-c93f-4c21-8648-7e4fa55acd61",senderUrl:new URL(t.tab.url).origin,messageOrigin:e.data.origin}),void this.handleExtensionUIRequestEvent({event:e,tabId:t.tab?.id,dappName:e.data.dappInfo?.frameTitle,dappLogoURL:(0,l.getFavicon)({url:e.data.origin,faviconQuality:64}),dappLogoURLAlt:void 0,dappURL:e?.data.origin,hasMultipleProviders:Boolean(e.data.hasMultipleProviders)})):(r=e?.data.dappInfo.dappLogoURL,i=t?.tab.favIconUrl,void this.handleExtensionUIRequestEvent({event:e,tabId:t.tab?.id,dappName:t.tab.title,dappLogoURL:r,dappLogoURLAlt:i,dappURL:t.tab.url,hasMultipleProviders:Boolean(e.data.hasMultipleProviders)}));case"extensionUIResponse":return n(),this.handlePopupResponseEvent(e),!1;case"popupUIRequest":return n(this.state.popupUIResponseMap[e.data.id]),!0;case q.SERVICE_WORKER_MEMORY_REQUEST:return this.serviceWorkerMemory.handleRequest(e.data,n),!0;case"saveDomainsRequest":{const r=[...e.data],{url:i}=t,a=(0,d.getHostNameForDapp)(i||"",!0);a&&!r.includes(a)&&r.push(a);const s={domains:r,url:i||""},o=t.tab?.id;return o?(this.setState((e=>{e.originsMap[o]=s})),n(s)):n(null),!0}case"updateActiveEthAddress":return chrome.storage.local.set({[B.ServiceWorkerStorageKey.activeEthAddress]:e.data.address}),!1;case"switchAddress":return chrome.tabs.query({active:!0,currentWindow:!0},(t=>{t[0]?.id&&(e.data.provider===u.EVM_PROVIDER_ID&&chrome.storage.local.set({[B.ServiceWorkerStorageKey.activeEthAddress]:e.data.addresses[0]}),chrome.tabs.sendMessage(t[0].id,{type:"switchAddress",provider:e.data.provider,addresses:e.data.addresses}))})),!1;case"unloadDomainsRequest":{const e=t.tab?.id||0,r=this.state.originsMap[e];return this.setState((t=>{delete t.originsMap[e]})),n(r),!0}case"getDomainsFromBrowserRequest":{const t={domains:[],url:""};if(e.data?.tabId)return n(this.state.originsMap[e.data.tabId]||t),!0;if(this.state.web3OriginTabId){const r=this.state.originsMap[this.state.web3OriginTabId]??t,i=[];let a=r.url;const s=e.data?.triggeringRequestId;if(s){const e=this.state.popupUIResponseMap[s],t=e?.data?.dappInfo?.dappURL;if(e?.data?.originTab===this.state.web3OriginTabId&&t){const e=(0,d.getHostNameForDapp)(t);i.push(e),a=t}}const o=[...r.domains,...i];return n({...{...r,url:a,domains:o},web3OriginTabId:this.state.web3OriginTabId}),!0}return n(t),!0}case"checkUrlWithBlocklist":return(0,c.fetchIsKillSwitchKilled)("kill_blocklist_integration_extension").then((t=>{if(t)n(void 0);else{const t=e.data;(0,o.fetchDataFromBlocklist)({domains:[t],appOrigin:t},o.DappSource.SERVICE_WORKER).then((e=>{e?e.result.length?(this.serviceWorkerEventManager.sendOrQueueEvent("blocklist.local_hit_blocklist_hit",{loggingId:"ebbb1a19-762d-48e7-ad27-a94d8b933e5b",dappUrl:t}),n(!0)):(this.serviceWorkerEventManager.sendOrQueueEvent("blocklist.local_hit_blocklist_miss",{loggingId:"0f5f81c5-23c6-4f2b-82cb-feab3d308912",dappUrl:t}),n(!1)):n(!1)}))}})),!0;default:return(0,x.log)(`Unknown message ${e.type}`),this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.UNKNOWN_MESSAGE_TYPE,{loggingId:"e706cd24-59a0-4edb-8171-7c6706620046",type:e.type}),n(),!1}})),chrome.runtime.onConnect.addListener((e=>{"extensionUIRequest"===e.name&&(this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.CONNECTED,{loggingId:"2b0641f6-28bc-4738-bdc5-3a0c9150db3e"}),(0,x.log)("connected ",e),e.onMessage.addListener(x.log))})),chrome.runtime.onSuspend.addListener((()=>{(0,x.log)("SUSPEND EVENT"),this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.SUSPEND,{loggingId:"26d0494e-d498-46d5-88aa-13f93ee5d0c8"})})),chrome.runtime.onInstalled.addListener((e=>{switch((0,x.log)("INSTALL EVENT"),e.reason){case"install":this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.INSTALLED,{loggingId:"3429023f-801a-4827-91ec-ee42c8311709"});break;case"update":this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.UPDATED,{loggingId:"2ae9b9c8-fbd8-4558-8dfe-a4f817f9965b"}),chrome.storage.local.set({[B.ServiceWorkerStorageKey.extensionWasUpdated]:!0});break;case"chrome_update":this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.CHROME_UPDATE,{loggingId:"d193911b-0f9c-4361-8eaf-e28e5209d844"})}if("install"!==e.reason)return;chrome.tabs.create({url:chrome.runtime.getURL("index.html?launchedForOnboarding=true")})})),this.listenForTabsClosingAndCancelWeb3Request();const e=e=>{};chrome.windows.onRemoved.addListener(e),chrome.windows.onRemoved.removeListener(e),this.serviceWorkerEventManager.initializeAnalytics(!0),await this.registerProviderContentScripts(),await this.injectProviderContentScriptsIntoActiveTab(),await this.logCpuUsage(C.EVENTS.CPU_INFO_SERVICE_WORKER_IDLE),(0,P.systemCpuPermissionEnabled)()&&setInterval((async()=>this.logCpuUsage(C.EVENTS.CPU_INFO_SERVICE_WORKER_INTERVAL)),3e5)}handlePopupResponseEvent(e){if((0,x.log)(e),void 0===e.data.id)return(0,x.log)("Undefined id in service worker response handler"),void this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.UNDEFINED_POPUP_EVENT_RESPONSE,{loggingId:"f72476d3-9f7b-4de9-be09-68ecc91a7ed3"});const t=this.state.callbackMap[e.data.id],n=t?.tabId,r=t?.action;if(void 0===n)return(0,x.log)("Couldn't find original tab to send response to"),void this.serviceWorkerEventManager.sendOrQueueEvent(C.EVENTS.NO_ORIGINAL_TAB,{loggingId:"c3ce9894-b206-4d09-a1e3-658f5d448b3d"});if(this.setState((t=>{delete t.callbackMap[e.data.id]})),chrome.tabs.sendMessage(n,e),r!==g.ExtensionConnectionRequest.requestEthereumAccounts&&r!==g.ExtensionConnectionRequest.selectProvider)return;const i=[];for(const t of Object.keys(this.state.callbackMap)){this.state.callbackMap[t].tabId===n&&((0,x.log)(`Also sending event ${e} to tab ${n}`),chrome.tabs.sendMessage(n,{...e,data:{...e.data,id:t}}),i.push(t))}this.setState((e=>{i.forEach((t=>delete e.callbackMap[t]))}))}async handleExtensionUIRequestEvent({event:e,tabId:t,dappName:n,dappLogoURL:r,dappLogoURLAlt:i,dappURL:a,hasMultipleProviders:s}){if(await this.checkIfWindowIsClosedAndClearCurrPopupWindow(),!e.data.id)return void(0,x.log)("Undefined id in service worker request handler");if(this.state.callbackMap[e.data.id])return void(0,x.log)("This event is already in the service worker callback map");if(a.startsWith("chrome-extension://"))throw Error("The service worker is handling an extension ui request from the extension itself, shouldn't happen");if(void 0===e.data.action)return void(0,x.log)("Undefined action in service worker script");const o=Object.values(this.state.callbackMap).find((e=>e.tabId===t))?.tabId;if(this.setState((n=>{n.callbackMap[e.data.id]={tabId:t,action:e.data.action}})),void 0!==o&&[g.ExtensionConnectionRequest.requestEthereumAccounts,g.ExtensionConnectionRequest.selectProvider,y.ExtensionConnectionRequest.getAllAddresses].includes(e.data.action)){if(this.state.currPopupWin)return(0,x.log)("skipping starting UI since window already exists"),void chrome.windows.update(this.state.currPopupWin,{focused:!0});if(this.state.currPopupTab)return(0,x.log)("skipping starting UI since tab already exists"),void chrome.tabs.update(this.state.currPopupTab,{highlighted:!0})}let l=I.getPopupResponseData;if((0,R.isValidRequestAction)(e.data.action))l=R.getPopupResponseData;else if((0,k.isValidRequestAction)(e.data.action,e.provider)){if(await(0,c.fetchIsKillSwitchKilled)("kill_solana_web3_extension"))return this.handlePopupResponseEvent({type:"extensionUIResponse",data:{id:e.data.id,action:f.SolanaWeb3Response.featureFlagOff,error:new Error("Feature flag is off")}});l=k.getPopupResponseData}else(0,M.isValidRequestAction)(e.data.action)&&(l=M.getPopupResponseData);const u={...l(e),dappInfo:{dappName:n,dappLogoURL:r,dappLogoURLAlt:i,dappURL:a},provider:e.provider,originTab:t};if("switchEthereumChain"===u.action)return this.switchEthereumChain(u),!0;this.makePopupRequest(e.data.action,{type:"extensionUIRequest",data:u},s,e.data.id,t)}async switchEthereumChain(e){await t.dappConnectionRepository.updateChainIdForHost({...e.dappInfo,...e.address&&{connectedAddress:e.address.toLocaleLowerCase()},overriddenChainId:e.chainId}).toPromise(),(0,E.triggerExtensionDappConnectionNetworkSwitched)({dappURL:e.dappInfo.dappURL,request:"switchEthereumChain",chainId:e.chainId}),this.handlePopupResponseEvent({type:"extensionUIResponse",data:{id:e.id,action:_.ExtensionConnectionResponse.switchEthereumChainApprove,chainId:e.chainId,blockchain:a.ETHEREUM_SYMBOL}})}async makePopupRequest(e,t,n,r,i,a){const s=await chrome.windows.getCurrent();let o,c;if(this.setState((e=>{e.web3OriginTabId=i})),void 0!==s?.width&&void 0!==s.left&&void 0!==s.top){const e=n?0:-296;o=s.width+s.left+e,c=s.top}else o=0,c=0;const l="fullscreen"===s.state;if((0,x.log)(`Checking if full screen ${l}`),this.setState((e=>{e.popupUIResponseMap[r]=t})),(this.state.currPopupTab||this.state.currPopupWin||this.hasStartedWindowOrTabOpen)&&Object.keys(this.state.callbackMap).length>1){if(chrome.runtime.sendMessage(t),this.state.currPopupWin)return void chrome.windows.update(this.state.currPopupWin,{focused:!0});if(this.state.currPopupTab)return void chrome.tabs.update(this.state.currPopupTab,{highlighted:!0})}const u=`index.html?inPageRequest=true&type=extensionUIRequest&action=${encodeURIComponent(e)}&id=${encodeURIComponent(r)}${a?`&step=${encodeURIComponent(a)}`:""}`;if(l){const e=`${u}&fullScreen=true`;this.hasStartedWindowOrTabOpen=!0,chrome.tabs.create({url:chrome.runtime.getURL(e)},(e=>{this.hasStartedWindowOrTabOpen=!1,this.setState((t=>{void 0!==e?.id&&(t.currPopupTab=e.id)}))}))}else{this._windowListenerCancelCallback?.(),this._windowListenerCancelCallback=void 0;const e=await this.checkingWindowLock.acquire();this.hasStartedWindowOrTabOpen=!0,chrome.windows.create({url:chrome.runtime.getURL(u),type:"popup",left:o,top:c,height:625,width:375},(t=>{e(),this._windowListenerCancelCallback=this.listenForWindowsClosingAndCancelWeb3Request(),this.hasStartedWindowOrTabOpen=!1,this.setState((e=>{void 0!==t?.id&&(e.currPopupWin=t.id)}))}))}}handleClosingAndCancelWeb3Request(){this.setState((e=>{e.currPopupTab=null}));const e=[];for(const t of Object.keys(this.state.callbackMap))chrome.tabs.sendMessage(this.state.callbackMap[t].tabId,{type:"extensionUIResponse",data:{id:t,action:b.WalletLinkExtensionConnectionResponse.web3RequestCanceled,error:(0,r.serializeError)(r.standardErrors.provider.userRejectedRequest({}))}}),e.push(t);this.setState((t=>{e.forEach((e=>delete t.callbackMap[e]))}))}listenForTabsClosingAndCancelWeb3Request(){chrome.tabs.onRemoved.addListener((e=>{e===this.state.currPopupTab&&this.handleClosingAndCancelWeb3Request()}))}async checkIfWindowIsClosedAndClearCurrPopupWindow(){const e=await this.checkingWindowLock.acquire(),t=await chrome.windows.getAll();if(e(),!this._windowListenerCancelCallback)return;t.find((e=>e.id===this.state.currPopupWin))||(this._windowListenerCancelCallback?.(),this._windowListenerCancelCallback=void 0,this.setState((e=>{e.currPopupWin=null})))}listenForWindowsClosingAndCancelWeb3Request(){let e=!1;return setTimeout((async()=>{if(!this.state.currPopupWin||e)return e=!0,void(this._windowListenerCancelCallback=void 0);const t=await this.checkingWindowLock.acquire(),n=await chrome.windows.getAll();if(t(),e)return;n.find((e=>e.id===this.state.currPopupWin))||(e=!0,this._windowListenerCancelCallback=void 0,this.handleClosingAndCancelWeb3Request()),this.listenForWindowsClosingAndCancelWeb3Request()}),5e3),()=>{e=!0}}async injectProviderContentScriptsIntoActiveTab(){const e=await this.getActiveTab();"number"==typeof e?.id?await this.injectProviderContentScriptsIntoTab(e.id):(0,x.log)("FAILED while injecting provider content scripts into active tab. No injectable active tab id.")}async injectProviderContentScriptsIntoTab(e){await this.injectScriptIntoTab(S.CONTENT_SCRIPTS.CoinbaseContent,e),await this.injectScriptIntoTab(S.CONTENT_SCRIPTS.CoinbaseRequestProvider,e),await this.injectScriptIntoTab(S.CONTENT_SCRIPTS.CoinbaseWalletDappProvider,e),chrome.storage.local.get([B.ServiceWorkerStorageKey.supportsSolana],(t=>{const n="true"===t[B.ServiceWorkerStorageKey.supportsSolana];n&&this.injectSolanaProviderContentScript(n,e)})),chrome.storage.onChanged.addListener((t=>{const n=t[B.ServiceWorkerStorageKey.supportsSolana];if(void 0!==n){const t="true"===n.newValue;this.injectSolanaProviderContentScript(t,e)}}))}async injectSolanaProviderContentScript(e,t){e?await this.injectScriptIntoTab(S.CONTENT_SCRIPTS.CoinbaseSolanaProvider,t):await this.injectScriptIntoTab(S.CONTENT_SCRIPTS.CoinbaseSolanaProviderCleanup,t)}async registerProviderContentScripts(){await this.registerContentScript(S.CONTENT_SCRIPTS.CoinbaseContent),await this.registerContentScript(S.CONTENT_SCRIPTS.CoinbaseRequestProvider),await this.registerContentScript(S.CONTENT_SCRIPTS.CoinbaseWalletDappProvider),await new Promise((e=>{chrome.storage.local.get([B.ServiceWorkerStorageKey.supportsSolana],(t=>{const n="true"===t[B.ServiceWorkerStorageKey.supportsSolana];n?this.registerSolanaProviderContentScript(n).then(e):e()}))})),chrome.storage.onChanged.addListener((e=>{const t=e[B.ServiceWorkerStorageKey.supportsSolana];if(void 0!==t){const e="true"===t.newValue;this.registerSolanaProviderContentScript(e)}}))}async registerSolanaProviderContentScript(e){return e?this.registerContentScript(S.CONTENT_SCRIPTS.CoinbaseSolanaProvider,S.CONTENT_SCRIPTS.CoinbaseSolanaProviderCleanup):this.registerContentScript(S.CONTENT_SCRIPTS.CoinbaseSolanaProviderCleanup,S.CONTENT_SCRIPTS.CoinbaseSolanaProvider)}async getActiveTab(){const e={active:!0,lastFocusedWindow:!0,url:S.INJECTABLE_TABS},[t]=await chrome.tabs.query(e);return t}async injectScriptIntoTab(e,t){if(e?.js&&t)if(this.state.injectedTabs[t]?.includes(e.id))(0,x.log)(`Skipping injecting ${e.id} into tab ${t}, already injected`);else{(0,x.log)(`Injecting ${e.id} into tab ${t}`);try{await chrome.scripting.executeScript({files:e.js,world:e.world,injectImmediately:!0,target:{tabId:t,allFrames:e.allFrames}}),this.setState((n=>{const r=n.injectedTabs[t]??[];r.push(e.id),n.injectedTabs[t]=r}))}catch(n){(0,x.log)(`FAILED while injecting ${e.id} into tab ${t}`,n)}}else(0,x.log)(`FAILED while injecting ${e?.id} into tab ${t}. Missing js or tab id.`)}async registerContentScript(e,t){const n=await chrome.scripting.getRegisteredContentScripts(),r=t&&n.find((e=>e.id===t.id)),i=n.find((t=>t.id===e.id));r&&((0,x.log)(`Deregistering content script ${t.id}`),await chrome.scripting.unregisterContentScripts({ids:[t.id]})),i?((0,x.log)(`Updating content script ${e.id}`),await chrome.scripting.updateContentScripts([e])):((0,x.log)(`Registering content script ${e.id}`),await chrome.scripting.registerContentScripts([e]))}}},486586:(e,t)=>{"use strict";function n(){return"function"==typeof chrome.system?.cpu?.getInfo}Object.defineProperty(t,"__esModule",{value:!0}),t.collectCpuUsage=t.systemCpuPermissionEnabled=void 0,t.systemCpuPermissionEnabled=n;let r=0,i=0;t.collectCpuUsage=async function(){if(!n())return;const e=(await chrome.system.cpu.getInfo())?.processors;if("number"!=typeof e?.length||0===e?.length)return;const{totalUsedCpuTime:t,totalCpuTime:a}=e.reduce(((e,t)=>{const n=t.usage.user+t.usage.kernel,r=t.usage.total;return{totalUsedCpuTime:e.totalUsedCpuTime+n,totalCpuTime:e.totalCpuTime+r}}),{totalUsedCpuTime:0,totalCpuTime:0}),s=(t-r)/(a-i);return r=t,i=a,s}},516755:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidRequestAction=t.getPopupResponseData=void 0;const r=n(151771),i=[r.ExtensionConnectionRequest.getAllAddresses];t.getPopupResponseData=function(e){if(e.data.action===r.ExtensionConnectionRequest.getAllAddresses)return function(e){return{action:r.ExtensionConnectionRequest.getAllAddresses,id:e.data.id,childSession:e.data.childSession}}(e)},t.isValidRequestAction=function(e){return i.includes(e)}},163392:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValidRequestAction=t.getPopupResponseData=void 0;const r=n(731648),i=[r.ExtensionConnectionRequest.requestEthereumAccounts,r.ExtensionConnectionRequest.addEthereumChain,r.ExtensionConnectionRequest.switchEthereumChain,r.ExtensionConnectionRequest.watchAsset,r.ExtensionConnectionRequest.selectProvider,"signEthereumMessage","signEthereumTransaction","submitEthereumTransaction"];t.getPopupResponseData=function(e){switch(e.data.action){case r.ExtensionConnectionRequest.requestEthereumAccounts:return function(e){return{action:r.ExtensionConnectionRequest.requestEthereumAccounts,id:e.data.id,childSession:e.data.childSession}}(e);case r.ExtensionConnectionRequest.addEthereumChain:return function(e){return{action:r.ExtensionConnectionRequest.addEthereumChain,id:e.data.id,chainId:e.data.chainId,rpcUrls:e.data.rpcUrls,blockExplorerUrls:e.data.blockExplorerUrls,chainName:e.data.chainName,iconUrls:e.data.iconUrls,nativeCurrency:e.data.nativeCurrency}}(e);case r.ExtensionConnectionRequest.switchEthereumChain:return function(e){return{action:r.ExtensionConnectionRequest.switchEthereumChain,id:e.data.id,chainId:e.data.chainId,...e.data.address&&{address:e.data.address}}}(e);case r.ExtensionConnectionRequest.selectProvider:return function(e){return{action:r.ExtensionConnectionRequest.selectProvider,id:e.data.id,selectedProviderKey:e.data.selectedProviderKey}}(e);case r.ExtensionConnectionRequest.watchAsset:return function(e){return{action:r.ExtensionConnectionRequest.watchAsset,id:e.data.id,type:e.data.type,chainId:e.data.chainId,options:{address:e.data.options.address,symbol:e.data.options.symbol,decimals:e.data.options.decimals,image:e.data.options.image}}}(e);case"signEthereumMessage":case"signEthereumTransaction":case"submitEthereumTransaction":return function(e){return{action:e.data.action,id:e.data.id,request:e.data.request}}(e);default:return}},t.isValidRequestAction=function(e){return i.includes(e)}},278163:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSingletonServiceWorker=void 0,t.isSingletonServiceWorker="undefined"==typeof localStorage},333770:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateStorage=void 0;const r=n(97501),i=n(220652),a=n(623242);async function s({fromKey:e,toKey:t,transformer:n}){const r=(await chrome.storage.local.get([e]))[e];if(void 0===r)return;const i=n(r);await chrome.storage.local.set({[t]:i}),await chrome.storage.local.remove([e])}t.migrateStorage=async function({eventMessenger:e}){try{const t=(await chrome.storage.local.get([i.ServiceWorkerStorageKey.migrationIndex]))[i.ServiceWorkerStorageKey.migrationIndex],n=void 0!==t?a.migrations.slice(Number(t)+1):a.migrations;if(n.length<1)return;for(const e of n)try{await s(e)}catch(t){throw new Error(`migration ${e.id} failed while trying to migrate ${e.fromKey} to ${e.toKey}`)}await chrome.storage.local.set({[i.ServiceWorkerStorageKey.migrationIndex]:a.migrations.length-1}),e(r.EVENTS.STORAGE_MIGRATION_SUCCESS,{loggingId:"e8e03da9-b928-4a18-a8eb-3e4971c454e0",numberOfOperations:n.length})}catch(t){e(r.EVENTS.STORAGE_MIGRATION_FAILED,{loggingId:"339e93a5-062d-40e5-a97b-9674f0930708",errorMessage:t?.message})}}},623242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrations=void 0;const r=n(220652),i=n(78818);t.migrations=[{id:1,fromKey:r.DeprecatedServiceWorkerStorageKey.signingDevice,toKey:r.ServiceWorkerStorageKey.supportsSolana,transformer:e=>String([i.SigningDevice.standalone,i.SigningDevice.ledger].includes(e))},{id:2,fromKey:r.DeprecatedServiceWorkerStorageKey.isStandaloneSigning,toKey:r.ServiceWorkerStorageKey.canSignViaExtension,transformer:e=>e}].sort(((e,t)=>e.id-t.id))},640284:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPopupResponseData=void 0;const r=n(288619);t.getPopupResponseData=function(e){if(e.data.action===r.WalletLinkExtensionConnectionRequest.troubleshootConnection)return function(e){return{action:r.WalletLinkExtensionConnectionRequest.troubleshootConnection,id:e.data.id,childSession:e.data.childSession}}(e)}},654484:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPopupResponseData=t.isValidRequestAction=void 0;const r=n(885197),i=n(608814),a=[i.SolanaWeb3Method.connect,i.SolanaWeb3Method.signMessage,i.SolanaWeb3Method.signTransaction,i.SolanaWeb3Method.signAllTransactions,i.SolanaWeb3Method.sendTransaction];t.isValidRequestAction=function(e,t){return t===r.SOLANA_PROVIDER_ID&&a.includes(e)},t.getPopupResponseData=function(e){switch(e.data.action){case i.SolanaWeb3Method.connect:return function(e){return{action:i.SolanaWeb3Method.connect,id:e.data.id}}(e);case i.SolanaWeb3Method.signMessage:return function(e){return{action:i.SolanaWeb3Method.signMessage,id:e.data.id,request:{method:i.SolanaWeb3Method.signMessage,params:{message:e.data.request.message,address:e.data.request.address}}}}(e);case i.SolanaWeb3Method.signTransaction:return function(e){return{action:i.SolanaWeb3Method.signTransaction,id:e.data.id,request:{method:i.SolanaWeb3Method.signTransaction,params:{transactions:e.data.request.transactions}}}}(e);case i.SolanaWeb3Method.signAllTransactions:return function(e){return{action:i.SolanaWeb3Method.signAllTransactions,id:e.data.id,request:{method:i.SolanaWeb3Method.signAllTransactions,params:{transactions:e.data.request.transactions}}}}(e);case i.SolanaWeb3Method.sendTransaction:return function(e){return{action:i.SolanaWeb3Method.sendTransaction,id:e.data.id,request:{method:i.SolanaWeb3Method.sendTransaction,params:{transactions:e.data.request.transactions,options:e.data.request.options}}}}(e);default:return}}},639761:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTENT_SCRIPTS=t.INJECTABLE_TABS=void 0,t.INJECTABLE_TABS=["https://*/*","http://localhost/*","http://127.0.0.1/*","http://0.0.0.0/*"],t.CONTENT_SCRIPTS=Object.freeze({CoinbaseContent:{allFrames:!0,id:"CoinbaseContent",js:["content.js"],matches:t.INJECTABLE_TABS,runAt:"document_start",world:"ISOLATED"},CoinbaseRequestProvider:{allFrames:!0,id:"CoinbaseRequestProvider",js:["requestProvider.js"],matches:t.INJECTABLE_TABS,runAt:"document_start",world:"MAIN"},CoinbaseSolanaProvider:{allFrames:!0,id:"CoinbaseSolanaProvider",js:["requestSolanaProvider.js"],matches:t.INJECTABLE_TABS,runAt:"document_start",world:"MAIN"},CoinbaseSolanaProviderCleanup:{allFrames:!0,id:"CoinbaseSolanaProviderCleanup",js:["requestSolanaProviderCleanup.js"],matches:t.INJECTABLE_TABS,runAt:"document_start",world:"MAIN"},CoinbaseWalletDappProvider:{allFrames:!0,id:"CoinbaseWalletDappProvider",js:["injectCoinbaseWalletDappProvider.js"],matches:["http://localhost:3000/*","https://dapp-dev.cbhq.net/*","https://dapp-staging.cbhq.net/*"],runAt:"document_start",world:"MAIN"}})},55446:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=t.hexStringToUint8Array=void 0;const r=n(856790);function i(e){return new Uint8Array(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))}t.hexStringToUint8Array=i,t.encrypt=async function(e,t){if(64!==t.length)throw Error("secret must be 256 bits");const n=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.importKey("raw",i(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),s=new TextEncoder,o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},a,s.encode(e)),c=o.slice(o.byteLength-16),l=o.slice(0,o.byteLength-16),u=new Uint8Array(c),h=new Uint8Array(l),d=new Uint8Array([...n,...u,...h]);return(0,r.uint8ArrayToHex)(d)},t.decrypt=async function(e,t){if(64!==t.length)throw Error("secret must be 256 bits");return new Promise(((n,r)=>{(async()=>{const a=await crypto.subtle.importKey("raw",i(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),s=i(e),o=s.slice(0,12),c=s.slice(12,28),l=s.slice(28),u=new Uint8Array([...l,...c]),h={name:"AES-GCM",iv:new Uint8Array(o)};try{const e=await window.crypto.subtle.decrypt(h,a,u),t=new TextDecoder;n(t.decode(e))}catch(e){r(e)}})()}))}},524264:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SOLANA_RPC_URL=t.SNOWTRACE_API_KEY=t.SHOW_CCA_LOGGING=t.RELEASE_ENVIRONMENT=t.POLYGONSCAN_API_KEY=t.OPTIMISM_API_KEY=t.NODE_ENV=t.KILL_SWITCH_ENDPOINT=t.FUNCTIONAL_TEST=t.FANTOMSCAN_API_KEY=t.ETHERSCAN_API_KEY=t.DETAILED_ERRORS=t.COINBASE_PUBLIC_SPRIG_ENV_ID=t.CB_WALLET_PUBLIC_URL=t.CB_WALLET_API_URL=t.CB_WALLET_AMPLITUDE_KEY=t.CB_API_URL=t.CBPAY_ID=t.BUGSNAG_SESSIONS_ENDPOINT=t.BUGSNAG_ENDPOINT=t.BUGSNAG_API_KEY=t.BSCSCAN_API_KEY=t.ARBISCAN_API_KEY=t.ANALYTICS_DISABLE_DEBUG_LOGGING=void 0;const r=n(340674);t.ANALYTICS_DISABLE_DEBUG_LOGGING=(0,r.yn)("false"),t.ARBISCAN_API_KEY="8EIAPIHN5S47JM7AD65UCVPGQWGZ38G7AJ",t.BSCSCAN_API_KEY="T8BK2SDU3I3JXKWCFAPVRFQDHKV5MACHWC",t.BUGSNAG_API_KEY="7b7f976839bca236e8d53c1de922f416",t.BUGSNAG_ENDPOINT="https://exceptions.coinbase.com",t.BUGSNAG_SESSIONS_ENDPOINT="https://sessions.coinbase.com",t.CBPAY_ID="36b7972f-b87f-4c13-a313-1b00db0212ec",t.CB_API_URL="https://api.coinbase.com",t.CB_WALLET_AMPLITUDE_KEY="4b5c59547a46317aee88399fdfc8f1f3",t.CB_WALLET_API_URL="https://api.wallet.coinbase.com",t.CB_WALLET_PUBLIC_URL="https://wallet.coinbase.com",t.COINBASE_PUBLIC_SPRIG_ENV_ID="SaAnIkWLlWzc",t.DETAILED_ERRORS=(0,r.yn)("false"),t.ETHERSCAN_API_KEY="GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",t.FANTOMSCAN_API_KEY="33A9K22PIJJEQT28HYD7JIWQHQ7AHC1TFF",t.FUNCTIONAL_TEST="MISSING_ENV_VAR".FUNCTIONAL_TEST,t.KILL_SWITCH_ENDPOINT="https://api.coinbase.com",t.NODE_ENV="production",t.OPTIMISM_API_KEY="3AC76IGUZCFP2ABUNPGAY8PJSPRAFJYHEF",t.POLYGONSCAN_API_KEY="N1QTECUKT25H7R5H1EGHAXUIG7SRT8BUYY",t.RELEASE_ENVIRONMENT="production",t.SHOW_CCA_LOGGING=(0,r.yn)("false"),t.SNOWTRACE_API_KEY="S1UPXSUGI2Z7TBZN2MZCMZBW2HP3DZ1B4G",t.SOLANA_RPC_URL="https://sol-mainnet.wallet.coinbase.com"},875651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppVersion=void 0;const r=n(540567);t.getAppVersion=function(){const e=chrome.runtime.getManifest().version;return(0,r.isPublicRelease)()?e:(0,r.isCorpRelease)()?`corp-${e}`:(0,r.isQABuild)()?`qa-${e}`:"local"}},856790:(e,t,n)=>{"use strict";var r=n(348834).Buffer;function i(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")}Object.defineProperty(t,"__esModule",{value:!0}),t.uint8ArrayToHex=t.hashStr=void 0,t.hashStr=async function(e){const t=r.from(e),n=await crypto.subtle.digest("SHA-256",t);return i(new Uint8Array(n))},t.uint8ArrayToHex=i},713403:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProd=void 0;const r=n(524264);t.isProd=function(){return"production"===r.NODE_ENV}},310666:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const r=n(713403);t.log=function(...e){(0,r.isProd)()||console.log(...e)}},519077:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveNavigatorVersion=void 0;const n=/Chrome\/([0-9.]+)/;t.resolveNavigatorVersion=function(){const e=navigator.userAgent,t=n.exec(navigator.userAgent)?.[1];if(!t)return{userAgent:e};const[r,i,a]=t.split(".").map(Number);return{major:r,minor:i,patch:a,userAgent:e,vendor:"chrome",version:t}}},6587:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCTION_EXTENSION_ID=t.CORPORATE_EXTENSION_ID=void 0,t.CORPORATE_EXTENSION_ID="ibdjdlilbembidmokdpjanlbnjclopbi",t.PRODUCTION_EXTENSION_ID="hnfanknocfeofbddgcijnmhnfnkdnaad"},540567:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDevBuild=t.isQABuild=t.isCorpRelease=t.isCorpQARelease=t.isCorpQADevRelease=t.isPublicRelease=t.getAppEnv=void 0;const r=n(542282);function i(e){const t=(0,r.getReleaseStage)();return e.includes(t)}t.getAppEnv=i,t.isPublicRelease=function(){return i(["production"])},t.isCorpQADevRelease=function(){return i(["local","local-prod","corporate"])},t.isCorpQARelease=function(){return i(["local-prod","corporate"])},t.isCorpRelease=function(){return i(["corporate"])},t.isQABuild=function(){return i(["local-prod"])},t.isDevBuild=function(){return i(["local"])}},542282:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalReleaseStage=t.getReleaseStage=void 0;const r=n(524264),i=n(6587);t.getReleaseStage=function(){if("production"===r.RELEASE_ENVIRONMENT)switch(chrome.runtime.id){case i.CORPORATE_EXTENSION_ID:return"corporate";case i.PRODUCTION_EXTENSION_ID:return"production";default:return"local-prod"}return"local"},t.isLocalReleaseStage=function(){return"local"===r.RELEASE_ENVIRONMENT||"local-prod"===r.RELEASE_ENVIRONMENT}},78818:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIsLegacyStandalone=t.getIsLegacyLedger=t.SigningDevice=void 0;const r=n(485599),i=n(394125),a=n(989289);var s;!function(e){e.ledger="ledger",e.standalone="standalone"}(s=t.SigningDevice||(t.SigningDevice={})),t.getIsLegacyLedger=function(){return r.Store.get(i.StoreKeys_signingDevice)===s.ledger},t.getIsLegacyStandalone=function(){return r.Store.get(i.StoreKeys_signingDevice)===s.standalone||(0,a.getHasStoredSecrets)()}},385394:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logClaimDIDFromSettings=t.logMultiAccountAnnouncementViewed=t.logMultiAccountAnnouncementDismissed=t.logMultiAccountAnnouncementPressed=t.logCreateWalletsForAccountsResult=t.logCreateWalletsForAccountsStart=t.logHadCorruptWallets=t.logFindAccountsThatNeedWalletsResult=t.logFindAccountsThatNeedWalletsStart=t.logCreateWalletsFailed=t.logCreateWalletsSuccess=t.logCreateWalletsStart=t.logMissingMnemonic=t.logSettingsSessionViewed=t.triggerCheckAuthStateAndAccountsMismatchFinish=t.triggerCheckAuthStateAndAccountsMismatchStart=t.logXpubStoreKeyMigrated=t.logXpubKeyMissing=t.logGetXpubKeyResult=t.logGetXpubKeyStart=t.triggerWalletGroupVisibilityToggled=t.triggerWalletGroupNicknameUpdated=t.triggerWalletGroupCreatedByUser=t.triggerWalletSwitcherWalletGroupCreateEntryClicked=t.triggerWalletSwitcherWalletGroupSelected=t.triggerWalletSwitcherClosed=t.triggerWalletSwitcherOpened=t.useTriggerEditWalletNicknameScreenViewed=t.useTriggerEditWalletScreenViewed=t.useTriggerWhyCreateNewWalletViewed=t.useTriggerMaxWalletsReachedCopyViewed=t.useTriggerAddManageWalletsViewed=t.useTriggerWalletSwitcherViewed=t.useTriggerNUXScreenViewed=t.triggerUserAccountCloudBackups=t.triggerMissingDefaultWalletGroupDetected=t.triggerMissingDefaultAccountDetected=t.triggerLogWalletLimitReached=t.triggerCreateWalletGroupsFailed=t.triggerCreateWalletGroupsSuccess=t.triggerCreateWalletsFromPublicKeysFailed=t.triggerCreateWalletsFromPublicKeysSuccess=t.triggerCreateWalletsFromPublicKeysStart=t.triggerCreateWalletsAtIndexFailed=t.triggerCreateWalletsAtIndexSuccess=t.triggerOnboardingWalletGroupCreated=t.triggerOnboardingAccountCreated=t.triggerOnboardingCreateFailed=t.triggerOnboardingCreateSuccess=t.triggerOnboardingCreateStarted=void 0,t.logGetEncryptedSecretsResult=t.logGetEncryptedSecretsStart=t.useLogRecoveryPhraseTrayViewed=t.logRecoveryPhraseTrayBackupPressed=t.logRecoveryPhraseTrayLaterPressed=t.triggerDeriveSegwitAddressFromXpubKeyResult=t.triggerDeriveSegwitAddressFromXpubKeyStart=t.triggerDeriveLegacyAddressFromXpubKeyResult=t.triggerDeriveLegacyAddressFromXpubKeyStart=t.triggerSignEthereumMessageFromSeedResult=t.triggerSignEthereumMessageFromSeedStart=t.triggerDeriveEthereumPublicKeyFromSeedResult=t.triggerDeriveEthereumPublicKeyFromSeedStart=t.triggerDeriveEthereumAddressFromPublicKeyResult=t.triggerDeriveEthereumAddressFromPublicKeyStart=t.FROM_WALLET_ENGINE=t.FROM_NATIVE_MODULE=t.triggerDeleteMnemonicAccountPostDeletion=t.logHandleUserChangeFailure=t.logHandleUserChangeSuccess=t.logHandleUserChangeStart=t.logSetAnalyticsSessionMetadataSuccess=t.triggerBalanceScanForAccountFailed=t.triggerBalanceScanForAccountResult=t.triggerBalanceScanForAccountStart=t.triggerFullScreenBackupRemindMeLaterPressed=t.triggerFullScreenBackupNowTrayPressed=t.triggerFullScreenBackupNotNowPressed=t.triggerFullScreenBackupNowPressed=t.useFullScreenBackupReminderViewed=t.triggerBackupMnemonicWalletPressed=t.logBackupAnnouncementCardPressed=t.logBackupAnnouncementCardViewed=t.logSaveAndSetAccountSuccess=t.logSaveAndSetAccountFailed=t.logSaveAndSetAccountStarted=t.useShowPrivateKeyViewed=void 0;const r=n(395545),i=n(160593);t.triggerOnboardingCreateStarted=function(e={}){(0,i.logDataEvent)("accounts.onboarding.create.started",{...e,loggingId:"6f64be72-2a4b-11ed-a261-0242ac120002"})},t.triggerOnboardingCreateSuccess=function({accountType:e,flow:t,...n}){(0,i.logDataEvent)("accounts.onboarding.create.success",{...n,accountType:e,flow:t,loggingId:"afd8abfe-a20e-4eab-93dc-5f4787262650"}),(0,i.logDataEvent)(`${t}.create-success.${e}`,{})},t.triggerOnboardingCreateFailed=function(e={}){(0,i.logDataEvent)("accounts.onboarding.create.failed",{...e,loggingId:"d81406b2-a289-4c08-bcc7-1b2f90e12805"})},t.triggerOnboardingAccountCreated=function(e={}){(0,i.logDataEvent)("accounts.onboarding.account.created",{...e,loggingId:"97e65158-facf-47e2-a11e-bd2605d2b6f9"})},t.triggerOnboardingWalletGroupCreated=function(e={}){(0,i.logDataEvent)("accounts.onboarding.wallet_group.created",{...e,loggingId:"40da5529-c855-4d7b-8d5c-7b5ff1c10cc6"})},t.triggerCreateWalletsAtIndexSuccess=function(e={}){(0,i.logDataEvent)("accounts.create_wallets_at_index.success",{...e,loggingId:"e8539129-6076-4174-8283-e2be411e15aa"})},t.triggerCreateWalletsAtIndexFailed=function(e={}){(0,i.logDataEvent)("accounts.create_wallets_at_index.failed",{...e,loggingId:"7268f5c6-261e-4310-8572-5a665ca01c1c"})},t.triggerCreateWalletsFromPublicKeysStart=function(e={}){(0,i.logDataEvent)("accounts.create_wallets_from_public_keys.start",e)},t.triggerCreateWalletsFromPublicKeysSuccess=function(e={}){(0,i.logDataEvent)("accounts.create_wallets_from_public_keys.success",e)},t.triggerCreateWalletsFromPublicKeysFailed=function(e={}){(0,i.logDataEvent)("accounts.create_wallets_from_public_keys.failed",e)},t.triggerCreateWalletGroupsSuccess=function(e={}){(0,i.logDataEvent)("accounts.create_wallet_groups.success",{...e,loggingId:"9de9f533-3335-473f-9ac5-6db97f2e632e"})},t.triggerCreateWalletGroupsFailed=function(e={}){(0,i.logDataEvent)("accounts.create_wallet_groups.failed",{...e,loggingId:"43e3b500-9278-4a75-92fd-318fcfbc37f8"})},t.triggerLogWalletLimitReached=function(e={action:r.ActionType.measurement,component:r.ComponentType.unknown}){(0,i.logDataEvent)("multiwallet.walletgrouplimit.reached",{...e,loggingId:"bd1e837c-dbcd-4f0b-b4d9-f48ecd3392f5"})},t.triggerMissingDefaultAccountDetected=function(e={}){(0,i.logDataEvent)("accounts.missing_default_account_detected",{...e,loggingId:"8df3d229-74f5-44e6-afc2-5e3a2065a784"})},t.triggerMissingDefaultWalletGroupDetected=function(e={}){(0,i.logDataEvent)("accounts.missing_default_wallet_group_detected",{...e,loggingId:"9f329552-b752-4b50-9fdd-7216ef12c0d5"})},t.triggerUserAccountCloudBackups=function(e={}){(0,i.logDataEvent)("accounts.user_account_cloud_backups",{...e,loggingId:"162bfdd2-2154-4033-a8ed-b093033f8350"})},t.useTriggerNUXScreenViewed=function(e){(0,i.useLogEventOnMount)("accounts.nux_screen.viewed",{...e,loggingId:"0055cc47-5acb-4ca7-8497-aefc9f69f220"})},t.useTriggerWalletSwitcherViewed=function(e){(0,i.useLogEventOnMount)("accounts.wallet_switcher.viewed",{...e,loggingId:"0a5cf7f7-b164-4b42-bf6d-50f77af7c9ff"})},t.useTriggerAddManageWalletsViewed=function(e){(0,i.useLogEventOnMount)("accounts.add_manage_wallets.viewed",{...e,loggingId:"752404c9-5802-4ca0-a76a-dc7fe15c9355"})},t.useTriggerMaxWalletsReachedCopyViewed=function(e){(0,i.useLogEventOnMount)("accounts.add_manage_wallets.max_wallets_reached_viewed",{...e,loggingId:"d5a9b97d-c253-431f-9af1-eb68765d22fd"})},t.useTriggerWhyCreateNewWalletViewed=function(e){(0,i.useLogEventOnMount)("accounts.why_create_new_wallet.viewed",{...e,loggingId:"815a78f1-e9d0-4799-8026-0c9be0927e32"})},t.useTriggerEditWalletScreenViewed=function(e){(0,i.useLogEventOnMount)("accounts.edit_wallet_screen.viewed",{...e,loggingId:"0059624c-56a3-4371-80ed-cf0efea17b3b"})},t.useTriggerEditWalletNicknameScreenViewed=function(e){(0,i.useLogEventOnMount)("accounts.edit_wallet_nickname_screen.viewed",{...e,loggingId:"640adf05-01b6-4262-928b-2b9f1bc1e681"})},t.triggerWalletSwitcherOpened=function(e={action:r.ActionType.click,componentType:r.ComponentType.text,context:"nav-bar"}){(0,i.logEvent)("accounts.wallet_switcher.opened",{...e,loggingId:"ae7033e9-139a-4679-9f65-9934fd85ff50"})},t.triggerWalletSwitcherClosed=function(e){(0,i.logEvent)("accounts.wallet_switcher.closed",{...e,loggingId:"91fbc52f-b178-42ba-96a6-24528822058e"})},t.triggerWalletSwitcherWalletGroupSelected=function(e){(0,i.logEvent)("accounts.wallet_switcher.wallet_group.selected",{...e,loggingId:"b1998889-fe81-41d9-98ae-2da55e58b3ab"})},t.triggerWalletSwitcherWalletGroupCreateEntryClicked=function(e){(0,i.logEvent)("accounts.wallet_switcher.wallet_group.create_entry_clicked",{...e,loggingId:"da6ff158-ffef-4a69-9c71-ad681ee3bd96"})},t.triggerWalletGroupCreatedByUser=function(e){(0,i.logEvent)("accounts.wallet_group.created_by_user",{...e,loggingId:"5de14990-c95d-4689-b9ec-9e272c348462"})},t.triggerWalletGroupNicknameUpdated=function(e){(0,i.logEvent)("accounts.wallet_group_nickname.updated",{...e,loggingId:"79da79e2-d2e2-4749-b481-f36a2aaefe7f"})},t.triggerWalletGroupVisibilityToggled=function(e){(0,i.logEvent)("accounts.wallet_group_visibility.toggled",{...e,loggingId:"6ecff47a-b941-4499-9d59-d640ee646275"})},t.logGetXpubKeyStart=function({blockchain:e,addressType:t,walletIndex:n,accountType:r}){(0,i.logDataEvent)("accounts.get_xpubkey.start",{data:{blockchain:e,addressType:t,walletIndex:n,accountType:r}})},t.logGetXpubKeyResult=function({blockchain:e,addressType:t,walletIndex:n,accountType:r,result:a}){(0,i.logDataEvent)(`accounts.get_xpubkey.${a}`,{data:{blockchain:e,addressType:t,walletIndex:n,accountType:r}})},t.logXpubKeyMissing=function({blockchain:e,addressType:t,walletIndex:n}){(0,r.logMetric)({metricName:"accounts.xpubkey.missing",metricType:r.MetricType.count,value:1,tags:{blockchain:e,addressType:t,walletIndex:n}})},t.logXpubStoreKeyMigrated=function({blockchain:e,addressType:t,walletIndex:n}){(0,r.logMetric)({metricName:"accounts.xpubkey.migrated",metricType:r.MetricType.count,value:1,tags:{blockchain:e,addressType:t,walletIndex:n}})},t.triggerCheckAuthStateAndAccountsMismatchStart=function({onboardingContextComponentStack:e,authStateHasMnemonic:t}){(0,i.logDataEvent)("accounts.check_auth_state_and_accounts_mismatch.start",{loggingId:"174353b0-5950-4c59-ae19-ec1d5085c87d",data:{onboardingContextComponentStack:e,authStateHasMnemonic:t}})},t.triggerCheckAuthStateAndAccountsMismatchFinish=function({newAuthStateHasMnemonic:e,isKilled:t=!1,hasAccount:n,hasWalletGroup:a,hasWallet:s,hasAddress:o,signout:c=!1}){(0,i.logDataEvent)("accounts.check_auth_state_and_accounts_mismatch.finish",{loggingId:"82e4044d-7f42-492f-a3d7-ac15dae2ce40",data:{newAuthStateHasMnemonic:e,isKilled:t,hasAccount:n,hasWalletGroup:a,hasWallet:s,hasAddress:o,signout:c}}),(0,r.sendScheduledEvents)()},t.logSettingsSessionViewed=function(){(0,i.logEvent)("accounts.settings.session.viewed",{loggingId:"10729598-5b57-4e70-bddb-7a8f188ac3d4",action:r.ActionType.view,componentType:r.ComponentType.page})},t.logMissingMnemonic=function({isMissingMnemonicEscapeHatchKilled:e}){(0,i.logDataEvent)("accounts.missing_mnemonic",{loggingId:"ee113ff3-f28c-461a-af51-ce0f94d085c6",isMissingMnemonicEscapeHatchKilled:e},r.AnalyticsEventImportance.high)},t.logCreateWalletsStart=function({accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r}){(0,i.logDataEvent)("accounts.create_wallets.start",{data:{accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r}})},t.logCreateWalletsSuccess=function({accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r,createdWalletsLength:a}){(0,i.logDataEvent)("accounts.create_wallets.success",{data:{accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r,createdWalletsLength:a}})},t.logCreateWalletsFailed=function({accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r}){(0,i.logDataEvent)("accounts.create_wallets.failed",{data:{accountType:e,replace:t,createWithZeroBalance:n,createAtIndexes:r}})},t.logFindAccountsThatNeedWalletsStart=function(){(0,i.logDataEvent)("accounts.find_accounts_that_need_wallets_start",{loggingId:"3adfe135-ae69-4305-8880-912b2c41680e"},r.AnalyticsEventImportance.high)},t.logFindAccountsThatNeedWalletsResult=function({accountsThatNeedWalletsLength:e,accountsThatWereCorruptLength:t,accountsLength:n,hasMissingAddresses:a,hasMissingWallets:s,missingAddressBlockchains:o,missingAddressEthNetworks:c,missingAddressIndexes:l,missingWalletBlockchains:u,missingWalletEthNetworks:h,missingWalletIndexes:d}){(0,i.logDataEvent)("accounts.find_accounts_that_need_wallets_result",{loggingId:"7e292620-cb5d-434b-af3b-85e9c8644e2b",accountsThatNeedWalletsLength:e,accountsThatWereCorruptLength:t,accountsLength:n,hasMissingAddresses:a,hasMissingWallets:s,missingAddressBlockchains:o,missingAddressEthNetworks:c,missingAddressIndexes:l,missingWalletBlockchains:u,missingWalletEthNetworks:h,missingWalletIndexes:d},r.AnalyticsEventImportance.high)},t.logHadCorruptWallets=function({accountType:e}){(0,i.logDataEvent)("accounts.find_accounts_that_need_wallets_had_corrupt_wallets",{loggingId:"f812fa24-1137-478a-9d9b-e6ec1064e560",accountType:e})},t.logCreateWalletsForAccountsStart=function({accountsThatNeedWalletsLength:e,mnemonicsLength:t}){(0,i.logDataEvent)("accounts.create_wallets_for_accounts_start",{loggingId:"9fa5597d-da2c-4dd6-b18d-214233c5d522",accountsThatNeedWalletsLength:e,mnemonicsLength:t},r.AnalyticsEventImportance.high)},t.logCreateWalletsForAccountsResult=function({accountsThatNeedWalletsLength:e,mnemonicsLength:t}){(0,i.logDataEvent)("accounts.create_wallets_for_accounts_result",{loggingId:"d72a156d-191d-41d0-8741-000871709a65",accountsThatNeedWalletsLength:e,mnemonicsLength:t},r.AnalyticsEventImportance.high)},t.logMultiAccountAnnouncementPressed=function(){(0,i.logEvent)("accounts.multi_account_announcement.pressed",{loggingId:"a4c62468-b261-4cf2-8c08-4ad24151c504",action:r.ActionType.click,componentType:r.ComponentType.button})},t.logMultiAccountAnnouncementDismissed=function(){(0,i.logEvent)("accounts.multi_account_announcement.dismissed",{loggingId:"a5ea2c7e-b9bc-4c85-923f-1929b99d5e5d",action:r.ActionType.click,componentType:r.ComponentType.button})},t.logMultiAccountAnnouncementViewed=function(){(0,i.logEvent)("accounts.multi_account_announcement.viewed",{loggingId:"56466db5-3809-462c-b1e1-e88558a727be",action:r.ActionType.view,componentType:r.ComponentType.button})},t.logClaimDIDFromSettings=function(){(0,i.logDataEvent)("accounts.claim_did_from_settings.pressed",{loggingId:"cd8c8bc2-d508-42bc-804c-3ace6769ad40"})},t.useShowPrivateKeyViewed=function(){return(0,i.useLogEventOnMount)("accounts.settings_show_private_key.viewed",{loggingId:"a3488a34-9928-4c15-adcf-a011e3390177",componentType:r.ComponentType.page})},t.logSaveAndSetAccountStarted=function(){(0,i.logDataEvent)("accounts.save_and_set.started",{loggingId:"712a8250-df8b-463b-bb5b-435ef9fb9eca"})},t.logSaveAndSetAccountFailed=function(){(0,i.logDataEvent)("accounts.save_and_set.failed",{loggingId:"bafef7b1-2b44-4fb6-b999-88df5f68e8d0"})},t.logSaveAndSetAccountSuccess=function(){(0,i.logDataEvent)("accounts.save_and_set.success",{loggingId:"0b54b783-8b25-4f90-bbdf-8205c92050a2"})},t.logBackupAnnouncementCardViewed=function(){(0,i.logEvent)("accounts.backup_announcement_card.viewed",{loggingId:"175840fc-405d-4f88-87d5-64f196d4d7e4",action:r.ActionType.view,componentType:r.ComponentType.banner})},t.logBackupAnnouncementCardPressed=function(){(0,i.logEvent)("accounts.backup_announcement_card.pressed",{loggingId:"8ffa2755-07ea-43e6-96ca-a387f877fa38",action:r.ActionType.view,componentType:r.ComponentType.banner})},t.triggerBackupMnemonicWalletPressed=function(){(0,i.logEvent)("accounts.backup_mnemonic_wallet.pressed",{action:r.ActionType.view,componentType:r.ComponentType.button})},t.useFullScreenBackupReminderViewed=function(){(0,i.useLogEventOnMount)("accounts.full_screen_backup_reminder.viewed",{action:r.ActionType.view,componentType:r.ComponentType.page})},t.triggerFullScreenBackupNowPressed=function(){(0,i.logEvent)("accounts.full_screen_backup_reminder.backup_now.pressed",{action:r.ActionType.click,componentType:r.ComponentType.button})},t.triggerFullScreenBackupNotNowPressed=function(){(0,i.logEvent)("accounts.full_screen_backup_reminder.not_now.pressed",{action:r.ActionType.click,componentType:r.ComponentType.button})},t.triggerFullScreenBackupNowTrayPressed=function(){(0,i.logEvent)("accounts.full_screen_backup_reminder.backup_now_tray.pressed",{action:r.ActionType.click,componentType:r.ComponentType.button})},t.triggerFullScreenBackupRemindMeLaterPressed=function(){(0,i.logEvent)("accounts.full_screen_backup_reminder.remind_me_later_tray.pressed",{action:r.ActionType.click,componentType:r.ComponentType.button})},t.triggerBalanceScanForAccountStart=function({userFacingAccountIndexByCreatedAt:e}){(0,i.logDataEvent)("accounts.balance_scan_for_account.start",{data:{userFacingAccountIndexByCreatedAt:e}})},t.triggerBalanceScanForAccountResult=function({userFacingAccountIndexByCreatedAt:e,createdWalletGroupsLength:t,createdWalletGroupIndexes:n}){(0,i.logDataEvent)("accounts.balance_scan_for_account.result",{data:{userFacingAccountIndexByCreatedAt:e,createdWalletGroupsLength:t,createdWalletGroupIndexes:n.sort()}})},t.triggerBalanceScanForAccountFailed=function({userFacingAccountIndexByCreatedAt:e}){(0,i.logDataEvent)("accounts.balance_scan_for_account.failed",{data:{userFacingAccountIndexByCreatedAt:e}})},t.logSetAnalyticsSessionMetadataSuccess=function({deviceId:e,locale:t,userId:n}){(0,i.logDataEvent)("accounts.set_analytics_session_metadata.success",{deviceId:e,locale:t,userId:n},r.AnalyticsEventImportance.high)},t.logHandleUserChangeStart=function({userId:e}){(0,i.logDataEvent)("accounts.handle_user_change.start",{userId:e},r.AnalyticsEventImportance.high)},t.logHandleUserChangeSuccess=function({userId:e}){(0,i.logDataEvent)("accounts.handle_user_change.success",{userId:e},r.AnalyticsEventImportance.high)},t.logHandleUserChangeFailure=function({userId:e,errorMessage:t}){(0,i.logDataEvent)("accounts.handle_user_change.failure",{userId:e,errorMessage:t},r.AnalyticsEventImportance.high)},t.triggerDeleteMnemonicAccountPostDeletion=function(e={}){(0,i.logDataEvent)("accounts.delete_mnemonic_account.post_deletion",{...e})},t.FROM_NATIVE_MODULE="from_native_module",t.FROM_WALLET_ENGINE="from_wallet_engine",t.triggerDeriveEthereumAddressFromPublicKeyStart=function({platform:e}){(0,i.logDataEvent)("accounts.derive_ethereum_address_from_public_key.start",{data:{platform:e}})},t.triggerDeriveEthereumAddressFromPublicKeyResult=function({platform:e,source:t,result:n}){(0,i.logDataEvent)("accounts.derive_ethereum_address_from_public_key.result",{data:{platform:e,source:t,result:n}})},t.triggerDeriveEthereumPublicKeyFromSeedStart=function({platform:e}){(0,i.logDataEvent)("accounts.derive_ethereum_public_key_from_seed.start",{data:{platform:e}})},t.triggerDeriveEthereumPublicKeyFromSeedResult=function({platform:e,source:t,result:n}){(0,i.logDataEvent)("accounts.derive_ethereum_public_key_from_seed.result",{data:{platform:e,source:t,result:n}})},t.triggerSignEthereumMessageFromSeedStart=function({platform:e}){(0,i.logDataEvent)("accounts.sign_ethereum_message_from_seed.start",{data:{platform:e}})},t.triggerSignEthereumMessageFromSeedResult=function({platform:e,source:t,result:n}){(0,i.logDataEvent)("accounts.sign_ethereum_message_from_seed.result",{data:{platform:e,source:t,result:n}})},t.triggerDeriveLegacyAddressFromXpubKeyStart=function({platform:e}){(0,i.logDataEvent)("accounts.derive_legacy_address_from_xpub_key.start",{data:{platform:e}})},t.triggerDeriveLegacyAddressFromXpubKeyResult=function({platform:e,source:t,result:n}){(0,i.logDataEvent)("accounts.derive_legacy_address_from_xpub_key.result",{data:{platform:e,source:t,result:n}})},t.triggerDeriveSegwitAddressFromXpubKeyStart=function({platform:e}){(0,i.logDataEvent)("accounts.derive_segwit_address_from_xpub_key.start",{data:{platform:e}})},t.triggerDeriveSegwitAddressFromXpubKeyResult=function({platform:e,source:t,result:n}){(0,i.logDataEvent)("accounts.derive_segwit_address_from_xpub_key.result",{data:{platform:e,source:t,result:n}})},t.logRecoveryPhraseTrayLaterPressed=function(){(0,i.logEvent)("recovery_phrase_tray.later.pressed",{componentType:r.ComponentType.button,action:r.ActionType.click})},t.logRecoveryPhraseTrayBackupPressed=function(){(0,i.logEvent)("recovery_phrase_tray.claim.pressed",{componentType:r.ComponentType.button,action:r.ActionType.click})},t.useLogRecoveryPhraseTrayViewed=function(){(0,i.useLogEventOnMount)("recovery_phrase_tray.viewed",{componentType:r.ComponentType.tray,action:r.ActionType.view})},t.logGetEncryptedSecretsStart=function(){(0,i.logDataEvent)("accounts.get_encrypted_secrets.start",{})},t.logGetEncryptedSecretsResult=function({encryptedSecretsLength:e,isEncryptedSecretsUndefined:t,isLocalStorageUndefined:n,localStorageLength:r}){(0,i.logDataEvent)("accounts.get_encrypted_secrets.result",{data:{encryptedSecretsLength:e,isEncryptedSecretsUndefined:t,isLocalStorageUndefined:n,localStorageLength:r}})}},854195:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.triggerDecryptLegacyMnemonic=t.triggerEncryptLegacyMnemonic=t.triggerEncryptedAllSecrets=t.triggerDecryptedAllSecrets=t.triggerEncryptedSecretForAccount=t.triggerDecryptedSecretForAccount=void 0;const r=n(160593);t.triggerDecryptedSecretForAccount=function(e,t){return(0,r.logDataEvent)("decrypt.mnemonics.for_account",{loggingId:"29f24e4a-3ba7-4cd6-a451-7a1c1dcc0ec1",mnemonicAccessContext:e,accountType:t})},t.triggerEncryptedSecretForAccount=function(e){return(0,r.logDataEvent)("encrypt.mnemonics.for_account",{loggingId:"ad309c6a-2935-4589-9c73-50ec3498e602",accountType:e})},t.triggerDecryptedAllSecrets=function(e,t){return(0,r.logDataEvent)("decrypt.mnemonics.all",{loggingId:"54e7a5de-8e18-49af-ab72-3fc59fb6fd8c",count:e,mnemonicAccessContext:t})},t.triggerEncryptedAllSecrets=function(e){return(0,r.logDataEvent)("encrypt.mnemonics.all",{loggingId:"a269080c-7a8e-4f1e-b616-6c4a2f5b06da",count:e})},t.triggerEncryptLegacyMnemonic=function(){return(0,r.logDataEvent)("encrypt.mnemonics.legacy",{loggingId:"8b331fa4-6d20-4bce-b21d-4905c856e2e9"})},t.triggerDecryptLegacyMnemonic=function(){return(0,r.logDataEvent)("decrypt.mnemonics.legacy",{loggingId:"6fc807be-b909-465e-9541-bb7241a02a22"})}},160593:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEventConfig=t.logDataEvent=t.useEventLogger=t.useLogEventOnMount=t.logEvent=t.setBreadcrumbEmitter=t.setEmitEventUpstreamFn=t.resetAccountMetadata=t.setIsAdvancedModeEnabledProperty=t.setAccountMetadata=void 0;const r=n(202784),i=n(395545);let a=()=>{},s=()=>{},o={},c=!0;function l(e){return{...e,...o,isAdvancedModeEnabled:c}}function u(e,t,n){if(!n){const{loggingId:n,...r}=t,i=`${e}\n\nproperties=${JSON.stringify(r,null,"\t")}`;a(i)}}t.setAccountMetadata=function(e){o={...e}},t.setIsAdvancedModeEnabledProperty=function(e){c=e},t.resetAccountMetadata=function(){o={}},t.setEmitEventUpstreamFn=function(e){a=e},t.setBreadcrumbEmitter=function(e){s=e},t.logEvent=function(e,t,n,r=!1){u(e,t,r),s(e);const a=l(t);return(0,i.logEvent)(e,a,n)},t.useLogEventOnMount=function(e,t,n=!1){(0,r.useEffect)((()=>{u(e,t,n)}),[]);const a=l(t);return(0,i.useLogEventOnMount)(e,a)},t.useEventLogger=function(e,t,n,a=!1){const s=(0,r.useRef)(t);(0,r.useEffect)((function(){s.current=t}),[t]);const o=l(t),c=(0,i.useEventLogger)(e,o,n);return(0,r.useCallback)((t=>{u(e,s.current,a),c(t)}),[e,a,c])},t.logDataEvent=function(e,t,n){const{action:r,componentType:a}=t,s=l(t);return(0,i.logEvent)(e,{...s,isDiagnostic:!0,action:r??i.ActionType.measurement,componentType:a??i.ComponentType.unknown},n)},t.createEventConfig=function(e,t,n){const r=n?l(n):void 0;return(0,i.createEventConfig)(e,t,r)}},670431:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletType=void 0,function(e){e.standalone="standalone",e.hw_wallet="hw_wallet",e.walletlink="basic",e.dapp_provider="dapp_provider"}(t.WalletType||(t.WalletType={}))},822754:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EVM_PROVIDER_ID=void 0,t.EVM_PROVIDER_ID="window.ethereum"},885197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SOLANA_PROVIDER_ID=void 0,t.SOLANA_PROVIDER_ID="window.coinbaseSolana"},327242:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorIgnoredChainIds=t.localhostTestnetChainIds=t.EthereumNetworkMap=void 0;const r=n(518650),i=n(405167),a={blockchainSymbol:"ETH",isNonEthChain:!1},s={ETHEREUM_MAINNET:{chainId:1,baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Ethereum",isTestnet:!1,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-mainnet",chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",chainProxyTarget:"ethereum-etherscan",privatePoolParams:{mevRevenueAddress:"0x8fB5c55E01AE82e00973Bec97549D6bCd14114F2",apiURL:i.ethereumUrls.ETHEREUM_MAINNET.privatePoolApi},...a,...i.ethereumUrls.ETHEREUM_MAINNET},OPTIMISM_MAINNET:{chainId:10,baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"OP Mainnet",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,etherscanLikeApiKey:"3AC76IGUZCFP2ABUNPGAY8PJSPRAFJYHEF",chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/optimism_logo.png",isNudgeSupported:!0,wacNetworkId:"networks/optimism-mainnet",chainProxyTarget:"optimism-etherscan",...a,...i.ethereumUrls.OPTIMISM_MAINNET},BASE_MAINNET:{chainId:8453,baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Base",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",isNudgeSupported:!0,chainProxyTarget:"basescan",wacNetworkId:"networks/base-mainnet",...a,...i.ethereumUrls.BASE_MAINNET},POLYGON_MAINNET:{chainId:137,baseAssetCurrencyCode:"MATIC",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/b474d4bf3af389e5f26ed66956f1da8a/maticLogo.png",baseAssetDisplayName:"MATIC",baseAssetDecimal:18,displayName:"Polygon",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"N1QTECUKT25H7R5H1EGHAXUIG7SRT8BUYY",chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0_64.png",isNudgeSupported:!0,wacNetworkId:"networks/polygon-mainnet",chainProxyTarget:"polygonscan",...a,...i.ethereumUrls.POLYGON_MAINNET},BNB_MAINNET:{chainId:56,baseAssetCurrencyCode:"BNB",baseAssetImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",baseAssetDisplayName:"BNB",baseAssetDecimal:18,displayName:"BNB (Binance Smart) Chain",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"T8BK2SDU3I3JXKWCFAPVRFQDHKV5MACHWC",chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/bnb_288.png",isNudgeSupported:!0,wacNetworkId:"networks/bnb-mainnet",chainProxyTarget:"bsc-bscscan",...a,...i.ethereumUrls.BNB_MAINNET},FANTOM_MAINNET:{chainId:250,baseAssetCurrencyCode:"FTM",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",baseAssetDisplayName:"FTM",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",displayName:"Fantom Opera",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"33A9K22PIJJEQT28HYD7JIWQHQ7AHC1TFF",isNudgeSupported:!0,wacNetworkId:"networks/fantom-mainnet",chainProxyTarget:"fantom-ftmscan",...a,...i.ethereumUrls.FANTOM_MAINNET},ARBITRUM_MAINNET:{chainId:42161,baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Ethereum",baseAssetDecimal:18,displayName:"Arbitrum",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"8EIAPIHN5S47JM7AD65UCVPGQWGZ38G7AJ",chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/arbitrum_logo.png",isNudgeSupported:!0,wacNetworkId:"networks/arbitrum-mainnet",chainProxyTarget:"arbitrum-arbiscan",...a,...i.ethereumUrls.ARBITRUM_MAINNET},GNOSIS_MAINNET:{chainId:100,baseAssetCurrencyCode:"XDAI",baseAssetImageUrl:"https://dynamic-assets.coinbase.com/d1afa9a4f7ce51fa1af1ab94a15ea875a4df2b9a0b6ca619ea3de482d688198d67112c70516b703405b01d9abd5856493c238fe58004b63f4c5b5986a7624da2/asset_icons/b2e81465e2ac5d20898c4793c1c672073895ba71688ad1044a01011fe555ca88.png",baseAssetDisplayName:"xDai",baseAssetDecimal:18,chainImageUrl:"https://dynamic-assets.coinbase.com/d1afa9a4f7ce51fa1af1ab94a15ea875a4df2b9a0b6ca619ea3de482d688198d67112c70516b703405b01d9abd5856493c238fe58004b63f4c5b5986a7624da2/asset_icons/b2e81465e2ac5d20898c4793c1c672073895ba71688ad1044a01011fe555ca88.png",displayName:"Gnosis",isTestnet:!1,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"1b25e3c1-9951-4366-afc6-a6d414ecdb5e",isNudgeSupported:!0,wacNetworkId:"networks/xdai-mainnet",chainProxyTarget:"gnosis-gnosisscan",...a,...i.ethereumUrls.GNOSIS_MAINNET},AVALANCHE_MAINNET:{chainId:43114,baseAssetCurrencyCode:"AVAX",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",baseAssetDisplayName:"AVAX",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",displayName:"Avalanche C-Chain",isTestnet:!1,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"S1UPXSUGI2Z7TBZN2MZCMZBW2HP3DZ1B4G",isNudgeSupported:!0,wacNetworkId:"networks/avacchain-mainnet",chainProxyTarget:"avalanche-snowtrace",...a,...i.ethereumUrls.AVALANCHE_MAINNET},HOLESKY:{chainId:17e3,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Holesky Ethereum",baseAssetDecimal:18,chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",displayName:"Holesky",isTestnet:!0,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-holesky-testnet",chainProxyTarget:"ethereum-holesky-etherscan",...a,...i.ethereumUrls.HOLESKY},SEPOLIA:{chainId:11155111,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",displayName:"Sepolia",isTestnet:!0,isLayer2:!1,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",isNudgeSupported:!0,wacNetworkId:"networks/ethereum-sepolia-testnet",chainProxyTarget:"ethereum-sepolia-etherscan",...a,...i.ethereumUrls.SEPOLIA},OP_SEPOLIA:{chainId:11155420,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,displayName:"OP Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,etherscanLikeApiKey:"GAH6BHW1WXF3TNQ4AH3G44B7BWVVKPKSV5",chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/optimism_logo.png",isNudgeSupported:!0,wacNetworkId:"networks/optimism-sepolia-testnet",chainProxyTarget:"optimism-sepolia-etherscan",...a,...i.ethereumUrls.OP_SEPOLIA},BASE_SEPOLIA:{chainId:84532,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,displayName:"Base Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",isNudgeSupported:!0,chainProxyTarget:"base-sepolia-etherscan",wacNetworkId:"networks/base-sepolia-testnet",...a,...i.ethereumUrls.BASE_SEPOLIA},BASE_GOERLI:{chainId:84531,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"G\xf6rli Ethereum",baseAssetDecimal:18,displayName:"Base G\xf6rli",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,isOvmNetwork:!0,chainImageUrl:"https://go.wallet.coinbase.com/static/base-logo.png",isNudgeSupported:!0,chainProxyTarget:"basescan-goerli",wacNetworkId:"networks/base-goerli-testnet",...a,...i.ethereumUrls.BASE_GOERLI},POLYGON_TESTNET:{chainId:80001,baseAssetCurrencyCode:"MATIC",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/b474d4bf3af389e5f26ed66956f1da8a/maticLogo.png",baseAssetDisplayName:"Testnet Matic",baseAssetDecimal:18,displayName:"Polygon Mumbai",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"N1QTECUKT25H7R5H1EGHAXUIG7SRT8BUYY",chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0_64.png",isNudgeSupported:!0,wacNetworkId:"networks/polygon-mumbai-testnet",chainProxyTarget:"polygon-mumbai-polygonscan",...a,...i.ethereumUrls.POLYGON_TESTNET},BNB_TESTNET:{chainId:97,baseAssetCurrencyCode:"BNB",baseAssetImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",baseAssetDisplayName:"BNB",baseAssetDecimal:18,chainImageUrl:"https://djly28hup5duz.cloudfront.net/wallet/wais/ea/1d/ea1dd1e2173d23bf2fdd95f78c145d064700aaccc24380403e73bbda74183742-MjQwOWEyYzYtMjUyMy00OGY4LTkxYzAtY2FlMzQyMmU1YTMw",displayName:"BNB (Binance Smart) Chain Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"T8BK2SDU3I3JXKWCFAPVRFQDHKV5MACHWC",isNudgeSupported:!0,wacNetworkId:"networks/bnb-testnet",chainProxyTarget:"bsc-testnet-bscscan",...a,...i.ethereumUrls.BNB_TESTNET},FANTOM_TESTNET:{chainId:4002,baseAssetCurrencyCode:"FTM",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",baseAssetDisplayName:"FTM",baseAssetDecimal:18,chainImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/ddbcf362d2717855adb007691745b83f/ftm_logo.png",displayName:"Fantom Testnet",isTestnet:!0,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"33A9K22PIJJEQT28HYD7JIWQHQ7AHC1TFF",isNudgeSupported:!0,wacNetworkId:"networks/fantom-testnet",chainProxyTarget:"fantom-testnet-ftmscan",...a,...i.ethereumUrls.FANTOM_TESTNET},ARBITRUM_SEPOLIA:{chainId:421614,baseAssetCurrencyCode:void 0,baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Sepolia Ethereum",baseAssetDecimal:18,chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/arbitrum_logo.png",displayName:"Arbitrum Sepolia",isTestnet:!0,isLayer2:!0,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"8EIAPIHN5S47JM7AD65UCVPGQWGZ38G7AJ",isNudgeSupported:!0,wacNetworkId:"networks/arbitrum-sepolia-testnet",chainProxyTarget:"arbitrum-sepolia-etherscan",...a,...i.ethereumUrls.ARBITRUM_SEPOLIA},AVALANCHE_FUJI:{chainId:43113,baseAssetCurrencyCode:"AVAX",baseAssetImageUrl:"https://wallet-api-production.s3.amazonaws.com/uploads/889d119cede59f72d7dae9132b2d35fc/avax_logo.png",baseAssetDisplayName:"Testnet AVAX",baseAssetDecimal:18,displayName:"Avalanche Fuji",isTestnet:!0,isLayer2:!0,is1559Enabled:!0,isCustomNetwork:!1,etherscanLikeApiKey:"S1UPXSUGI2Z7TBZN2MZCMZBW2HP3DZ1B4G",isNudgeSupported:!0,wacNetworkId:"networks/avacchain-fuji-testnet",chainProxyTarget:"avalanche-fuji-snowtrace",...a,...i.ethereumUrls.AVALANCHE_FUJI},LOCALHOST_8545:{chainId:31337,baseAssetCurrencyCode:"ETH",baseAssetImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",baseAssetDisplayName:"Localhost ETH",baseAssetDecimal:18,chainImageUrl:"https://coinbase-west.s3.us-west-2.amazonaws.com/ethereum_logo.png",displayName:"Localhost 8545",isTestnet:!0,isLayer2:!1,is1559Enabled:!1,isCustomNetwork:!1,etherscanLikeApiKey:"",...a,...i.ethereumUrls.LOCALHOST_8545}};t.EthereumNetworkMap=new r.NetworkMap(s),t.localhostTestnetChainIds=[31337,5777,1337],t.errorIgnoredChainIds=[...t.localhostTestnetChainIds]},108389:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POLYGON_CHAIN_ID=t.ETHEREUM_CHAIN_ID=t.BURN_ADDRESS=t.ETHEREUM_QR_CODE_MAINNET_SCHEME=t.ETHEREUM_CURRENCY_DECIMAL=t.ETHEREUM_SYMBOL=t.ETHEREUM_PREFIX=void 0,t.ETHEREUM_PREFIX="ETHEREUM_CHAIN",t.ETHEREUM_SYMBOL="ETH",t.ETHEREUM_CURRENCY_DECIMAL=18n,t.ETHEREUM_QR_CODE_MAINNET_SCHEME="ethereum",t.BURN_ADDRESS="0x000000000000000000000000000000000000dead",t.ETHEREUM_CHAIN_ID=1n,t.POLYGON_CHAIN_ID=137n},53610:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LAMPORT_CURRENCY=t.SOLANA_CURRENCY_DECIMAL=t.BLOCKCHAIN_SOLANA_MAINNET_IMAGE_URL=t.LAMPORTS_PER_SOL=t.SOLANA_SYMBOL=t.NAME=void 0,t.NAME="Solana",t.SOLANA_SYMBOL="SOL",t.LAMPORTS_PER_SOL=1000000000n,t.BLOCKCHAIN_SOLANA_MAINNET_IMAGE_URL="https://assets.coingecko.com/coins/images/4128/small/Solana.jpg?1635329178",t.SOLANA_CURRENCY_DECIMAL=9n,t.LAMPORT_CURRENCY="lamport"},575561:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolanaNetworkMap=void 0;const r=n(518650),i=n(53610),a=n(907879),s={SOLANA_MAINNET:{blockchainSymbol:"SOL",chainId:101,baseAssetCurrencyCode:"SOL",baseAssetImageUrl:i.BLOCKCHAIN_SOLANA_MAINNET_IMAGE_URL,baseAssetDisplayName:"Solana",baseAssetDecimal:9,displayName:"Solana",isLayer2:!1,isTestnet:!1,chainImageUrl:i.BLOCKCHAIN_SOLANA_MAINNET_IMAGE_URL,isCustomNetwork:!1,isNonEthChain:!0,isNudgeSupported:!1,wacNetworkId:"networks/solana-mainnet",...a.solanaUrls.SOLANA_MAINNET}};t.SolanaNetworkMap=new r.NetworkMap(s)},907879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.solanaUrls=void 0;const r=n(211774),i={SOLANA_MAINNET:{blockExplorerUrl:"https://explorer.solana.com",rpcUrl:r.SOLANA_RPC_URL}},a=Object.keys(i).reduce((function(e,t){return e[t]={blockExplorerUrl:`${r.CB_WALLET_API_URL}/mock-block-explorer`,rpcUrl:`${r.CB_WALLET_API_URL}/mock-chain-rpc`},e}),{});t.solanaUrls=r.isNonExtensionUiTest?a:i},733711:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedChain=t.asNetwork=t.chainIdFromNetworkRawValue=t.fromNetworkRawValue=t.SOLANA_PREFIX=void 0;const r=n(575561),i=n(886855);function a(e){const n=e.split("/");if(2!==n.length)return;const r=n[0],i=r?.split(":")??[];if(2!==i.length||t.SOLANA_PREFIX!==i[0])return;const a=i[1];return a?BigInt(a):void 0}t.SOLANA_PREFIX="SOLANA_CHAIN",t.fromNetworkRawValue=function(e){const t=a(e);if(t)return r.SolanaNetworkMap.fromChainId(t)},t.chainIdFromNetworkRawValue=a,t.asNetwork=function(e){return new i.Network(`${t.SOLANA_PREFIX}:${e.chainId}`,e.isTestnet)},t.SelectedChain=r.SolanaNetworkMap.whitelisted.SOLANA_MAINNET},518650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkMap=void 0;t.NetworkMap=class{constructor(e,t){this.whitelisted=e,this.internal=t||{},this.whitelistedChainIdSet=new Set(Object.values(this.whitelisted).map((e=>e.chainId.toString()))),this.internalChainIdSet=new Set(Object.values(this.internal).map((e=>e.chainId.toString()))),this.networkMap=new Map(Object.values(e).map((e=>[e.chainId.toString(),e])))}get allNetworks(){return this.networkMap}addNetwork(e,t){this.networkMap.set(e,t)}removeNetwork(e){if(this.isWhitelisted(e))throw Error("Cannot delete a whitelisted network");this.networkMap.delete(e)}removeCustomizationForWhitelisted(e){const t=Object.values(this.whitelisted).find((t=>t.chainId.toString()===e));t&&this.addNetwork(e,t)}isWhitelisted(e){return this.whitelistedChainIdSet.has(e)}isInternal(e){return this.internalChainIdSet.has(e)}isWhiteListedAndCustomized(e){if(!this.isWhitelisted(e))return!1;const t=this.fromChainId(BigInt(e)),n=Object.values(this.whitelisted).find((t=>t.chainId.toString()===e));return!t||!n||t.displayName!==n.displayName||t.rpcUrl!==n.rpcUrl||t.baseAssetCurrencyCode!==n.baseAssetCurrencyCode||t.blockExplorerUrl!==n.blockExplorerUrl}resetNetworks(){this.networkMap=new Map(Object.values(this.whitelisted).map((e=>[e.chainId.toString(),e])))}fromChainId(e){const t=e.toString();if(this.networkMap.has(t))return this.networkMap.get(t)}}},45378:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitcoinWalletConfiguration=t.BitcoinNetworkSetting=t.BitcoinBlockchain=t.BitcoinBRDLegacyAddressType=t.BitcoinLegacyAddressType=t.BitcoinBRDSegwitAddressType=t.BitcoinSegwitAddressType=t.BITCOIN_SYMBOL=void 0;const r=n(840149),i=n(839668),a=n(524801),s=n(328332),o=n(899871);t.BITCOIN_SYMBOL="BTC",t.BitcoinSegwitAddressType=new s.AddressType("BitcoinSegWit"),t.BitcoinBRDSegwitAddressType=new s.AddressType("BitcoinBRDSegWit"),t.BitcoinLegacyAddressType=new s.AddressType("BitcoinLegacy"),t.BitcoinBRDLegacyAddressType=new s.AddressType("BitcoinBRDLegacy"),t.BitcoinBlockchain=new i.Blockchain(t.BITCOIN_SYMBOL),t.BitcoinNetworkSetting=o.NetworkSetting.forMainnetOnlyBlockchain(t.BitcoinBlockchain),t.BitcoinWalletConfiguration=new r.UTXOConfiguration({supportedAddressTypes:[t.BitcoinSegwitAddressType,t.BitcoinLegacyAddressType,t.BitcoinBRDSegwitAddressType,t.BitcoinBRDLegacyAddressType],blockchain:t.BitcoinBlockchain,currencyName:"Bitcoin",currencyCode:a.CurrencyCode.BTC,decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/btc_288.png",defaultReceiveType:t.BitcoinSegwitAddressType,txResubmitterInterval:120n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"bitcoin",qrCodeUriTestnetScheme:"bitcoin",networkSetting:t.BitcoinNetworkSetting,refreshInterval:480n,isDerivationPathSupported:function(e,n){switch(e.rawValue){case t.BitcoinBRDLegacyAddressType.rawValue:case t.BitcoinBRDSegwitAddressType.rawValue:return!n;default:return!0}}})},591892:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLOCK_EXPLORER_URL=void 0,t.BLOCK_EXPLORER_URL="https://live.blockcypher.com/btc"},65341:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DogecoinWalletConfiguration=t.DogecoinNetworkSetting=t.DogecoinBlockchain=t.DogecoinAddressType=t.DOGECOIN_SYMBOL=void 0;const r=n(840149),i=n(839668),a=n(524801),s=n(328332),o=n(899871);t.DOGECOIN_SYMBOL="DOGE",t.DogecoinAddressType=new s.AddressType("DogeCoin"),t.DogecoinBlockchain=new i.Blockchain(t.DOGECOIN_SYMBOL),t.DogecoinNetworkSetting=o.NetworkSetting.forMainnetOnlyBlockchain(t.DogecoinBlockchain),t.DogecoinWalletConfiguration=new r.UTXOConfiguration({supportedAddressTypes:[t.DogecoinAddressType],blockchain:t.DogecoinBlockchain,currencyName:"Dogecoin",currencyCode:new a.CurrencyCode("DOGE"),decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/doge_288.png",defaultReceiveType:t.DogecoinAddressType,txResubmitterInterval:30n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"dogecoin",qrCodeUriTestnetScheme:"dogecoin",networkSetting:t.DogecoinNetworkSetting,refreshInterval:BigInt(480)})},218324:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLOCK_EXPLORER_URL=void 0,t.BLOCK_EXPLORER_URL="https://dogechain.info"},494023:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LitecoinWalletConfiguration=t.isDerivationPathSupported=t.LitecoinNetworkSetting=t.LitecoinBlockchain=t.LitecoinBRDAddressType=t.LitecoinLegacyAddressType=t.LitecoinSegwitAddressType=t.LITECOIN_SYMBOL=void 0;const r=n(840149),i=n(839668),a=n(524801),s=n(328332),o=n(899871);function c(e,n){return e.rawValue!==t.LitecoinBRDAddressType.rawValue||!n}t.LITECOIN_SYMBOL="LTC",t.LitecoinSegwitAddressType=new s.AddressType("LitecoinSegwit"),t.LitecoinLegacyAddressType=new s.AddressType("LitecoinLegacy"),t.LitecoinBRDAddressType=new s.AddressType("LitecoinBRD"),t.LitecoinBlockchain=new i.Blockchain(t.LITECOIN_SYMBOL),t.LitecoinNetworkSetting=o.NetworkSetting.forMainnetOnlyBlockchain(t.LitecoinBlockchain),t.isDerivationPathSupported=c,t.LitecoinWalletConfiguration=new r.UTXOConfiguration({supportedAddressTypes:[t.LitecoinSegwitAddressType,t.LitecoinLegacyAddressType,t.LitecoinBRDAddressType],blockchain:t.LitecoinBlockchain,currencyName:"Litecoin",currencyCode:new a.CurrencyCode("LTC"),decimals:8n,imageURL:"https://wallet-api-production.s3.amazonaws.com/uploads/tokens/ltc_288.png",defaultReceiveType:t.LitecoinSegwitAddressType,txResubmitterInterval:30n,maxSubmissionAttempts:5n,qrCodeUriMainnetScheme:"litecoin",qrCodeUriTestnetScheme:"litecoin",networkSetting:t.LitecoinNetworkSetting,refreshInterval:BigInt(480),isDerivationPathSupported:c})},51158:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLOCK_EXPLORER_URL=void 0,t.BLOCK_EXPLORER_URL="https://live.blockcypher.com/ltc"},840149:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UTXOConfiguration=void 0;const r=n(346722);class i extends r.WalletConfiguration{constructor(e){super({blockchain:e.blockchain,networkSetting:e.networkSetting,refreshInterval:e.refreshInterval,currencyCode:e.currencyCode,decimals:e.decimals,imageURL:e.imageURL,defaultReceiveType:e.defaultReceiveType,supportsMultiWallet:!1,isSyncingRequired:!0}),Object.assign(this,e)}displayName(e){return e.isTestnet?`Testnet ${this.currencyName}`:this.currencyName}}t.UTXOConfiguration=i},86296:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.coerceError=t.reportComponentError=t.cbReportError=t.setErrorHandler=t.consoleNotify=t.CONSOLE_STYLE=t.CONSOLE_PREFIX=t.shouldReport=t.createErrorReporter=void 0;const i=r(n(768762));function a(e){return n=>{let r;n instanceof Error?(r={error:n,context:"unknown",severity:"error",isHandled:!1},console.warn(t.CONSOLE_PREFIX,t.CONSOLE_STYLE,"reportError called incorrectly (reportError(error) rather than reportError({error}))")):"object"==typeof n?(r=n,r.error instanceof Error||(console.warn(t.CONSOLE_PREFIX,t.CONSOLE_STYLE,"reportError called incorrectly with something other than an error object",n),r.metadata={...r.metadata,originalErrorData:JSON.stringify(r.error)},r.error=new Error("Unspecified error."))):(r={error:new Error("Unspecified error."),context:"unknown",severity:"error",metadata:{originalErrorData:JSON.stringify(n)},isHandled:!1},console.warn(t.CONSOLE_PREFIX,t.CONSOLE_STYLE,"reportError called incorrectly"));const{error:a}=r,o=function(e){return(0,i.default)(e.message+e.stack).substring(0,8)}(a);return s(a)&&e(r,o),{errorHash:o}}}function s(e){return!("reportError"in e)||e.reportError}t.createErrorReporter=a,t.shouldReport=s;const o={debug:console.debug,warning:console.warn,error:console.error,critical:console.error,crash:console.error};function c(e){const{severity:n}=e;(o[n??"error"]||console.error)(t.CONSOLE_PREFIX,t.CONSOLE_STYLE,e)}t.CONSOLE_PREFIX="%c Error Reporting:",t.CONSOLE_STYLE="color:red;",t.consoleNotify=c;let l=a(c);t.setErrorHandler=function(e){l=e};const u=["MISSING_INSTANCEID_SERVICE","SERVICE_NOT_AVAILABLE","TOO_MANY_REGISTRATIONS","AUTHENTICATION_FAILED","PHONE_REGISTRATION_ERROR"];function h(e){try{return u.some((t=>e.error?.message?.includes(t)))?l({...e,severity:"warning"}):l(e)}catch(e){return console.error(t.CONSOLE_PREFIX,t.CONSOLE_STYLE,"Error reporting error",e),{}}}t.cbReportError=h,t.reportComponentError=function(e){return h({...e,context:"component_error"})},t.coerceError=function(e,t){let n;return e instanceof Error?n=e:(n=new Error(`${t} threw non-error`),n.cause=e),n}},552421:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extensionClientKillSwitchConfig=void 0;t.extensionClientKillSwitchConfig={kill_switch_profiles_balance_parity_extension:!0,kill_switch_ledger_multi_address_extension:!0,kill_human_readable_transactions_extension:!0,kill_txhistory_service_network_base_sepolia_extension:!0,kill_txhistory_service_network_goerli_base_extension:!0,kill_txhistory_service_network_holesky_extension:!0,kill_txhistory_service_network_sepolia_extension:!0,kill_txhistory_service_network_optimism_sepolia_extension:!0,kill_txhistory_service_network_ftm_testnet_extension:!0,kill_txhistory_service_network_polygon_testnet_extension:!0,kill_txhistory_service_network_arbitrum_sepolia_extension:!0,kill_txhistory_service_network_avax_fuji_extension:!0,kill_txhistory_service_network_bnb_testnet_extension:!0,kill_sponsored_gas_send_extension2:!0,kill_send_flow_pfp_extension:!1,kill_search_receive_asset_extension:!1,kill_edit_qr_code_extension:!1,kill_standardized_qr_codes_extension:!1,kill_receive_wallet_group_infos_extension:!1,kill_private_key_import_extension:!0,kill_test_switch_wallet_extension:!1,kill_ledger_onboarding:!1,kill_miami_illustrations:!1,kill_terms_of_service_update:!1,kill_sprig_rn:!1,kill_defi_tab_extension:!1,kill_nft_pfp_extension:!1,kill_experiments_local_override:!1,kill_asset_management_extension:!1,kill_announcement_banner_extension:!1,kill_cross_platform_hidden_assets_extension:!1,enable_new_settings_multi_account_extension:!1,kill_multiaccount_announcement_extension:!1,kill_txhistory_service_extension:!1,kill_txhistory_service_network_eth_extension:!1,kill_txhistory_service_network_bsc_extension:!1,kill_txhistory_service_network_ftm_extension:!1,kill_txhistory_service_network_gnosis_extension:!1,kill_txhistory_service_network_polygon_extension:!1,kill_txhistory_service_network_optimism_extension:!1,kill_txhistory_service_network_arbitrum_extension:!1,kill_txhistory_service_network_avalanche_c_extension:!1,kill_txhistory_service_network_etc_extension:!1,kill_txhistory_service_sol_extension:!1,kill_txhistory_service_network_base_v2_extension:!1,enable_human_readable_transactions_v2_extension:!1,kill_txhistory_service_v3_network_bsc_extension:!1,kill_txhistory_service_v3_network_ftm_extension:!1,kill_txhistory_service_v3_network_eth_extension:!1,kill_txhistory_service_v3_network_gnosis_extension:!1,kill_txhistory_service_v3_network_polygon_extension:!1,kill_txhistory_service_v3_network_optimism_extension:!1,kill_txhistory_service_v3_network_arbitrum_extension:!1,kill_txhistory_service_v3_network_avalanche_c_extension:!1,kill_txhistory_service_v3_network_etc_extension:!1,kill_txhistory_service_sol_v3_extension:!1,kill_txhistory_service_v3_network_base_v2_extension:!1,kill_txhistory_service_v3_network_base_sepolia_extension:!1,kill_txhistory_service_v3_network_goerli_base_extension:!1,kill_txhistory_service_v3_network_holesky_extension:!1,kill_txhistory_service_v3_network_optimism_sepolia_extension:!1,kill_txhistory_service_v3_network_sepolia_extension:!1,kill_txhistory_service_v3_network_bnb_testnet_extension:!1,kill_txhistory_service_v3_network_avax_fuji_extension:!1,kill_txhistory_service_v3_network_ftm_testnet_extension:!1,kill_txhistory_service_v3_network_arbitrum_sepolia_extension:!1,kill_txhistory_service_v3_network_polygon_testnet_extension:!1,kill_switch_nft_portfolio_tab_extension:!1,kill_switch_nft_offers_tab_extension:!1,kill_switch_nft_history_tab_extension:!1,kill_switch_aggregate_bids_extension:!1,kill_switch_aggregate_listings_extension:!1,kill_gnosis_poaps_extension:!1,kill_gnosis_poaps_send_extension:!1,kill_switch_nft_send_extension:!1,kill_switch_recent_collectibles_extension:!1,kill_switch_accept_bids_extension:!1,kill_nft_marketplace_links_extension:!1,kill_nft_native_buy_extension:!1,kill_polygon_nfts_extension:!1,kill_use_floor_price_extension:!1,kill_nft_collection_sort_by_chain_extension:!1,kill_nft_round_corners_extension:!1,kill_switch_view_solana_nft_extension:!1,kill_switch_aggregate_bids_ext:!1,kill_solana_nft_refresh_ext:!1,kill_switch_paginated_collections_extension:!1,kill_optimism_nfts_extension:!1,kill_optimism_nfts_send_extension:!1,kill_switch_reservoir_notification_extension:!1,kill_base_nfts_extension:!1,kill_base_nfts_send_extension:!1,kill_backend_based_nft_chain_config_extension:!1,kill_nft_grid_view_extension:!1,kill_collections_grid_view_extension:!1,kill_switch_pending_collectible_extension:!1,enable_nft_grid_increased_page_size_extension:!1,enable_nft_tab_sorting_extension:!1,kill_nft_aggregated_oe721s_extension:!1,kill_swap_ethereum_extension:!1,kill_swap_polygon_extension:!1,kill_swap_avax_extension:!1,kill_swap_solana_extension:!1,kill_swap_bsc_extension:!1,kill_swap_optimism_extension:!1,kill_swap_extension:!1,kill_free_usdc_swap_extension:!1,kill_private_pool_extension:!1,kill_swap_coinbase_fee_extension:!1,kill_dex_deposit_gas_extension:!1,kill_standardize_errors_dex_extension:!1,kill_gasless_swap_eth_extension:!1,kill_gasless_swap_polygon_extension:!1,kill_adjustable_slippage_extension:!1,kill_revert_format_decimal_extension:!1,kill_bridge_extension:!1,kill_adjustable_miner_fee_extension:!1,kill_cb_generic_sign_and_submit_extension:!1,kill_real_time_send_gas_fee_extension:!1,kill_recipient_suggestions_my_addresses_tab_extension:!1,kill_recipient_suggestions_recents_tab_extension:!0,kill_send_blockchain_all_extension:!1,kill_send_blockchain_eth_extension:!1,kill_send_blockchain_sol_extension:!1,kill_send_blockchain_xlm_extension:!1,kill_send_blockchain_xrp_extension:!1,kill_send_blockchain_btc_extension:!1,kill_send_blockchain_bch_extension:!1,kill_send_blockchain_doge_extension:!1,kill_send_blockchain_ltc_extension:!1,kill_send_network_eth_extension:!1,kill_send_network_etc_extension:!1,kill_send_network_bsc_extension:!1,kill_send_network_ftm_extension:!1,kill_send_network_gnosis_extension:!1,kill_send_network_polygon_extension:!1,kill_send_network_optimism_extension:!1,kill_send_network_arbitrum_extension:!1,kill_send_network_avalanche_c_extension:!1,kill_send_network_base_v2_extension:!1,kill_send_network_base_sepolia_extension:!1,kill_send_network_goerli_base_extension:!1,kill_send_network_holesky_extension:!1,kill_send_network_sepolia_extension:!1,kill_send_network_optimism_sepolia_extension:!1,kill_send_network_ftm_testnet_extension:!1,kill_send_network_polygon_testnet_extension:!1,kill_send_network_arbitrum_sepolia_extension:!1,kill_send_network_avax_fuji_extension:!1,kill_send_network_bnb_testnet_extension:!1,kill_dapp_tx_blockchain_all_extension:!1,kill_dapp_tx_blockchain_eth_extension:!1,kill_dapp_tx_blockchain_sol_extension:!1,kill_dapp_tx_blockchain_xlm_extension:!1,kill_dapp_tx_blockchain_xrp_extension:!1,kill_dapp_tx_blockchain_btc_extension:!1,kill_dapp_tx_blockchain_bch_extension:!1,kill_dapp_tx_blockchain_doge_extension:!1,kill_dapp_tx_blockchain_ltc_extension:!1,kill_dapp_tx_network_eth_extension:!1,kill_dapp_tx_network_etc_extension:!1,kill_dapp_tx_network_bsc_extension:!1,kill_dapp_tx_network_ftm_extension:!1,kill_dapp_tx_network_gnosis_extension:!1,kill_dapp_tx_network_polygon_extension:!1,kill_dapp_tx_network_optimism_extension:!1,kill_dapp_tx_network_arbitrum_extension:!1,kill_dapp_tx_network_avalanche_c_extension:!1,kill_dapp_tx_network_base_v2_extension:!1,kill_dapp_tx_network_base_sepolia_extension:!1,kill_dapp_tx_network_goerli_base_extension:!1,kill_dapp_tx_network_holesky_extension:!1,kill_dapp_tx_network_sepolia_extension:!1,kill_dapp_tx_network_optimism_sepolia_extension:!1,kill_dapp_tx_network_ftm_testnet_extension:!1,kill_dapp_tx_network_polygon_testnet_extension:!1,kill_dapp_tx_network_arbitrum_sepolia_extension:!1,kill_dapp_tx_network_avax_fuji_extension:!1,kill_dapp_tx_network_bnb_testnet_extension:!1,kill_chain_network_eth_extension:!1,kill_chain_network_polygon_extension:!1,kill_chain_network_bsc_extension:!1,kill_chain_network_ftm_extension:!1,kill_chain_network_arbitrum_extension:!1,kill_chain_network_gnosis_extension:!1,kill_chain_network_avalanche_c_extension:!1,kill_chain_network_optimism_extension:!1,kill_chain_network_etc_extension:!1,kill_chain_network_base_v2_extension:!1,kill_chain_network_base_sepolia_extension:!1,kill_chain_network_goerli_base_extension:!1,kill_chain_network_holesky_extension:!1,kill_chain_network_sepolia_extension:!1,kill_chain_network_optimism_sepolia_extension:!1,kill_chain_network_ftm_testnet_extension:!1,kill_chain_network_polygon_testnet_extension:!1,kill_chain_network_arbitrum_sepolia_extension:!1,kill_chain_network_avax_fuji_extension:!1,kill_chain_network_bnb_testnet_extension:!1,kill_repair_db_with_wallets_if_needed_extension:!1,enable_mnemonic_escape_hatch_extension:!1,kill_repair_mnemonic_accounts_extension:!1,kill_data_migration_runner_extension:!1,kill_delete_accounts_with_no_mnemonic_extension:!1,enable_mnemonic_account_consistency_check_extension:!1,kill_cb_one_swap_fees_extension:!1,kill_explore_nft_extension:!1,kill_explore_tab_extension:!1,kill_explore_search_extension:!1,kill_explore_multichain_extension:!1,kill_explore_dynamic_module_extension:!1,kill_explore_mint_streaks_extension:!1,kill_explore_minting_service_collections_extension:!1,kill_explore_mint_dot_fun_collections_extension:!1,kill_explore_cb_nft_collections_extension:!1,kill_explore_trending_collections_tab_extension:!1,kill_explore_cta_tray_extension:!0,kill_community_tab_extension:!1,kill_stake_extension:!1,kill_staking_top_up_extension:!1,kill_stake_multi_provider_extension:!1,kill_stake_matic_extension:!1,kill_delegator_staking_extension:!1,kill_watchlist_extension:!1,kill_switch_transaction_preview_extension:!1,kill_switch_eth_pow_fork_warning:!1,kill_switch_transaction_preview_native_send_extension:!1,kill_switch_token_approvals_extension:!1,kill_tx_scanner_simulation_extension:!1,kill_eoa_approval_fraud_warning_extension:!1,kill_dapp_tx_confirmation_scam_warning_extension:!1,kill_message_scan_v1_extension:!1,kill_message_scan_v2_extension:!1,kill_message_scan_seaport_warning_extension:!1,kill_speedup_and_cancel_bip125:!1,kill_speedup_and_cancel:!1,kill_pending_utxo_aware_balances_extension:!1,kill_recent_recipients_tab_v3_extension:!1,kill_notification_settings_account_activity_extension:!1,kill_notification_settings_product_announcement_extension:!1,kill_notification_settings_promotion_extension:!1,kill_notification_settings_price_alert_extension:!1,kill_notification_settings_price_alert_btc_extension:!1,kill_notification_settings_price_alert_eth_extension:!1,kill_notification_settings_price_alert_owned_extension:!1,kill_notification_settings_price_alert_trending_extension:!1,kill_notification_settings_network_fee_alert_ethereum_extension:!1,kill_notification_settings_feature_tip_extension:!1,kill_notification_settings_trending_dapp_extension:!1,kill_notification_settings_wallet_activity_extension:!1,kill_notification_settings_nft_offers_alert_extension:!1,kill_notifications_hub_extension:!1,kill_notification_settings_wallet_messaging_extension:!1,kill_solana_web3_extension:!1,kill_solana_web3_provider_extension:!1,kill_blocklist_integration_extension:!1,kill_txhistory_nudge_blockchain_eth_extension:!1,kill_txhistory_nudge_blockchain_sol_extension:!1,kill_balance_nudge_blockchain_eth_extension:!1,kill_balance_nudge_blockchain_sol_extension:!1,enable_balance_fetching_throttle_extension:!1,kill_onramp_on_send_extension:!1,kill_onramp_on_receive_extension:!1,kill_cbpay_extension:!1,kill_testnet_faucet_extension:!1,kill_testnet_faucet_bridge_extension:!1,kill_testnet_tab_extension:!1,kill_native_asset_max_button_send_extension:!1,kill_native_asset_max_button_bridge_chain_1_extension:!1,kill_native_asset_max_button_bridge_chain_137_extension:!1,kill_native_asset_max_button_bridge_chain_8453_extension:!1,kill_native_asset_max_button_bridge_chain_42161_extension:!1,kill_native_asset_max_button_bridge_chain_10_extension:!1,kill_native_asset_max_button_stake_chain_1_extension:!1,kill_native_asset_max_button_swap_chain_1_extension:!1,kill_native_asset_max_button_swap_chain_137_extension:!1,kill_native_asset_max_button_swap_chain_56_extension:!1,kill_native_asset_max_button_swap_chain_43114_extension:!1,kill_native_asset_max_button_swap_chain_10_extension:!1,kill_native_asset_max_button_swap_chain_101_extension:!1,kill_native_asset_max_button_swap_chain_8453_extension:!1,kill_native_asset_max_button_swap_chain_42161_extension:!1,kill_revoke_approvals_extension:!1,kill_subdomain_claiming_extension:!1,enable_did_non_primary_wallets_extension:!1,enable_export_private_key_extension:!1,kill_error_boundary_escape_hatch_extension:!1,kill_create_new_mnemonic_account_extension:!1,kill_import_new_mnemonic_account_extension:!1,kill_utxo_blockheight_syncing_extension:!1,kill_utxo_pending_tx_tray_extension:!1,kill_utxo_transaction_replacement_bip_125_extension:!1,kill_change_address_filtering_extension:!1,kill_utxo_transaction_blockheight_syncing_extension:!1,kill_walletlink_link:!1,kill_spam_score_extension:!1,kill_wallet_backfilling_extension:!1,enable_replace_existing_wallets_extension:!1,kill_utxo_announcement_banner_extension:!1,kill_switch_sponsored_dapp_extension:!1,enable_sponsored_sends_1:!1,enable_sponsored_sends_10:!1,enable_sponsored_sends_137:!1,enable_sponsored_sends_42161:!1,enable_sponsored_sends_43114:!1,enable_sponsored_sends_84531:!1,kill_contentful_announcements_extension:!1,kill_switch_onchain_summer_upcoming_drops_extension:!1,kill_switch_onchain_summer_minting_extension:!1,kill_defi_education_extension:!1,kill_testnet_mode_enabled_extension:!1,enable_wallets_atom_debounce_extension:!1,kill_permissions_prompt_extension:!1,kill_advanced_mode_extension:!0,kill_referral_program_extension:!1,kill_address_scanner_extension:!1,kill_wallet_group_balances_extension:!1,kill_fe_tracing_extension:!1,kill_delete_invalid_accounts_recovery_extension:!1}},223967:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rnClientKillSwitchConfig=void 0;t.rnClientKillSwitchConfig={kill_txhistory_service_network_base_sepolia_rn:!0,kill_txhistory_service_network_goerli_base_rn:!0,kill_txhistory_service_network_holesky_rn:!0,kill_txhistory_service_network_sepolia_rn:!0,kill_txhistory_service_network_optimism_sepolia_rn:!0,kill_txhistory_service_network_ftm_testnet_rn:!0,kill_txhistory_service_network_polygon_testnet_rn:!0,kill_txhistory_service_network_arbitrum_sepolia_rn:!0,kill_txhistory_service_network_avax_fuji_rn:!0,kill_txhistory_service_network_bnb_testnet_rn:!0,kill_nft_nux_v2_ios:!0,kill_nft_nux_v2_android:!0,kill_nft_ticketing_ios:!0,kill_nft_ticketing_android:!0,kill_sponsored_gas_send_rn2:!0,kill_global_trays_on_qr_code_scan_ios:!0,kill_global_trays_on_qr_code_scan_android:!0,kill_top_up_for_all_supported_assets_ios:!0,kill_top_up_for_all_supported_assets_android:!0,kill_handle_wallet_not_found_error_ios:!1,kill_handle_wallet_not_found_error_android:!1,kill_send_via_link_ios:!1,kill_send_via_link_android:!1,kill_send_flow_pfp_ios:!1,kill_send_flow_pfp_android:!1,kill_claim_links_url_v2_ios:!0,kill_claim_links_url_v2_android:!0,kill_search_receive_asset_rn:!1,kill_edit_qr_code_ios:!1,kill_edit_qr_code_android:!1,kill_standardized_qr_codes_ios:!1,kill_standardized_qr_codes_android:!1,kill_receive_wallet_group_infos_ios:!1,kill_receive_wallet_group_infos_android:!1,enable_address_observability_ios:!1,enable_address_observability_android:!1,kill_send_blockchain_xlm_rn:!0,kill_send_blockchain_xrp_rn:!0,kill_send_blockchain_bch_rn:!0,kill_dapp_tx_blockchain_xlm_rn:!0,kill_dapp_tx_blockchain_xrp_rn:!0,kill_dapp_tx_blockchain_bch_rn:!0,kill_private_key_import_ios:!0,kill_private_key_import_android:!0,kill_switch_test:!1,kill_profile_list_cell_follow_button:!1,kill_profile_follow_counts:!1,kill_profile_pfp_list_cell:!1,kill_profile_rn:!1,kill_miami_illustrations:!1,kill_sprig_rn:!1,kill_terms_of_service_update:!1,kill_defi_tab_rn:!1,kill_watchlist_rn:!1,kill_experiments_local_override:!1,kill_attestations_rn:!1,kill_switch_profiles_balance_parity_rn:!1,kill_asset_management_rn:!1,kill_cloud_backup_trays_rn:!1,kill_cross_platform_hidden_assets_rn:!1,enable_new_settings_multi_account_rn:!1,kill_multiaccount_announcement_ios:!1,kill_multiaccount_announcement_android:!1,kill_multi_wallet_assets_long_press_rn:!1,kill_mismatched_address_force_signout_rn:!1,kill_cache_retail_accounts_ios:!1,kill_cache_retail_accounts_android:!1,kill_tabbar_visibility_toggle_rn:!1,kill_messaging_poaps_rn:!1,kill_search_result_avatar_rn:!1,kill_txhistory_service_rn:!1,kill_txhistory_service_network_eth_rn:!1,kill_txhistory_service_network_bsc_rn:!1,kill_txhistory_service_network_ftm_rn:!1,kill_txhistory_service_network_gnosis_rn:!1,kill_txhistory_service_network_polygon_rn:!1,kill_txhistory_service_network_optimism_rn:!1,kill_txhistory_service_network_arbitrum_rn:!1,kill_txhistory_service_network_avalanche_c_rn:!1,kill_txhistory_service_network_etc_rn:!1,kill_txhistory_service_sol_rn:!1,kill_txhistory_service_network_base_v2_rn:!1,enable_human_readable_transactions_v2_ios:!1,enable_human_readable_transactions_v2_android:!1,kill_txhistory_service_v3_network_bsc_rn:!1,kill_txhistory_service_v3_network_ftm_rn:!1,kill_txhistory_service_v3_network_eth_rn:!1,kill_txhistory_service_v3_network_gnosis_rn:!1,kill_txhistory_service_v3_network_polygon_rn:!1,kill_txhistory_service_v3_network_optimism_rn:!1,kill_txhistory_service_v3_network_arbitrum_rn:!1,kill_txhistory_service_v3_network_avalanche_c_rn:!1,kill_txhistory_service_v3_network_etc_rn:!1,kill_txhistory_service_sol_v3_rn:!1,kill_txhistory_service_v3_network_base_v2_rn:!1,kill_txhistory_service_v3_network_base_sepolia_rn:!1,kill_txhistory_service_v3_network_goerli_base_rn:!1,kill_txhistory_service_v3_network_holesky_rn:!1,kill_txhistory_service_v3_network_optimism_sepolia_rn:!0,kill_txhistory_service_v3_network_sepolia_rn:!0,kill_txhistory_service_v3_network_bnb_testnet_rn:!0,kill_txhistory_service_v3_network_avax_fuji_rn:!0,kill_txhistory_service_v3_network_ftm_testnet_rn:!0,kill_txhistory_service_v3_network_arbitrum_sepolia_rn:!0,kill_txhistory_service_v3_network_polygon_testnet_rn:!0,kill_unsandboxed_nfts_rn:!1,kill_switch_nft_portfolio_tab_rn:!1,kill_switch_nft_offers_tab_rn:!1,kill_switch_nft_history_tab_rn:!1,kill_switch_aggregate_bids_rn:!1,kill_switch_aggregate_listings_rn:!1,kill_gnosis_poaps_rn:!1,kill_gnosis_poaps_send_rn:!1,kill_switch_nft_send_rn:!1,kill_switch_recent_collectibles_rn:!1,kill_switch_accept_bids_ios:!1,kill_switch_accept_bids_android:!1,kill_nft_native_buy_ios:!1,kill_nft_native_buy_android:!1,kill_nft_marketplace_links_ios:!1,kill_nft_marketplace_links_android:!1,kill_polygon_nfts_rn:!1,kill_use_floor_price_rn:!1,kill_nft_collection_sort_by_chain_rn:!1,kill_nft_offers_alert_tray_ios:!1,kill_nft_offers_alert_tray_android:!1,kill_nft_round_corners_rn:!1,kill_switch_nft_send_android:!1,kill_switch_nft_send_ios:!1,kill_switch_view_solana_nft_rn:!1,kill_switch_paginated_collections_rn:!1,kill_solana_nft_refresh_rn:!1,kill_optimism_nfts_ios:!1,kill_optimism_nfts_android:!1,kill_optimism_nfts_send_ios:!1,kill_optimism_nfts_send_android:!1,kill_switch_reservoir_notification_ios:!1,kill_switch_reservoir_notification_android:!1,kill_base_nfts_ios:!1,kill_base_nfts_android:!1,kill_base_nfts_send_ios:!1,kill_base_nfts_send_android:!1,kill_wallet_music_nfts_ios:!1,kill_wallet_music_nfts_android:!1,kill_backend_based_nft_chain_config_ios:!1,kill_backend_based_nft_chain_config_android:!1,kill_nft_pfp_ios:!1,kill_nft_pfp_android:!1,kill_nft_grid_view_ios:!1,kill_nft_grid_view_android:!1,kill_collections_grid_view_ios:!1,kill_collections_grid_view_android:!1,kill_switch_pending_collectible_ios:!1,kill_switch_pending_collectible_android:!1,enable_nft_grid_increased_page_size_ios:!1,enable_nft_grid_increased_page_size_android:!1,enable_nft_tab_sorting_ios:!1,enable_nft_tab_sorting_android:!1,kill_nft_aggregated_oe721s_ios:!1,kill_nft_aggregated_oe721s_android:!1,kill_retail_suggested_destination_rn:!1,enable_mpc_initialization_ios:!1,enable_mpc_initialization_android:!1,kill_dapp_browser_ios_rn:!1,kill_dapp_browser_android_rn:!1,kill_dapp_browser_deeplinks_ios_rn:!1,kill_dapp_browser_deeplinks_android_rn:!1,kill_dapp_lists_ios:!1,kill_browser_tab_screenshot_ios:!1,kill_browser_tab_screenshot_android:!1,enable_browser_loading_status_animation_ios:!0,enable_browser_loading_status_animation_android:!0,kill_browser_nav_redesign_rn:!1,kill_browser_mute_media_injected_js_ios:!1,kill_browser_mute_media_injected_js_android:!1,kill_browser_pull_to_refresh_android:!1,kill_browser_stack_navigation:!1,kill_swap_ethereum_rn:!1,kill_swap_polygon_rn:!1,kill_swap_avax_rn:!1,kill_swap_solana_rn:!1,kill_swap_bsc_rn:!1,kill_swap_optimism_rn:!1,kill_swap_rn:!1,kill_free_usdc_swap_rn:!1,kill_private_pool_rn:!1,kill_swap_coinbase_fee_rn:!1,kill_dex_deposit_gas_ios:!1,kill_dex_deposit_gas_android:!1,kill_standardize_errors_dex_ios:!1,kill_standardize_errors_dex_android:!1,kill_gasless_swap_eth_ios:!1,kill_gasless_swap_eth_android:!1,kill_gasless_swap_polygon_ios:!1,kill_gasless_swap_polygon_android:!1,kill_adjustable_slippage_ios:!1,kill_adjustable_slippage_android:!1,kill_revert_format_decimal_ios:!1,kill_revert_format_decimal_android:!1,kill_bridge_rn:!1,kill_real_time_send_gas_fee_rn:!1,kill_recipient_suggestions_my_addresses_tab_rn:!1,kill_recipient_suggestions_recents_tab_rn:!0,kill_warning_on_send_confirmation_rn:!1,kill_send_via_link_adp_banner_ios:!1,kill_send_via_link_adp_banner_android:!1,kill_send_blockchain_all_rn:!1,kill_send_blockchain_eth_rn:!1,kill_send_blockchain_sol_rn:!1,kill_send_blockchain_btc_rn:!1,kill_send_blockchain_doge_rn:!1,kill_send_blockchain_ltc_rn:!1,kill_send_network_eth_rn:!1,kill_send_network_etc_rn:!1,kill_send_network_bsc_rn:!1,kill_send_network_ftm_rn:!1,kill_send_network_gnosis_rn:!1,kill_send_network_polygon_rn:!1,kill_send_network_optimism_rn:!1,kill_send_network_arbitrum_rn:!1,kill_send_network_avalanche_c_rn:!1,kill_send_network_base_v2_rn:!1,kill_send_network_base_sepolia_rn:!1,kill_send_network_goerli_base_rn:!1,kill_send_network_holesky_rn:!1,kill_send_network_sepolia_rn:!1,kill_send_network_optimism_sepolia_rn:!1,kill_send_network_ftm_testnet_rn:!1,kill_send_network_polygon_testnet_rn:!1,kill_send_network_arbitrum_sepolia_rn:!1,kill_send_network_avax_fuji_rn:!1,kill_send_network_bnb_testnet_rn:!1,kill_dapp_tx_blockchain_all_rn:!1,kill_dapp_tx_blockchain_eth_rn:!1,kill_dapp_tx_blockchain_sol_rn:!1,kill_dapp_tx_blockchain_btc_rn:!1,kill_dapp_tx_blockchain_doge_rn:!1,kill_dapp_tx_blockchain_ltc_rn:!1,kill_dapp_tx_network_eth_rn:!1,kill_dapp_tx_network_etc_rn:!1,kill_dapp_tx_network_bsc_rn:!1,kill_dapp_tx_network_ftm_rn:!1,kill_dapp_tx_network_gnosis_rn:!1,kill_dapp_tx_network_polygon_rn:!1,kill_dapp_tx_network_optimism_rn:!1,kill_dapp_tx_network_arbitrum_rn:!1,kill_dapp_tx_network_avalanche_c_rn:!1,kill_dapp_tx_network_base_v2_rn:!1,kill_dapp_tx_network_base_sepolia_rn:!1,kill_dapp_tx_network_goerli_base_rn:!1,kill_dapp_tx_network_holesky_rn:!1,kill_dapp_tx_network_sepolia_rn:!1,kill_dapp_tx_network_optimism_sepolia_rn:!1,kill_dapp_tx_network_ftm_testnet_rn:!1,kill_dapp_tx_network_polygon_testnet_rn:!1,kill_dapp_tx_network_arbitrum_sepolia_rn:!1,kill_dapp_tx_network_avax_fuji_rn:!1,kill_dapp_tx_network_bnb_testnet_rn:!1,kill_repair_db_with_wallets_if_needed_ios:!1,kill_repair_db_with_wallets_if_needed_android:!1,enable_mnemonic_escape_hatch_ios:!1,enable_mnemonic_escape_hatch_android:!1,kill_repair_mnemonic_accounts_ios:!1,kill_repair_mnemonic_accounts_android:!1,kill_data_migration_runner_rn:!1,enable_mnemonic_account_consistency_check_android:!1,enable_mnemonic_account_consistency_check_ios:!1,kill_show_notifications_permissions_post_onboarding_ios:!1,kill_show_notifications_permissions_post_onboarding_android:!1,kill_wallet_settings_hub_notif_optin_ios:!1,kill_wallet_settings_hub_notif_optin_android:!1,kill_load_existing_browser_tab_ios:!1,kill_load_existing_browser_tab_android:!1,kill_chain_network_eth_rn:!1,kill_chain_network_polygon_rn:!1,kill_chain_network_bsc_rn:!1,kill_chain_network_ftm_rn:!1,kill_chain_network_arbitrum_rn:!1,kill_chain_network_gnosis_rn:!1,kill_chain_network_avalanche_c_rn:!1,kill_chain_network_optimism_rn:!1,kill_chain_network_etc_rn:!1,kill_chain_network_base_v2_rn:!1,kill_chain_network_base_sepolia_rn:!1,kill_chain_network_goerli_base_rn:!1,kill_chain_network_holesky_rn:!1,kill_chain_network_sepolia_rn:!1,kill_chain_network_optimism_sepolia_rn:!1,kill_chain_network_ftm_testnet_rn:!1,kill_chain_network_polygon_testnet_rn:!1,kill_chain_network_arbitrum_sepolia_rn:!1,kill_chain_network_avax_fuji_rn:!1,kill_chain_network_bnb_testnet_rn:!1,kill_cb_one_swap_fees_rn:!1,kill_cbpay_rn:!1,enable_cbpay_sdk_ios:!1,enable_cbpay_sdk_android:!1,enable_apollo_new_cbpay_params_rn:!1,enable_apollo_skip_preview_step:!1,enable_add_card_header_rn:!1,kill_explore_multichain_android:!1,kill_explore_multichain_ios:!1,kill_explore_nft_android:!1,kill_explore_nft_ios:!1,kill_explore_search_android:!1,kill_explore_search_ios:!1,kill_explore_tab_android:!1,kill_explore_tab_ios:!1,kill_explore_quests_ios:!1,kill_explore_quests_android:!1,kill_explore_mint_streaks_ios:!1,kill_explore_mint_streaks_android:!1,kill_explore_dynamic_module_rn:!1,kill_explore_dynamic_module_ios:!1,kill_explore_dynamic_module_android:!1,kill_explore_daylight_list_module_ios:!1,kill_explore_daylight_list_module_android:!1,kill_explore_nux_screen_rn:!1,kill_explore_cta_tray_ios:!1,kill_explore_cta_tray_android:!1,kill_explore_minting_service_collections_rn:!1,kill_explore_mint_dot_fun_collections_ios:!1,kill_explore_mint_dot_fun_collections_android:!1,enable_mint_streak_collection_gtm_ios:!1,enable_mint_streak_collection_gtm_android:!1,kill_explore_cb_nft_collections_ios:!1,kill_explore_cb_nft_collections_android:!1,kill_explore_trending_collections_tab_ios:!1,kill_explore_trending_collections_tab_android:!1,kill_gas_tracker_ios:!1,kill_gas_tracker_android:!1,kill_explore_spotlight_module_ios:!1,kill_explore_spotlight_module_android:!1,kill_explore_on_home_below_crypto_ios:!1,kill_explore_on_home_below_crypto_android:!1,kill_streaks_v2_ios:!1,kill_streaks_v2_android:!1,kill_stake_rn:!1,kill_staking_top_up_rn:!1,kill_stake_multi_provider_rn:!1,kill_stake_matic_ios:!1,kill_stake_matic_android:!1,kill_delegator_staking_ios:!1,kill_delegator_staking_android:!1,kill_switch_transaction_preview_rn:!1,kill_tx_scanner_simulation_rn:!1,kill_switch_eth_pow_fork_warning:!1,kill_switch_token_approvals_rn:!1,kill_message_scan_v1_rn:!1,kill_message_scan_v2_ios:!1,kill_message_scan_v2_android:!1,kill_message_scan_seaport_warning_ios:!1,kill_message_scan_seaport_warning_android:!1,kill_eoa_approval_fraud_warning_android:!1,kill_eoa_approval_fraud_warning_ios:!1,kill_dapp_tx_confirmation_scam_warning_android:!1,kill_dapp_tx_confirmation_scam_warning_ios:!1,kill_speedup_and_cancel:!1,kill_speedup_and_cancel_bip125:!1,kill_recent_recipients_tab_v3_ios:!1,kill_recent_recipients_tab_v3_android:!1,enable_human_readable_transactions_ui_ios:!1,enable_human_readable_transactions_ui_android:!1,kill_txhistory_nudge_blockchain_eth_rn:!1,kill_txhistory_nudge_blockchain_sol_rn:!1,kill_balance_nudge_blockchain_eth_rn:!1,kill_balance_nudge_blockchain_sol_rn:!1,enable_balance_fetching_throttle_ios:!1,enable_balance_fetching_throttle_android:!1,kill_onramp_on_send_rn:!1,kill_onramp_on_receive_rn:!1,kill_minting_service_collections_rn:!1,kill_mint_dot_fun_collections_ios:!1,kill_mint_dot_fun_collections_android:!1,kill_quick_buy_eth_card:!1,kill_cb_nft_collections_ios:!1,kill_cb_nft_collections_android:!1,kill_trending_collections_tab_ios:!1,kill_trending_collections_tab_android:!1,kill_umo_rn:!1,kill_guest_checkout_ios:!1,kill_guest_checkout_android:!1,kill_cbpay_buy_default_experiment:!1,kill_unified_login_ios:!1,kill_unified_login_android:!1,kill_browser_persistent_nux_cards:!1,kill_buy_add_payment_method_rn:!1,kill_quick_buy_eth_modal_rn:!1,kill_gasless_purchase_modal_rn:!1,kill_nux_nft_incentive_retry_air_drop:!1,kill_nux_nft_incentive_ios:!1,kill_nux_nft_incentive_android:!1,kill_transak_ios:!1,kill_transak_android:!1,kill_cbke_ios:!1,kill_cbke_android:!1,kill_pending_asset_rn:!1,kill_onramp_ios:!1,kill_onramp_android:!1,kill_usdc_rewards_ios:!1,kill_usdc_rewards_android:!1,enable_force_skip_tracking_onramp_experiment_rn:!1,enable_nux_nft_incentive_entry_modal_ios:!1,enable_nux_nft_incentive_entry_modal_android:!1,enable_browser_nux_tray_ios:!1,enable_browser_nux_tray_android:!1,enable_base_browser_nux_tray_ios:!1,enable_base_browser_nux_tray_android:!1,enable_assets_tab_nux_cards_ios:!1,enable_assets_tab_nux_cards_android:!1,enable_fund_and_swap_on_explore_ios:!1,enable_fund_and_swap_on_explore_android:!1,enable_instant_funding_flow_ios:!1,enable_instant_funding_flow_android:!1,enable_web3_starter_kit_on_asset_list_ios:!1,enable_web3_starter_kit_on_asset_list_android:!1,enable_initialize_local_currency_ios:!1,enable_initialize_local_currency_android:!1,enable_onramp_currency_selector_ios:!1,enable_onramp_currency_selector_android:!1,enable_onramp_crypto_amount_ios:!1,enable_onramp_crypto_amount_android:!1,enable_nft_incentive_with_usdc_ios:!1,enable_nft_incentive_with_usdc_android:!1,kill_blocklist_integration_rn:!1,kill_bbml2_app_to_app_oauth2_v2:!1,kill_notification_settings_account_activity_rn:!1,kill_notification_settings_product_announcement_rn:!1,kill_notification_settings_promotion_rn:!1,kill_notification_settings_price_alert_rn:!1,kill_notification_settings_price_alert_btc_rn:!1,kill_notification_settings_price_alert_eth_rn:!1,kill_notification_settings_price_alert_owned_rn:!1,kill_notification_settings_price_alert_trending_rn:!1,kill_notification_settings_network_fee_alert_ethereum_rn:!1,kill_notification_settings_feature_tip_rn:!1,kill_notification_settings_trending_dapp_rn:!1,kill_notification_settings_wallet_activity_rn:!1,kill_notification_settings_nft_offers_alert_rn:!1,kill_notifications_hub_v2_rn:!1,kill_notification_settings_wallet_messaging_rn:!1,kill_solana_web3_ios:!1,kill_solana_web3_android:!1,kill_dapp_browser_top_dapps_solana:!1,kill_quests_ios:!1,kill_quests_android:!1,kill_referral_hub_rn:!1,kill_native_sdk_rn:!1,kill_check_auth_state_and_accounts_sign_out_ios:!1,kill_check_auth_state_and_accounts_sign_out_android:!1,kill_native_asset_max_button_send_android:!1,kill_native_asset_max_button_send_ios:!1,kill_native_asset_max_button_bridge_chain_1_android:!1,kill_native_asset_max_button_bridge_chain_1_ios:!1,kill_native_asset_max_button_bridge_chain_137_android:!1,kill_native_asset_max_button_bridge_chain_137_ios:!1,kill_native_asset_max_button_stake_chain_1_android:!1,kill_native_asset_max_button_stake_chain_1_ios:!1,kill_native_asset_max_button_swap_chain_1_android:!1,kill_native_asset_max_button_swap_chain_1_ios:!1,kill_native_asset_max_button_swap_chain_137_android:!1,kill_native_asset_max_button_swap_chain_137_ios:!1,kill_native_asset_max_button_swap_chain_56_android:!1,kill_native_asset_max_button_swap_chain_56_ios:!1,kill_native_asset_max_button_swap_chain_43114_android:!1,kill_native_asset_max_button_swap_chain_43114_ios:!1,kill_native_asset_max_button_swap_chain_10_android:!1,kill_native_asset_max_button_swap_chain_10_ios:!1,kill_native_asset_max_button_swap_chain_101_android:!1,kill_native_asset_max_button_swap_chain_101_ios:!1,kill_native_asset_max_button_swap_chain_8453_android:!1,kill_native_asset_max_button_swap_chain_8453_ios:!1,kill_native_asset_max_button_swap_chain_42161_ios:!1,kill_native_asset_max_button_swap_chain_42161_android:!1,kill_native_asset_max_button_bridge_chain_8453_ios:!1,kill_native_asset_max_button_bridge_chain_8453_android:!1,kill_native_asset_max_button_bridge_chain_10_ios:!1,kill_native_asset_max_button_bridge_chain_10_android:!1,kill_native_asset_max_button_bridge_chain_42161_ios:!1,kill_native_asset_max_button_bridge_chain_42161_android:!1,kill_native_asset_max_button_buy_android:!1,kill_native_asset_max_button_buy_ios:!1,kill_revoke_approvals_rn:!1,kill_subdomain_claiming_ios:!1,kill_subdomain_claiming_android:!1,enable_did_non_primary_wallets_ios:!1,enable_did_non_primary_wallets_android:!1,enable_export_private_key_ios:!1,enable_export_private_key_android:!1,kill_create_new_mnemonic_account_ios:!1,kill_create_new_mnemonic_account_android:!1,kill_import_new_mnemonic_account_ios:!1,kill_import_new_mnemonic_account_android:!1,kill_error_boundary_escape_hatch_ios:!1,kill_error_boundary_escape_hatch_android:!1,kill_messaging_ios:!1,kill_messaging_android:!1,kill_payment_messsaging_flow:!1,kill_messaging_payment_messages:!1,kill_messaging_tab_search:!1,kill_messaging_payment_request_ios:!1,kill_messaging_payment_request_android:!1,kill_messaging_attachments_ios:!1,kill_messaging_attachments_android:!1,kill_messaging_attachment_sends_ios:!1,kill_messaging_attachment_sends_android:!1,kill_messaging_mute_conversation_ios:!1,kill_messaging_mute_conversation_android:!1,kill_messaging_subscribe_ios:!1,kill_messaging_subscribe_android:!1,kill_messaging_suggestions_ios:!1,kill_messaging_suggestions_android:!1,kill_messaging_report_wallet_address_ios:!1,kill_messaging_report_wallet_address_android:!1,kill_messaging_address_scoring_ios:!1,kill_messaging_address_scoring_android:!1,kill_messaging_chatbot_referral_processing_ios:!1,kill_messaging_chatbot_referral_processing_android:!1,kill_messaging_fsto_ios:!1,kill_messaging_fsto_android:!1,kill_sign_xmtp_notification:!1,kill_request_management_ios:!1,kill_request_management_android:!1,kill_missing_mnemonic_escape_hatch_ios:!1,kill_missing_mnemonic_escape_hatch_android:!1,kill_utxo_blockheight_syncing_rn:!1,kill_utxo_pending_tx_tray_android:!1,kill_utxo_pending_tx_tray_ios:!1,kill_pending_utxo_aware_balances_android:!1,kill_pending_utxo_aware_balances_ios:!1,kill_utxo_transaction_replacement_bip_125_android:!1,kill_utxo_transaction_replacement_bip_125_ios:!1,kill_change_address_filtering_android:!1,kill_change_address_filtering_ios:!1,kill_utxo_transaction_blockheight_syncing_ios:!1,kill_utxo_transaction_blockheight_syncing_android:!1,kill_utxo_replace_by_fee_android:!1,kill_utxo_replace_by_fee_ios:!1,kill_widgets_announcement_ios:!1,kill_widgets_announcement_android:!1,kill_web3_starter_kit_ios:!1,kill_web3_starter_kit_android:!1,kill_spam_score_rn:!1,kill_switch_layout_animation_android:!1,kill_wallet_backfilling_ios:!1,kill_wallet_backfilling_android:!1,enable_replace_existing_wallets_ios:!1,enable_replace_existing_wallets_android:!1,kill_utxo_announcement_banner_ios:!1,kill_utxo_announcement_banner_android:!1,kill_payments_risk_threatmetrix_config_rn:!1,kill_br_full_name:!1,kill_jp_kyc_refresh_rn:!1,kill_reskin_kyc_refresh_ui:!1,kill_solarisbank_skip_rn:!1,kill_switch_sponsored_dapp_ios:!1,kill_switch_sponsored_dapp_android:!1,enable_sponsored_sends_1:!1,enable_sponsored_sends_10:!1,enable_sponsored_sends_137:!1,enable_sponsored_sends_8453:!1,enable_sponsored_sends_42161:!1,enable_sponsored_sends_43114:!1,enable_sponsored_sends_84531:!1,kill_contentful_announcements_ios:!1,kill_contentful_announcements_android:!1,kill_switch_onchain_summer_upcoming_drops_ios:!1,kill_switch_onchain_summer_upcoming_drops_android:!1,kill_switch_onchain_summer_minting_ios:!1,kill_switch_onchain_summer_minting_android:!1,kill_explore_upcoming_drop_notification_link_ios:!1,kill_explore_upcoming_drop_notification_link_android:!1,kill_defi_education_ios:!1,kill_defi_education_android:!1,kill_recovery_mode_ios:!1,kill_recovery_mode_android:!1,kill_testnet_mode_enabled_rn:!1,enable_instant_onboarding_ios:!1,enable_instant_onboarding_android:!1,kill_instant_onboarding_v1_ios:!1,kill_instant_onboarding_v1_android:!1,kill_instant_onboarding_full_screen_reminder_ios:!1,kill_instant_onboarding_full_screen_reminder_android:!1,kill_translate_branch_into_static_deeplink_ios:!0,kill_translate_branch_into_static_deeplink_android:!0,enable_wallets_atom_debounce_rn:!1,kill_onramp_provider_tray_ios:!1,kill_onramp_provider_tray_android:!1,enable_gift_links2_ios:!1,enable_gift_links2_android:!1,kill_send_via_link_send_input_option_ios:!1,kill_send_via_link_send_input_option_android:!1,enable_onboarding_accounts_guardrail_android:!1,enable_onboarding_accounts_guardrail_ios:!1,enable_landing_accounts_guardrail_android:!1,enable_landing_accounts_guardrail_ios:!1,kill_advanced_mode_ios:!1,kill_advanced_mode_android:!1,kill_referral_program_ios:!1,kill_referral_program_android:!1,kill_address_scanner_ios:!1,kill_address_scanner_android:!1,kill_create_wallets_activation_ios:!1,kill_create_wallets_activation_android:!1,kill_rp_secure_indicator_ios:!1,kill_rp_secure_indicator_android:!1,kill_guided_import_paths_ios:!1,kill_guided_import_paths_android:!1,kill_skip_restore_wallet_ios:!1,kill_skip_restore_wallet_android:!1,kill_wallet_group_balances_ios:!1,kill_wallet_group_balances_android:!1,kill_wallet_extension_promotion_announcement_ios:!1,kill_wallet_extension_promotion_announcement_android:!1,kill_fe_tracing_ios:!1,kill_fe_tracing_android:!1,kill_offline_notification_rn:!1,kill_switch_explore_partner_drops_ios:!1,kill_switch_explore_partner_drops_android:!1,kill_cashout_ios:!0,kill_cashout_android:!0,kill_delete_invalid_accounts_recovery_ios:!1,kill_delete_invalid_accounts_recovery_android:!1}},839668:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Blockchain=void 0;const r=n(591892),i=n(218324),a=n(51158);t.Blockchain=class{constructor(e){this.rawValue=e.toUpperCase()}toString(){return this.rawValue}static isEqual(e,t){return e.rawValue===t.rawValue}get addressCharLength(){switch(this.rawValue){case"SOL":return 44;case"ETH":case"BTC":return 42;case"LTC":return 43;case"DOGE":return 34;default:throw new Error("Blockchain not supported")}}blockExplorerUrl(e,t){switch(this.rawValue){case"ETH":{const n=t.asChain();return n?.blockExplorerUrl?`${n.blockExplorerUrl}/tx/${e}`:void 0}case"SOL":{const n=t.asChain();return n?`${n.blockExplorerUrl}/tx/${e}`:void 0}case"BTC":return`${r.BLOCK_EXPLORER_URL}/tx/${e}`;case"DOGE":return`${i.BLOCK_EXPLORER_URL}/tx/${e}`;case"LTC":return`${a.BLOCK_EXPLORER_URL}/tx/${e}`;default:return}}fullName(){switch(this.rawValue){case"ETH":return"Ethereum";case"SOL":return"Solana";case"BTC":return"Bitcoin";case"DOGE":return"Dogecoin";case"LTC":return"Litecoin";default:return}}avgConfirmationTime(){switch(this.rawValue){case"ETH":return{confirmationTime:"30",timeUnit:"seconds"};case"SOL":return{confirmationTime:"10",timeUnit:"seconds"};case"BTC":return{confirmationTime:"30",timeUnit:"minutes"};case"DOGE":return{confirmationTime:"3",timeUnit:"minutes"};case"LTC":return{confirmationTime:"8",timeUnit:"minutes"};default:return}}}},524801:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CurrencyCode=void 0;class n{constructor(e){this.code=e.toUpperCase(),this.rawValue=this.code}static isEqual(e,t){return e.rawValue===t.rawValue}get value(){return this.rawValue}}n.USD=new n("USD"),n.EUR=new n("EUR"),n.CNY=new n("CNY"),n.GBP=new n("GBP"),n.CAD=new n("CAD"),n.USDC=new n("USDC"),n.USDT=new n("USDT"),n.RUB=new n("RUB"),n.BTC=new n("BTC"),n.ETH=new n("ETH"),n.WETH=new n("WETH"),n.CETH=new n("CETH"),n.WBTC=new n("WBTC"),n.CWBTC=new n("CWBTC"),n.MATIC=new n("MATIC"),n.SOL=new n("SOL"),n.XDAI=new n("XDAI"),n.AVAX=new n("AVAX"),n.RETH=new n("RETH"),t.CurrencyCode=n},996016:function(e,t,n){"use strict";var r,i,a,s=this&&this.__decorate||function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Account=t.AccountDMO=void 0;const c=n(670431),l=n(45378),u=n(65341),h=n(494023),d=n(994450),p=n(137134),m=n(46290),f=n(157299);let y=class{};s([(0,p.PrimaryColumn)("varchar"),o("design:type",String)],y.prototype,"id",void 0),s([(0,p.Column)("datetime"),o("design:type","function"==typeof(r="undefined"!=typeof Date&&Date)?r:Object)],y.prototype,"createdAt",void 0),s([(0,p.Column)("varchar"),o("design:type","function"==typeof(i=void 0!==m.AccountType&&m.AccountType)?i:Object)],y.prototype,"type",void 0),s([(0,p.Column)("varchar",{nullable:!0}),o("design:type",Object)],y.prototype,"primaryAddressChain",void 0),s([(0,p.Column)("varchar",{nullable:!0}),o("design:type",String)],y.prototype,"primaryAddress",void 0),s([(0,p.Column)(),o("design:type",String)],y.prototype,"nickname",void 0),s([(0,p.Column)("varchar",{nullable:!0,default:"unconverted"}),o("design:type",Object)],y.prototype,"mpcConversionState",void 0),s([(0,p.Column)({nullable:!0,default:!1}),o("design:type",Boolean)],y.prototype,"isDeleted",void 0),s([(0,p.Column)("boolean",{default:!0}),o("design:type",Boolean)],y.prototype,"hasCompletedBackupFlow",void 0),s([(0,p.Column)("varchar",{nullable:!0}),o("design:type","function"==typeof(a=void 0!==f.WalletConnectionProvider&&f.WalletConnectionProvider)?a:Object)],y.prototype,"provider",void 0),y=s([(0,p.Entity)("account"),(0,p.Index)("IDX_ACCOUNT",["type","primaryAddress","primaryAddressChain"]),(0,p.Index)("IDX_ACCOUNT_CreatedAt",["createdAt"])],y),t.AccountDMO=y;class g{get asDMO(){return{id:this.id,createdAt:this.createdAt,type:this.type,primaryAddress:this.primaryAddress,primaryAddressChain:this.primaryAddressChain,nickname:this.nickname,mpcConversionState:this.mpcConversionState,isDeleted:this.isDeleted,hasCompletedBackupFlow:this.hasCompletedBackupFlow,provider:this.provider}}static isHardware(e){return(0,d.includes)(m.HARDWARE_TYPES,e)}static isMultiAccountRollup(e){return(0,d.includes)(m.MULTI_ACCOUNT_ROLLUP_TYPES,e)}static hasLocallyStoredKey(e){return(0,d.includes)(m.LOCALLY_STORED_KEY_TYPES,e)}static supportsMultiWallet(e){return(0,d.includes)(m.SUPPORTS_MULTI_WALLET_TYPES,e)}static supportsUTXO(e,t){return e===m.AccountType.DAPP_PROVIDER?(0,d.includes)([l.BITCOIN_SYMBOL,u.DOGECOIN_SYMBOL,h.LITECOIN_SYMBOL],t):(0,d.includes)(m.SUPPORTS_UTXO_TYPES,e)}static signsViaExtension(e){return(0,d.includes)(m.SIGNS_VIA_EXTENSION_TYPES,e)}get walletType(){if(this.isMPCAccount||this.isMnemonicAccount||this.isPrivateKeyAccount)return c.WalletType.standalone;if(this.isLedgerAccount)return c.WalletType.hw_wallet;if(this.isWalletlinkAccount)return c.WalletType.walletlink;if(this.isDappProviderAccount)return c.WalletType.dapp_provider;throw new Error("No WalletType matches this account type")}static fromDMO(e){return new g(e)}static generateID(e,t,n){return[e,t,n].join("/")}static isStringValidAccountId(e){return"string"==typeof e&&new RegExp(".+/.+/.+","g").test(e)}static parseAccountTypeFromId(e){const[t]=e.split("/");return t}static isMnemonicAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.MNEMONIC}static isMPCAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.MPC}static isLedgerAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.LEDGER}static isWalletlinkAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.WALLET_LINK}static isPrivateKeyAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.PRIVATE_KEY}static isDappProviderAccount(e){return g.parseAccountTypeFromId(e)===m.AccountType.DAPP_PROVIDER}static parseAddressFromId(e){const[,,t]=e.split("/");return t}static parseMnemonicOrPrivateKeyFromId(e){const t=g.parseAccountTypeFromId(e);if(t!==m.AccountType.MNEMONIC&&t!==m.AccountType.PRIVATE_KEY)throw new Error(`Invalid account type for show recovery phrase ${t}`);return t}static validateDAppProviderAccountConstruction(e){if(!e)throw new Error("provider is required when the accountType === DAPP_PROVIDER")}constructor({id:e,createdAt:t,type:n,primaryAddressChain:r,primaryAddress:i,nickname:a,mpcConversionState:s,isDeleted:o,hasCompletedBackupFlow:c,provider:l}){this.mpcConversionState="unconverted",n===m.AccountType.DAPP_PROVIDER&&g.validateDAppProviderAccountConstruction(l),this.id=e||g.generateID(n,r,i),this.createdAt=t||new Date,this.type=n,this.primaryAddressChain=r,this.primaryAddress=i,this.nickname=a||"",this.isLedgerAccount=this.type===m.AccountType.LEDGER,this.isWalletlinkAccount=this.type===m.AccountType.WALLET_LINK,this.isDappProviderAccount=this.type===m.AccountType.DAPP_PROVIDER,this.isMnemonicAccount=this.type===m.AccountType.MNEMONIC,this.isMPCAccount=this.type===m.AccountType.MPC,this.isPrivateKeyAccount=this.type===m.AccountType.PRIVATE_KEY,this.isMultiAccountRollup=g.isMultiAccountRollup(this.type),this.isHardwareAccount=g.isHardware(this.type),this.hasLocallyStoredKey=g.hasLocallyStoredKey(this.type),this.supportsMultiWallet=g.supportsMultiWallet(this.type),this.supportsUTXO=g.supportsUTXO(this.type,r),this.signsViaExtension=g.signsViaExtension(this.type),this.provider=l,this.mpcConversionState=s??m.DEFAULT_MPC_CONVERSION_STATE,this.isDeleted=o??!1,this.hasCompletedBackupFlow=c??!0}}t.Account=g},46290:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTS_UTXO_TYPES=t.DEFAULT_MPC_CONVERSION_STATE=t.SUPPORTS_MULTI_WALLET_TYPES=t.LOCALLY_STORED_KEY_TYPES=t.SIGNS_VIA_EXTENSION_TYPES=t.MULTI_ACCOUNT_ROLLUP_TYPES=t.HARDWARE_TYPES=t.AccountType=void 0,function(e){e.MNEMONIC="mnemonic",e.PRIVATE_KEY="private_key",e.WALLET_LINK="wallet_link",e.LEDGER="ledger",e.TREZOR="trezor",e.MPC="mpc",e.DAPP_PROVIDER="dapp_provider"}(n=t.AccountType||(t.AccountType={})),t.HARDWARE_TYPES=[n.LEDGER,n.TREZOR],t.MULTI_ACCOUNT_ROLLUP_TYPES=[...t.HARDWARE_TYPES,n.PRIVATE_KEY],t.SIGNS_VIA_EXTENSION_TYPES=[n.MNEMONIC,n.MPC,n.PRIVATE_KEY,n.LEDGER,n.TREZOR,n.DAPP_PROVIDER],t.LOCALLY_STORED_KEY_TYPES=[n.MNEMONIC,n.MPC,n.PRIVATE_KEY],t.SUPPORTS_MULTI_WALLET_TYPES=[n.MNEMONIC,n.MPC],t.DEFAULT_MPC_CONVERSION_STATE="unconverted",t.SUPPORTS_UTXO_TYPES=[n.MNEMONIC,n.MPC]},157299:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConnectionProvider=void 0,function(e){e.COINBASE_WALLET="coinbase-wallet",e.METAMASK="metamask",e.PHANTOM="phantom",e.WALLET_CONNECT="wallet-connect"}(t.WalletConnectionProvider||(t.WalletConnectionProvider={}))},328332:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddressType=void 0;t.AddressType=class{constructor(e){this.rawValue=e}}},408027:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDataFromBlocklist=t.BLOCKLIST_REQUEST_TIMEOUT=t.DappSource=void 0;const r=n(49982),i=n(134813),a=n(245430);!function(e){e.SERVICE_WORKER="SERVICE_WORKER",e.EXTENSION_REQUEST="EXTENSION_REQUEST",e.DAPP_BROWSER="DAPP_BROWSER",e.MOBILE_SDK="MOBILE_SDK"}(t.DappSource||(t.DappSource={})),t.BLOCKLIST_REQUEST_TIMEOUT=750,t.fetchDataFromBlocklist=async function({domains:e,appOrigin:n},s){const o=e.map((e=>e.replace("www.",""))),c=(new Date).getTime();let l,u=0;try{(0,a.blocklistRequestMadeEvent)(n,s);const e=await(0,r.postJSON)("blocklist",{domains:o});e?.result.length&&(0,a.maliciousDomainsFoundEvent)(n,s),l=e}catch(t){t instanceof i.HTTPError&&(0,a.blocklistRequestErrorEvent)(e,n,t.status,s)}u=(new Date).getTime();const h=u-c;return h>t.BLOCKLIST_REQUEST_TIMEOUT&&(0,a.requestTimeoutEvent)(n,s,h),l}},245430:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestTimeoutEvent=t.blocklistRequestErrorEvent=t.maliciousDomainsFoundEvent=t.blocklistRequestMadeEvent=void 0;const r=n(160593),i=n(86296);t.blocklistRequestMadeEvent=function(e,t){return(0,r.logDataEvent)("blocklist.request_made",{loggingId:"eea42880-0aa3-4ff2-a9e2-2196f160dea8",dappUrl:e,dappSource:t})},t.maliciousDomainsFoundEvent=function(e,t){return(0,r.logDataEvent)("blocklist.malicious_domains_found",{loggingId:"6fc621a7-42e0-4a3b-bc66-b70bb2928634",dappUrl:e,dappSource:t})},t.blocklistRequestErrorEvent=function(e,t,n,a){(0,r.logDataEvent)("blocklist.blocklist_fetch_error",{loggingId:"ae57da5a-1870-493d-b6ab-9554d76f635e",dappUrl:t,dappSource:a,status:n.toString()});const s={domains:e,status:n};(0,i.cbReportError)({error:new Error("Blocklist API is not fetching data"),context:"http_error",...s,severity:"error",isHandled:!1})},t.requestTimeoutEvent=function(e,t,n){return(0,r.logDataEvent)("blocklist.request_timeout",{loggingId:"53c69854-f1e9-4264-b4d4-0a60931a09fd",dappUrl:e,dappSource:t,elapsedTime:n})}},305944:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchIsKillSwitchKilled=void 0;const r=n(193479);t.fetchIsKillSwitchKilled=async function(e){return new Promise((t=>{(0,r.fetchKillSwitches)().then((n=>{n?.[e]&&t(!0),t(!1)}))}))}},886855:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.chainComponentsFromNetworkRawValue=t.Network=t.TESTNET_PREFIX=void 0;const i=n(108389),a=n(327242),s=n(575561),o=n(733711),c=r(n(830733));t.TESTNET_PREFIX="TESTNET";const l=(0,c.default)((function(e){const t=e.split("/");if(2!==t.length)return;const n=t[0],r=JSON.parse(t[1]);return"boolean"==typeof r?new u(n,r):void 0}));class u{constructor(e,t=!1){this.isTestnet=t,this.rawValue=[e,String(t)].join("/")}static createTestnetNetwork(e){return new u(t.TESTNET_PREFIX,e)}static create(e){return l(e)}static isEqual(e,t){return e.rawValue===t.rawValue}static fromChainId({chainPrefix:e=i.ETHEREUM_PREFIX,chainId:t}){let n=a.EthereumNetworkMap.fromChainId(t);return e===o.SOLANA_PREFIX&&(n=s.SolanaNetworkMap.fromChainId(t)),new u(`${e}:${t}`,n?.isTestnet??!1)}static fromSupportedChain(e){return new u(`${e.prefix}:${e.chainId}`,!1)}asChain(){const{chainPrefix:e,chainId:n}=(0,t.chainComponentsFromNetworkRawValue)(this.rawValue);if(e&&n)switch(e){case i.ETHEREUM_PREFIX:return a.EthereumNetworkMap.fromChainId(n);case o.SOLANA_PREFIX:return s.SolanaNetworkMap.fromChainId(n);default:return}}}t.Network=u;const h={chainId:void 0,chainPrefix:void 0};t.chainComponentsFromNetworkRawValue=(0,c.default)((function(e){if(!e)return h;const t=e.split("/");if(2!==t.length)return h;const n=t[0],r=n?.split(":")??[];if(2!==r.length)return h;const i=r[0],a=r[1];return{chainPrefix:i,chainId:"undefined"===a?void 0:BigInt(a)}}))},899871:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkSetting=t.NetworkSettingItem=void 0;const r=n(886855);class i{constructor(e,t){this.name=e,this.network=t}}t.NetworkSettingItem=i;class a{constructor(e,t,n,r,i=[]){this.blockchain=e,this.defaultMainnet=t,this.mainnets=n,this.testnets=r,this.customNetworks=i}get defaultNetworks(){return[...this.mainnets,...this.testnets]}get allNetworks(){return[...this.mainnets,...this.testnets,...this.customNetworks]}get mainnetsAndCustomNetworks(){return[...this.mainnets,...this.customNetworks]}static forMainnetOnlyBlockchain(e){const t=new i("Mainnet",r.Network.createTestnetNetwork(!1));return new a(e,t,[t],[])}}t.NetworkSetting=a},346722:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConfiguration=void 0;t.WalletConfiguration=class{constructor(e){Object.assign(this,e)}imageURLForNetwork(e){return this.imageURL}currencyCodeForNetwork(e){return this.currencyCode}get minimumBalance(){}}},151886:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFavicon=void 0;const r=n(936803);t.getFavicon=function({url:e,faviconQuality:t}){const{hostname:n,protocol:i}=(0,r.safeParseUrl)(e??"");return n?`https://t2.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${i}://${n}&size=${t}`:void 0}},994450:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.includes=void 0,t.includes=function(e,t){return e.includes(t)}},936803:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeUrl=t.isExternalProtocol=t.appendQuery=t.buildUrl=t.parseUrl=t.googleSearchURL=t.isURL=t.safeParseUrl=t.buildValidURL=t.BUILD_VALID_URL_ERROR_PREFIX=void 0;const i=r(n(764846));function a(e){let t;return t=e.toLowerCase().startsWith("https://")||e.toLowerCase().startsWith("http://")?e:`https://${e}`,t}function s(e){return e.endsWith(":")?e.substr(0,e.length-1):e}function o(e){const t=new i.default(e,!0);return{protocol:s(t.protocol),hostname:t.hostname,params:t.query,pathname:t.pathname,host:t.host,origin:`${t.protocol}${t.slashes?"//":""}${t.host}`}}function c(e,t={}){if(0===Object.keys(t).length)return e;const n=new URLSearchParams(t);return n.sort(),`${e}?${n.toString()}`}t.BUILD_VALID_URL_ERROR_PREFIX="invalid_url",t.buildValidURL=function(e){try{return new URL(a(e))}catch(e){return`${t.BUILD_VALID_URL_ERROR_PREFIX}:${String(e)}`}},t.safeParseUrl=function(e){try{return o(e)}catch(e){return{protocol:"",hostname:"",params:{},pathname:"",host:"",origin:""}}},t.isURL=function(e){const t=a(e);return/^(?:\w+:)?\/\/([^\s.]+\.\S{2}|localhost[:?\d]*)\S*$/.test(t)},t.googleSearchURL=function(e){const t=encodeURIComponent(e);try{return new URL(`https://www.google.com/search?q=${t}`)}catch(e){return t}},t.parseUrl=o,t.buildUrl=c,t.appendQuery=function(e,t={}){const{params:n,pathname:r,origin:i}=o(e);return c(`${i}${r}`,{...n,...t})},t.isExternalProtocol=function(e){if("about:blank"===e)return!1;const t=s(new i.default(e,!0).protocol).toLowerCase();return!!t?.length&&!["http","https","ws","wss","cbwallet","walletswap"].includes(t)},t.sanitizeUrl=function(e){return e?.replace(/\u200B/g,"").trim()??""}},211774:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POAP_API_KEY=t.IS_PRODUCTION=t.horizonUrl=t.walletBlockchainUrl=t.isNonExtensionUiTest=t.isUiTest=t.isE2eTest=t.CB_API_URL=t.SOLANA_RPC_URL=t.CB_WALLET_CHAIN_PROXY_URL=t.CB_WALLET_API_DEV_URL=t.CB_WALLET_API_URL=void 0,t.CB_WALLET_API_URL="https://api.wallet.coinbase.com",t.CB_WALLET_API_DEV_URL="https://wallet-api-dev.cbhq.net",t.CB_WALLET_CHAIN_PROXY_URL="MISSING_ENV_VAR".CB_WALLET_CHAIN_PROXY_URL??"https://chain-proxy.wallet.coinbase.com",t.SOLANA_RPC_URL="https://sol-mainnet.wallet.coinbase.com",t.CB_API_URL="https://api.coinbase.com",t.isE2eTest="MISSING_ENV_VAR".TARGET_ENV?.includes("e2e")??!1,t.isUiTest=t.isE2eTest,t.isNonExtensionUiTest=t.isUiTest&&!"MISSING_ENV_VAR".TARGET_ENV?.includes("extension"),t.walletBlockchainUrl=t.isUiTest?`${t.CB_WALLET_API_URL}/mock-blockchain`:"MISSING_ENV_VAR".CB_WALLET_BLOCKCHAIN_URL??"https://blockchain.wallet.coinbase.com",t.horizonUrl=t.isNonExtensionUiTest?`${t.CB_WALLET_API_URL}/horizon-stellar`:"https://horizon.stellar.org";t.IS_PRODUCTION=!0,t.POAP_API_KEY="SPBwPfc3VdYhoBFKdmsnpYg3UKf8AeJuWp3uprYqB6xKZk4awjSC4NgEVCc7FecN3ExXLO0n4xcmy51rznLnY4dyBpIVaqm4KxAwWHAiGt6hvspXDbrsewCLakGAItyM"},676399:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ethProductionUrls=void 0;const r=n(211774);t.ethProductionUrls={ETHEREUM_MAINNET:{blockExplorerUrl:"https://etherscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=ethereum-mainnet`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL,privatePoolApi:"https://pool.usemerkle.com/transactions"},OPTIMISM_MAINNET:{blockExplorerUrl:"https://optimistic.etherscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=optimism-mainnet`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},BASE_MAINNET:{blockExplorerUrl:"https://explorer.base.org",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=base`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},POLYGON_MAINNET:{blockExplorerUrl:"https://polygonscan.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=polygon-mainnet`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},BNB_MAINNET:{blockExplorerUrl:"https://bscscan.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=bsc`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},FANTOM_MAINNET:{blockExplorerUrl:"https://ftmscan.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=fantom`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},ARBITRUM_MAINNET:{blockExplorerUrl:"https://arbiscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=arbitrum`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},GNOSIS_MAINNET:{blockExplorerUrl:"https://blockscout.com/poa/xdai",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=xdai`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},AVALANCHE_MAINNET:{blockExplorerUrl:"https://snowtrace.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=avalanche`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},SEPOLIA:{blockExplorerUrl:"https://sepolia.etherscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=ethereum-sepolia`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},HOLESKY:{blockExplorerUrl:"https://holesky.etherscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=ethereum-holesky`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},OP_SEPOLIA:{blockExplorerUrl:"https://optimism-sepolia.blockscout.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=optimism-sepolia`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},BASE_SEPOLIA:{blockExplorerUrl:"https://sepolia-explorer.base.org",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=base-sepolia`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},BASE_GOERLI:{blockExplorerUrl:"https://goerli-explorer.base.org",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=base-goerli`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},POLYGON_TESTNET:{blockExplorerUrl:"https://mumbai.polygonscan.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=polygon-mumbai`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},BNB_TESTNET:{blockExplorerUrl:"https://testnet.bscscan.com",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=bsc-testnet`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},FANTOM_TESTNET:{blockExplorerUrl:"https://testnet.ftmscan.com",rpcUrl:"https://rpc.ankr.com/fantom_testnet",etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},ARBITRUM_SEPOLIA:{blockExplorerUrl:"https://sepolia.arbiscan.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=arbitrum-sepolia`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},AVALANCHE_FUJI:{blockExplorerUrl:"https://testnet.snowtrace.io",rpcUrl:`${r.CB_WALLET_CHAIN_PROXY_URL}?targetName=avalanche-fuji`,etherscanCompatibleTxHistoryApi:r.CB_WALLET_CHAIN_PROXY_URL},LOCALHOST_8545:{blockExplorerUrl:"",rpcUrl:"http://127.0.0.1:8545",etherscanCompatibleTxHistoryApi:""}}},773200:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.refreshAccessToken=void 0;const r=n(49982);t.refreshAccessToken=async function(e){const{result:t}=await(0,r.postJSON)("refreshAccessToken",{refreshToken:e});return t}},608634:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.revokeAccessToken=t.EMPTY_REFRESH_TOKEN_RESULT=t.refreshAccessToken=void 0;const r=n(773200),i=n(368856);let a;t.refreshAccessToken=async function(e){const t=(0,i.getRefreshTokenFromStorage)();if(!t)throw new Error("Attempted to refresh access token without a refresh token. This can't work.");let n;try{return a||(a=(0,r.refreshAccessToken)(t)),n=await a,e(n),n.token}finally{a=void 0}},t.EMPTY_REFRESH_TOKEN_RESULT={token:"",expiresIn:Number.MAX_SAFE_INTEGER,refreshToken:""},t.revokeAccessToken=async function(){const e=(0,i.getRefreshTokenFromStorage)();if(e)try{return a&&await a,a=(0,r.refreshAccessToken)(e).then((()=>t.EMPTY_REFRESH_TOKEN_RESULT)),void await a}catch{}finally{a=void 0}}},368856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAuthTokensImperative=t.getRefreshTokenFromStorage=t.getAccessTokenFromStorage=t.StoreKeys_refreshToken=t.StoreKeys_accessToken=void 0;const r=n(298801),i=n(485599);t.StoreKeys_accessToken=new r.LocalStorageStoreKey("accessToken"),t.StoreKeys_refreshToken=new r.LocalStorageStoreKey("refreshToken"),t.getAccessTokenFromStorage=function(){return i.Store.get(t.StoreKeys_accessToken)},t.getRefreshTokenFromStorage=function(){return i.Store.get(t.StoreKeys_refreshToken)},t.setAuthTokensImperative=function(e){i.Store.set(t.StoreKeys_accessToken,e.token),i.Store.set(t.StoreKeys_refreshToken,e.refreshToken)}},134813:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HTTPError=void 0;class n extends Error{constructor(e,t,n,r,i){super(n),this.status=e,this.code=t,this.message=n,this.description=r,this.errorDetail=i}}t.HTTPError=n},39963:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRequestFailedError=void 0;class n extends Error{constructor(e,t){super(e),this.message=e,this.endpoint=t}}t.NetworkRequestFailedError=n},102495:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setUserIdInStorage=t.getUserIdFromStorage=t.StoreKeys_userId=void 0;const r=n(298801),i=n(485599);t.StoreKeys_userId=new r.LocalStorageStoreKey("userId"),t.getUserIdFromStorage=function(){return i.Store.get(t.StoreKeys_userId)},t.setUserIdInStorage=function(e){i.Store.set(t.StoreKeys_userId,e)}},445420:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAbortSignal=t.abortAllHTTPRequests=void 0;let n=new AbortController;t.abortAllHTTPRequests=function(){n.abort(),n=new AbortController},t.getAbortSignal=function(){return n.signal}},49982:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthError=t.postFile=t.deleteJSON=t.postJSON=t.fetchWithBodyJSON=t.getJSON=t.getFetchResponse=t.fetchJSON=t.request=t.StoreKeys_chaosTestingServiceGroups=void 0;const r=n(211774),i=n(608634),a=n(368856),s=n(102495),o=n(990656),c=n(298801),l=n(485599),u=n(395545),h=n(445420),d=n(359513),p=n(39963),m=n(474449),f=n(22157),y=new c.LocalStorageStoreKey("baseUrl");async function g(e,n,s){const{method:c,authenticated:f,retried:_,apiVersion:b=2,isThirdParty:v=!1,service:w="rpc",forceDevEnvironment:E}=s,T=l.Store.get(y)||r.CB_WALLET_API_URL,S=l.Store.get(t.StoreKeys_chaosTestingServiceGroups)||"";let N;N=v?new URL(e):new URL(`${E?r.CB_WALLET_API_DEV_URL:T}/${w}/v${b}/${e}`),"GET"===c&&n&&(N.search=n);const A=N.toString().replace(/\/$/,""),{version:C,platform:x,appsFlyerAppID:M}=(0,o.getApplicationMetadata)(),R=(0,m.startNetworkSpan)(e),O={Accept:"application/json",...s.skipBlockingHeaders?{}:{"X-App-Version":C??"","X-Platform-Name":x??"","X-Appsflyer-Id":M??""},...s.additionalHeaders,...f?{Authorization:`Bearer ${(0,a.getAccessTokenFromStorage)()}`}:null,...S?{"X-Cb-Egw-Simulate-Killswitch":S.replace(/, *$/,"")}:null,...(0,u.getAnalyticsHeaders)(),...(0,m.getNetworkTracingHeaders)(R)},I=["POST","DELETE"].includes(c)?{method:c,body:n}:null,k={headers:O,signal:(0,h.getAbortSignal)(),...I};let P;try{P=await fetch(A,k)}catch(t){if(t instanceof Error)throw new p.NetworkRequestFailedError(t.message,e);throw t}if(P.status>=400){if(f&&401===P.status&&!_)return await(0,i.refreshAccessToken)(s.setAuthTokens),g(e,n,{...s,retried:!0});await(0,d.handleHTTPError)(P)}let L=null;return s.isTextResponse&&P.ok?L=await P.text():P.ok&&(L=await P.json()),(0,m.stopNetworkTrace)(R,{error:Number(Boolean(P.status>=400))}),{status:P.status,body:L,headers:Object.fromEntries(P.headers?.entries()??[])}}function _(){const{platform:e}=(0,o.getApplicationMetadata)();return e===u.PlatformName.extension?"production":e===u.PlatformName.web?"MISSING_ENV_VAR".NEXT_PUBLIC_RELEASE_STAGE??"local":"MISSING_ENV_VAR".RELEASE_STAGE??"development"}async function b(e,t,n){const r=(0,s.getUserIdFromStorage)();return g(e,t,{...n,additionalHeaders:{"Content-Type":"application/json",...n.skipBlockingHeaders?{}:{"X-Wallet-User-Id":r},...n.skipBlockingHeaders?{}:{"X-Release-Stage":_()},...n.additionalHeaders??{}}})}async function v(e,t,n){return b(e,new URLSearchParams(t).toString(),{method:"GET",...n})}async function w(e,t,{returnHeaders:n,...r}){const i=(0,f.isEmptyObject)(t)?void 0:JSON.stringify(t,E),a=await b(e,i,r);return n?a:a.body}function E(e,t){return"bigint"==typeof t?t.toString():t}t.StoreKeys_chaosTestingServiceGroups=new c.LocalStorageStoreKey("chaosTestingServiceGroups"),t.request=g,t.fetchJSON=b,t.getFetchResponse=v,t.getJSON=async function(e,t,n){return(await v(e,t,n)).body},t.fetchWithBodyJSON=w,t.postJSON=async function(e,t,n){return w(e,t,{method:"POST",...n})},t.deleteJSON=async function(e,t,n){return w(e,t,{method:"DELETE",...n})},t.postFile=async function(e,t,n){const r=await g(e,t,{method:"POST",...n});return n?.returnHeaders?r:r.body},t.isAuthError=function(e){return"refreshToken is invalid"===e.message}},359513:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleHTTPError=void 0;const r=n(134813);t.handleHTTPError=async function(e){let t;try{t=(await e.json()).error}catch{throw new r.HTTPError(e.status,"","",void 0,void 0)}throw new r.HTTPError(e.status,t?.code,t?.message??t?.error,t?.description,t?.errorDetail??t?.details)}},474449:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNetworkTracingHeaders=t.stopNetworkTrace=t.startNetworkSpan=t.canSendTrace=t.DEFAULT_SAMPLING_LOGIC=void 0;const r=n(990656),i=n(395545);function a(e=t.DEFAULT_SAMPLING_LOGIC){return Math.random()<=e}t.DEFAULT_SAMPLING_LOGIC=.05,t.canSendTrace=a,t.startNetworkSpan=function(e){if(!a())return null;const t=Date.now(),{version:n}=(0,r.getApplicationMetadata)();return(0,i.createNewSpan)({name:"network_request",resource:(s=e,s.replace(/\?.*$/,"")),start:t,meta:{version:n??"0.0.0"}});var s},t.stopNetworkTrace=function(e,t={}){var n;if(e)try{const r=Date.now();(0,i.logTrace)([e],{duration:r-(n=e.start,Math.ceil(n/1e6)),...t})}catch(e){reportError(e)}},t.getNetworkTracingHeaders=function(e){return e?(0,i.getTracingHeadersFromSpan)(e):{}}},22157:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=void 0,t.isEmptyObject=function(e){return 0===Object.keys(e).length}},990656:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlatformName=t.getApplicationMetadata=t.setApplicationMetadata=t.getClientType=t.WALLET_WEB_CLIENT_TYPE=t.WALLET_EXTENSION_CLIENT_TYPE=t.WALLET_IOS_CLIENT_TYPE=t.WALLET_ANDROID_CLIENT_TYPE=void 0;const r=n(247359);t.WALLET_ANDROID_CLIENT_TYPE=7,t.WALLET_IOS_CLIENT_TYPE=6,t.WALLET_EXTENSION_CLIENT_TYPE=8,t.WALLET_WEB_CLIENT_TYPE=9;const i={[r.PlatformName.ios]:t.WALLET_IOS_CLIENT_TYPE,[r.PlatformName.android]:t.WALLET_ANDROID_CLIENT_TYPE,[r.PlatformName.extension]:t.WALLET_EXTENSION_CLIENT_TYPE,[r.PlatformName.web]:t.WALLET_WEB_CLIENT_TYPE};let a;function s(){if(!a)throw new Error("cb-wallet-data initialization error: setApplicationMetadata must be called prior to getApplicationMetadata.");return a}function o(){return s().platform}t.getClientType=function(){return i[o()]},t.setApplicationMetadata=function(e){a=a?{...a,...e}:e},t.getApplicationMetadata=s,t.getPlatformName=o},608814:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolanaWeb3Method=void 0,function(e){e.connect="connect",e.signMessage="signMessage",e.signTransaction="signTransaction",e.signAllTransactions="signAllTransactions",e.sendTransaction="sendTransaction"}(t.SolanaWeb3Method||(t.SolanaWeb3Method={}))},46668:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolanaWeb3Response=void 0,function(e){e.connectionSuccess="solanaConnectionSuccess",e.connectionDeny="solanaConnectionDeny",e.signMessageSuccess="signSolanaMessageSuccess",e.signMessageDeny="signSolanaMessageDeny",e.sendTransactionSuccess="sendSolanaTransactionSuccess",e.sendTransactionDeny="sendSolanaTransactionDeny",e.signTransactionSuccess="signSolanaTransactionSuccess",e.signTransactionDeny="signaSolanaTransactionDeny",e.signAllTransactionsSuccess="signAllSolanaTransactionsSuccess",e.signAllTransactionsDeny="signAllSolanaTransactionsDeny",e.parentDisconnected="parentDisconnected",e.featureFlagOff="featureFlagOff",e.web3RequestCanceled="web3RequestCanceled"}(t.SolanaWeb3Response||(t.SolanaWeb3Response={}))},485599:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=t.StoreClass=void 0;const r=n(873843),i=n(63335),a=n(236374);class s{constructor(){this.localStorage=new i.LocalStorage,this.memoryStorage=new a.MemoryStorage,this.isOpen=!0}open(){this.isOpen=!0}set(e,t){this.isOpen&&this.storageForKey(e).set(e,t)}get(e){return this.storageForKey(e).get(e)}has(e){const t=this.get(e);return null!=t}clear(e){this.isOpen=!1,this.deleteAllEntries([r.StoreKind.LocalStorage,r.StoreKind.Memory],e)}deleteAllEntries(e,t){e.forEach((e=>{e===r.StoreKind.LocalStorage&&this.localStorage.clear(t),e===r.StoreKind.Memory&&this.memoryStorage.clear()}))}storageForKey(e){switch(e.kind){case r.StoreKind.LocalStorage:return this.localStorage;case r.StoreKind.Memory:return this.memoryStorage;default:throw new Error("Switch statements must be exhaustive")}}}t.StoreClass=s,t.Store=new s},298801:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageStoreKey=void 0;const r=n(331089),i=n(873843);class a extends r.StoreKey{constructor(e,t){super(e,t,i.StoreKind.LocalStorage)}}t.LocalStorageStoreKey=a},191501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStorageKey=void 0;const r=n(331089),i=n(873843);class a extends r.StoreKey{constructor(e,t){super(e,t,i.StoreKind.Memory)}}t.MemoryStorageKey=a},331089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoreKey=void 0;t.StoreKey=class{constructor(e,t,n){this.id=e,this.uuid=t,this.kind=n,this.name=[this.id,t,n].filter((e=>e)).join("_")}}},873843:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoreKind=void 0,function(e){e[e.LocalStorage=0]="LocalStorage",e[e.Memory=1]="Memory"}(t.StoreKind||(t.StoreKind={}))},63335:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorage=void 0;const r=n(271126);class i{constructor(){this.storageScope="CBStore.plaintext"}set(e,t){if("undefined"==typeof window||void 0===window.localStorage)return;if(null==t)return void localStorage.removeItem(this.scopedKey(e.name));const n=(0,r.stringify)(t);localStorage.setItem(this.scopedKey(e.name),n)}get(e){if("undefined"==typeof window||void 0===window.localStorage)return;const t=localStorage.getItem(this.scopedKey(e.name));if(null==t)return;const n=(0,r.parse)(t),a=i.mappedPrototypes.get(e.name);if(a){const e=Object.create(a);return Object.assign(e,n),e}return n}clear(e){if("undefined"==typeof window||void 0===window.localStorage)return;const t=this.scopedKey(""),n=[];for(let r=0;r<localStorage.length;r++){const i=localStorage.key(r);"string"!=typeof i||!i.startsWith(t)||e?.exceptions&&!this.shouldKeyBeCleared(i,e.exceptions)||n.push(i)}n.forEach((e=>localStorage.removeItem(e)))}scopedKey(e){return`${this.storageScope}:${e}`}shouldKeyBeCleared(e,t){for(const n of t)if(this.scopedKey(n.name)===e)return!1;return!0}}i.mappedPrototypes=new Map,t.LocalStorage=i},236374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryStorage=void 0;t.MemoryStorage=class{constructor(){this.storage=new Map}set(e,t){this.storage.set(e.name,t)}get(e){return this.storage.get(e.name)}clear(){this.storage.clear()}}},271126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.stringify=void 0,t.stringify=function(e){return JSON.stringify(e,((e,t)=>"bigint"==typeof t?`bigint:${t.toString()}`:t))},t.parse=function(e){return JSON.parse(e,((e,t)=>"string"==typeof t&&t.startsWith("bigint:")?BigInt(t.substr(7)):t))}},628656:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHostNameForDapp=void 0,t.getHostNameForDapp=function(e,t=!1){let n="";try{n=new URL(e).hostname.toLocaleLowerCase(),t&&(n=n.replace("www.",""))}catch{n=""}return n}},340674:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.yn=void 0,t.yn=function(e){if(null==e)return!1;const t=String(e).trim();return!!/^(?:y|yes|true|1|on)$/i.test(t)}},405167:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ethereumUrls=void 0;const r=n(211774);const i={...n(676399).ethProductionUrls},a=Object.keys(i).reduce(((e,t)=>({...e,[t]:{blockExplorerUrl:`${r.CB_WALLET_API_URL}/mock-block-explorer`,rpcUrl:`${r.CB_WALLET_API_URL}/mock-chain-rpc`,etherscanCompatibleTxHistoryApi:`${r.CB_WALLET_API_URL}/mock-etherscan-${t}`}})),{});t.ethereumUrls=r.isNonExtensionUiTest?a:i},846353:function(e,t,n){var r;!function(i,a){"use strict";var s="function",o="undefined",c="object",l="string",u="major",h="model",d="name",p="type",m="vendor",f="version",y="architecture",g="console",_="mobile",b="tablet",v="smarttv",w="wearable",E="embedded",T="Amazon",S="Apple",N="ASUS",A="BlackBerry",C="Browser",x="Chrome",M="Firefox",R="Google",O="Huawei",I="LG",k="Microsoft",P="Motorola",L="Opera",D="Samsung",q="Sharp",B="Sony",j="Xiaomi",$="Zebra",U="Facebook",F="Chromium OS",K="Mac OS",W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},V=function(e,t){return typeof e===l&&-1!==H(t).indexOf(H(e))},H=function(e){return e.toLowerCase()},Q=function(e,t){if(typeof e===l)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},z=function(e,t){for(var n,r,i,o,l,u,h=0;h<t.length&&!l;){var d=t[h],p=t[h+1];for(n=r=0;n<d.length&&!l&&d[n];)if(l=d[n++].exec(e))for(i=0;i<p.length;i++)u=l[++r],typeof(o=p[i])===c&&o.length>0?2===o.length?typeof o[1]==s?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==s||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):a:this[o[0]]=u?o[1].call(this,u,o[2]):a:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):a):this[o]=u||a;h+=2}},G=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(V(t[n][r],e))return"?"===n?a:n}else if(V(t[n],e))return"?"===n?a:n;return e},Y={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,f],[/opios[\/ ]+([\w\.]+)/i],[f,[d,L+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[d,L]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[d,"UC"+C]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[d,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[d,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+C],f],[/\bfocus\/([\w\.]+)/i],[f,[d,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[d,L+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[d,L+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[d,"MIUI "+C]],[/fxios\/([-\w\.]+)/i],[f,[d,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[d,"360 "+C]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1 "+C],f],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[d,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,U],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[d,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[d,x+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,x+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[d,"Android "+C]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[f,G,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[d,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[d,f],[/(cobalt)\/([\w\.]+)/i],[d,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,H]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,"",H]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,H]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[m,D],[p,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[m,D],[p,_]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[m,S],[p,_]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[m,S],[p,b]],[/(macintosh);/i],[h,[m,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[m,q],[p,_]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[m,O],[p,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[m,O],[p,_]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[m,j],[p,_]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[m,j],[p,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[m,"OPPO"],[p,_]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[m,"Vivo"],[p,_]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[m,"Realme"],[p,_]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[m,P],[p,_]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[m,P],[p,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[m,I],[p,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[m,I],[p,_]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[m,"Lenovo"],[p,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[m,"Nokia"],[p,_]],[/(pixel c)\b/i],[h,[m,R],[p,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[m,R],[p,_]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[m,B],[p,_]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[m,B],[p,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[m,"OnePlus"],[p,_]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[m,T],[p,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[m,T],[p,_]],[/(playbook);[-\w\),; ]+(rim)/i],[h,m,[p,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[m,A],[p,_]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[m,N],[p,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[m,N],[p,_]],[/(nexus 9)/i],[h,[m,"HTC"],[p,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[h,/_/g," "],[p,_]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[m,"Acer"],[p,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[m,"Meizu"],[p,_]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,h,[p,_]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,h,[p,b]],[/(surface duo)/i],[h,[m,k],[p,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[m,"Fairphone"],[p,_]],[/(u304aa)/i],[h,[m,"AT&T"],[p,_]],[/\bsie-(\w*)/i],[h,[m,"Siemens"],[p,_]],[/\b(rct\w+) b/i],[h,[m,"RCA"],[p,b]],[/\b(venue[\d ]{2,7}) b/i],[h,[m,"Dell"],[p,b]],[/\b(q(?:mv|ta)\w+) b/i],[h,[m,"Verizon"],[p,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[m,"Barnes & Noble"],[p,b]],[/\b(tm\d{3}\w+) b/i],[h,[m,"NuVision"],[p,b]],[/\b(k88) b/i],[h,[m,"ZTE"],[p,b]],[/\b(nx\d{3}j) b/i],[h,[m,"ZTE"],[p,_]],[/\b(gen\d{3}) b.+49h/i],[h,[m,"Swiss"],[p,_]],[/\b(zur\d{3}) b/i],[h,[m,"Swiss"],[p,b]],[/\b((zeki)?tb.*\b) b/i],[h,[m,"Zeki"],[p,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],h,[p,b]],[/\b(ns-?\w{0,9}) b/i],[h,[m,"Insignia"],[p,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[m,"NextBook"],[p,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],h,[p,_]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],h,[p,_]],[/\b(ph-1) /i],[h,[m,"Essential"],[p,_]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[m,"Envizen"],[p,b]],[/\b(trio[-\w\. ]+) b/i],[h,[m,"MachSpeed"],[p,b]],[/\btu_(1491) b/i],[h,[m,"Rotor"],[p,b]],[/(shield[\w ]+) b/i],[h,[m,"Nvidia"],[p,b]],[/(sprint) (\w+)/i],[m,h,[p,_]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[m,k],[p,_]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[m,$],[p,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[m,$],[p,_]],[/smart-tv.+(samsung)/i],[m,[p,v]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[m,D],[p,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,I],[p,v]],[/(apple) ?tv/i],[m,[h,S+" TV"],[p,v]],[/crkey/i],[[h,x+"cast"],[m,R],[p,v]],[/droid.+aft(\w)( bui|\))/i],[h,[m,T],[p,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[m,q],[p,v]],[/(bravia[\w ]+)( bui|\))/i],[h,[m,B],[p,v]],[/(mitv-\w{5}) bui/i],[h,[m,j],[p,v]],[/Hbbtv.*(technisat) (.*);/i],[m,h,[p,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,Q],[h,Q],[p,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,h,[p,g]],[/droid.+; (shield) bui/i],[h,[m,"Nvidia"],[p,g]],[/(playstation [345portablevi]+)/i],[h,[m,B],[p,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[m,k],[p,g]],[/((pebble))app/i],[m,h,[p,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[m,S],[p,w]],[/droid.+; (glass) \d/i],[h,[m,R],[p,w]],[/droid.+; (wt63?0{2,3})\)/i],[h,[m,$],[p,w]],[/(quest( 2| pro)?)/i],[h,[m,U],[p,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[p,E]],[/(aeobc)\b/i],[h,[m,T],[p,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[p,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[p,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,_]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[d,[f,G,Y]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[d,"Windows"],[f,G,Y]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,K],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,f],[/\(bb(10);/i],[f,[d,A]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[d,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[d,x+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,F],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,f],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,f]]},X=function(e,t){if(typeof e===c&&(t=e,e=a),!(this instanceof X))return new X(e,t).getResult();var n=typeof i!==o&&i.navigator?i.navigator:a,r=e||(n&&n.userAgent?n.userAgent:""),g=n&&n.userAgentData?n.userAgentData:a,v=t?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(J,t):J,w=n&&n.userAgent==r;return this.getBrowser=function(){var e,t={};return t[d]=a,t[f]=a,z.call(t,r,v.browser),t[u]=typeof(e=t[f])===l?e.replace(/[^\d\.]/g,"").split(".")[0]:a,w&&n&&n.brave&&typeof n.brave.isBrave==s&&(t[d]="Brave"),t},this.getCPU=function(){var e={};return e[y]=a,z.call(e,r,v.cpu),e},this.getDevice=function(){var e={};return e[m]=a,e[h]=a,e[p]=a,z.call(e,r,v.device),w&&!e[p]&&g&&g.mobile&&(e[p]=_),w&&"Macintosh"==e[h]&&n&&typeof n.standalone!==o&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[h]="iPad",e[p]=b),e},this.getEngine=function(){var e={};return e[d]=a,e[f]=a,z.call(e,r,v.engine),e},this.getOS=function(){var e={};return e[d]=a,e[f]=a,z.call(e,r,v.os),w&&!e[d]&&g&&"Unknown"!=g.platform&&(e[d]=g.platform.replace(/chrome os/i,F).replace(/macos/i,K)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===l&&e.length>350?Q(e,350):e,this},this.setUA(r),this};X.VERSION="1.0.35",X.BROWSER=W([d,f,u]),X.CPU=W([y]),X.DEVICE=W([h,m,p,g,_,v,b,w,E]),X.ENGINE=X.OS=W([d,f]),typeof t!==o?(e.exports&&(t=e.exports=X),t.UAParser=X):n.amdO?(r=function(){return X}.call(t,n,t,e))===a||(e.exports=r):typeof i!==o&&(i.UAParser=X);var Z=typeof i!==o&&(i.jQuery||i.Zepto);if(Z&&!Z.ua){var ee=new X;Z.ua=ee.getResult(),Z.ua.get=function(){return ee.getUA()},Z.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var n in t)Z.ua[n]=t[n]}}}("object"==typeof window?window:this)},764846:(e,t,n)=>{"use strict";var r=n(957245),i=n(897375),a=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s=/[\n\r\t]/g,o=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,c=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,u=/^[a-zA-Z]:/;function h(e){return(e||"").toString().replace(a,"")}var d=[["#","hash"],["?","query"],function(e,t){return f(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function m(e){var t,r=("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{}).location||{},i={},a=typeof(e=e||r);if("blob:"===e.protocol)i=new g(unescape(e.pathname),{});else if("string"===a)for(t in i=new g(e,{}),p)delete i[t];else if("object"===a){for(t in e)t in p||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=o.test(e.href))}return i}function f(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function y(e,t){e=(e=h(e)).replace(s,""),t=t||{};var n,r=l.exec(e),i=r[1]?r[1].toLowerCase():"",a=!!r[2],o=!!r[3],c=0;return a?o?(n=r[2]+r[3]+r[4],c=r[2].length+r[3].length):(n=r[2]+r[4],c=r[2].length):o?(n=r[3]+r[4],c=r[3].length):n=r[4],"file:"===i?c>=2&&(n=n.slice(2)):f(i)?n=r[4]:i?a&&(n=n.slice(2)):c>=2&&f(t.protocol)&&(n=r[4]),{protocol:i,slashes:a||f(i),slashesCount:c,rest:n}}function g(e,t,n){if(e=(e=h(e)).replace(s,""),!(this instanceof g))return new g(e,t,n);var a,o,c,l,p,_,b=d.slice(),v=typeof t,w=this,E=0;for("object"!==v&&"string"!==v&&(n=t,t=null),n&&"function"!=typeof n&&(n=i.parse),a=!(o=y(e||"",t=m(t))).protocol&&!o.slashes,w.slashes=o.slashes||a&&t.slashes,w.protocol=o.protocol||t.protocol||"",e=o.rest,("file:"===o.protocol&&(2!==o.slashesCount||u.test(e))||!o.slashes&&(o.protocol||o.slashesCount<2||!f(w.protocol)))&&(b[3]=[/(.*)/,"pathname"]);E<b.length;E++)"function"!=typeof(l=b[E])?(c=l[0],_=l[1],c!=c?w[_]=e:"string"==typeof c?~(p="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof l[2]?(w[_]=e.slice(0,p),e=e.slice(p+l[2])):(w[_]=e.slice(p),e=e.slice(0,p))):(p=c.exec(e))&&(w[_]=p[1],e=e.slice(0,p.index)),w[_]=w[_]||a&&l[3]&&t[_]||"",l[4]&&(w[_]=w[_].toLowerCase())):e=l(e,w);n&&(w.query=n(w.query)),a&&t.slashes&&"/"!==w.pathname.charAt(0)&&(""!==w.pathname||""!==t.pathname)&&(w.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],a=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(a=!0),n.splice(r,1),s--);return a&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(w.pathname,t.pathname)),"/"!==w.pathname.charAt(0)&&f(w.protocol)&&(w.pathname="/"+w.pathname),r(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(~(p=w.auth.indexOf(":"))?(w.username=w.auth.slice(0,p),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(p+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin="file:"!==w.protocol&&f(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}g.prototype={set:function(e,t,n){var a=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||i.parse)(t)),a[e]=t;break;case"port":a[e]=t,r(t,a.protocol)?t&&(a.host=a.hostname+":"+t):(a.host=a.hostname,a[e]="");break;case"hostname":a[e]=t,a.port&&(t+=":"+a.port),a.host=t;break;case"host":a[e]=t,c.test(t)?(t=t.split(":"),a.port=t.pop(),a.hostname=t.join(":")):(a.hostname=t,a.port="");break;case"protocol":a.protocol=t.toLowerCase(),a.slashes=!n;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";a[e]=t.charAt(0)!==s?s+t:t}else a[e]=t;break;case"username":case"password":a[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(a.username=t.slice(0,o),a.username=encodeURIComponent(decodeURIComponent(a.username)),a.password=t.slice(o+1),a.password=encodeURIComponent(decodeURIComponent(a.password))):a.username=encodeURIComponent(decodeURIComponent(t))}for(var l=0;l<d.length;l++){var u=d[l];u[4]&&(a[u[1]]=a[u[1]].toLowerCase())}return a.auth=a.password?a.username+":"+a.password:a.username,a.origin="file:"!==a.protocol&&f(a.protocol)&&a.host?a.protocol+"//"+a.host:"null",a.href=a.toString(),a},toString:function(e){e&&"function"==typeof e||(e=i.stringify);var t,n=this,r=n.host,a=n.protocol;a&&":"!==a.charAt(a.length-1)&&(a+=":");var s=a+(n.protocol&&n.slashes||f(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&f(n.protocol)&&!r&&"/"!==n.pathname&&(s+="@"),(":"===r[r.length-1]||c.test(n.hostname)&&!n.port)&&(r+=":"),s+=r+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}},g.extractProtocol=y,g.location=m,g.trimLeft=h,g.qs=i,e.exports=g},410189:(e,t,n)=>{"use strict";n.r(t),n.d(t,{NIL:()=>N,parse:()=>h,stringify:()=>s.Z,v1:()=>l,v3:()=>v,v4:()=>w.Z,v5:()=>S,validate:()=>u.Z,version:()=>A});var r,i,a=n(45302),s=n(120708),o=0,c=0;const l=function(e,t,n){var l=t&&n||0,u=t||new Array(16),h=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==d){var p=e.random||(e.rng||a.Z)();null==h&&(h=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=i=16383&(p[6]<<8|p[7]))}var m=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:c+1,y=m-o+(f-c)/1e4;if(y<0&&void 0===e.clockseq&&(d=d+1&16383),(y<0||m>o)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=m,c=f,i=d;var g=(1e4*(268435455&(m+=122192928e5))+f)%4294967296;u[l++]=g>>>24&255,u[l++]=g>>>16&255,u[l++]=g>>>8&255,u[l++]=255&g;var _=m/4294967296*1e4&268435455;u[l++]=_>>>8&255,u[l++]=255&_,u[l++]=_>>>24&15|16,u[l++]=_>>>16&255,u[l++]=d>>>8|128,u[l++]=255&d;for(var b=0;b<6;++b)u[l+b]=h[b];return t||(0,s.Z)(u)};var u=n(858495);const h=function(e){if(!(0,u.Z)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function d(e,t,n){function r(e,r,i,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=h(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+e.length);if(o.set(r),o.set(e,r.length),(o=n(o))[6]=15&o[6]|t,o[8]=63&o[8]|128,i){a=a||0;for(var c=0;c<16;++c)i[a+c]=o[c];return i}return(0,s.Z)(o)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function p(e){return 14+(e+64>>>9<<4)+1}function m(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function f(e,t,n,r,i,a){return m((s=m(m(t,e),m(r,a)))<<(o=i)|s>>>32-o,n);var s,o}function y(e,t,n,r,i,a,s){return f(t&n|~t&r,e,t,i,a,s)}function g(e,t,n,r,i,a,s){return f(t&r|n&~r,e,t,i,a,s)}function _(e,t,n,r,i,a,s){return f(t^n^r,e,t,i,a,s)}function b(e,t,n,r,i,a,s){return f(n^(t|~r),e,t,i,a,s)}const v=d("v3",48,(function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var a=e[i>>5]>>>i%32&255,s=parseInt(r.charAt(a>>>4&15)+r.charAt(15&a),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[p(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,s=0;s<e.length;s+=16){var o=n,c=r,l=i,u=a;n=y(n,r,i,a,e[s],7,-680876936),a=y(a,n,r,i,e[s+1],12,-389564586),i=y(i,a,n,r,e[s+2],17,606105819),r=y(r,i,a,n,e[s+3],22,-1044525330),n=y(n,r,i,a,e[s+4],7,-176418897),a=y(a,n,r,i,e[s+5],12,1200080426),i=y(i,a,n,r,e[s+6],17,-1473231341),r=y(r,i,a,n,e[s+7],22,-45705983),n=y(n,r,i,a,e[s+8],7,1770035416),a=y(a,n,r,i,e[s+9],12,-1958414417),i=y(i,a,n,r,e[s+10],17,-42063),r=y(r,i,a,n,e[s+11],22,-1990404162),n=y(n,r,i,a,e[s+12],7,1804603682),a=y(a,n,r,i,e[s+13],12,-40341101),i=y(i,a,n,r,e[s+14],17,-1502002290),n=g(n,r=y(r,i,a,n,e[s+15],22,1236535329),i,a,e[s+1],5,-165796510),a=g(a,n,r,i,e[s+6],9,-1069501632),i=g(i,a,n,r,e[s+11],14,643717713),r=g(r,i,a,n,e[s],20,-373897302),n=g(n,r,i,a,e[s+5],5,-701558691),a=g(a,n,r,i,e[s+10],9,38016083),i=g(i,a,n,r,e[s+15],14,-660478335),r=g(r,i,a,n,e[s+4],20,-405537848),n=g(n,r,i,a,e[s+9],5,568446438),a=g(a,n,r,i,e[s+14],9,-1019803690),i=g(i,a,n,r,e[s+3],14,-187363961),r=g(r,i,a,n,e[s+8],20,1163531501),n=g(n,r,i,a,e[s+13],5,-1444681467),a=g(a,n,r,i,e[s+2],9,-51403784),i=g(i,a,n,r,e[s+7],14,1735328473),n=_(n,r=g(r,i,a,n,e[s+12],20,-1926607734),i,a,e[s+5],4,-378558),a=_(a,n,r,i,e[s+8],11,-2022574463),i=_(i,a,n,r,e[s+11],16,1839030562),r=_(r,i,a,n,e[s+14],23,-35309556),n=_(n,r,i,a,e[s+1],4,-1530992060),a=_(a,n,r,i,e[s+4],11,1272893353),i=_(i,a,n,r,e[s+7],16,-155497632),r=_(r,i,a,n,e[s+10],23,-1094730640),n=_(n,r,i,a,e[s+13],4,681279174),a=_(a,n,r,i,e[s],11,-358537222),i=_(i,a,n,r,e[s+3],16,-722521979),r=_(r,i,a,n,e[s+6],23,76029189),n=_(n,r,i,a,e[s+9],4,-640364487),a=_(a,n,r,i,e[s+12],11,-421815835),i=_(i,a,n,r,e[s+15],16,530742520),n=b(n,r=_(r,i,a,n,e[s+2],23,-995338651),i,a,e[s],6,-198630844),a=b(a,n,r,i,e[s+7],10,1126891415),i=b(i,a,n,r,e[s+14],15,-1416354905),r=b(r,i,a,n,e[s+5],21,-57434055),n=b(n,r,i,a,e[s+12],6,1700485571),a=b(a,n,r,i,e[s+3],10,-1894986606),i=b(i,a,n,r,e[s+10],15,-1051523),r=b(r,i,a,n,e[s+1],21,-2054922799),n=b(n,r,i,a,e[s+8],6,1873313359),a=b(a,n,r,i,e[s+15],10,-30611744),i=b(i,a,n,r,e[s+6],15,-1560198380),r=b(r,i,a,n,e[s+13],21,1309151649),n=b(n,r,i,a,e[s+4],6,-145523070),a=b(a,n,r,i,e[s+11],10,-1120210379),i=b(i,a,n,r,e[s+2],15,718787259),r=b(r,i,a,n,e[s+9],21,-343485551),n=m(n,o),r=m(r,c),i=m(i,l),a=m(a,u)}return[n,r,i,a]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(p(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))}));var w=n(888767);function E(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function T(e,t){return e<<t|e>>>32-t}const S=d("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var a=e.length/4+2,s=Math.ceil(a/16),o=new Array(s),c=0;c<s;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*c+4*u]<<24|e[64*c+4*u+1]<<16|e[64*c+4*u+2]<<8|e[64*c+4*u+3];o[c]=l}o[s-1][14]=8*(e.length-1)/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<s;++h){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=o[h][p];for(var m=16;m<80;++m)d[m]=T(d[m-3]^d[m-8]^d[m-14]^d[m-16],1);for(var f=n[0],y=n[1],g=n[2],_=n[3],b=n[4],v=0;v<80;++v){var w=Math.floor(v/20),S=T(f,5)+E(w,y,g,_)+b+t[w]+d[v]>>>0;b=_,_=g,g=T(y,30)>>>0,y=f,f=S}n[0]=n[0]+f>>>0,n[1]=n[1]+y>>>0,n[2]=n[2]+g>>>0,n[3]=n[3]+_>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),N="00000000-0000-0000-0000-000000000000";const A=function(e){if(!(0,u.Z)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},45302:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>a});var i=new Uint8Array(16);function a(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}},120708:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});for(var r=n(858495),i=[],a=0;a<256;++a)i.push((a+256).toString(16).substr(1));const s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!(0,r.Z)(n))throw TypeError("Stringified UUID is invalid");return n}},888767:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(45302),i=n(120708);const a=function(e,t,n){var a=(e=e||{}).random||(e.rng||r.Z)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=a[s];return t}return(0,i.Z)(a)}},858495:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const i=function(e){return"string"==typeof e&&r.test(e)}},833196:()=>{},959085:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Dexie:()=>Kn,RangeSet:()=>Ln,default:()=>Kn,liveQuery:()=>Qn,mergeRanges:()=>qn,rangesOverlap:()=>Bn});const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,i=Object.keys,a=Array.isArray;function s(e,t){return"object"!=typeof t||i(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);const o=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function u(e,t){"function"==typeof t&&(t=t(o(e))),("undefined"==typeof Reflect?i:Reflect.ownKeys)(t).forEach((n=>{d(e,n,t[n])}))}const h=Object.defineProperty;function d(e,t,n,r){h(e,t,s(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:u.bind(null,e.prototype)}}}}const m=Object.getOwnPropertyDescriptor;function f(e,t){let n;return m(e,t)||(n=o(e))&&f(n,t)}const y=[].slice;function g(e,t,n){return y.call(e,t,n)}function _(e,t){return t(e)}function b(e){if(!e)throw new Error("Assertion Failed")}function v(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function w(e,t){return e.reduce(((e,n,r)=>{var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function E(e,t){if(l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var a=E(e,t[r]);n.push(a)}return n}var s=t.indexOf(".");if(-1!==s){var o=e[t.substr(0,s)];return void 0===o?void 0:E(o,t.substr(s+1))}}function T(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){b("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)T(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),c=t.substr(s+1);if(""===c)void 0===n?a(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var u=e[o];u&&l(e,o)||(u=e[o]={}),T(u,c,n)}}else void 0===n?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function S(e){var t={};for(var n in e)l(e,n)&&(t[n]=e[n]);return t}const N=[].concat;function A(e){return N.apply([],e)}const C="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(A([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>r[e])),x=C.map((e=>r[e]));w(C,(e=>[e,!0]));let M=null;function R(e){M="undefined"!=typeof WeakMap&&new WeakMap;const t=O(e);return M=null,t}function O(e){if(!e||"object"!=typeof e)return e;let t=M&&M.get(e);if(t)return t;if(a(e)){t=[],M&&M.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(O(e[n]))}else if(x.indexOf(e.constructor)>=0)t=e;else{const n=o(e);for(var i in t=n===Object.prototype?{}:Object.create(n),M&&M.set(e,t),e)l(e,i)&&(t[i]=O(e[i]))}return t}const{toString:I}={};function k(e){return I.call(e).slice(8,-1)}const P="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",L="symbol"==typeof P?function(e){var t;return null!=e&&(t=e[P])&&t.apply(e)}:function(){return null},D={};function q(e){var t,n,r,i;if(1===arguments.length){if(a(e))return e.slice();if(this===D&&"string"==typeof e)return[e];if(i=L(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const B="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var j="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function $(e,t){j=e,U=t}var U=()=>!0;const F=!new Error("").stack;function K(){if(F)try{throw K.arguments,new Error}catch(e){return e}return new Error}function W(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(U).map((e=>"\n"+e)).join("")):""}var V=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],H=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(V),Q={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function z(e,t){this._e=K(),this.name=e,this.message=t}function G(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,n)=>n.indexOf(e)===t)).join("\n")}function Y(e,t,n,r){this._e=K(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=G(e,t)}function J(e,t){this._e=K(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=G(e,t)}p(z).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+W(this._e,2))}},toString:function(){return this.name+": "+this.message}}),p(Y).from(z),p(J).from(z);var X=H.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const Z=z;var ee=H.reduce(((e,t)=>{var n=t+"Error";function r(e,r){this._e=K(),this.name=n,e?"string"==typeof e?(this.message=`${e}${r?"\n "+r:""}`,this.inner=r||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=Q[t]||n,this.inner=null)}return p(r).from(Z),e[t]=r,e}),{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=V.reduce(((e,t)=>(e[t+"Error"]=ee[t],e)),{}),ne=H.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e)),{});function re(){}function ie(e){return e}function ae(e,t){return null==e||e===ie?t:function(n){return t(e(n))}}function se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function oe(e,t){return e===re?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?se(r,this.onsuccess):r),i&&(this.onerror=this.onerror?se(i,this.onerror):i),void 0!==a?a:n}}function ce(e,t){return e===re?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?se(n,this.onsuccess):n),r&&(this.onerror=this.onerror?se(r,this.onerror):r)}}function le(e,t){return e===re?t:function(n){var r=e.apply(this,arguments);s(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?se(i,this.onsuccess):i),a&&(this.onerror=this.onerror?se(a,this.onerror):a),void 0===r?void 0===o?void 0:o:s(r,o)}}function ue(e,t){return e===re?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function he(e,t){return e===re?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then((function(){return t.apply(r,a)}))}return t.apply(this,arguments)}}ne.ModifyError=Y,ne.DexieError=z,ne.BulkError=J;var de={};const[pe,me,fe]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,o(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,o(t),e]})(),ye=me&&me.then,ge=pe&&pe.constructor,_e=!!fe;var be=!1,ve=fe?()=>{fe.then(Ke)}:r.setImmediate?setImmediate.bind(null,Ke):r.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{Ke(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(Ke,0)},we=function(e,t){Re.push([e,t]),Te&&(ve(),Te=!1)},Ee=!0,Te=!0,Se=[],Ne=[],Ae=null,Ce=ie,xe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{pt(e[0],e[1])}catch(e){}}))}},Me=xe,Re=[],Oe=0,Ie=[];function ke(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=re,this._lib=!1;var t=this._PSD=Me;if(j&&(this._stackHolder=K(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==de)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&qe(this,this._value))}this._state=null,this._value=null,++t.ref,De(this,e)}const Pe={get:function(){var e=Me,t=Ze;function n(n,r){var i=!e.global&&(e!==Me||t!==Ze);const a=i&&!rt();var s=new ke(((t,s)=>{je(this,new Le(ht(n,e,i,a),ht(r,e,i,a),t,s,e))}));return j&&Fe(s,this),s}return n.prototype=de,n},set:function(e){d(this,"then",e&&e.prototype===de?Pe:{get:function(){return e},set:Pe.set})}};function Le(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function De(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&We();t&&"function"==typeof t.then?De(e,((e,n)=>{t instanceof ke?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Be(e)),n&&Ve()}}),qe.bind(null,e))}catch(t){qe(e,t)}}function qe(e,t){if(Ne.push(t),null===e._state){var n=e._lib&&We();t=Ce(t),e._state=!1,e._value=t,j&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,n){try{e.apply(null,void 0)}catch(e){}}((()=>{var n=f(t,"stack");t._promise=e,d(t,"stack",{get:()=>be?n&&(n.get?n.get.apply(t):n.value):e.stack})})),function(e){Se.some((t=>t._value===e._value))||Se.push(e)}(e),Be(e),n&&Ve()}}function Be(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)je(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Oe&&(++Oe,we((()=>{0==--Oe&&He()}),[]))}function je(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Oe,we($e,[n,e,t])}else e._listeners.push(t)}function $e(e,t,n){try{Ae=t;var r,i=t._value;t._state?r=e(i):(Ne.length&&(Ne=[]),r=e(i),-1===Ne.indexOf(i)&&function(e){for(var t=Se.length;t;)if(Se[--t]._value===e._value)return void Se.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Ae=null,0==--Oe&&He(),--n.psd.ref||n.psd.finalize()}}function Ue(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,a,s=e._value;null!=s?(i=s.name||"Error",a=s.message||s,r=W(s,0)):(i=s,a=""),t.push(i+(a?": "+a:"")+r)}return j&&((r=W(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ue(e._prev,t,n)),t}function Fe(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function Ke(){We()&&Ve()}function We(){var e=Ee;return Ee=!1,Te=!1,e}function Ve(){var e,t,n;do{for(;Re.length>0;)for(e=Re,Re=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Re.length>0);Ee=!0,Te=!0}function He(){var e=Se;Se=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ie.slice(0),n=t.length;n;)t[--n]()}function Qe(e){return new ke(de,!1,e)}function ze(e,t){var n=Me;return function(){var r=We(),i=Me;try{return ot(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ot(i,!1),r&&Ve()}}}u(ke.prototype,{then:Pe,_then:function(e,t){je(this,new Le(null,null,e,t,Me))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?n(e):Qe(e))):this.then(null,(e=>e&&e.name===t?n(e):Qe(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),Qe(t))))},stack:{get:function(){if(this._stack)return this._stack;try{be=!0;var e=Ue(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{be=!1}}},timeout:function(e,t){return e<1/0?new ke(((n,r)=>{var i=setTimeout((()=>r(new ee.Timeout(t))),e);this.then(n,r).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(ke.prototype,Symbol.toStringTag,"Dexie.Promise"),xe.env=ct(),u(ke,{all:function(){var e=q.apply(null,arguments).map(it);return new ke((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(((i,a)=>ke.resolve(i).then((n=>{e[a]=n,--r||t(e)}),n)))}))},resolve:e=>{if(e instanceof ke)return e;if(e&&"function"==typeof e.then)return new ke(((t,n)=>{e.then(t,n)}));var t=new ke(de,!0,e);return Fe(t,Ae),t},reject:Qe,race:function(){var e=q.apply(null,arguments).map(it);return new ke(((t,n)=>{e.map((e=>ke.resolve(e).then(t,n)))}))},PSD:{get:()=>Me,set:e=>Me=e},totalEchoes:{get:()=>Ze},newPSD:tt,usePSD:lt,scheduler:{get:()=>we,set:e=>{we=e}},rejectionMapper:{get:()=>Ce,set:e=>{Ce=e}},follow:(e,t)=>new ke(((n,r)=>tt(((t,n)=>{var r=Me;r.unhandleds=[],r.onunhandled=n,r.finalize=se((function(){!function(e){Ie.push((function t(){e(),Ie.splice(Ie.indexOf(t),1)})),++Oe,we((()=>{0==--Oe&&He()}),[])}((()=>{0===this.unhandleds.length?t():n(this.unhandleds[0])}))}),r.finalize),e()}),t,n,r)))}),ge&&(ge.allSettled&&d(ke,"allSettled",(function(){const e=q.apply(null,arguments).map(it);return new ke((t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach(((e,i)=>ke.resolve(e).then((e=>r[i]={status:"fulfilled",value:e}),(e=>r[i]={status:"rejected",reason:e})).then((()=>--n||t(r)))))}))})),ge.any&&"undefined"!=typeof AggregateError&&d(ke,"any",(function(){const e=q.apply(null,arguments).map(it);return new ke(((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const i=new Array(r);e.forEach(((e,a)=>ke.resolve(e).then((e=>t(e)),(e=>{i[a]=e,--r||n(new AggregateError(i))}))))}))})));const Ge={awaits:0,echoes:0,id:0};var Ye=0,Je=[],Xe=0,Ze=0,et=0;function tt(e,t,n,r){var i=Me,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++et;var o=xe.env;a.env=_e?{Promise:ke,PromiseProp:{value:ke,configurable:!0,writable:!0},all:ke.all,race:ke.race,allSettled:ke.allSettled,any:ke.any,resolve:ke.resolve,reject:ke.reject,nthen:dt(o.nthen,a),gthen:dt(o.gthen,a)}:{},t&&s(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var c=lt(a,e,n,r);return 0===a.ref&&a.finalize(),c}function nt(){return Ge.id||(Ge.id=++Ye),++Ge.awaits,Ge.echoes+=100,Ge.id}function rt(){return!!Ge.awaits&&(0==--Ge.awaits&&(Ge.id=0),Ge.echoes=100*Ge.awaits,!0)}function it(e){return Ge.echoes&&e&&e.constructor===ge?(nt(),e.then((e=>(rt(),e)),(e=>(rt(),mt(e))))):e}function at(e){++Ze,Ge.echoes&&0!=--Ge.echoes||(Ge.echoes=Ge.id=0),Je.push(Me),ot(e,!0)}function st(){var e=Je[Je.length-1];Je.pop(),ot(e,!1)}function ot(e,t){var n=Me;if((t?!Ge.echoes||Xe++&&e===Me:!Xe||--Xe&&e===Me)||ut(t?at.bind(null,e):st),e!==Me&&(Me=e,n===xe&&(xe.env=ct()),_e)){var i=xe.env.Promise,a=e.env;me.then=a.nthen,i.prototype.then=a.gthen,(n.global||e.global)&&(Object.defineProperty(r,"Promise",a.PromiseProp),i.all=a.all,i.race=a.race,i.resolve=a.resolve,i.reject=a.reject,a.allSettled&&(i.allSettled=a.allSettled),a.any&&(i.any=a.any))}}function ct(){var e=r.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:me.then,gthen:e.prototype.then}:{}}function lt(e,t,n,r,i){var a=Me;try{return ot(e,!0),t(n,r,i)}finally{ot(a,!1)}}function ut(e){ye.call(pe,e)}function ht(e,t,n,r){return"function"!=typeof e?e:function(){var i=Me;n&&nt(),ot(t,!0);try{return e.apply(this,arguments)}finally{ot(i,!1),r&&ut(rt)}}}function dt(e,t){return function(n,r){return e.call(this,ht(n,t),ht(r,t))}}function pt(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var i,a={promise:t,reason:e};if(r.document&&document.createEvent?((i=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),s(i,a)):r.CustomEvent&&s(i=new CustomEvent("unhandledrejection",{detail:a}),a),i&&r.dispatchEvent&&(dispatchEvent(i),!r.PromiseRejectionEvent&&r.onunhandledrejection))try{r.onunhandledrejection(i)}catch(e){}j&&i&&!i.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+ye).indexOf("[native code]")&&(nt=rt=re);var mt=ke.reject;function ft(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Me.letThrough||e._vip)){var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>ft(e,t,n,r)))):mt(i)}return i._promise(t,((e,t)=>tt((()=>(Me.trans=i,r(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return mt(new ee.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return mt(new ee.DatabaseClosed);e.open().catch(re)}return e._state.dbReadyPromise.then((()=>ft(e,t,n,r)))}const yt=String.fromCharCode(65535),gt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",_t=[],bt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),vt=bt,wt=bt,Et=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function Tt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const St={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Nt(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=R(t))[e],t)}class At{_trans(e,t,n){const r=this._tx||Me.trans,i=this.name;function a(e,n,r){if(!r.schema[i])throw new ee.NotFound("Table "+i+" not part of transaction");return t(r.idbtrans,r)}const s=We();try{return r&&r.db===this.db?r===Me.trans?r._promise(e,a,n):tt((()=>r._promise(e,a,n)),{trans:r,transless:Me.transless||Me}):ft(this.db,e,[this.name],a)}finally{s&&Ve()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=i(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(n&&this.db._maxKey!==yt)return this.where(n.name).equals(n.keyPath.map((t=>e[t])));!n&&j&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:r}=this.schema,s=this.db._deps.indexedDB;function o(e,t){try{return 0===s.cmp(e,t)}catch(e){return!1}}const[c,l]=t.reduce((([t,n],i)=>{const s=r[i],c=e[i];return[t||s,t||!s?Tt(n,s&&s.multi?e=>{const t=E(e,i);return a(t)&&t.some((e=>o(c,e)))}:e=>o(c,E(e,i))):n]}),[null,null]);return c?this.where(c.name).equals(e[c.keyPath]).filter(l):n?this.filter(l):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const n=Object.create(e.prototype);for(var r in t)if(l(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){s(this,e)}))}add(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Nt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?ke.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{T(e,r,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||a(e))return this.where(":id").equals(e).modify(t);{const n=E(e,this.schema.primKey.keyPath);if(void 0===n)return mt(new ee.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?i(t).forEach((n=>{T(e,n,t[n])})):t(e,{value:e,primKey:n})}catch(e){}return this.where(":id").equals(n).modify(t)}}put(e,t){const{auto:n,keyPath:r}=this.schema.primKey;let i=e;return r&&n&&(i=Nt(r)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?ke.reject(e.failures[0]):e.lastResult)).then((t=>{if(r)try{T(e,r,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?ke.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:St}))).then((e=>e.numFailures?ke.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:a}=this.schema.primKey;if(a&&r)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let o=a&&n?e.map(Nt(a)):e;return this.core.mutate({trans:t,type:"add",keys:r,values:o,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new J(`${this.name}.bulkAdd(): ${e} of ${s} operations failed`,r)}))}))}bulkPut(e,t,n){const r=Array.isArray(t)?t:void 0,i=(n=n||(r?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:n,keyPath:a}=this.schema.primKey;if(a&&r)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");const s=e.length;let o=a&&n?e.map(Nt(a)):e;return this.core.mutate({trans:t,type:"put",keys:r,values:o,wantResults:i}).then((({numFailures:e,results:t,lastResult:n,failures:r})=>{if(0===e)return i?t:n;throw new J(`${this.name}.bulkPut(): ${e} of ${s} operations failed`,r)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:n,failures:r})=>{if(0===e)return n;throw new J(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,r)}))}}function Ct(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,a=new Array(i-1);--i;)a[i-1]=arguments[i];return t[n].subscribe.apply(null,a),e}if("string"==typeof n)return t[n]};n.addEventType=o;for(var r=1,s=arguments.length;r<s;++r)o(arguments[r]);return n;function o(e,r,i){if("object"==typeof e)return c(e);r||(r=ue),i||(i=re);var a={subscribers:[],fire:i,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=r(a.fire,e))},unsubscribe:function(e){a.subscribers=a.subscribers.filter((function(t){return t!==e})),a.fire=a.subscribers.reduce(r,i)}};return t[e]=n[e]=a,a}function c(e){i(e).forEach((function(t){var n=e[t];if(a(n))o(t,e[t][0],e[t][1]);else{if("asap"!==n)throw new ee.InvalidArgument("Invalid event config");var r=o(t,ie,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach((function(e){v((function(){e.apply(null,t)}))}))}))}}))}}function xt(e,t){return p(t).from({prototype:e}),t}function Mt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Rt(e,t){e.filter=Tt(e.filter,t)}function Ot(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>Tt(r(),t()):t,e.justLimit=n&&!r}function It(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function kt(e,t,n){const r=It(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Pt(e,t,n,r){const i=e.replayFilter?Tt(e.filter,e.replayFilter()):e.filter;if(e.or){const a={},s=(e,n,r)=>{if(!i||i(n,r,(e=>n.stop(e)),(e=>n.fail(e)))){var s=n.primaryKey,o=""+s;"[object ArrayBuffer]"===o&&(o=""+new Uint8Array(s)),l(a,o)||(a[o]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(s,n),Lt(kt(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Lt(kt(e,r,n),Tt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Lt(e,t,n,r){var i=ze(r?(e,t,i)=>n(r(e),t,i):n);return e.then((e=>{if(e)return e.start((()=>{var n=()=>e.continue();t&&!t(e,(e=>n=e),(t=>{e.stop(t),n=re}),(t=>{e.fail(t),n=re}))||i(e.value,e,(e=>n=e)),n()}))}))}function Dt(e,t){try{const n=qt(e),r=qt(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return n===r?0:n<r?-1:1}(Bt(e),Bt(t));case"Array":return function(e,t){const n=e.length,r=t.length,i=n<r?n:r;for(let n=0;n<i;++n){const r=Dt(e[n],t[n]);if(0!==r)return r}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function qt(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=k(e);return"ArrayBuffer"===n?"binary":n}function Bt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class jt{_read(e,t){var n=this._ctx;return n.error?n.table._trans(null,mt.bind(null,n.error)):n.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,mt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Tt(t.algorithm,e)}_iterate(e,t){return Pt(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((n=>Pt(t,e,n,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,n=t.table.core;if(Mt(t,!0))return n.count({trans:e,query:{index:It(t,n.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var r=0;return Pt(t,(()=>(++r,!1)),e,n).then((()=>r))})).then(e)}sortBy(e,t){const n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var s="next"===this._ctx.dir?1:-1;function o(e,t){var n=a(e,i),r=a(t,i);return n<r?-s:n>r?s:0}return this.toArray((function(e){return e.sort(o)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Mt(t,!0)&&t.limit>0){const{valueMapper:n}=t,r=It(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then((({result:e})=>n?e.map(n):e))}{const n=[];return Pt(t,(e=>n.push(e)),e,t.table.core).then((()=>n))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Mt(t)?Ot(t,(()=>{var t=e;return(e,n)=>0===t||(1===t?(--t,!1):(n((()=>{e.advance(t),t=0})),!1))})):Ot(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Ot(this._ctx,(()=>{var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this}until(e,t){return Rt(this._ctx,(function(n,r,i){return!e(n.value)||(r(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,n;return Rt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=Tt(t.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Mt(t,!0)&&t.limit>0)return this._read((e=>{var n=It(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Rt(this._ctx,(function(e){var t=e.primaryKey.toString(),r=l(n,t);return n[t]=!0,!r})),this}modify(e){var t=this._ctx;return this._write((n=>{var r;if("function"==typeof e)r=e;else{var a=i(e),s=a.length;r=function(t){for(var n=!1,r=0;r<s;++r){var i=a[r],o=e[i];E(t,i)!==o&&(T(t,i,o),n=!0)}return n}}const o=t.table.core,{outbound:c,extractKey:l}=o.schema.primaryKey,u=this.db._options.modifyChunkSize||200,h=[];let d=0;const p=[],m=(e,t)=>{const{failures:n,numFailures:r}=t;d+=e-r;for(let e of i(n))h.push(n[e])};return this.clone().primaryKeys().then((i=>{const a=s=>{const h=Math.min(u,i.length-s);return o.getMany({trans:n,keys:i.slice(s,s+h),cache:"immutable"}).then((d=>{const p=[],f=[],y=c?[]:null,g=[];for(let e=0;e<h;++e){const t=d[e],n={value:R(t),primKey:i[s+e]};!1!==r.call(n,n.value,n)&&(null==n.value?g.push(i[s+e]):c||0===Dt(l(t),l(n.value))?(f.push(n.value),c&&y.push(i[s+e])):(g.push(i[s+e]),p.push(n.value)))}const _=Mt(t)&&t.limit===1/0&&("function"!=typeof e||e===$t)&&{index:t.index,range:t.range};return Promise.resolve(p.length>0&&o.mutate({trans:n,type:"add",values:p}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);m(p.length,e)}))).then((()=>(f.length>0||_&&"object"==typeof e)&&o.mutate({trans:n,type:"put",keys:y,values:f,criteria:_,changeSpec:"function"!=typeof e&&e}).then((e=>m(f.length,e))))).then((()=>(g.length>0||_&&e===$t)&&o.mutate({trans:n,type:"delete",keys:g,criteria:_}).then((e=>m(g.length,e))))).then((()=>i.length>s+h&&a(s+u)))}))};return a(0).then((()=>{if(h.length>0)throw new Y("Error modifying one or more objects",h,d,p);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Mt(e)&&(e.isPrimKey&&!wt||3===t.type)?this._write((n=>{const{primaryKey:r}=e.table.core.schema,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then((t=>e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then((({failures:e,lastResult:n,results:r,numFailures:i})=>{if(i)throw new Y("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify($t)}}const $t=(e,t)=>t.value=null;function Ut(e,t){return e<t?-1:e===t?0:1}function Ft(e,t){return e>t?-1:e===t?0:1}function Kt(e,t,n){var r=e instanceof Gt?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Wt(e){return new e.Collection(e,(()=>zt(""))).limit(0)}function Vt(e,t,n,r,i,a){for(var s=Math.min(e.length,r.length),o=-1,c=0;c<s;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):o>=0?e.substr(0,o)+t[o]+n.substr(o+1):null;i(e[c],l)<0&&(o=c)}return s<r.length&&"next"===a?e+n.substr(e.length):s<e.length&&"prev"===a?e.substr(0,n.length):o<0?null:e.substr(0,o)+r[o]+n.substr(o+1)}function Ht(e,t,n,r){var i,a,s,o,c,l,u,h=n.length;if(!n.every((e=>"string"==typeof e)))return Kt(e,"String expected.");function d(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),a=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),s="next"===e?Ut:Ft;var t=n.map((function(e){return{lower:a(e),upper:i(e)}})).sort((function(e,t){return s(e.lower,t.lower)}));o=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),l=e,u="next"===e?"":r}d("next");var p=new e.Collection(e,(()=>Qt(o[0],c[h-1]+r)));p._ondirectionchange=function(e){d(e)};var m=0;return p._addAlgorithm((function(e,n,r){var i=e.key;if("string"!=typeof i)return!1;var d=a(i);if(t(d,c,m))return!0;for(var p=null,f=m;f<h;++f){var y=Vt(i,d,o[f],c[f],s,l);null===y&&null===p?m=f+1:(null===p||s(p,y)>0)&&(p=y)}return n(null!==p?function(){e.continue(p+u)}:r),!1})),p}function Qt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function zt(e){return{type:1,lower:e,upper:e}}class Gt{get Collection(){return this._ctx.table.db.Collection}between(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Wt(this):new this.Collection(this,(()=>Qt(e,t,!n,!r)))}catch(e){return Kt(this,gt)}}equals(e){return null==e?Kt(this,gt):new this.Collection(this,(()=>zt(e)))}above(e){return null==e?Kt(this,gt):new this.Collection(this,(()=>Qt(e,void 0,!0)))}aboveOrEqual(e){return null==e?Kt(this,gt):new this.Collection(this,(()=>Qt(e,void 0,!1)))}below(e){return null==e?Kt(this,gt):new this.Collection(this,(()=>Qt(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?Kt(this,gt):new this.Collection(this,(()=>Qt(void 0,e)))}startsWith(e){return"string"!=typeof e?Kt(this,"String expected."):this.between(e,e+yt,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):Ht(this,((e,t)=>0===e.indexOf(t[0])),[e],yt)}equalsIgnoreCase(e){return Ht(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=q.apply(D,arguments);return 0===e.length?Wt(this):Ht(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=q.apply(D,arguments);return 0===e.length?Wt(this):Ht(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,yt)}anyOf(){const e=q.apply(D,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return Kt(this,gt)}if(0===e.length)return Wt(this);const n=new this.Collection(this,(()=>Qt(e[0],e[e.length-1])));n._ondirectionchange=n=>{t="next"===n?this._ascending:this._descending,e.sort(t)};let r=0;return n._addAlgorithm(((n,i,a)=>{const s=n.key;for(;t(s,e[r])>0;)if(++r,r===e.length)return i(a),!1;return 0===t(s,e[r])||(i((()=>{n.continue(e[r])})),!1)})),n}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=q.apply(D,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Kt(this,gt)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const n=this._cmp,r=this._ascending,i=this._descending,a=this._min,s=this._max;if(0===e.length)return Wt(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&r(e[0],e[1])<=0)))return Kt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);const o=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let l,u=r;function h(e,t){return u(e[0],t[0])}try{l=e.reduce((function(e,t){let r=0,i=e.length;for(;r<i;++r){const i=e[r];if(n(t[0],i[1])<0&&n(t[1],i[0])>0){i[0]=a(i[0],t[0]),i[1]=s(i[1],t[1]);break}}return r===i&&e.push(t),e}),[]),l.sort(h)}catch(e){return Kt(this,gt)}let d=0;const p=c?e=>r(e,l[d][1])>0:e=>r(e,l[d][1])>=0,m=o?e=>i(e,l[d][0])>0:e=>i(e,l[d][0])>=0;let f=p;const y=new this.Collection(this,(()=>Qt(l[0][0],l[l.length-1][1],!o,!c)));return y._ondirectionchange=e=>{"next"===e?(f=p,u=r):(f=m,u=i),l.sort(h)},y._addAlgorithm(((e,t,n)=>{for(var i=e.key;f(i);)if(++d,d===l.length)return t(n),!1;return!!function(e){return!p(e)&&!m(e)}(i)||(0===this._cmp(i,l[d][1])||0===this._cmp(i,l[d][0])||t((()=>{u===r?e.continue(l[d][0]):e.continue(l[d][1])})),!1)})),y}startsWithAnyOf(){const e=q.apply(D,arguments);return e.every((e=>"string"==typeof e))?0===e.length?Wt(this):this.inAnyRange(e.map((e=>[e,e+yt]))):Kt(this,"startsWithAnyOf() only works with strings")}}function Yt(e){return ze((function(t){return Jt(t),e(t.target.error),!1}))}function Jt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const Xt=Ct(null,"storagemutated");class Zt{_lock(){return b(!Me.global),++this._reculock,1!==this._reculock||Me.global||(Me.lockOwnerFor=this),this}_unlock(){if(b(!Me.global),0==--this._reculock)for(Me.global||(Me.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lt(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Me.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,n=this.db._state.dbOpenError;if(b(!this.idbtrans),!e&&!t)switch(n&&n.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(n);case"MissingAPIError":throw new ee.MissingAPI(n.message,n);default:throw new ee.OpenFailed(n)}if(!this.active)throw new ee.TransactionInactive;return b(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ze((t=>{Jt(t),this._reject(e.error)})),e.onabort=ze((t=>{Jt(t),this.active&&this._reject(new ee.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=ze((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Xt.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,n){if("readwrite"===e&&"readwrite"!==this.mode)return mt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return mt(new ee.TransactionInactive);if(this._locked())return new ke(((r,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,n).then(r,i)},Me])}));if(n)return tt((()=>{var e=new ke(((e,n)=>{this._lock();const r=t(e,n,this);r&&r.then&&r.then(e,n)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var r=new ke(((e,n)=>{var r=t(e,n,this);r&&r.then&&r.then(e,n)}));return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const n=ke.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>n));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new ke(((e,r)=>{n.then((n=>t._waitingQueue.push(ze(e.bind(null,n)))),(e=>t._waitingQueue.push(ze(r.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];const n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r}}function en(e,t,n,r,i,a,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+tn(t)}}function tn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:w(n,(e=>[e.name,e]))}}let rn=e=>{try{return e.only([[]]),rn=()=>[[]],[[]]}catch(e){return rn=()=>yt,yt}};function an(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>E(t,e)}(e):t=>E(t,e)}function sn(e){return[].slice.call(e)}let on=0;function cn(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function ln(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:n,upper:r,lowerOpen:i,upperOpen:a}=e;return void 0===n?void 0===r?null:t.upperBound(r,!!a):void 0===r?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!a)}const{schema:i,hasGetAll:s}=function(e,t){const n=sn(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:n}=e,r=a(t),i=null==t,s={},o={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:an(t)},indexes:sn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:n,multiEntry:r,keyPath:i}=e,o={name:t,compound:a(i),keyPath:i,unique:n,multiEntry:r,extractKey:an(i)};return s[cn(i)]=o,o})),getIndexByKeyPath:e=>s[cn(e)]};return s[":id"]=o.primaryKey,null!=t&&(s[cn(t)]=o.primaryKey),o}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),o=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:n,keys:i,values:a,range:s}){return new Promise(((o,c)=>{o=ze(o);const l=e.objectStore(t),u=null==l.keyPath,h="put"===n||"add"===n;if(!h&&"delete"!==n&&"deleteRange"!==n)throw new Error("Invalid operation type: "+n);const{length:d}=i||a||{length:1};if(i&&a&&i.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===d)return o({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const m=[],f=[];let y=0;const g=e=>{++y,Jt(e)};if("deleteRange"===n){if(4===s.type)return o({numFailures:y,failures:f,results:[],lastResult:void 0});3===s.type?m.push(p=l.clear()):m.push(p=l.delete(r(s)))}else{const[e,t]=h?u?[a,i]:[a,null]:[i,null];if(h)for(let r=0;r<d;++r)m.push(p=t&&void 0!==t[r]?l[n](e[r],t[r]):l[n](e[r])),p.onerror=g;else for(let t=0;t<d;++t)m.push(p=l[n](e[t])),p.onerror=g}const _=e=>{const t=e.target.result;m.forEach(((e,t)=>null!=e.error&&(f[t]=e.error))),o({numFailures:y,failures:f,results:"delete"===n?i:m.map((e=>e.result)),lastResult:t})};p.onerror=e=>{g(e),_(e)},p.onsuccess=_}))},getMany:({trans:e,keys:n})=>new Promise(((r,i)=>{r=ze(r);const a=e.objectStore(t),s=n.length,o=new Array(s);let c,l=0,u=0;const h=e=>{const t=e.target;o[t._pos]=t.result,++u===l&&r(o)},d=Yt(i);for(let e=0;e<s;++e)null!=n[e]&&(c=a.get(n[e]),c._pos=e,c.onsuccess=h,c.onerror=d,++l);0===l&&r(o)})),get:({trans:e,key:n})=>new Promise(((r,i)=>{r=ze(r);const a=e.objectStore(t).get(n);a.onsuccess=e=>r(e.target.result),a.onerror=Yt(i)})),query:function(e){return n=>new Promise(((i,a)=>{i=ze(i);const{trans:s,values:o,limit:c,query:l}=n,u=c===1/0?void 0:c,{index:h,range:d}=l,p=s.objectStore(t),m=h.isPrimaryKey?p:p.index(h.name),f=r(d);if(0===c)return i({result:[]});if(e){const e=o?m.getAll(f,u):m.getAllKeys(f,u);e.onsuccess=e=>i({result:e.target.result}),e.onerror=Yt(a)}else{let e=0;const t=o||!("openKeyCursor"in m)?m.openCursor(f):m.openKeyCursor(f),n=[];t.onsuccess=r=>{const a=t.result;return a?(n.push(o?a.value:a.primaryKey),++e===c?i({result:n}):void a.continue()):i({result:n})},t.onerror=Yt(a)}}))}(s),openCursor:function({trans:e,values:n,query:i,reverse:a,unique:s}){return new Promise(((o,c)=>{o=ze(o);const{index:l,range:u}=i,h=e.objectStore(t),d=l.isPrimaryKey?h:h.index(l.name),p=a?s?"prevunique":"prev":s?"nextunique":"next",m=n||!("openKeyCursor"in d)?d.openCursor(r(u),p):d.openKeyCursor(r(u),p);m.onerror=Yt(c),m.onsuccess=ze((t=>{const n=m.result;if(!n)return void o(null);n.___id=++on,n.done=!1;const r=n.continue.bind(n);let i=n.continuePrimaryKey;i&&(i=i.bind(n));const a=n.advance.bind(n),s=()=>{throw new Error("Cursor not stopped")};n.trans=e,n.stop=n.continue=n.continuePrimaryKey=n.advance=()=>{throw new Error("Cursor not started")},n.fail=ze(c),n.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},n.start=e=>{const t=new Promise(((e,t)=>{e=ze(e),m.onerror=Yt(t),n.fail=t,n.stop=t=>{n.stop=n.continue=n.continuePrimaryKey=n.advance=s,e(t)}})),o=()=>{if(m.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=()=>{throw new Error("Cursor behind last entry")},n.stop()};return m.onsuccess=ze((e=>{m.onsuccess=o,o()})),n.continue=r,n.continuePrimaryKey=i,n.advance=a,o(),t},o(n)}),c)}))},count({query:e,trans:n}){const{index:i,range:a}=e;return new Promise(((e,s)=>{const o=n.objectStore(t),c=i.isPrimaryKey?o:o.index(i.name),l=r(a),u=l?c.count(l):c.count();u.onsuccess=ze((t=>e(t.target.result))),u.onerror=Yt(s)}))}}}(e))),c={};return o.forEach((e=>c[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!c[e])throw new Error(`Table '${e}' not found`);return c[e]},MIN_KEY:-1/0,MAX_KEY:rn(t),schema:i}}function un({_novip:e},t){const n=t.db,r=function(e,t,{IDBKeyRange:n,indexedDB:r},i){const a=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(ln(t,n,i),e.dbcore);return{dbcore:a}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((t=>{const n=t.name;e.core.schema.tables.some((e=>e.name===n))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function hn({_novip:e},t,n,r){n.forEach((n=>{const i=r[n];t.forEach((t=>{const r=f(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?d(t,n,{get(){return this.table(n)},set(e){h(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))}))}))}function dn({_novip:e},t){t.forEach((t=>{for(let n in t)t[n]instanceof e.Table&&delete t[n]}))}function pn(e,t){return e._cfg.version-t._cfg.version}function mn(e,t,n,r){const a=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,a);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),c=Me.transless||Me;tt((()=>{Me.trans=s,Me.transless=c,0===t?(i(a).forEach((e=>{yn(n,e,a[e].primKey,a[e].indexes)})),un(e,n),ke.follow((()=>e.on.populate.fire(s))).catch(o)):function({_novip:e},t,n,r){const a=[],s=e._versions;let o=e._dbSchema=_n(e,e.idbdb,r),c=!1;return s.filter((e=>e._cfg.version>=t)).forEach((s=>{a.push((()=>{const a=o,l=s._cfg.dbschema;bn(e,a,r),bn(e,l,r),o=e._dbSchema=l;const u=fn(a,l);u.add.forEach((e=>{yn(r,e[0],e[1].primKey,e[1].indexes)})),u.change.forEach((e=>{if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");{const t=r.objectStore(e.name);e.add.forEach((e=>gn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),gn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const h=s._cfg.contentUpgrade;if(h&&s._cfg.version>t){un(e,r),n._memoizedTables={},c=!0;let t=S(l);u.del.forEach((e=>{t[e]=a[e]})),dn(e,[e.Transaction.prototype]),hn(e,[e.Transaction.prototype],i(t),t),n.schema=t;const s=B(h);let o;s&&nt();const d=ke.follow((()=>{if(o=h(n),o&&s){var e=rt.bind(null,null);o.then(e,e)}}));return o&&"function"==typeof o.then?ke.resolve(o):d.then((()=>o))}})),a.push((t=>{c&&vt||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((n=>null==e[n]&&t.db.deleteObjectStore(n)))}(s._cfg.dbschema,t),dn(e,[e.Transaction.prototype]),hn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}))})),function e(){return a.length?ke.resolve(a.shift()(n.idbtrans)).then(e):ke.resolve()}().then((()=>{var e,t;t=r,i(e=o).forEach((n=>{t.db.objectStoreNames.contains(n)||yn(t,n,e[n].primKey,e[n].indexes)}))}))}(e,t,s,n).catch(o)}))}function fn(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const i=e[r],a=t[r];if(i){const e={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!bt)e.recreate=!0,n.change.push(e);else{const t=i.idxByName,r=a.idxByName;let s;for(s in t)r[s]||e.del.push(s);for(s in r){const n=t[s],i=r[s];n?n.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&n.change.push(e)}}else n.add.push([r,a])}return n}function yn(e,t,n,r){const i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((e=>gn(i,e))),i}function gn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function _n(e,t,n){const r={};return g(t.objectStoreNames,0).forEach((e=>{const t=n.objectStore(e);let i=t.keyPath;const a=en(tn(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),s=[];for(let e=0;e<t.indexNames.length;++e){const n=t.index(t.indexNames[e]);i=n.keyPath;var o=en(n.name,i,!!n.unique,!!n.multiEntry,!1,i&&"string"!=typeof i,!1);s.push(o)}r[e]=nn(e,a,s)})),r}function bn({_novip:e},t,n){const i=n.db.objectStoreNames;for(let r=0;r<i.length;++r){const a=i[r],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(let e=0;e<s.indexNames.length;++e){const n=s.indexNames[e],r=s.index(n).keyPath,i="string"==typeof r?r:"["+g(r).join("+")+"]";if(t[a]){const e=t[a].idxByName[i];e&&(e.name=n,delete t[a].idxByName[i],t[a].idxByName[n]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class vn{_parseStoresSpec(e,t){i(e).forEach((n=>{if(null!==e[n]){var r=e[n].split(",").map(((e,t)=>{const n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return en(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(r),0===t)})),i=r.shift();if(i.multi)throw new ee.Schema("Primary key cannot be multi-valued");r.forEach((e=>{if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")})),t[n]=nn(n,i,r)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e;const n=t._versions,r={};let a={};return n.forEach((e=>{s(r,e._cfg.storesSource),a=e._cfg.dbschema={},e._parseStoresSpec(r,a)})),t._dbSchema=a,dn(t,[t._allTables,t,t.Transaction.prototype]),hn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(a),a),t._storeNames=i(a),this}upgrade(e){return this._cfg.contentUpgrade=he(this._cfg.contentUpgrade||re,e),this}}function wn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Kn("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function En(e){return e&&"function"==typeof e.databases}function Tn(e){return tt((function(){return Me.letThrough=!0,e()}))}function Sn(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Nn(e){var t=t=>e.next(t),n=i(t),r=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(n,r):a(s)?Promise.all(s).then(n,r):n(s)}}return i(t)()}function An(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,A(i),n]}function Cn(e,t,n,r,i){return ke.resolve().then((()=>{const a=Me.transless||Me,s=e._createTransaction(t,n,e._dbSchema,r),o={trans:s,transless:a};if(r)s.idbtrans=r.idbtrans;else try{s.create(),e._state.PR1398_maxLoop=3}catch(r){return r.name===X.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Cn(e,t,n,null,i)))):mt(r)}const c=B(i);let l;c&&nt();const u=ke.follow((()=>{if(l=i.call(s,s),l)if(c){var e=rt.bind(null,null);l.then(e,e)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=Nn(l))}),o);return(l&&"function"==typeof l.then?ke.resolve(l).then((e=>s.active?e:mt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>l))).then((e=>(r&&s._resolve(),s._completion.then((()=>e))))).catch((e=>(s._reject(e),mt(e))))}))}function xn(e,t,n){const r=a(e)?e.slice():[e];for(let e=0;e<n;++e)r.push(t);return r}const Mn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,i={},a=[];function s(e,t,n){const r=cn(e),o=i[r]=i[r]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,u={...n,isVirtual:l,keyTail:t,keyLength:c,extractKey:an(e),unique:!l&&n.unique};return o.push(u),u.isPrimaryKey||a.push(u),c>1&&s(2===c?e[0]:e.slice(0,c-1),t+1,n),o.sort(((e,t)=>e.keyTail-t.keyTail)),u}const o=s(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(const e of r.indexes)s(e.keyPath,0,e);function c(t){const n=t.query.index;return n.isVirtual?{...t,query:{index:n,range:(r=t.query.range,i=n.keyTail,{type:1===r.type?2:r.type,lower:xn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:xn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var r,i}const l={...n,schema:{...r,primaryKey:o,indexes:a,getIndexByKeyPath:function(e){const t=i[cn(e)];return t&&t[0]}},count:e=>n.count(c(e)),query:e=>n.query(c(e)),openCursor(t){const{keyTail:r,isVirtual:i,keyLength:a}=t.query.index;return i?n.openCursor(c(t)).then((n=>n&&function(n){const i=Object.create(n,{continue:{value:function(i){null!=i?n.continue(xn(i,t.reverse?e.MAX_KEY:e.MIN_KEY,r)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value(t,i){n.continuePrimaryKey(xn(t,e.MAX_KEY,r),i)}},primaryKey:{get:()=>n.primaryKey},key:{get(){const e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:()=>n.value}});return i}(n))):n.openCursor(t)}};return l}}}};function Rn(e,t,n,r){return n=n||{},r=r||"",i(e).forEach((i=>{if(l(t,i)){var a=e[i],s=t[i];if("object"==typeof a&&"object"==typeof s&&a&&s){const e=k(a);e!==k(s)?n[r+i]=t[i]:"Object"===e?Rn(a,s,n,r+i+"."):a!==s&&(n[r+i]=t[i])}else a!==s&&(n[r+i]=t[i])}else n[r+i]=void 0})),i(t).forEach((i=>{l(e,i)||(n[r+i]=t[i])})),n}const On={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema,i={...n,mutate(e){const i=Me.trans,{deleting:a,creating:s,updating:o}=i.table(t).hook;switch(e.type){case"add":if(s.fire===re)break;return i._promise("readwrite",(()=>c(e)),!0);case"put":if(s.fire===re&&o.fire===re)break;return i._promise("readwrite",(()=>c(e)),!0);case"delete":if(a.fire===re)break;return i._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(a.fire===re)break;return i._promise("readwrite",(()=>function(e){return u(e.trans,e.range,1e4)}(e)),!0)}return n.mutate(e);function c(e){const t=Me.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,e,i).then((c=>{const u=i.map(((n,i)=>{const u=c[i],h={onerror:null,onsuccess:null};if("delete"===e.type)a.fire.call(h,n,u,t);else if("add"===e.type||void 0===u){const a=s.fire.call(h,n,e.values[i],t);null==n&&null!=a&&(n=a,e.keys[i]=n,r.outbound||T(e.values[i],r.keyPath,n))}else{const r=Rn(u,e.values[i]),a=o.fire.call(h,r,n,u,t);if(a){const t=e.values[i];Object.keys(a).forEach((e=>{l(t,e)?t[e]=a[e]:T(t,e,a[e])}))}}return h}));return n.mutate(e).then((({failures:t,results:n,numFailures:r,lastResult:a})=>{for(let r=0;r<i.length;++r){const a=n?n[r]:i[r],s=u[r];null==a?s.onerror&&s.onerror(t[r]):s.onsuccess&&s.onsuccess("put"===e.type&&c[r]?e.values[r]:a)}return{failures:t,results:n,numFailures:r,lastResult:a}})).catch((e=>(u.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function u(e,t,i){return n.query({trans:e,values:!1,query:{index:r,range:t},limit:i}).then((({result:n})=>c({type:"delete",keys:n,trans:e}).then((r=>r.numFailures>0?Promise.reject(r.failures[0]):n.length<i?{failures:[],numFailures:0,lastResult:void 0}:u(e,{...t,lower:n[n.length-1],lowerOpen:!0},i)))))}}};return i}})};function In(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;const r=[];for(let i=0,a=0;i<t.keys.length&&a<e.length;++i)0===Dt(t.keys[i],e[a])&&(r.push(n?R(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch(e){return null}}const kn={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:e=>{if(!e.cache)return n.getMany(e);const t=In(e.keys,e.trans._cache,"clone"===e.cache);return t?ke.resolve(t):n.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?R(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),n.mutate(e))}}})};function Pn(e){return!("from"in e)}const Ln=function(e,t){if(!this){const t=new Ln;return e&&"d"in e&&s(t,e),t}s(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function Dn(e,t,n){const r=Dt(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Pn(e))return s(e,{from:t,to:n,d:1});const i=e.l,a=e.r;if(Dt(n,e.from)<0)return i?Dn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},$n(e);if(Dt(t,e.to)>0)return a?Dn(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},$n(e);Dt(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),Dt(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;i&&!e.l&&qn(e,i),a&&o&&qn(e,a)}function qn(e,t){Pn(t)||function e(t,{from:n,to:r,l:i,r:a}){Dn(t,n,r),i&&e(t,i),a&&e(t,a)}(e,t)}function Bn(e,t){const n=jn(t);let r=n.next();if(r.done)return!1;let i=r.value;const a=jn(e);let s=a.next(i.from),o=s.value;for(;!r.done&&!s.done;){if(Dt(o.from,i.to)<=0&&Dt(o.to,i.from)>=0)return!0;Dt(i.from,o.from)<0?i=(r=n.next(o.from)).value:o=(s=a.next(i.from)).value}return!1}function jn(e){let t=Pn(e)?null:{s:0,n:e};return{next(e){const n=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&Dt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||Dt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function $n(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const t="r"===i?"l":"r",n={...e},r=e[i];e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],e[t]=n,n.d=Un(n)}e.d=Un(e)}function Un({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}u(Ln.prototype,{add(e){return qn(this,e),this},addKey(e){return Dn(this,e,e),this},addKeys(e){return e.forEach((e=>Dn(this,e,e))),this},[P](){return jn(this)}});const Fn={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new Ln(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const s=e.table(r),{schema:o}=s,{primaryKey:c}=o,{extractKey:l,outbound:u}=c,h={...s,mutate:e=>{const i=e.trans,c=i.mutatedParts||(i.mutatedParts={}),l=e=>{const n=`idb://${t}/${r}/${e}`;return c[n]||(c[n]=new Ln)},u=l(""),h=l(":dels"),{type:d}=e;let[p,m]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const f=e.trans._cache;return s.mutate(e).then((e=>{if(a(p)){"delete"!==d&&(p=e.results),u.addKeys(p);const t=In(p,f);t||"add"===d||h.addKeys(p),(t||m)&&function(e,t,n,r){t.indexes.forEach((function(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const o=e=>t.multiEntry&&a(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(n||r).forEach(((e,t)=>{const i=n&&s(n[t]),a=r&&s(r[t]);0!==Dt(i,a)&&(null!=i&&o(i),null!=a&&o(a))}))}))}(l,o,t,m)}else if(p){const e={from:p.lower,to:p.upper};h.add(e),u.add(e)}else u.add(n),h.add(n),o.indexes.forEach((e=>l(e.name).add(n)));return e}))}},d=({query:{index:t,range:n}})=>{var r,i;return[t,new Ln(null!==(r=n.lower)&&void 0!==r?r:e.MIN_KEY,null!==(i=n.upper)&&void 0!==i?i:e.MAX_KEY)]},p={get:e=>[c,new Ln(e.key)],getMany:e=>[c,(new Ln).addKeys(e.keys)],count:d,query:d,openCursor:d};return i(p).forEach((e=>{h[e]=function(i){const{subscr:a}=Me;if(a){const o=e=>{const n=`idb://${t}/${r}/${e}`;return a[n]||(a[n]=new Ln)},c=o(""),h=o(":dels"),[d,m]=p[e](i);if(o(d.name||"").add(m),!d.isPrimaryKey){if("count"!==e){const t="query"===e&&u&&i.values&&s.query({...i,values:!1});return s[e].apply(this,arguments).then((n=>{if("query"===e){if(u&&i.values)return t.then((({result:e})=>(c.addKeys(e),n)));const e=i.values?n.result.map(l):n.result;i.values?c.addKeys(e):h.addKeys(e)}else if("openCursor"===e){const e=n,t=i.values;return e&&Object.create(e,{key:{get:()=>(h.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return h.addKey(t),t}},value:{get:()=>(t&&c.addKey(e.primaryKey),e.value)}})}return n}))}h.add(n)}}return s[e].apply(this,arguments)}})),h}}}};class Kn{constructor(e,t){this._middlewares={},this.verno=0;const n=Kn.dependencies;this._options=t={addons:Kn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:r}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:re,dbReadyPromise:null,cancelOpen:re,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;i.dbReadyPromise=new ke((e=>{i.dbReadyResolve=e})),i.openCanceller=new ke(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Ct(this,"populate","blocked","versionchange","close",{ready:[he,re]}),this.on.ready.subscribe=_(this.on.ready.subscribe,(e=>(t,n)=>{Kn.vip((()=>{const r=this._state;if(r.openComplete)r.dbOpenError||ke.resolve().then(t),n&&e(t);else if(r.onReadyBeingFired)r.onReadyBeingFired.push(t),n&&e(t);else{e(t);const r=this;n||e((function e(){r.on.ready.unsubscribe(t),r.on.ready.unsubscribe(e)}))}}))})),this.Collection=(a=this,xt(jt.prototype,(function(e,t){this.db=a;let n=St,r=null;if(t)try{n=t()}catch(e){r=e}const i=e._ctx,s=i.table,o=s.hook.reading.fire;this._ctx={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:o!==ie?o:null}}))),this.Table=function(e){return xt(At.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:Ct(null,{creating:[oe,re],reading:[ae,ie],updating:[le,re],deleting:[ce,re]})}))}(this),this.Transaction=function(e){return xt(Zt.prototype,(function(t,n,r,i,a){this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Ct(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ke(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),mt(e)}))}))}(this),this.Version=function(e){return xt(vn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return xt(Gt.prototype,(function(t,n,r){this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r};const i=e._deps.indexedDB;if(!i)throw new ee.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=rn(t.IDBKeyRange),this._createTransaction=(e,t,n,r)=>new this.Transaction(e,t,n,this._options.chromeTransactionDurability,r),this._fireOnBlocked=e=>{this.on("blocked").fire(e),_t.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Mn),this.use(On),this.use(Fn),this.use(kn),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new ee.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var n=t.filter((t=>t._cfg.version===e))[0];return n||(n=new this.Version(e),t.push(n),t.sort(pn),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Me.letThrough||this._vip)?e():new ke(((e,t)=>{if(this._state.openComplete)return t(new ee.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new ee.DatabaseClosed);this.open().catch(re)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:n,name:r}){r&&this.unuse({stack:e,name:r});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==n?10:n,name:r}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>n?e.create!==n:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?mt(t.dbOpenError):e));j&&(t.openCanceller._stackHolder=K()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function a(){if(t.openCanceller!==r)throw new ee.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,o=null,c=!1;return ke.race([r,("undefined"==typeof navigator?ke.resolve():Sn()).then((()=>new ke(((r,s)=>{if(a(),!n)throw new ee.MissingAPI;const l=e.name,u=t.autoSchema?n.open(l):n.open(l,Math.round(10*e.verno));if(!u)throw new ee.MissingAPI;u.onerror=Yt(s),u.onblocked=ze(e._fireOnBlocked),u.onupgradeneeded=ze((r=>{if(o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=Jt,o.abort(),u.result.close();const e=n.deleteDatabase(l);e.onsuccess=e.onerror=ze((()=>{s(new ee.NoSuchDatabase(`Database ${l} doesnt exist`))}))}else{o.onerror=Yt(s);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;c=i<1,e._novip.idbdb=u.result,mn(e,i/10,o,s)}}),s),u.onsuccess=ze((()=>{o=null;const n=e._novip.idbdb=u.result,a=g(n.objectStoreNames);if(a.length>0)try{const r=n.transaction(1===(s=a).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=_n(0,t,n);e._storeNames=g(t.objectStoreNames,0),hn(e,[e._allTables],i(r),r)}(e,n,r):(bn(e,e._dbSchema,r),function(e,t){const n=fn(_n(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((e=>e.add.length||e.change.length)))}(e,r)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),un(e,r)}catch(e){}var s;_t.push(e),n.onversionchange=ze((n=>{t.vcFired=!0,e.on("versionchange").fire(n)})),n.onclose=ze((t=>{e.on("close").fire(t)})),c&&function({indexedDB:e,IDBKeyRange:t},n){!En(e)&&"__dbnames"!==n&&wn(e,t).put({name:n}).catch(re)}(e._deps,l),r()}),s)}))))]).then((()=>(a(),t.onReadyBeingFired=[],ke.resolve(Tn((()=>e.on.ready.fire(e.vip)))).then((function n(){if(t.onReadyBeingFired.length>0){let r=t.onReadyBeingFired.reduce(he,re);return t.onReadyBeingFired=[],ke.resolve(Tn((()=>r(e.vip)))).then(n)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((n=>{t.dbOpenError=n;try{o&&o.abort()}catch(e){}return r===t.openCanceller&&e._close(),mt(n)})).finally((()=>{t.openComplete=!0,s()}))}(this)}_close(){const e=this._state,t=_t.indexOf(this);if(t>=0&&_t.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new ke((t=>{e.dbReadyResolve=t})),e.openCanceller=new ke(((t,n)=>{e.cancelOpen=n}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new ee.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new ke(((n,r)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=ze((()=>{!function({indexedDB:e,IDBKeyRange:t},n){!En(e)&&"__dbnames"!==n&&wn(e,t).delete(n).catch(re)}(this._deps,this.name),n()})),e.onerror=Yt(r),e.onblocked=this._fireOnBlocked};if(e)throw new ee.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return i(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=An.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,n){let r=Me.trans;r&&r.db===this&&-1===e.indexOf("!")||(r=null);const i=-1!==e.indexOf("?");let a,s;e=e.replace("!","").replace("?","");try{if(s=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)a="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new ee.InvalidArgument("Invalid transaction mode: "+e);a="readwrite"}if(r){if("readonly"===r.mode&&"readwrite"===a){if(!i)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((e=>{if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,((t,n)=>{n(e)})):mt(e)}const o=Cn.bind(null,this,a,s,r,n);return r?r._promise(a,o,"lock"):Me.trans?lt(Me.transless,(()=>this._whenReady(o))):this._whenReady(o)}table(e){if(!l(this._allTables,e))throw new ee.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Wn="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class Vn{constructor(e){this._subscribe=e}subscribe(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})}[Wn](){return this}}function Hn(e,t){return i(t).forEach((n=>{qn(e[n]||(e[n]=new Ln),t[n])})),e}function Qn(e){return new Vn((t=>{const n=B(e);let r=!1,a={},s={};const o={get closed(){return r},unsubscribe:()=>{r=!0,Xt.storagemutated.unsubscribe(h)}};t.start&&t.start(o);let c=!1,l=!1;function u(){return i(s).some((e=>a[e]&&Bn(a[e],s[e])))}const h=e=>{Hn(a,e),u()&&d()},d=()=>{if(c||r)return;a={};const i={},p=function(t){n&&nt();const r=()=>tt(e,{subscr:t,trans:null}),i=Me.trans?lt(Me.transless,r):r();return n&&i.then(rt,rt),i}(i);l||(Xt("storagemutated",h),l=!0),c=!0,Promise.resolve(p).then((e=>{c=!1,r||(u()?d():(a={},s=i,t.next&&t.next(e)))}),(e=>{c=!1,t.error&&t.error(e),o.unsubscribe()}))};return d(),o}))}let zn;try{zn={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(r){zn={indexedDB:null,IDBKeyRange:null}}const Gn=Kn;function Yn(e){let t=Jn;try{Jn=!0,Xt.storagemutated.fire(e)}finally{Jn=t}}u(Gn,{...ne,delete:e=>new Gn(e,{addons:[]}).delete(),exists:e=>new Gn(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return En(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):wn(e,t).toCollection().primaryKeys()}(Gn.dependencies).then(e)}catch(e){return mt(new ee.MissingAPI)}},defineClass:()=>function(e){s(this,e)},ignoreTransaction:e=>Me.trans?lt(Me.transless,e):e(),vip:Tn,async:function(e){return function(){try{var t=Nn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:ke.resolve(t)}catch(e){return mt(e)}}},spawn:function(e,t,n){try{var r=Nn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:ke.resolve(r)}catch(e){return mt(e)}},currentTransaction:{get:()=>Me.trans||null},waitFor:function(e,t){const n=ke.resolve("function"==typeof e?Gn.ignoreTransaction(e):e).timeout(t||6e4);return Me.trans?Me.trans.waitFor(n):n},Promise:ke,debug:{get:()=>j,set:e=>{$(e,"dexie"===e?()=>!0:Et)}},derive:p,extend:s,props:u,override:_,Events:Ct,on:Xt,liveQuery:Qn,extendObservabilitySet:Hn,getByKeyPath:E,setByKeyPath:T,delByKeyPath:function(e,t){"string"==typeof t?T(e,t,void 0):"length"in t&&[].map.call(t,(function(t){T(e,t,void 0)}))},shallowClone:S,deepClone:R,getObjectDiff:Rn,cmp:Dt,asap:v,minKey:-1/0,addons:[],connections:_t,errnames:X,dependencies:zn,semVer:"3.2.2",version:"3.2.2".split(".").map((e=>parseInt(e))).reduce(((e,t,n)=>e+t/Math.pow(10,2*n)))}),Gn.maxKey=rn(Gn.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Xt("storagemutated",(e=>{if(!Jn){let t;bt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),Jn=!0,dispatchEvent(t),Jn=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{Jn||Yn(e)})));let Jn=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");Xt("storagemutated",(t=>{Jn||e.postMessage(t)})),e.onmessage=e=>{e.data&&Yn(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){Xt("storagemutated",(e=>{try{Jn||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&Yn(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&Yn(e.changedParts)}))}ke.rejectionMapper=function(e,t){if(!e||e instanceof z||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name])return e;var n=new te[e.name](t||e.message,e);return"stack"in e&&d(n,"stack",{get:function(){return this.inner.stack}}),n},$(j,Et)},571419:(e,t,n)=>{"use strict";n.d(t,{X3:()=>y});const r=(e,t)=>t.some((t=>e instanceof t));let i,a;const s=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return o.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(f(this),t),m(s.get(this))}:function(...t){return m(e.apply(f(this),t))}:function(t,...n){const r=e.call(f(this),t,...n);return c.set(r,t.sort?t.sort():[t]),m(r)}}function p(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(o.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));o.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e)}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t(m(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((t=>{t instanceof IDBCursor&&s.set(t,e)})).catch((()=>{})),u.set(t,e),t}(e);if(l.has(e))return l.get(e);const t=p(e);return t!==e&&(l.set(e,t),u.set(t,e)),t}const f=e=>u.get(e);function y(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),o=m(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(m(s.result),e.oldVersion,e.newVersion,m(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),o.then((e=>{a&&e.addEventListener("close",(()=>a())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}const g=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],b=new Map;function v(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!g.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,i?"readwrite":"readonly");let s=a.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&a.done]))[0]};return b.set(t,a),a}h=(e=>({...e,get:(t,n,r)=>v(t,n)||e.get(t,n,r),has:(t,n)=>!!v(t,n)||e.has(t,n)}))(h)},122970:(e,t,n)=>{"use strict";n.r(t),n.d(t,{__addDisposableResource:()=>P,__assign:()=>a,__asyncDelegator:()=>N,__asyncGenerator:()=>S,__asyncValues:()=>A,__await:()=>T,__awaiter:()=>m,__classPrivateFieldGet:()=>O,__classPrivateFieldIn:()=>k,__classPrivateFieldSet:()=>I,__createBinding:()=>y,__decorate:()=>o,__disposeResources:()=>D,__esDecorate:()=>l,__exportStar:()=>g,__extends:()=>i,__generator:()=>f,__importDefault:()=>R,__importStar:()=>M,__makeTemplateObject:()=>C,__metadata:()=>p,__param:()=>c,__propKey:()=>h,__read:()=>b,__rest:()=>s,__runInitializers:()=>u,__setFunctionName:()=>d,__spread:()=>v,__spreadArray:()=>E,__spreadArrays:()=>w,__values:()=>_,default:()=>q});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function o(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function l(e,t,n,r,i,a){function s(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=r.kind,l="getter"===c?"get":"setter"===c?"set":"value",u=!t&&e?r.static?e:e.prototype:null,h=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),d=!1,p=n.length-1;p>=0;p--){var m={};for(var f in r)m[f]="access"===f?{}:r[f];for(var f in r.access)m.access[f]=r.access[f];m.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");a.push(s(e||null))};var y=(0,n[p])("accessor"===c?{get:h.get,set:h.set}:h[l],m);if("accessor"===c){if(void 0===y)continue;if(null===y||"object"!=typeof y)throw new TypeError("Object expected");(o=s(y.get))&&(h.get=o),(o=s(y.set))&&(h.set=o),(o=s(y.init))&&i.unshift(o)}else(o=s(y))&&("field"===c?i.unshift(o):h[l]=o)}u&&Object.defineProperty(u,r.name,h),d=!0}function u(e,t,n){for(var r=arguments.length>2,i=0;i<t.length;i++)n=r?t[i].call(e,n):t[i].call(e);return r?n:void 0}function h(e){return"symbol"==typeof e?e:"".concat(e)}function d(e,t,n){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function m(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function o(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}c((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var y=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function g(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||y(t,e,n)}function _(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function w(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,i++)r[i]=a[s];return r}function E(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function T(e){return this instanceof T?(this.v=e,this):new T(e)}function S(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||o(e,t)}))})}function o(e,t){try{(n=i[e](t)).value instanceof T?Promise.resolve(n.value.v).then(c,l):u(a[0][2],n)}catch(e){u(a[0][3],e)}var n}function c(e){o("next",e)}function l(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}function N(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:T(e[r](t)),done:!1}:i?i(t):t}:i}}function A(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=_(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function C(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var x=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&y(t,e,n);return x(t,e),t}function R(e){return e&&e.__esModule?e:{default:e}}function O(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function I(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function P(e,t,n){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose]}if("function"!=typeof r)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var L="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function D(e){function t(t){e.error=e.hasError?new L(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var r=e.stack.pop();try{var i=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(i).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}const q={__extends:i,__assign:a,__rest:s,__decorate:o,__param:c,__metadata:p,__awaiter:m,__generator:f,__createBinding:y,__exportStar:g,__values:_,__read:b,__spread:v,__spreadArrays:w,__spreadArray:E,__await:T,__asyncGenerator:S,__asyncDelegator:N,__asyncValues:A,__makeTemplateObject:C,__importStar:M,__importDefault:R,__classPrivateFieldGet:O,__classPrivateFieldSet:I,__classPrivateFieldIn:k,__addDisposableResource:P,__disposeResources:D}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);(()=>{"use strict";(new(n(325566).WalletServiceWorker)).start()})()})();
//# sourceMappingURL=service.js.map